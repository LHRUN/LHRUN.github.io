<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="songlh">







<title>ã€ç¿»ã€‘Rendering Mechanism | LH&#39;BLOG</title>



    <link rel="icon" href="/favicon.png">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/js/frame.js"></script>
    








<script type="text/javascript">
(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "jy4barl9vt");
</script>

  <meta name="generator" content="Hexo 6.2.0"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/">
          
            <img loading="lazy" class="logo-img" src="/logo.png" alt="logo_image">
          
        </a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/">Home</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/categories/gallery/">Posts</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/tags/Translate/">Translate</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/archives/">Archive</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/about/">About</a>
              </li> 
                   
          
          
            <li class="menu-item search-btn">
              <a href="#">Search</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </div>
</div>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
                
                    <span class="post-tag">
                        <a href="/tags/Vue/">
                            Vue
                        </a>
                    </span>    
                
                    <span class="post-tag">
                        <a href="/tags/Translate/">
                            Translate
                        </a>
                    </span>    
                           
            
        </div>
        <div class="post-title">
            
            
                ã€ç¿»ã€‘Rendering Mechanism
            
            
        </div>
        <span class="post-date">
            8æœˆ 13, 2023
        </span>
    </div>
    <div class="post-img">
        
            <div class="h-line-primary"></div>
              
    </div>
</div>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.6.0/styles/base16/gruvbox-light-medium.min.css">
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<div class="post-content">
    <blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://vuejs.org/guide/extras/rendering-mechanism.html">Rendering Mechanism</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>Vue æ˜¯å¦‚ä½•å°† template è½¬æ¢ä¸ºçœŸå®çš„DOMèŠ‚ç‚¹ï¼Ÿåˆæ˜¯å¦‚ä½•é«˜æ•ˆåœ°æ›´æ–°è¿™äº›èŠ‚ç‚¹ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé€šè¿‡ç ”ç©¶Vueå†…éƒ¨çš„æ¸²æŸ“æœºåˆ¶ï¼Œæ¥è§£é‡Šè¿™äº›é—®é¢˜ã€‚</p>
<h2 id="Virtual-DOM"><a href="#Virtual-DOM" class="headerlink" title="Virtual DOM"></a>Virtual DOM</h2><p>ä½ ä¹Ÿè®¸å¬è¿‡â€è™šæ‹ŸDOMâ€è¿™ä¸ªæ¦‚å¿µï¼ŒVueçš„æ¸²æŸ“å°±æ˜¯åŸºäºå®ƒå®ç°çš„</p>
<p>è™šæ‹ŸDOMï¼ˆVDOMï¼‰æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¦‚å¿µï¼Œä»–å°†ç”¨æˆ·æ‰€éœ€çš„ç•Œé¢é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹(å¯¹è±¡ç»“æ„)ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸çœŸå®çš„DOMèŠ‚ç‚¹åŒæ­¥ã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯ç”± React é¦–åˆ›ï¼Œå¹¶è¢«Vueåœ¨å†…çš„è®¸å¤šå…¶ä»–æ¡†æ¶ä»¥ä¸åŒçš„å®ç°æ–¹å¼é‡‡ç”¨</p>
<p>è™šæ‹ŸDOMæ›´åƒæ˜¯ä¸€ç§æ¨¡å¼ï¼Œè€Œä¸æ˜¯ä¸€ç§ç‰¹å®šçš„æŠ€æœ¯ï¼Œå› æ­¤ä¸å­˜åœ¨æŸç§æ ‡å‡†çš„å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p>
<pre><code class="highlight js"><span class="keyword">const</span> vnode = &#123;
  <span class="attr">type</span>: <span class="string">&#x27;div&#x27;</span>,
  <span class="attr">props</span>: &#123;
    <span class="attr">id</span>: <span class="string">&#x27;hello&#x27;</span>
  &#125;,
  <span class="attr">children</span>: [
    <span class="comment">/* more vnodes */</span>
  ]
&#125;</code></pre>

<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œvnode æ˜¯ä¸€ä¸ªçº¯ JavaScript å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ª <code>&lt;div&gt;</code>å…ƒç´ ã€‚å®ƒåŒ…å«äº†æˆ‘ä»¬åˆ›å»ºçœŸå®DOMæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚å®ƒè¿˜åŒ…å«äº†æ›´å¤šçš„å­èŠ‚ç‚¹ï¼Œè¿™å°±ä½¿å®ƒæˆä¸ºäº†è™šæ‹ŸDOMæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p>
<p>ç„¶åä¸€ä¸ªè¿è¡Œæ—¶çš„æ¸²æŸ“å™¨(runtime renderer)éå†è¿™ä¸ªè™šæ‹ŸDOMæ ‘ï¼Œå¹¶ä½¿å…¶æ„å»ºä¸ºä¸€ä¸ªçœŸå®çš„DOMæ ‘ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºæŒ‚è½½(mount)ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªè™šæ‹ŸDOMæ ‘ï¼Œæ¸²æŸ“å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸ªæ ‘è¿›è¡Œéå†å’Œå¯¹æ¯”ï¼Œæ‰¾å‡ºä¸åŒä¹‹å¤„ã€‚ç„¶åå°†è¿™äº›ä¸åŒä¹‹å¤„çš„æ›´æ”¹åº”ç”¨åˆ°çœŸå®DOMä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º patchï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºâ€diffingâ€æˆ–è€…â€reconciliationâ€</p>
<p>è™šæ‹ŸDOMçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜ä»¥å£°æ˜çš„æ–¹å¼ï¼Œåˆ›å»ºã€æ£€æŸ¥å’Œç»„åˆæ‰€éœ€çš„ç”¨æˆ·ç•Œé¢ç»“æ„ï¼Œè€ŒçœŸå®DOMçš„æ“ä½œå°±ç•™ç»™æ¸²æŸ“å™¨å»å®ç°</p>
<h2 id="Render-Pipeline"><a href="#Render-Pipeline" class="headerlink" title="Render Pipeline"></a>Render Pipeline</h2><p>ä»é«˜å±‚æ¬¡æ¥çœ‹ï¼ŒæŒ‚è½½Vueç»„ä»¶æ—¶ä¼šå‘ç”Ÿä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ol>
<li><p><strong>Compile</strong>ï¼šVue æ¨¡ç‰ˆä¼šè¢«ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°ï¼šæ¸²æŸ“å‡½æ•°ä¼šè¿”å›è™šæ‹ŸDOMæ ‘ï¼Œè¿™ä¸€æ­¥å¯ä»¥æ˜¯åœ¨æ„å»ºä¹‹å‰å®Œæˆï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æ¸²æŸ“å™¨å³æ—¶å®Œæˆçš„ã€‚</p>
</li>
<li><p><strong>Mount</strong>ï¼šè¿è¡Œæ—¶æ¸²æŸ“å™¨ä¼šè°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œç„¶åéå†è¿”å›çš„è™šæ‹ŸDOMæ ‘ï¼Œå¹¶ä»¥æ­¤åˆ›å»ºçœŸå®DOMèŠ‚ç‚¹ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨å“åº”å¼å‰¯ä½œç”¨ä¸­æ‰§è¡Œï¼Œå› æ­¤å®ƒä¼šè·Ÿè¸ªæ‰€æœ‰ä½¿ç”¨è¿‡çš„å“åº”å¼ä¾èµ–é¡¹ã€‚</p>
</li>
<li><p><strong>Patch</strong>ï¼šå½“æŒ‚è½½æœŸé—´ä½¿ç”¨è¿‡çš„ä¾èµ–æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‰¯ä½œç”¨ä¼šé‡æ–°è¿è¡Œã€‚è¿™æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¹¶ä¸”ç»è¿‡æ›´æ–°çš„è™šæ‹ŸDOMæ ‘ã€‚ç„¶åè¿è¡Œæ—¶æ¸²æŸ“å™¨ä¼šéå†æ–°çš„DOMæ ‘ï¼Œå¹¶ä¸æ—§çš„DOMæ ‘è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶å°†å¿…è¦çš„æ›´æ–°åº”ç”¨åˆ°çœŸå®DOMä¸Šã€‚</p>
</li>
</ol>
<p><img src="https://cn.vuejs.org/assets/render-pipeline.03805016.png"></p>
<h2 id="Templates-vs-Render-Functions"><a href="#Templates-vs-Render-Functions" class="headerlink" title="Templates vs. Render Functions"></a>Templates vs. Render Functions</h2><p>Vueæ¨¡ç‰ˆä¼šè¢«ç¼–è¯‘æˆè™šæ‹ŸDOMæ¸²æŸ“å‡½æ•°ã€‚å¦å¤–Vueä¹Ÿæä¾›äº†ä¸€äº›APIå¯ä»¥è·³è¿‡æ¨¡ç‰ˆç¼–è¯‘é˜¶æ®µç›´æ¥ç¼–å†™æ¸²æŸ“å‡½æ•°ã€‚å½“ä½ åœ¨å¤„ç†é«˜åº¦åŠ¨æ€çš„é€»è¾‘æ—¶ï¼Œç›´æ¥ç¼–å†™æ¸²æŸ“å‡½æ•°æ¯”æ¨¡ç‰ˆæ›´åŠ çµæ´»ï¼Œå› ä¸ºä½ å¯ä»¥ä½¿ç”¨javascriptçš„å…¨éƒ¨åŠŸèƒ½æ¥å¤„ç† vnodes</p>
<p>é‚£ä¸ºä»€ä¹ˆVueé»˜è®¤æ¨èä½¿ç”¨æ¨¡ç‰ˆå‘¢ï¼Ÿæœ‰å‡ ä¸ªåŸå› ï¼š</p>
<ol>
<li><p>æ¨¡ç‰ˆæ›´æ¥è¿‘çœŸå®çš„HTMLã€‚è¿™æ ·å°±æ›´å®¹æ˜“çš„å¤ç”¨ç°æœ‰çš„HTMLä»£ç æ®µï¼Œå¹¶æœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼Œæ›´èƒ½æ–¹ä¾¿åœ°ä½¿ç”¨CSSæ ·å¼ï¼Œå¹¶ä¸”è®¾è®¡å¸ˆæ›´å®¹æ˜“ç†è§£å’Œä¿®æ”¹ã€‚</p>
</li>
<li><p>æ¨¡ç‰ˆçš„è¯­æ³•æ›´åŠ ç¡®å®šï¼Œå› æ­¤æ›´å®¹æ˜“è¿›è¡Œé™æ€åˆ†æã€‚è¿™å°±å¯ä»¥è®©Vueçš„æ¨¡ç‰ˆç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æœ‰æ›´å¤šçš„ä¼˜åŒ–ï¼Œä»¥æé«˜è™šæ‹ŸDOMçš„æ€§èƒ½(è¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨ä¸‹é¢è®¨è®º)ã€‚</p>
</li>
</ol>
<p>åœ¨å®è·µä¸­ï¼Œæ¨¡ç‰ˆè¶³ä»¥æ»¡è¶³åº”ç”¨ä¸­çš„å¤§å¤šç”¨ä¾‹ã€‚æ¸²æŸ“å‡½æ•°é€šå¸¸åªéœ€è¦å¤„ç†é«˜åº¦åŠ¨æ€æ¸²æŸ“é€»è¾‘çš„å¯é‡ç”¨ç»„ä»¶ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šæ¸²æŸ“å‡½æ•°çš„ä½¿ç”¨ï¼Œå¯ä»¥å» <a target="_blank" rel="noopener" href="https://vuejs.org/guide/extras/render-function.html"><strong>Render Functions &amp; JSX</strong></a> ä¸­ç»§ç»­é˜…è¯»</p>
<h2 id="Compiler-Informed-Virtual-DOM"><a href="#Compiler-Informed-Virtual-DOM" class="headerlink" title="Compiler-Informed Virtual DOM"></a>Compiler-Informed Virtual DOM</h2><p>React ä¸­çš„è™šæ‹ŸDOMå’Œå¤§å¤šæ•°è™šæ‹ŸDOMå®ç°éƒ½æ˜¯å•çº¯çš„è¿è¡Œæ—¶å®ç°ï¼šreconciliation ç®—æ³•æ— æ³•é¢„çŸ¥ä¼ å…¥çš„è™šæ‹ŸDOMæ ‘ï¼Œæ‰€ä»¥å®ƒå¿…é¡»å®Œå…¨éå†ï¼Œå¹¶å¯¹æ¯”æ¯ä¸ªvnodeçš„propsï¼Œä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å¦å¤– ï¼Œå³ä½¿DOMæ ‘çš„å…¶ä¸­ä¸€éƒ¨åˆ†ä»æœªæ”¹å˜ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ä¹Ÿä¼šä¸ºå®ƒä»¬åˆ›å»ºæ–°çš„vnodeï¼Œä»è€Œé€ æˆä¸å¿…è¦çš„å†…å­˜å‹åŠ›ã€‚è¿™ä¹Ÿæ˜¯è™šæ‹ŸDOMæœ€ä¸ºäººè¯Ÿç—…çš„åœ°æ–¹ä¹‹ä¸€ï¼šç²—æš´çš„æ›´æ–°è¿‡ç¨‹ç‰ºç‰²äº†æ•ˆç‡ï¼Œå´æ¢æ¥äº†ä»£ç çš„å£°æ˜æ€§å’Œæ­£ç¡®æ€§</p>
<p>ä½†å…¶å®ä¸å¿…å¦‚æ­¤ã€‚åœ¨Vueä¸­ï¼Œæ¡†æ¶åŒæ—¶æ§åˆ¶äº†ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬å®ç°è®¸å¤šç¼–è¯‘æ—¶çš„ä¼˜åŒ–ï¼Œåªæœ‰ç¼–è¯‘æ—¶å’Œæ¸²æŸ“æ—¶ç´§å¯†è€¦åˆæ‰èƒ½åˆ©ç”¨è¿™äº›ä¼˜åŒ–ã€‚ç¼–è¯‘å™¨å¯ä»¥é™æ€åˆ†ææ¨¡ç‰ˆï¼Œå¹¶åœ¨ç”Ÿæˆçš„ä»£ç ä¸­ç•™ä¸‹æç¤ºï¼Œè¿™æ ·è¿è¡Œæ—¶å°±å¯èƒ½é€šè¿‡è¿™äº›æç¤ºèµ°æ·å¾„ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä»ç„¶ä¿ç•™äº†ç”¨æˆ·åœ¨æŸäº›è¾¹ç•Œæƒ…å†µæƒ³è¦ä½¿ç”¨åº•å±‚æ¸²æŸ“å‡½æ•°çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å°†è¿™ç§æ··åˆå®ç°ç§°ä¸ºå¸¦ç¼–è¯‘æ—¶ä¿¡æ¯çš„è™šæ‹Ÿ DOM (Compiler-Informed Virtual DOM)</p>
<p>åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬å°†è®¨è®ºVueç¼–è¯‘å™¨ä¸ºæé«˜è™šæ‹ŸDOMè¿è¡Œæ—¶æ€§èƒ½è€Œè¿›è¡Œçš„å‡ é¡¹ä¸»è¦ä¼˜åŒ–ã€‚</p>
<h3 id="Static-Hoisting"><a href="#Static-Hoisting" class="headerlink" title="Static Hoisting"></a>Static Hoisting</h3><p>åœ¨æ¨¡ç‰ˆä¸­ç»å¸¸ä¼šå‡ºç°ä¸åŒ…å«ä»»ä½•åŠ¨æ€ç»‘å®šçš„éƒ¨åˆ†ï¼š</p>
<pre><code class="highlight js">&lt;div&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>foo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> &lt;!-- hoisted --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> &lt;!-- hoisted --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; dynamic &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
&lt;/div&gt;

<span class="comment">// ==&gt; after compile</span>

<span class="keyword">import</span> &#123; createElementVNode <span class="keyword">as</span> _createElementVNode, createCommentVNode <span class="keyword">as</span> _createCommentVNode, toDisplayString <span class="keyword">as</span> _toDisplayString, openBlock <span class="keyword">as</span> _openBlock, createElementBlock <span class="keyword">as</span> _createElementBlock &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>

<span class="keyword">const</span> _hoisted_1 = <span class="comment">/*#__PURE__*/</span><span class="title function_">_createElementVNode</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;foo&quot;</span>, -<span class="number">1</span> <span class="comment">/* HOISTED */</span>)
<span class="keyword">const</span> _hoisted_2 = <span class="comment">/*#__PURE__*/</span><span class="title function_">_createElementVNode</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;bar&quot;</span>, -<span class="number">1</span> <span class="comment">/* HOISTED */</span>)

<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">_ctx, _cache, $props, $setup, $data, $options</span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, [
    _hoisted_1,
    <span class="title function_">_createCommentVNode</span>(<span class="string">&quot; hoisted &quot;</span>),
    _hoisted_2,
    <span class="title function_">_createCommentVNode</span>(<span class="string">&quot; hoisted &quot;</span>),
    <span class="title function_">_createElementVNode</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="title function_">_toDisplayString</span>(_ctx.<span class="property">dynamic</span>), <span class="number">1</span> <span class="comment">/* TEXT */</span>)
  ]))
&#125;</code></pre>

<p><code>foo</code> å’Œ <code>bar</code>çš„<code>div</code>å…ƒç´ æ˜¯é™æ€çš„ï¼Œå› æ­¤åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶é‡æ–°åˆ›å»ºvnodeå¹¶è¿›è¡Œdiffingå¤„ç†æ˜¯æ²¡å¿…è¦çš„ã€‚Vueç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†é™æ€éƒ¨åˆ†ä»æ¸²æŸ“å‡½æ•°ä¸­ç§»å‡ºåˆ°å¤–é¢ï¼Œå¹¶åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶é‡å¤ä½¿ç”¨ç›¸åŒçš„vnodeã€‚å½“æ¸²æŸ“å™¨å‘ç°æ—§çš„vnodeå’Œæ–°çš„vnodeæ˜¯åŒä¸€ä¸ªæ—¶ï¼Œå®ƒè¿˜å¯ä»¥å®Œå…¨è·³è¿‡å®ƒä»¬çš„diffingå¤„ç†</p>
<p>æ­¤å¤–ï¼Œå¦‚æœæœ‰è¶³å¤Ÿå¤šçš„è¿ç»­é™æ€å…ƒç´ ï¼Œå®ƒä»¬å°†ç»„åˆæˆä¸€ä¸ªâ€é™æ€vnodeâ€ï¼Œå…¶ä¸­åŒ…å«è¿™äº›èŠ‚ç‚¹çš„çº¯HTMLå­—ç¬¦ä¸²ã€‚ç„¶åè¿™äº›vnodeå¯ä»¥ç›´æ¥é€šè¿‡<code>innerHTML</code>æ¥åŠ è½½ã€‚åœ¨åˆå§‹æŒ‚è½½æ—¶ï¼Œå®ƒä»¬ä¹Ÿä¼šç¼“å­˜ç›¸åº”çš„DOMèŠ‚ç‚¹ï¼Œå¦‚æœåŒä¸€å†…å®¹åœ¨åº”ç”¨çš„å…¶ä»–åœ°æ–¹é‡å¤ä½¿ç”¨åï¼Œå°±ä¼šé€šè¿‡æœ¬åœ°çš„<code>cloneNode()</code>åˆ›å»ºæ–°çš„DOMèŠ‚ç‚¹ï¼Œè¿™æ ·åšä¼šéå¸¸é«˜æ•ˆã€‚</p>
<h3 id="Patch-Flags"><a href="#Patch-Flags" class="headerlink" title="Patch Flags"></a>Patch Flags</h3><p>å¯¹äºåŠ¨æ€ç»‘å®šçš„å•ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æ—¶ä»ä¸­æ¨æ–­å‡ºå¾ˆå¤šä¿¡æ¯ï¼š</p>
<pre><code class="highlight js">&lt;!-- <span class="keyword">class</span> <span class="title class_">binding</span> only --&gt;
<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; active &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>

&lt;!-- id and value bindings only --&gt;
<span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;value&quot;</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="comment">&lt;!-- text children only --&gt;</span></span>
<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; dynamic &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">// ==&gt; after compile</span>
<span class="language-xml"></span>
<span class="language-xml">import &#123; normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock &#125; from &quot;vue&quot;</span>
<span class="language-xml"></span>
<span class="language-xml">export function render(_ctx, _cache, $props, $setup, $data, $options) &#123;</span>
<span class="language-xml">  return (_openBlock(), _createElementBlock(_Fragment, null, [</span>
<span class="language-xml">    _createElementVNode(&quot;div&quot;, &#123;</span>
<span class="language-xml">      class: _normalizeClass(&#123; active: _ctx.active &#125;)</span>
<span class="language-xml">    &#125;, null, 2 /* CLASS */),</span>
<span class="language-xml">    _createElementVNode(&quot;input&quot;, &#123;</span>
<span class="language-xml">      id: _ctx.id,</span>
<span class="language-xml">      value: _ctx.value</span>
<span class="language-xml">    &#125;, null, 8 /* PROPS */, [&quot;id&quot;, &quot;value&quot;]),</span>
<span class="language-xml">    _createElementVNode(&quot;div&quot;, null, _toDisplayString(_ctx.dynamic), 1 /* TEXT */)</span>
<span class="language-xml">  ], 64 /* STABLE_FRAGMENT */))</span>
<span class="language-xml">&#125;</span>
<span class="language-xml"></span></code></pre>

<p>åœ¨ä¸ºè¿™äº›å…ƒç´ ç”Ÿæˆæ¸²æŸ“å‡½æ•°ä»£ç æ—¶ï¼ŒVueä¼šåœ¨vnodeåˆ›å»ºè°ƒç”¨ä¸­ç›´æ¥ç¼–ç æ¯ä¸ªå…ƒç´ æ‰€éœ€çš„æ›´æ–°ç±»å‹ï¼š</p>
<pre><code class="highlight js"><span class="title function_">createElementVNode</span>(<span class="string">&quot;div&quot;</span>, &#123;
  <span class="attr">class</span>: <span class="title function_">_normalizeClass</span>(&#123; <span class="attr">active</span>: _ctx.<span class="property">active</span> &#125;)
&#125;, <span class="literal">null</span>, <span class="number">2</span> <span class="comment">/* CLASS */</span>)</code></pre>

<p>æœ€åä¸€ä¸ªå‚æ•°2æ˜¯patch flagã€‚ä¸€ä¸ªå…ƒç´ å¯ä»¥æœ‰å¤šä¸ªflagï¼Œè¿™äº›flagä¼šåˆå¹¶æˆä¸€ä¸ªæ•°å­—ã€‚ç„¶åï¼Œè¿è¡Œæ—¶æ¸²æŸ“å™¨å¯ä»¥é€šè¿‡ä½è¿ç®—æ£€æŸ¥è¿™äº›flagï¼Œç”¨äºç¡®å®šæ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›æ›´æ–°æ“ä½œï¼š</p>
<pre><code class="highlight js"><span class="keyword">if</span> (vnode.<span class="property">patchFlag</span> &amp; <span class="title class_">PatchFlags</span>.<span class="property">CLASS</span> <span class="comment">/* 2 */</span>) &#123;
  <span class="comment">// update the element&#x27;s class</span>
&#125;</code></pre>

<p>ä½è¿ç®—æ£€æŸ¥é€Ÿåº¦æå¿«ã€‚æœ‰äº†patch flagsï¼ŒVueå°±èƒ½é€šè¿‡æœ€å°‘çš„æ›´æ–°æ“ä½œæ¥æ›´æ–°å…·æœ‰åŠ¨æ€ç»‘å®šçš„å…ƒç´ </p>
<p>Vueè¿˜ä¼šç»™vnodeçš„å­èŠ‚ç‚¹ç±»å‹è¿›è¡Œç¼–ç ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹çš„æ¨¡ç‰ˆè¢«è¡¨ç¤ºä¸ºä¸€ä¸ªç‰‡æ®µã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šè¿™äº›æ ¹èŠ‚ç‚¹çš„é¡ºåºæ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ä¸ªä¿¡æ¯é€šè¿‡æ ‡è®°æä¾›ç»™è¿è¡Œæ—¶</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(_Fragment, <span class="literal">null</span>, [
    <span class="comment">/* children */</span>
  ], <span class="number">64</span> <span class="comment">/* STABLE_FRAGMENT */</span>))
&#125;
</code></pre>

<p>æ‰€ä»¥ï¼Œè¿è¡Œæ—¶å¯ä»¥å®Œå…¨è·³è¿‡æ ¹ç‰‡æ®µçš„å­åºåˆ—é¡ºåºçš„åè°ƒè¿‡ç¨‹</p>
<h3 id="Tree-Flattening"><a href="#Tree-Flattening" class="headerlink" title="Tree Flattening"></a>Tree Flattening</h3><p>å†çœ‹ä¸€ä¸‹ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ç”Ÿæˆçš„ä»£ç ï¼Œä½ ä¼šå‘ç°è¿”å›çš„è™šæ‹ŸDOMæ ‘çš„æ ¹æ˜¯é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ <code>createElementBlock()</code>è°ƒç”¨åˆ›å»ºçš„ï¼š</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(_Fragment, <span class="literal">null</span>, [
    <span class="comment">/* children */</span>
  ], <span class="number">64</span> <span class="comment">/* STABLE_FRAGMENT */</span>))
&#125;</code></pre>

<p>ä»æ¦‚å¿µä¸Šçœ‹ï¼Œâ€œblockâ€æ˜¯æ¨¡ç‰ˆä¸­å…·æœ‰ç¨³å®šå†…éƒ¨ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ•´ä¸ªæ¨¡ç‰ˆåªæœ‰ä¸€ä¸ªblockï¼Œå› ä¸ºå®ƒä¸åŒ…å«ä»»ä½•ç»“æ„æŒ‡ä»¤ï¼Œå¦‚<code>v-if</code>å’Œ<code>v-for</code></p>
<p>æ¯ä¸ªblockéƒ½ä¼šè¿½è¸ªä»»ä½•æœ‰patch flagsçš„åä»£èŠ‚ç‚¹(ä¸åªæ˜¯ç›´æ¥å­èŠ‚ç‚¹)ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight js">&lt;div&gt; &lt;!-- root block --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>         &lt;!-- not tracked --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>   &lt;!-- tracked --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>                  <span class="comment">&lt;!-- not tracked --&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; bar &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- tracked --&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
&lt;/div&gt;</code></pre>

<p>è¿™ä¸ªç»“æœæ˜¯ä¸€ä¸ªåªåŒ…å«åŠ¨æ€å­èŠ‚ç‚¹çš„æ‰å¹³åŒ–æ•°ç»„ï¼š</p>
<pre><code class="highlight js">div (block root)
- div <span class="keyword">with</span> :id binding
- div <span class="keyword">with</span> &#123;&#123; bar &#125;&#125; binding</code></pre>

<p>å½“ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“æ—¶ï¼Œå®ƒåªéœ€è¦éå†è¿™ä¸ªæ‰å¹³åŒ–çš„æ ‘è€Œä¸æ˜¯æ•´æ£µæ ‘ã€‚è¿™å°±æ‰€è°“çš„ Tree Flatteningï¼Œå®ƒå¤§å¤§å‡å°‘äº†è™šæ‹ŸDOMåè°ƒè¿‡ç¨‹ä¸­éœ€è¦éå†çš„èŠ‚ç‚¹æ•°é‡ã€‚æ¨¡ç‰ˆä¸­çš„ä»»ä½•é™æ€éƒ¨åˆ†éƒ½ä¼šé«˜æ•ˆç•¥è¿‡ã€‚</p>
<p><code>v-if</code>å’Œ<code>v-for</code>ä¼šåˆ›å»ºæ–°çš„blockèŠ‚ç‚¹ï¼š</p>
<pre><code class="highlight js">&lt;div&gt; &lt;!-- root block --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>&gt;</span> <span class="comment">&lt;!-- if block --&gt;</span></span>
<span class="language-xml">      ...</span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></code></pre>

<p>å­blockä¼šåœ¨çˆ¶blockçš„åŠ¨æ€åä»£æ•°ç»„ä¸­è¿›è¡Œè¿½è¸ªã€‚è¿™å°±ä¸ºçˆ¶blockä¿ç•™äº†ä¸€ä¸ªç¨³å®šçš„ç»“æ„ã€‚</p>
<h2 id="Impact-on-SSR-Hydration"><a href="#Impact-on-SSR-Hydration" class="headerlink" title="Impact on SSR Hydration"></a>Impact on SSR Hydration</h2><p>patch flags å’Œ tree flattening ä¹Ÿä¼šæé«˜Vueçš„ <a target="_blank" rel="noopener" href="https://vuejs.org/guide/scaling-up/ssr.html#client-hydration">SSR Hydration</a> æ€§èƒ½ï¼š</p>
<ul>
<li>å•ä¸ªå…ƒç´ çš„ hydration å¯ä»¥æ ¹æ® vnode çš„ path flag èµ°æ›´å¿«çš„æ·å¾„ã€‚</li>
<li>åªæœ‰blockèŠ‚ç‚¹å’Œå…¶åŠ¨æ€å­èŠ‚ç‚¹åœ¨è¿›è¡Œ hydration æ—¶éœ€è¦è¿›è¡Œéå†ï¼Œä»è€Œåœ¨æ¨¡æ¿çº§åˆ«å®ç°éƒ¨åˆ† hydrationã€‚</li>
</ul>

</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
                <div class="icon arrow-left"></div>
                <div class="post-link">
                    <a href="/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/">Prev</a>
                </div>
            
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/2023/08/08/%E3%80%90%E7%BF%BB%E3%80%91AI%E2%80%99s-black-swans-Unforeseen-consequences-looming/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

    <!-- <div class="post-toc">
  <div class="post-toc-wrap">
    <div class="post-toc-title">ç›®å½•</div>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-text">æ­£æ–‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Virtual-DOM"><span class="toc-text">Virtual DOM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Render-Pipeline"><span class="toc-text">Render Pipeline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Templates-vs-Render-Functions"><span class="toc-text">Templates vs. Render Functions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compiler-Informed-Virtual-DOM"><span class="toc-text">Compiler-Informed Virtual DOM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Static-Hoisting"><span class="toc-text">Static Hoisting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Patch-Flags"><span class="toc-text">Patch Flags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tree-Flattening"><span class="toc-text">Tree Flattening</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impact-on-SSR-Hydration"><span class="toc-text">Impact on SSR Hydration</span></a></li></ol></li></ol>
  </div>
</div>

<script>
  const tocLinks = document.querySelectorAll('.toc-link')
  tocLinks.forEach((el) => {
    el.setAttribute('href', `#${el.innerText}`)
  })
</script>
 -->
    
      <div class="post-comment">

     

    
        <div id="disqus_thread"></div>
        <script>
            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
            
            var disqus_config = function () {
                this.page.url = 'https://lhrun.github.io/2023/08/13/%E3%80%90%E7%BF%BB%E3%80%91Rendering-Mechanism/';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = '2023/08/13/ã€ç¿»ã€‘Rendering-Mechanism/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                this.language = 'en'
            };
            
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://lhblog-1.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>   
     
    
    

</div>
     
  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
            
            
                Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
                
        </div>
    </div>
</div>

    </div>

    
      <div class="search-popup">
    <div class="search-popup-overlay">  
    </div>
    <div class="search-popup-window" >
        <div class="search-header">
            <div class="search-input-container">
              <input autocomplete="off" autocapitalize="off" maxlength="80"
                     placeholder="Search Anything" spellcheck="false"
                     type="search" class="search-input">
            </div>
            <div class="search-close-btn">
                <div class="icon close-btn"></div>
            </div>
        </div>
        <div class="search-result-container">
        </div>
    </div>
</div>

<script>
    const searchConfig = {
        path             : "/search.xml",
        top_n_per_article: "1",
        unescape         : "false",
        trigger: "auto",
        preload: "false"
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script>
<script src="/js/search.js"></script>
    
    

  </body>
</html>
