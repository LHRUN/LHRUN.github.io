<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Reactivity in Depth">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€ç¿»ã€‘Reactivity in Depth">
<meta property="og:url" content="https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/index.html">
<meta property="og:site_name" content="Leo&#39;blog">
<meta property="og:description" content="Reactivity in Depth">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-08-18T14:02:01.000Z">
<meta property="article:modified_time" content="2023-08-19T15:09:58.925Z">
<meta property="article:author" content="leo">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="Translate">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/IMG_1444.JPG">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/IMG_1444.JPG" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/IMG_1444.JPG">
        
      
    
    <!-- title -->
    <title>ã€ç¿»ã€‘Reactivity in Depth</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "jy4barl9vt");
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/08/23/%E3%80%90%E7%BF%BB%E3%80%91Announcing-Vue-3-3/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/08/13/%E3%80%90%E7%BF%BB%E3%80%91Rendering-Mechanism/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&text=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&is_video=false&description=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ã€ç¿»ã€‘Reactivity in Depth&body=Check out this article: https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&name=ã€ç¿»ã€‘Reactivity in Depth&description=Reactivity in Depth"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&t=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">1.</span> <span class="toc-text">æ­£æ–‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-Reactivity"><span class="toc-number">1.1.</span> <span class="toc-text">What is Reactivity?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-Reactivity-Works-in-Vue"><span class="toc-number">1.2.</span> <span class="toc-text">How Reactivity Works in Vue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runtime-vs-Compile-time-Reactivity"><span class="toc-number">1.3.</span> <span class="toc-text">Runtime vs. Compile-time Reactivity</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ã€ç¿»ã€‘Reactivity in Depth
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">leo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-08-18T14:02:01.000Z" class="dt-published" itemprop="datePublished">2023-08-18</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Translate/" rel="tag">Translate</a>, <a class="p-category" href="/tags/Vue/" rel="tag">Vue</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://vuejs.org/guide/extras/reactivity-in-depth.html">Reactivity in Depth</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>Vue æœ€ä¸ä¼—ä¸åŒçš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å…¶éš¾ä»¥å¯Ÿè§‰çš„å“åº”å¼ç³»ç»Ÿã€‚Vueçš„ç»„ä»¶çŠ¶æ€éƒ½æ˜¯ç”±javascriptå¯¹è±¡ç»„æˆã€‚å½“ä½ ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œè§†å›¾å°±ä¼šæ›´æ–°ã€‚è¿™å°±ä½¿çŠ¶æ€ç®¡ç†å˜å¾—ç®€å•ç›´è§‚ï¼Œä½†å¦‚æœèƒ½äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ä¹Ÿå¯ä»¥é¿å…ä¸€äº›å¸¸è§çš„é—®é¢˜ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šæ·±å…¥æ¢è®¨Vueå“åº”å¼ç³»ç»Ÿçš„ä¸€äº›åº•å±‚ç»†èŠ‚ã€‚</p>
<h2 id="What-is-Reactivity"><a href="#What-is-Reactivity" class="headerlink" title="What is Reactivity?"></a>What is Reactivity?</h2><p>è¿‘æ¥ï¼Œè¿™ä¸ªæœ¯è¯­åœ¨ç¼–ç¨‹çš„è®¨è®ºä¸­å‡ºç°é¢‘ç‡å¾ˆé«˜ï¼Œä½†å½“äººä»¬è¯´è¿™ä¸ªè¯æ—¶æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå“åº”å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥å£°æ˜çš„æ–¹å¼å¤„ç†å˜åŒ–ã€‚ä¸€ä¸ªç»å¸¸æ‹¿æ¥å±•ç¤ºçš„ä¾‹å­å°±æ˜¯Excelè¡¨æ ¼</p>
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>è¿™é‡Œçš„å•å…ƒæ ¼A2æ˜¯é€šè¿‡å…¬å¼ A0 + A1 å®šä¹‰çš„(ä½ å¯ä»¥ç‚¹å‡»A2æŸ¥çœ‹æˆ–ç¼–è¾‘å…¬å¼)ï¼Œæ‰€ä»¥å¾—å‡ºç»“æœä¸º3ã€‚æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæ›´æ–°A0æˆ–è€…A1ï¼Œä½ ä¼šå‘ç°A2ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>å½“ç„¶javascripté€šå¸¸ä¸æ˜¯è¿™æ ·å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬ç”¨javascriptå†™ä¸€ä¸ªç›¸ä¼¼çš„é€»è¾‘ï¼š</p>
<pre><code class="highlight js"><span class="keyword">let</span> <span class="variable constant_">A0</span> = <span class="number">1</span>
<span class="keyword">let</span> <span class="variable constant_">A1</span> = <span class="number">2</span>
<span class="keyword">let</span> <span class="variable constant_">A2</span> = <span class="variable constant_">A0</span> + <span class="variable constant_">A1</span>

<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">A2</span>) <span class="comment">// 3</span>

<span class="variable constant_">A0</span> = <span class="number">2</span>
<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">A2</span>) <span class="comment">// Still 3</span></code></pre>

<p>å½“æˆ‘ä»¬æ”¹å˜A0æ—¶ï¼ŒA2ä¸ä¼šè‡ªåŠ¨æ”¹å˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œè¯¥å¦‚ä½•ç”¨javascriptå®ç°è¿™ä¸€åŠŸèƒ½å‘¢ï¼Ÿé¦–å…ˆï¼Œä¸ºäº†é‡æ–°è¿è¡Œæ›´æ–°A2çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°æ¥å°è£…å®ƒï¼š</p>
<pre><code class="highlight js"><span class="keyword">let</span> <span class="variable constant_">A2</span>

<span class="keyword">function</span> <span class="title function_">update</span>(<span class="params"></span>) &#123;
  <span class="variable constant_">A2</span> = <span class="variable constant_">A0</span> + <span class="variable constant_">A1</span>
&#125;</code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å‡ ä¸ªæœ¯è¯­ï¼š</p>
<ul>
<li>é¦–å…ˆ<code>update()</code>å‡½æ•°ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œç®€ç§°â€œeffectâ€ï¼Œå› ä¸ºå®ƒä¼šä¿®æ”¹ç¨‹åºçš„çŠ¶æ€ã€‚</li>
<li><code>A0</code>å’Œ<code>A1</code>æ˜¯ effect çš„ä¾èµ–é¡¹ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼æ˜¯ç”¨äºæ‰§è¡Œeffectã€‚å¯ä»¥è¯´ï¼Œeffectæ˜¯å…¶ä¾èµ–é¡¹çš„è®¢é˜…è€…</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé­”æ³•å‡½æ•°ï¼Œå¯ä»¥åœ¨<code>A0</code>æˆ–<code>A1</code>å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨<code>update()</code></p>
<pre><code class="highlight js"><span class="title function_">whenDepsChange</span>(update)</code></pre>

<p>è¿™ä¸ª<code>whenDepsChange()</code>å‡½æ•°æœ‰ä»¥ä¸‹ä»»åŠ¡ï¼š</p>
<ol>
<li>è¿½è¸ªå˜é‡ä½•æ—¶è¢«è¯»å–ã€‚æ¯”å¦‚ï¼Œåœ¨è®¡ç®—è¡¨è¾¾å¼<code>A0 + A1</code>æ—¶ï¼Œ<code>A0</code>å’Œ<code>A1</code>éƒ½ä¼šè¢«è¯»å–ã€‚</li>
<li>å¦‚æœä¸€ä¸ªå˜é‡åœ¨å½“å‰è¿è¡Œçš„effectä¸­è¢«è¯»å–ï¼Œåˆ™è¯¥effectå°±ä¸ºè¯¥å˜é‡çš„è®¢é˜…è€…ã€‚æ¯”å¦‚ï¼Œç”±äº<code>A0</code>å’Œ<code>A1</code>åœ¨<code>update()</code>æ‰§è¡Œæ—¶è¢«è¯»å–ï¼Œå› æ­¤<code>update()</code>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨åå°±æˆä¸ºäº†<code>A0</code>å’Œ<code>A1</code>çš„è®¢é˜…è€…</li>
<li>å½“å˜é‡å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œæ£€æµ‹ã€‚æ¯”å¦‚ï¼Œå½“<code>A0</code>è¢«ä¿®æ”¹ä¸ºä¸€ä¸ªæ–°å€¼æ—¶ï¼Œé€šçŸ¥å…¶æ‰€æœ‰è®¢é˜…äº†çš„effecté‡æ–°æ‰§è¡Œã€‚</li>
</ol>
<h2 id="How-Reactivity-Works-in-Vue"><a href="#How-Reactivity-Works-in-Vue" class="headerlink" title="How Reactivity Works in Vue"></a>How Reactivity Works in Vue</h2><p>æˆ‘ä»¬æ— æ³•åƒç¤ºä¾‹ä¸­é‚£æ ·è¿½è¸ªå±€éƒ¨å˜é‡çš„è¯»å†™ã€‚åœ¨åŸç”Ÿçš„javascriptä¸­æ²¡æœ‰è¿™æ ·çš„æœºåˆ¶ã€‚ä½†æˆ‘ä»¬å¯ä»¥åšåˆ°è¿½è¸ªå¯¹è±¡å±æ€§çš„è¯»å†™ã€‚</p>
<p>åœ¨javascriptä¸­æœ‰ä¸¤ç§æ‹¦æˆªå±æ€§è®¿é—®çš„æ–¹æ³•ï¼š<code>getter</code>&#x2F;<code>setters</code>å’Œ<code>proxies</code>ã€‚ç”±äºæµè§ˆå™¨æ”¯æŒçš„é™åˆ¶ï¼ŒVue2ä¸­åªèƒ½ä½¿ç”¨<code>getter</code>&#x2F;<code>setters</code>ã€‚åœ¨Vue3ä¸­ï¼Œ<code>proxy</code>ç”¨äºå“åº”å¼å¯¹è±¡ï¼Œ<code>getter</code>&#x2F;<code>setter</code>ç”¨äº<code>refs</code>ã€‚ä¸‹é¢æ˜¯ä¸€äº›è¯´æ˜å®ƒä»¬å¦‚ä½•å·¥ä½œçš„ä¼ªä»£ç ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;
    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;
      <span class="title function_">track</span>(target, key)
      <span class="keyword">return</span> target[key]
    &#125;,
    <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;
      target[key] = value
      <span class="title function_">trigger</span>(target, key)
    &#125;
  &#125;)
&#125;

<span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value</span>) &#123;
  <span class="keyword">const</span> refObject = &#123;
    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;
      <span class="title function_">track</span>(refObject, <span class="string">&#x27;value&#x27;</span>)
      <span class="keyword">return</span> value
    &#125;,
    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>) &#123;
      value = newValue
      <span class="title function_">trigger</span>(refObject, <span class="string">&#x27;value&#x27;</span>)
    &#125;
  &#125;
  <span class="keyword">return</span> refObject
&#125;</code></pre>

<blockquote>
<p>TIP: è¿™é‡Œå’Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¯ä¸ºäº†ä»¥æœ€ç®€å•çš„å½¢å¼è§£é‡Šæ ¸å¿ƒæ¦‚å¿µï¼Œå› æ­¤çœç•¥äº†è®¸å¤šç»†èŠ‚ï¼Œä¹Ÿå¿½ç•¥äº†è¾¹ç•Œæƒ…å†µã€‚</p>
</blockquote>
<p>ä»¥ä¸Šå°±è§£é‡Šäº†æˆ‘åœ¨åŸºç¡€éƒ¨åˆ†è®¨è®ºè¿‡çš„å“åº”å¼å¯¹è±¡çš„ä¸€äº›å±€é™æ€§ï¼š</p>
<ul>
<li>å½“ä½ å°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡çš„å±æ€§èµ‹å€¼æˆ–è§£æ„åˆ°ä¸€ä¸ªæœ¬åœ°å˜é‡æ—¶ï¼Œè¯¥å˜é‡çš„è®¿é—®å’Œèµ‹å€¼å°±ä¸æ˜¯å“åº”å¼çš„äº†ï¼Œå› ä¸ºå®ƒä¸å†è§¦å‘æºå¯¹è±¡ä¸Šçš„<code>get</code>&#x2F;<code>set</code>çš„ä»£ç†ã€‚è¯·æ³¨æ„ï¼Œè¿™ç§æ–­å¼€åªå½±å“å˜é‡ç»‘å®šï¼Œå¦‚æœå˜é‡æŒ‡å‘ä¸€ä¸ªéåŸå§‹å€¼ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡çš„æ›´æ”¹ä»æ˜¯å“åº”å¼çš„ã€‚</li>
<li>ä½¿ç”¨<code>proxy</code>è¿”å›çš„å“åº”å¼å¯¹è±¡ï¼Œè™½ç„¶ä¸åŸå§‹å¯¹è±¡æ— å¼‚ï¼Œä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>===</code> æ“ä½œç¬¦å°†å…¶å¯¹æ¯”å¼ï¼Œè¿˜æ˜¯èƒ½å¤Ÿæ¯”è¾ƒå‡ºä¸åŒ</li>
</ul>
<p>åœ¨<code>track()</code>ä¸­ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥å½“å‰æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„effectã€‚å¦‚æœæœ‰ï¼Œæˆ‘ä»¬ä¼šæŸ¥æ‰¾åˆ°ä¸€ä¸ªå­˜å‚¨æ‰€æœ‰è¿½è¸ªäº†è¯¥å±æ€§çš„è®¢é˜…çš„Setï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Setä¸­ï¼š</p>
<pre><code class="highlight js"><span class="comment">// This will be set right before an effect is about</span>
<span class="comment">// to be run. We&#x27;ll deal with this later.</span>
<span class="keyword">let</span> activeEffect

<span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>) &#123;
  <span class="keyword">if</span> (activeEffect) &#123;
    <span class="keyword">const</span> effects = <span class="title function_">getSubscribersForProperty</span>(target, key)
    effects.<span class="title function_">add</span>(activeEffect)
  &#125;
&#125;</code></pre>

<p>effectè®¢é˜…ä¼šä»¥è¿™ç§æ•°æ®ç»“æ„<code>WeakMap&lt;target, Map&lt;key, Set&lt;effect&gt;&gt;</code>å­˜å‚¨åœ¨å…¨å±€ã€‚å¦‚æœæŸä¸ªå±æ€§æ²¡æœ‰æ‰¾åˆ°effect Setï¼Œè¯´æ˜æ˜¯é¦–æ¬¡è¿½è¸ªï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªeffect Setã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯<code>getSubscribersForProperty()</code>å‡½æ•°çš„ä½œç”¨ã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬è·³è¿‡å…¶ç»†èŠ‚ã€‚</p>
<p>åœ¨<code>trigger()</code>ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥æ‰¾è¯¥å±æ€§çš„effectè®¢é˜…ã€‚ä½†è¿™æ¬¡æˆ‘ä»¬ä¼šæ‰§è¡Œå®ƒä»¬ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;
  <span class="keyword">const</span> effects = <span class="title function_">getSubscribersForProperty</span>(target, key)
  effects.<span class="title function_">forEach</span>(<span class="function">(<span class="params">effect</span>) =&gt;</span> <span class="title function_">effect</span>())
&#125;</code></pre>

<p>ç°åœ¨æˆ‘ä»¬å›åˆ°<code>whenDepsChange()</code>å‡½æ•°ä¸­ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">whenDepsChange</span>(<span class="params">update</span>) &#123;
  <span class="keyword">const</span> <span class="title function_">effect</span> = (<span class="params"></span>) =&gt; &#123;
    activeEffect = effect
    <span class="title function_">update</span>()
    activeEffect = <span class="literal">null</span>
  &#125;
  <span class="title function_">effect</span>()
&#125;</code></pre>

<p>å®ƒæŠŠåŸå§‹çš„<code>update</code>å‡½æ•°å°è£…åœ¨ä¸€ä¸ªeffectä¸­ï¼Œç„¶åè¯¥effectä¼šåœ¨å®é™…æ›´æ–°ä¹‹å‰å°†è‡ªå·±è®¾ç½®ä¸ºactiveEffectã€‚è¿™æ ·å°±èƒ½åœ¨æ›´æ–°è¿‡ç¨‹ä¸­è°ƒç”¨<code>track()</code>æ¥å®šä½å½“å‰çš„active effectã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨è¿½è¸ªå…¶ä¾èµ–å…³ç³»çš„effectï¼Œå¹¶åœ¨ä¾èµ–å…³ç³»å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è¿è¡Œã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºå“åº”å¼å‰¯ä½œç”¨ã€‚</p>
<p>Vueæä¾›ä¸€ä¸ªå¯ä»¥åˆ›å»ºå“åº”å¼å‰¯ä½œç”¨çš„APIï¼š<code>watchEffect()</code>ã€‚äº‹å®ä¸Šï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°å®ƒçš„å·¥ä½œåŸç†ä¸ç¤ºä¾‹ä¸­çš„<code>whenDepsChange()</code>éå¸¸ç›¸ä¼¼ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®é™…çš„Vue APIè¿è¡Œæœ€åˆçš„ç¤ºä¾‹ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> <span class="variable constant_">A0</span> = <span class="title function_">ref</span>(<span class="number">0</span>)
<span class="keyword">const</span> <span class="variable constant_">A1</span> = <span class="title function_">ref</span>(<span class="number">1</span>)
<span class="keyword">const</span> <span class="variable constant_">A2</span> = <span class="title function_">ref</span>()

<span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;
  <span class="comment">// tracks A0 and A1</span>
  <span class="variable constant_">A2</span>.<span class="property">value</span> = <span class="variable constant_">A0</span>.<span class="property">value</span> + <span class="variable constant_">A1</span>.<span class="property">value</span>
&#125;)

<span class="comment">// triggers the effect</span>
<span class="variable constant_">A0</span>.<span class="property">value</span> = <span class="number">2</span></code></pre>

<p>ä½¿ç”¨å“åº”å¼å‰¯ä½œç”¨æ¥æ”¹å˜refå¹¶ä¸æ˜¯æœ€æœ‰è¶£çš„ç”¨ä¾‹ï¼Œäº‹å®ä¸Šï¼Œä½¿ç”¨è®¡ç®—å±æ€§ä¼šä½¿å®ƒæ›´å…·æœ‰å£°æ˜æ€§ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> <span class="variable constant_">A0</span> = <span class="title function_">ref</span>(<span class="number">0</span>)
<span class="keyword">const</span> <span class="variable constant_">A1</span> = <span class="title function_">ref</span>(<span class="number">1</span>)
<span class="keyword">const</span> <span class="variable constant_">A2</span> = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="variable constant_">A0</span>.<span class="property">value</span> + <span class="variable constant_">A1</span>.<span class="property">value</span>)

<span class="variable constant_">A0</span>.<span class="property">value</span> = <span class="number">2</span></code></pre>

<p>åœ¨å†…éƒ¨ï¼Œcomputedä¼šé€šè¿‡å“åº”å¼å‰¯ä½œç”¨æ¥ç®¡ç†å¤±æ•ˆå’Œé‡æ–°è®¡ç®—çš„è¿‡ç¨‹ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ€æœ‰ç”¨ä¸”å¸¸è§çš„å“åº”å¼ç¤ºä¾‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯æ›´æ–°DOMï¼æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ªç®€å•çš„å“åº”å¼æ¸²æŸ“ä¾‹å­ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)

<span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;
  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = <span class="string">`count is: <span class="subst">$&#123;count.value&#125;</span>`</span>
&#125;)

<span class="comment">// updates the DOM</span>
count.<span class="property">value</span>++</code></pre>

<p>äº‹å®ä¸Šï¼Œè¿™ä¸Vueä¿æŒçŠ¶æ€å’ŒDOMåŒæ­¥çš„æ–¹å¼éå¸¸æ¥è¿‘ï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå“åº”å¼å‰¯ä½œç”¨æ¥æ¸²æŸ“å’Œæ›´æ–°DOMã€‚å½“ç„¶Vueç»„ä»¶ä½¿ç”¨äº†æ¯”innerHTMLæ›´é«˜æ•ˆçš„æ–¹å¼æ¥æ›´æ–°DOMã€‚è¿™ä¼šåœ¨æ¸²æŸ“æœºåˆ¶ä¸€èŠ‚ä¸­è®¨è®ºã€‚</p>
<h2 id="Runtime-vs-Compile-time-Reactivity"><a href="#Runtime-vs-Compile-time-Reactivity" class="headerlink" title="Runtime vs. Compile-time Reactivity"></a>Runtime vs. Compile-time Reactivity</h2><p>Vueçš„å“åº”å¼ç³»ç»Ÿä¸»è¦åŸºäºè¿è¡Œæ—¶ï¼šè·Ÿè¸ªå’Œè§¦å‘éƒ½æ˜¯ä»£ç ç›´æ¥åœ¨æµè§ˆå™¨è¿è¡Œæ—¶è¿›è¡Œçš„ã€‚è¿è¡Œæ—¶çš„ä¼˜ç‚¹æ˜¯æ— éœ€æ„å»ºæ­¥éª¤å³å¯è¿è¡Œï¼Œè€Œä¸”è¾¹ç•Œæƒ…å†µè¾ƒå°‘ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¹Ÿä½¿å®ƒå—åˆ°javascriptè¯­æ³•çš„åˆ¶çº¦ï¼Œå¯¼è‡´éœ€è¦ refsè¿™æ ·çš„å€¼å®¹å™¨</p>
<p>åƒä¸€äº›æ¡†æ¶ï¼Œå¦‚Svelteï¼Œé€‰æ‹©åœ¨ç¼–è¯‘é˜¶æ®µå®ç°å“åº”å¼æ¥å…‹æœè¿™äº›é™åˆ¶ï¼Œå®ƒé€šè¿‡åˆ†æå’Œè½¬æ¢ä»£ç æ¥æ¨¡æ‹Ÿå“åº”å¼ã€‚ç¼–è¯‘é˜¶æ®µå…è®¸æ¡†æ¶æ”¹å˜javascriptæœ¬èº«çš„è¯­ä¹‰ï¼Œæ¯”å¦‚ï¼Œéšå¼æ³¨å…¥ä»£ç æ¥æ‰§è¡Œä¾èµ–æ€§åˆ†æï¼Œå¹¶åœ¨è®¿é—®æœ¬åœ°å®šä¹‰çš„å˜é‡æ—¶è§¦å‘ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ï¼Œè¿™ç§è½¬æ¢éœ€è¦ä¸€ä¸ªæ„å»ºæ­¥éª¤ï¼Œè€Œæ”¹å˜javascriptè¯­ä¹‰æœ¬è´¨ä¸Šå°±æ˜¯åˆ›é€ ä¸€ç§çœ‹èµ·æ¥åƒjavascriptä½†ç¼–è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„è¯­è¨€ã€‚</p>
<p>Vueå›¢é˜Ÿæ›¾é€šè¿‡äº†ä¸€é¡¹åä¸º <a target="_blank" rel="noopener" href="https://vuejs.org/guide/extras/reactivity-transform.html">Reactivity Transform</a> çš„å®éªŒæ€§åŠŸèƒ½æ¢ç´¢è¿‡è¿™ä¸ªæ–¹å‘ï¼Œä½†æˆ‘ä»¬æœ€åè¿˜æ˜¯å› ä¸º<a target="_blank" rel="noopener" href="https://github.com/vuejs/rfcs/discussions/369#discussioncomment-5059028">è¿™ä¸ªåŸå› </a>ï¼Œè®¤ä¸ºä»–ä¸é€‚åˆè¿™ä¸ªé¡¹ç›®ã€‚</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">1.</span> <span class="toc-text">æ­£æ–‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-Reactivity"><span class="toc-number">1.1.</span> <span class="toc-text">What is Reactivity?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-Reactivity-Works-in-Vue"><span class="toc-number">1.2.</span> <span class="toc-text">How Reactivity Works in Vue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runtime-vs-Compile-time-Reactivity"><span class="toc-number">1.3.</span> <span class="toc-text">Runtime vs. Compile-time Reactivity</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&text=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&is_video=false&description=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ã€ç¿»ã€‘Reactivity in Depth&body=Check out this article: https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&title=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&name=ã€ç¿»ã€‘Reactivity in Depth&description=Reactivity in Depth"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lhrun.github.io/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/&t=ã€ç¿»ã€‘Reactivity in Depth"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2024
    leo
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'LHS';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
