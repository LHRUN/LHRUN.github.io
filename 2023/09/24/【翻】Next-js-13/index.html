<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Next.js 13">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€ç¿»ã€‘Next.js 13">
<meta property="og:url" content="https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/index.html">
<meta property="og:site_name" content="Leo&#39;blog">
<meta property="og:description" content="Next.js 13">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://nextjs.org/_next/image?url=/static/blog/layouts-rfc/app-folder.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6">
<meta property="og:image" content="https://nextjs.org/_next/image?url=/static/blog/next-13/colocating-assets-in-the-app-directory.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6">
<meta property="og:image" content="https://nextjs.org/_next/image?url=/static/blog/next-13/streaming.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6">
<meta property="og:image" content="https://nextjs.org/_next/image?url=/static/blog/next-13/streaming.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6">
<meta property="og:image" content="https://nextjs.org/_next/image?url=/static/blog/next-13/turbopack.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6">
<meta property="article:published_time" content="2023-09-24T09:57:32.000Z">
<meta property="article:modified_time" content="2023-09-25T14:34:00.498Z">
<meta property="article:author" content="leo">
<meta property="article:tag" content="Next.js">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Translate">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://nextjs.org/_next/image?url=/static/blog/layouts-rfc/app-folder.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6">
    
    
      
        
          <link rel="shortcut icon" href="/images/IMG_1444.JPG">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/IMG_1444.JPG" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/IMG_1444.JPG">
        
      
    
    <!-- title -->
    <title>ã€ç¿»ã€‘Next.js 13</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "jy4barl9vt");
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/11/28/Explore-Full-Stack-Magic/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/08/31/%E3%80%90%E7%BF%BB%E3%80%91Render-Functions-JSX/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&text=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&is_video=false&description=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ã€ç¿»ã€‘Next.js 13&body=Check out this article: https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&name=ã€ç¿»ã€‘Next.js 13&description=Next.js 13"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&t=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">1.</span> <span class="toc-text">æ­£æ–‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#New-app-Directory-Beta"><span class="toc-number">1.1.</span> <span class="toc-text">New app Directory(Beta)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Layouts"><span class="toc-number">1.1.1.</span> <span class="toc-text">Layouts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Components"><span class="toc-number">1.1.2.</span> <span class="toc-text">Server Components</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Streaming"><span class="toc-number">1.1.3.</span> <span class="toc-text">Streaming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Fetching"><span class="toc-number">1.1.4.</span> <span class="toc-text">Data Fetching</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Introducing-Turbopack-Alpha"><span class="toc-number">1.2.</span> <span class="toc-text">Introducing Turbopack (Alpha)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#next-x2F-image"><span class="toc-number">1.3.</span> <span class="toc-text">next&#x2F;image</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Upgrading-next-x2F-image-to-Next-js-13"><span class="toc-number">1.3.1.</span> <span class="toc-text">Upgrading next&#x2F;image to Next.js 13</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#next-x2F-font"><span class="toc-number">1.4.</span> <span class="toc-text">@next&#x2F;font</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#next-x2F-link"><span class="toc-number">1.5.</span> <span class="toc-text">next&#x2F;link</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Upgrading-next-x2F-link-to-Next-js-13"><span class="toc-number">1.5.1.</span> <span class="toc-text">Upgrading next&#x2F;link to Next.js 13</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OG-Image-Generation"><span class="toc-number">1.6.</span> <span class="toc-text">OG Image Generation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Middleware-API-Updates"><span class="toc-number">1.7.</span> <span class="toc-text">Middleware API Updates</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ã€ç¿»ã€‘Next.js 13
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">leo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-09-24T09:57:32.000Z" class="dt-published" itemprop="datePublished">2023-09-24</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Next-js/" rel="tag">Next.js</a>, <a class="p-category" href="/tags/React/" rel="tag">React</a>, <a class="p-category" href="/tags/Translate/" rel="tag">Translate</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://nextjs.org/blog/next-13">Next.js 13</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>æ­£å¦‚æˆ‘ä»¬åœ¨ <a href="">Next.js Conf</a> ä¸Šå®£å¸ƒçš„é‚£æ ·ï¼ŒNext.js13(stable)ä¸ºå®ç°æ— é™åˆ¶çš„åŠ¨æ€åŠŸèƒ½è€Œå¥ å®šäº†åŸºç¡€ï¼š</p>
<ul>
<li>app Directory(beta): æ›´ç®€å•ï¼Œæ›´å¿«é€Ÿï¼Œå®¢æˆ·ç«¯ JS å†…å®¹æ›´å°‘<ul>
<li>Layouts</li>
<li>React Server Components</li>
<li>Streaming</li>
</ul>
</li>
<li>Turbopack(alpha): åŸºäº Rust çš„ Webpack æ›¿ä»£å“å¯æœ€é«˜æå‡700å€çš„é€Ÿåº¦ã€‚</li>
<li>New next&#x2F;image: ä½¿ç”¨æœ¬åœ°æµè§ˆå™¨æ‡’åŠ è½½ï¼Œé€Ÿåº¦æ›´å¿«ã€‚</li>
<li>New @next&#x2F;font(beta): è‡ªåŠ¨æ‰˜ç®¡å­—ä½“ï¼Œå¸ƒå±€é›¶åç§»ã€‚</li>
<li>Improved next&#x2F;link: è‡ªåŠ¨<code>&lt;a&gt;</code>é“¾æ¥ï¼Œç®€åŒ–APIã€‚</li>
</ul>
<p>Next.js å’Œ page directory å·²ç¨³å®šå¹¶å¯ç”¨äºç”Ÿäº§ã€‚è¯·è¿è¡Œ</p>
<pre><code class="highlight bash">npm i next@latest react@latest react-dom@latest eslint-config-next@latest</code></pre>

<h2 id="New-app-Directory-Beta"><a href="#New-app-Directory-Beta" class="headerlink" title="New app Directory(Beta)"></a>New app Directory(Beta)</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ”¹è¿› Next.js ä¸­çš„è·¯ç”±å’Œå¸ƒå±€ä½“éªŒï¼Œå¹¶é€šè¿‡å¼•å…¥ app directory å’Œ React çš„æœªæ¥ä¿æŒä¸€è‡´ã€‚è¿™æ˜¯åœ¨ä¹‹å‰ä¸ºå¾æ±‚ç¤¾åŒºåé¦ˆè€Œå‘å¸ƒçš„ Layouts RFC ä¹‹åçš„åˆä¸€æ¬¡æ”¹è¿›ã€‚</p>
<p>app directory ç›®å‰å¤„äº beta é˜¶æ®µï¼Œæˆ‘ä»¬è¿˜ä¸å»ºè®®åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚ä½ å¯ä»¥åœ¨Nextjs.13ä¸­ä½¿ç”¨ pages directory å’Œæ”¹è¿›çš„ next&#x2F;image å’Œ next&#x2F;link ç»„ä»¶ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„è¿›åº¦é€‰æ‹© app directoryã€‚åœ¨æœªæ¥ï¼Œå°†ç»§ç»­æ”¯æŒ pages directoryã€‚</p>
<p>app directory åŒ…æ‹¬ä»¥ä¸‹æ”¯æŒï¼š</p>
<ul>
<li>Layouts: åœ¨è·¯ç”±ä¹‹é—´è½»æ¾å…±äº«ç”¨æˆ·ç•Œé¢ï¼ŒåŒæ—¶ä¿ç•™çŠ¶æ€å¹¶é¿å…æ˜‚è´µçš„é‡æ–°æ¸²æŸ“ã€‚</li>
<li>Server Components: å°†æœåŠ¡å™¨ä¼˜å…ˆä½œä¸ºåŠ¨æ€åº”ç”¨çš„é»˜è®¤è®¾ç½®ã€‚</li>
<li>Streaming: åœ¨æ¸²æŸ“æ—¶ä»¥ç”¨æˆ·ç•Œé¢ä¸ºå•ä½æ˜¾ç¤ºå³æ—¶åŠ è½½çŠ¶æ€å’Œæ•°æ®æµã€‚</li>
<li>Support for Data Fetching: async æœåŠ¡å™¨ç»„ä»¶å’Œæ‰©å±•çš„ fetch API å¯å®ç°ç»„ä»¶çº§æ•°æ®è·å–ã€‚</li>
</ul>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/layouts-rfc/app-folder.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<h3 id="Layouts"><a href="#Layouts" class="headerlink" title="Layouts"></a>Layouts</h3><p>é€šè¿‡ <code>app/</code> ç›®å½•ï¼Œå¯ä»¥è½»æ¾å®ç°å¸ƒå±€å¤æ‚çš„ç•Œé¢ï¼Œåœ¨å¯¼èˆªè¿‡ç¨‹ä¸­ä¿æŒçŠ¶æ€ï¼Œé¿å…æ˜‚è´µçš„é‡æ–°æ¸²æŸ“ï¼Œå¹¶å¯ç”¨é«˜çº§è·¯ç”±æ¨¡å¼ã€‚æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥åµŒå¥—å¸ƒå±€ï¼Œå¹¶å°† app ä»£ç ä¸è·¯ç”±ï¼ˆå¦‚ç»„ä»¶ã€testså’Œstylesï¼‰æ”¾åœ¨ä¸€èµ·ã€‚</p>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/colocating-assets-in-the-app-directory.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>åœ¨ <code>app/</code> å†…åˆ›å»ºè·¯ç”±åªéœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå³ page.js:</p>
<pre><code class="highlight js"><span class="comment">// This file maps to the index route (/)</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, Next.js!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;
&#125;</code></pre>

<p>ä½ å¯ä»¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿå®šä¹‰å¸ƒå±€ã€‚å¸ƒå±€åœ¨å¤šä¸ªé¡µé¢ä¹‹é—´å…±äº«ç”¨æˆ·ç•Œé¢ã€‚åœ¨å¯¼èˆªæ—¶ï¼Œå¸ƒå±€ä¼šä¿ç•™çŠ¶æ€ï¼Œä¿æŒäº¤äº’æ€§ï¼Œå¹¶ä¸”ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BlogLayout</span>(<span class="params">&#123; children &#125;</span>) &#123;
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>;
&#125;</code></pre>

<h3 id="Server-Components"><a href="#Server-Components" class="headerlink" title="Server Components"></a>Server Components</h3><p><code>app/</code> ç›®å½•å¼•å…¥äº†å¯¹Reactæ–°æœåŠ¡å™¨ç»„ä»¶æ¶æ„çš„æ”¯æŒã€‚æœåŠ¡å™¨ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶åˆ†åˆ«åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å……åˆ†å‘æŒ¥å®ƒä»¬å„è‡ªçš„ä¼˜åŠ¿ï¼Œä½¿ä½ èƒ½å¤Ÿå•ç‹¬ä½¿ç”¨å•ä¸€çš„ç¼–ç¨‹æ¨¡å‹æ„å»ºå¿«é€Ÿã€é«˜åº¦äº¤äº’å¼çš„åº”ç”¨ç¨‹åºï¼Œæä¾›å‡ºè‰²çš„å¼€å‘è€…ä½“éªŒã€‚</p>
<p>åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ„å»ºå¤æ‚çš„ç•Œé¢å¥ å®šäº†åŸºç¡€ï¼ŒåŒæ—¶å‡å°‘äº†å‘é€åˆ°å®¢æˆ·ç«¯çš„JavaScriptæ•°é‡ï¼Œä»è€ŒåŠ å¿«äº†åˆå§‹é¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚</p>
<p>åŠ è½½è·¯ç”±æ—¶ï¼Œå°†ä¼šåŠ è½½ Next.js å’Œ React runtime, è¯¥ runtime å¯ç¼“å­˜ä¸”å¤§å°å¯é¢„æµ‹ã€‚runtimeçš„å¤§å°ä¸ä¼šéšç€åº”ç”¨çš„å¢é•¿è€Œå¢åŠ ã€‚æ­¤å¤–ï¼Œruntime æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œå› æ­¤å¯ä»¥åœ¨å®¢æˆ·ç«¯é€æ­¥å¢å¼ºæœåŠ¡å™¨ä¸Šçš„HTML</p>
<h3 id="Streaming"><a href="#Streaming" class="headerlink" title="Streaming"></a>Streaming</h3><p><code>app/</code> ç›®å½•å¼•å…¥äº†é€æ­¥æ¸²æŸ“å’Œå¢é‡å¼æµå¼ä¼ è¾“ç”¨æˆ·ç•Œé¢å•å…ƒåˆ°å®¢æˆ·ç«¯çš„åŠŸèƒ½ã€‚</p>
<p>åˆ©ç”¨ Next.js ä¸­çš„æœåŠ¡å™¨ç»„ä»¶å’ŒåµŒå¥—å¸ƒå±€ï¼Œä½ å¯ä»¥ç«‹å³å‘ˆç°é¡µé¢ä¸­ä¸éœ€è¦æ•°æ®çš„éƒ¨åˆ†ï¼Œå¹¶ä¸ºæ­£åœ¨è·å–æ•°æ®çš„é¡µé¢æ˜¾ç¤ºåŠ è½½çŠ¶æ€ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…æ•´ä¸ªé¡µé¢åŠ è½½å®Œæ¯•ï¼Œå°±å¯ä»¥å¼€å§‹ä¸é¡µé¢è¿›è¡Œäº¤äº’ã€‚</p>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/streaming.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>éƒ¨ç½²åˆ°Vercelåï¼Œä½¿ç”¨<code>app/</code>ç›®å½•çš„ Next.js åº”ç”¨å°†é»˜è®¤åœ¨Node.jså’ŒEdgeè¿è¡Œæ—¶ä½¿ç”¨æµå¼å“åº”ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</p>
<h3 id="Data-Fetching"><a href="#Data-Fetching" class="headerlink" title="Data Fetching"></a>Data Fetching</h3><p>Reactæœ€è¿‘å‘å¸ƒçš„ <a target="_blank" rel="noopener" href="https://github.com/acdlite/rfcs/blob/first-class-promises/text/0000-first-class-support-for-promises.md">Support for Promises RFC</a> ä¸ºåœ¨ç»„ä»¶å†…è·å–æ•°æ®å’Œå¤„ç†Promiseå¼•å…¥äº†ä¸€ç§å¼ºå¤§çš„æ–°æ–¹æ³•ï¼š</p>
<pre><code class="highlight js"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/...&#x27;</span>);
  <span class="comment">// The return value is *not* serialized</span>
  <span class="comment">// You can return Date, Map, Set, etc.</span>
  <span class="keyword">return</span> res.<span class="title function_">json</span>();
&#125;
 
<span class="comment">// This is an async Server Component</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getData</span>();
 
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span>&#123;/* ... */&#125;<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>;
&#125;</code></pre>

<p>React å’Œ Next.js ä¸­ä¹Ÿæ‰©å±•äº†æœ¬åœ° fetch APIã€‚å®ƒèƒ½å¤Ÿè‡ªåŠ¨å¯¹ fetch requests è¿›è¡Œé‡å¤è®¡ç®—ï¼Œå¹¶æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼åœ¨ç»„ä»¶çº§è·å–ã€ç¼“å­˜å’Œé‡æ–°éªŒè¯æ•°æ®ã€‚è¿™æ„å‘³ç€SSGï¼ŒSSRï¼ŒISRçš„æ‰€æœ‰ä¼˜ç‚¹ç°åœ¨éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªAPIè·å¾—ï¼š</p>
<pre><code class="highlight js"><span class="comment">// This request should be cached until manually invalidated.</span>
<span class="comment">// Similar to `getStaticProps`.</span>
<span class="comment">// `force-cache` is the default and can be omitted.</span>
<span class="title function_">fetch</span>(<span class="variable constant_">URL</span>, &#123; <span class="attr">cache</span>: <span class="string">&#x27;force-cache&#x27;</span> &#125;);
 
<span class="comment">// This request should be refetched on every request.</span>
<span class="comment">// Similar to `getServerSideProps`.</span>
<span class="title function_">fetch</span>(<span class="variable constant_">URL</span>, &#123; <span class="attr">cache</span>: <span class="string">&#x27;no-store&#x27;</span> &#125;);
 
<span class="comment">// This request should be cached with a lifetime of 10 seconds.</span>
<span class="comment">// Similar to `getStaticProps` with the `revalidate` option.</span>
<span class="title function_">fetch</span>(<span class="variable constant_">URL</span>, &#123; <span class="attr">next</span>: &#123; <span class="attr">revalidate</span>: <span class="number">10</span> &#125; &#125;);</code></pre>

<p>åœ¨ app ç›®å½•ä¸­ï¼Œä½ å¯ä»¥åœ¨layoutsï¼Œpagesï¼Œcomponentsä¸­è·å–æ•°æ®ï¼ŒåŒ…æ‹¬æ”¯æŒä»æœåŠ¡å™¨è·å–æµå¼å“åº”ã€‚</p>
<p>æˆ‘ä»¬æ­£åœ¨å¯ç”¨ç¬¦åˆäººä½“å·¥å­¦çš„æ–¹å¼æ¥å¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€ï¼Œå¹¶åœ¨æ¸²æŸ“ç”¨æˆ·ç•Œé¢æ—¶å¯¹å…¶è¿›è¡Œæµå¼å¤„ç†ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†æ”¹è¿›å’Œç®€åŒ–æ•°æ®çªå˜ã€‚</p>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/streaming.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>æˆ‘ä»¬å¾ˆé«˜å…´èƒ½ä¸å¼€æºç¤¾åŒºã€åŒ…ç»´æŠ¤è€…ä»¥åŠå…¶ä»–ä¸º React ç”Ÿæ€ç³»ç»Ÿåšå‡ºè´¡çŒ®çš„å…¬å¸åˆä½œï¼Œå…±åŒæ‰“é€  React å’Œ Next.js çš„æ–°æ—¶ä»£ã€‚æˆ‘ä»¬å¾ˆé«˜å…´èƒ½åœ¨ <code>app/</code> ç›®å½•ä¸­åŠ å…¥ä¸¤ä¸ªé‡è¦çš„ç¤¾åŒºåé¦ˆï¼Œä¸€æ˜¯åœ¨ç»„ä»¶å†…éƒ¨é›†ä¸­æ•°æ®è·å–çš„èƒ½åŠ›ï¼ŒäºŒæ˜¯å‘å®¢æˆ·ç«¯å‘é€æ›´å°‘çš„ JavaScript ã€‚</p>
<h2 id="Introducing-Turbopack-Alpha"><a href="#Introducing-Turbopack-Alpha" class="headerlink" title="Introducing Turbopack (Alpha)"></a>Introducing Turbopack (Alpha)</h2><p>Next.js åŒ…å« Turbopack, å®ƒæ˜¯åŸºäºRustçš„Webpackæ›¿ä»£å“</p>
<p>Webpackå·²ç»è¢«ä¸‹è½½è¶…è¿‡30äº¿æ¬¡ï¼Œè™½ç„¶å®ƒä¸€ç›´æ˜¯æ„å»ºWebçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘ä»¬è¾¾åˆ°äº†åŸºäºJavaScriptçš„å·¥å…·æ‰€èƒ½è¾¾åˆ°çš„æœ€é«˜æ€§èƒ½æé™ã€‚</p>
<p>åœ¨Next.js12ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹å‘Rusté©±åŠ¨çš„å·¥å…·è¿‡æ¸¡ã€‚é¦–å…ˆæ˜¯è¿ç§»äº†Babelï¼Œè½¬è¯‘é€Ÿåº¦æé«˜äº†17å€ã€‚ç„¶åï¼Œæ›¿æ¢äº†Terserï¼Œå‹ç¼©é€Ÿåº¦æé«˜äº†6å€ã€‚æ˜¯æ—¶å€™å…¨éƒ¨ä½¿ç”¨åŸç”Ÿå·¥å…·è¿›è¡Œç»‘å®šäº†ã€‚</p>
<p>åœ¨ Next.js13 ä¸­ä½¿ç”¨ Turbopack alpha çš„ç»“æœæ˜¯ï¼š</p>
<ul>
<li>æ›´æ–°é€Ÿåº¦æ¯”Webpackå¿«700å€</li>
<li>æ›´æ–°é€Ÿåº¦æ¯”Viteå¿«10å€</li>
<li>å†·å¯åŠ¨é€Ÿåº¦æ¯”Webpackå¿«4å€</li>
</ul>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/turbopack.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>Turbopack åªæ†ç»‘å¼€å‘ä¸­æ‰€éœ€çš„æœ€å°èµ„æºï¼Œæ‰€ä»¥å¯åŠ¨æ—¶é—´æçŸ­ã€‚åœ¨ä¸€ä¸ªåŒ…å«3000ä¸ªmodulesçš„åº”ç”¨ä¸­ï¼ŒTurbopackåªéœ€1.8ç§’å³å¯å¯åŠ¨ã€‚Vite éœ€è¦11.4ç§’ï¼ŒWebpackéœ€è¦16.5ç§’ã€‚</p>
<p>Turbopackå¼€ç®±å³ç”¨ï¼Œæ”¯æŒæœåŠ¡å™¨ç»„ä»¶ã€TypeScriptã€JSXã€CSSç­‰ã€‚åœ¨alphaé˜¶æ®µï¼Œ<a target="_blank" rel="noopener" href="https://turbo.build/pack/docs/features">è®¸å¤šåŠŸèƒ½</a>å°šä¸æ”¯æŒã€‚æˆ‘ä»¬å¸Œæœ›å¬åˆ°ä½ å¯¹ä½¿ç”¨ Turbopack å¿«é€Ÿæœ¬åœ°è¿­ä»£è¿‡ç¨‹çš„åé¦ˆ</p>
<blockquote>
<p>Note: Next.jsä¸­çš„ Turbopack ç›®å‰åªæ”¯æŒ <code>next dev</code>ã€‚æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://turbo.build/pack/docs/features">æ”¯æŒçš„åŠŸèƒ½</a>ã€‚æˆ‘ä»¬è¿˜åœ¨åŠªåŠ›é€šè¿‡ Turbopack å¢åŠ å¯¹ next build çš„æ”¯æŒ</p>
</blockquote>
<p>ä½¿ç”¨<code>next dev --turbo</code>åœ¨ Next.js13 ä¸­è¯•ç”¨ Turbopack alphaã€‚</p>
<h2 id="next-x2F-image"><a href="#next-x2F-image" class="headerlink" title="next&#x2F;image"></a>next&#x2F;image</h2><p>Next.js13 å¼•å…¥äº†åŠŸèƒ½å¼ºå¤§çš„æ–°Imageç»„ä»¶ï¼Œè®©ä½ å¯ä»¥è½»æ¾æ˜¾ç¤ºå›¾åƒè€Œæ— éœ€æ”¹å˜å¸ƒå±€ï¼Œå¹¶æŒ‰éœ€ä¼˜åŒ–æ–‡ä»¶ä»¥æé«˜æ€§èƒ½ã€‚</p>
<p>åœ¨ Next.js ç¤¾åŒºè°ƒæŸ¥ä¸­ï¼Œ70%çš„å—è®¿è€…å‘Šè¯‰æˆ‘ä»¬ï¼Œä»–ä»¬åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨äº† Next.js çš„ Image ç»„ä»¶ï¼Œå¹¶çœ‹åˆ°äº† Core Web Vitals çš„æ”¹è¿›ã€‚åœ¨ Next.js13 ä¸­ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ”¹è¿› next&#x2F;imageã€‚</p>
<p>æ–°çš„ Image ç»„ä»¶ï¼š</p>
<ul>
<li>å‡å°‘å®¢æˆ·ç«¯ JavaScript</li>
<li>æ›´æ˜“äºè®¾è®¡å’Œé…ç½®</li>
<li>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨<code>alt</code>æ ‡è®°æ›´æ˜“äºè®¿é—®</li>
<li>ä¸Webå¹³å°ä¿æŒä¸€è‡´</li>
<li>å› ä¸ºæœ¬åœ°æ‡’åŠ è½½ä¸éœ€è¦ hydrationï¼Œå› æ­¤é€Ÿåº¦æ›´å¿«</li>
</ul>
<pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">Image</span> <span class="keyword">from</span> <span class="string">&#x27;next/image&#x27;</span>;
<span class="keyword">import</span> avatar <span class="keyword">from</span> <span class="string">&#x27;./lee.png&#x27;</span>;
 
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;
  <span class="comment">// &quot;alt&quot; is now required for improved accessibility</span>
  <span class="comment">// optional: image files can be colocated inside the app/ directory</span>
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">alt</span>=<span class="string">&quot;leeerob&quot;</span> <span class="attr">src</span>=<span class="string">&#123;avatar&#125;</span> <span class="attr">placeholder</span>=<span class="string">&quot;blur&quot;</span> /&gt;</span></span>;
&#125;</code></pre>

<h3 id="Upgrading-next-x2F-image-to-Next-js-13"><a href="#Upgrading-next-x2F-image-to-Next-js-13" class="headerlink" title="Upgrading next&#x2F;image to Next.js 13"></a>Upgrading next&#x2F;image to Next.js 13</h3><p>æ—§çš„ Image ç»„ä»¶å·²æ›´åä¸º <code>next/legacy/image</code>ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªcodemodï¼Œå®ƒå°†è‡ªåŠ¨æŠŠä½ ç°æœ‰çš„ next&#x2F;image æ›´æ–°ä¸º <code>next/legacy/image</code>ã€‚ä¾‹å¦‚ï¼Œå½“ä»æ ¹ç›®å½•è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œå°†åœ¨ <code>./pages</code> ç›®å½•ä¸­è¿è¡Œ codemod:</p>
<pre><code class="highlight bash">npx @next/codemod next-image-to-legacy-image ./pages</code></pre>

<h2 id="next-x2F-font"><a href="#next-x2F-font" class="headerlink" title="@next&#x2F;font"></a>@next&#x2F;font</h2><p>Next.js å¼•å…¥äº†å…¨æ–°çš„å­—ä½“ç³»ç»Ÿï¼š</p>
<ul>
<li>è‡ªåŠ¨ä¼˜åŒ–ä½ çš„å­—ä½“ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰å­—ä½“</li>
<li>ç§»é™¤å¤–éƒ¨ç½‘ç»œè¯·æ±‚ï¼Œæé«˜ç§å¯†æ€§å’Œæ€§èƒ½</li>
<li>å†…ç½®è‡ªåŠ¨æ‰˜ç®¡åŠŸèƒ½ï¼Œå¯æ‰˜ç®¡ä»»ä½•å­—ä½“æ–‡ä»¶</li>
<li>ä½¿ç”¨CSS <code>size-adjust</code> å±æ€§è‡ªåŠ¨å®ç°é›¶å¸ƒå±€åç§»</li>
</ul>
<p>æ–°çš„å­—ä½“ç³»ç»Ÿå¯ä»¥è®©ä½ æ–¹ä¾¿çš„ä½¿ç”¨æ‰€æœ‰ Google å­—ä½“ï¼ŒåŒæ—¶å…¼é¡¾æ€§èƒ½å’Œéšç§ã€‚CSSå’Œå­—ä½“æ–‡ä»¶åœ¨æ„å»ºæ—¶ä¸‹è½½ï¼Œå¹¶äºå…¶ä»–é™æ€èµ„æºä¸€èµ·è‡ªè¡Œæ‰˜ç®¡ã€‚æµè§ˆå™¨ä¸ä¼šå‘ Google å‘é€ä»»ä½•è¯·æ±‚ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">Inter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@next/font/google&#x27;</span>;
 
<span class="keyword">const</span> inter = <span class="title class_">Inter</span>();
 
<span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">className</span>=<span class="string">&#123;inter.className&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span>;</code></pre>

<p>è‡ªå®šä¹‰å­—ä½“ä¹Ÿæ”¯æŒï¼ŒåŒ…æ‹¬æ”¯æŒå­—ä½“æ–‡ä»¶çš„è‡ªåŠ¨æ‰˜ç®¡ã€ç¼“å­˜å’Œé¢„åŠ è½½ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> localFont <span class="keyword">from</span> <span class="string">&#x27;@next/font/local&#x27;</span>;
 
<span class="keyword">const</span> myFont = <span class="title function_">localFont</span>(&#123; <span class="attr">src</span>: <span class="string">&#x27;./my-font.woff2&#x27;</span> &#125;);
 
<span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">className</span>=<span class="string">&#123;myFont.className&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span>;</code></pre>

<p>ä½ å¯ä»¥è‡ªå®šä¹‰å­—ä½“åŠ è½½è¿‡ç¨‹çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œå¹¶ä¸”ç¡®ä¿å‡ºè‰²çš„æ€§èƒ½å’Œå¸ƒå±€ä¸å˜ï¼ŒåŒ…æ‹¬ <code>font-display</code>ï¼Œé¢„åŠ è½½ï¼Œå›é€€ç­‰ã€‚</p>
<h2 id="next-x2F-link"><a href="#next-x2F-link" class="headerlink" title="next&#x2F;link"></a>next&#x2F;link</h2><p><code>next/link</code> ä¸å†éœ€è¦æ‰‹åŠ¨æ·»åŠ <code>&lt;a&gt;</code>ä½œä¸ºå­ä»£ã€‚</p>
<p>è¿™ä¸ªåŠŸèƒ½ä¹‹å‰æ˜¯åœ¨12.2ä¸­ä½œä¸º expreimental option æ·»åŠ çš„ï¼Œç°åœ¨æ˜¯é»˜è®¤é€‰é¡¹ã€‚åœ¨ Next.js13 ä¸­ï¼Œ<code>&lt;Link&gt;</code>æ€»æ˜¯æ¸²æŸ“<code>&lt;a&gt;</code>ï¼Œå¹¶å…è®¸ä½ å°†propså‘é€åˆ°åº•å±‚æ ‡ç­¾ä¸Šã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span>
 
<span class="comment">// Next.js 12: `&lt;a&gt;` has to be nested otherwise it&#x27;s excluded</span>
&lt;<span class="title class_">Link</span> href=<span class="string">&quot;/about&quot;</span>&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>
&lt;/<span class="title class_">Link</span>&gt;
 
<span class="comment">// Next.js 13: `&lt;Link&gt;` always renders `&lt;a&gt;`</span>
<span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span></span>
<span class="language-xml">  About</span>
<span class="language-xml"><span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></code></pre>

<h3 id="Upgrading-next-x2F-link-to-Next-js-13"><a href="#Upgrading-next-x2F-link-to-Next-js-13" class="headerlink" title="Upgrading next&#x2F;link to Next.js 13"></a>Upgrading next&#x2F;link to Next.js 13</h3><p>å°† links å‡çº§åˆ° Next.js13ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªcodemodï¼Œå¯ä»¥è‡ªåŠ¨æ›´æ–° codebaseã€‚æ¯”å¦‚åœ¨æ ¹ç›®å½•è¿è¡Œæ­¤å‘½ä»¤ï¼Œå°†åœ¨<code>./pages</code>ç›®å½•ä¸­è¿è¡Œcodemodï¼š</p>
<pre><code class="highlight bash">npx @next/codemod new-link ./pages</code></pre>

<h2 id="OG-Image-Generation"><a href="#OG-Image-Generation" class="headerlink" title="OG Image Generation"></a>OG Image Generation</h2><p>ç¤¾äº¤å¡ç‰‡ï¼Œä¹Ÿå¯ç§°ä¸ºå¼€æ”¾å›¾å›¾åƒï¼Œå¯ä»¥å¤§å¤§æé«˜å†…å®¹ç‚¹å‡»çš„å‚ä¸ç‡ï¼Œä¸€äº›å®éªŒæ˜¾ç¤ºè½¬åŒ–ç‡æœ€é«˜å¯æé«˜40%ã€‚</p>
<p>é™æ€ç¤¾äº¤å¡è€—æ—¶ã€æ˜“å‡ºé”™ä¸”éš¾ç»´æŠ¤ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œç¤¾äº¤å¡ç»å¸¸è¢«å¿½ç•¥ç”šè‡³è·³è¿‡ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦ä¸ªæ€§åŒ–å’Œå³æ—¶è®¡ç®—çš„åŠ¨æ€ç¤¾äº¤å¡æ—¢å›°éš¾åˆæ˜‚è´µã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°åº“ <code>@vercel/og</code>, å¯ä¸ Next.js æ— ç¼åä½œï¼Œç”ŸæˆåŠ¨æ€çš„ç¤¾äº¤å¡ç‰‡ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">ImageResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@vercel/og&#x27;</span>;
 
<span class="keyword">export</span> <span class="keyword">const</span> config = &#123;
  <span class="attr">runtime</span>: <span class="string">&#x27;experimental-edge&#x27;</span>,
&#125;;
 
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ImageResponse</span>(
    (
      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span>
<span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span>
<span class="tag"><span class="language-xml">          <span class="attr">display:</span> &#x27;<span class="attr">flex</span>&#x27;,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">fontSize:</span> <span class="attr">128</span>,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">background:</span> &#x27;<span class="attr">white</span>&#x27;,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">height:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span>
<span class="tag"><span class="language-xml">        &#125;&#125;</span></span>
<span class="tag"><span class="language-xml">      &gt;</span></span>
<span class="language-xml">        Hello, World!</span>
<span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
    ),
  );
&#125;</code></pre>

<p>è¿™ä¸ªæ–¹æ³•æ¯”ç°æœ‰è§£å†³æ–¹æ³•å¿«5å€ã€‚é€šè¿‡ä½¿ç”¨ Vercel Edge Functionsã€WebAssembly å’Œç”¨äºå°† HTML å’Œ CSS è½¬æ¢ä¸ºå›¾åƒçš„å…¨æ–°æ ¸å¿ƒåº“ï¼Œå¹¶åˆ©ç”¨ React ç»„ä»¶æŠ½è±¡ã€‚</p>
<h2 id="Middleware-API-Updates"><a href="#Middleware-API-Updates" class="headerlink" title="Middleware API Updates"></a>Middleware API Updates</h2><p>åœ¨ Next.js12 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸­é—´ä»¶ï¼Œä½¿ Next.js è·¯ç”±å…·æœ‰å……åˆ†çš„çµæ´»æ€§ã€‚ç„¶åæˆ‘ä»¬å¬å–äº†å¤§å®¶å¯¹åˆå§‹ API è®¾è®¡çš„åé¦ˆæ„è§ï¼Œå¹¶å¢åŠ äº†ä¸€äº›æ–°å†…å®¹ï¼Œä»¥æ”¹å–„å¼€å‘äººå‘˜çš„ä½“éªŒï¼Œå¹¶æ·»åŠ äº†å¼ºå¤§çš„æ–°åŠŸèƒ½ã€‚</p>
<p>ç°åœ¨ä½ å¯ä»¥æ›´è½»æ¾åœ°åœ¨è¯·æ±‚ä¸­è®¾ç½® headersï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">NextResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next/server&#x27;</span>;
<span class="keyword">import</span> type &#123; <span class="title class_">NextRequest</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next/server&#x27;</span>;
 
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">middleware</span>(<span class="params">request: NextRequest</span>) &#123;
  <span class="comment">// Clone the request headers and set a new header `x-version`</span>
  <span class="keyword">const</span> requestHeaders = <span class="keyword">new</span> <span class="title class_">Headers</span>(request.<span class="property">headers</span>);
  requestHeaders.<span class="title function_">set</span>(<span class="string">&#x27;x-version&#x27;</span>, <span class="string">&#x27;13&#x27;</span>);
 
  <span class="comment">// You can also set request headers in NextResponse.rewrite</span>
  <span class="keyword">const</span> response = <span class="title class_">NextResponse</span>.<span class="title function_">next</span>(&#123;
    <span class="attr">request</span>: &#123;
      <span class="comment">// New request headers</span>
      <span class="attr">headers</span>: requestHeaders,
    &#125;,
  &#125;);
 
  <span class="comment">// Set a new response header `x-version`</span>
  response.<span class="property">headers</span>.<span class="title function_">set</span>(<span class="string">&#x27;x-version&#x27;</span>, <span class="string">&#x27;13&#x27;</span>);
  <span class="keyword">return</span> response;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œä½ è¿˜å¯ä»¥ç›´æ¥åœ¨ä¸­é—´ä»¶ä¸­æä¾›å“åº”ï¼Œæ— éœ€ <code>rewrite</code> å’Œ <code>redirect</code>ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">NextRequest</span>, <span class="title class_">NextResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next/server&#x27;</span>;
<span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&#x27;@lib/auth&#x27;</span>;
 
<span class="comment">// Limit the middleware to paths starting with `/api/`</span>
<span class="keyword">export</span> <span class="keyword">const</span> config = &#123;
  <span class="attr">matcher</span>: <span class="string">&#x27;/api/:function*&#x27;</span>,
&#125;;
 
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">middleware</span>(<span class="params">request: NextRequest</span>) &#123;
  <span class="comment">// Call our authentication function to check the request</span>
  <span class="keyword">if</span> (!<span class="title function_">isAuthenticated</span>(request)) &#123;
    <span class="comment">// Respond with JSON indicating an error message</span>
    <span class="keyword">return</span> <span class="title class_">NextResponse</span>.<span class="title function_">json</span>(
      &#123;
        <span class="attr">success</span>: <span class="literal">false</span>,
        <span class="attr">message</span>: <span class="string">&#x27;Auth failed&#x27;</span>,
      &#125;,
      &#123;
        <span class="attr">status</span>: <span class="number">401</span>,
      &#125;,
    );
  &#125;
&#125;</code></pre>

<p>ä»ä¸­é—´ä»¶å‘é€å“åº”ç›®å‰éœ€è¦ä½¿ç”¨ <code>next.config.js</code> ä¸­çš„ <code>experimental.allowMiddlewareResponseBody</code> é…ç½®é¡¹ã€‚</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">1.</span> <span class="toc-text">æ­£æ–‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#New-app-Directory-Beta"><span class="toc-number">1.1.</span> <span class="toc-text">New app Directory(Beta)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Layouts"><span class="toc-number">1.1.1.</span> <span class="toc-text">Layouts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Components"><span class="toc-number">1.1.2.</span> <span class="toc-text">Server Components</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Streaming"><span class="toc-number">1.1.3.</span> <span class="toc-text">Streaming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Fetching"><span class="toc-number">1.1.4.</span> <span class="toc-text">Data Fetching</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Introducing-Turbopack-Alpha"><span class="toc-number">1.2.</span> <span class="toc-text">Introducing Turbopack (Alpha)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#next-x2F-image"><span class="toc-number">1.3.</span> <span class="toc-text">next&#x2F;image</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Upgrading-next-x2F-image-to-Next-js-13"><span class="toc-number">1.3.1.</span> <span class="toc-text">Upgrading next&#x2F;image to Next.js 13</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#next-x2F-font"><span class="toc-number">1.4.</span> <span class="toc-text">@next&#x2F;font</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#next-x2F-link"><span class="toc-number">1.5.</span> <span class="toc-text">next&#x2F;link</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Upgrading-next-x2F-link-to-Next-js-13"><span class="toc-number">1.5.1.</span> <span class="toc-text">Upgrading next&#x2F;link to Next.js 13</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OG-Image-Generation"><span class="toc-number">1.6.</span> <span class="toc-text">OG Image Generation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Middleware-API-Updates"><span class="toc-number">1.7.</span> <span class="toc-text">Middleware API Updates</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&text=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&is_video=false&description=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ã€ç¿»ã€‘Next.js 13&body=Check out this article: https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&title=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&name=ã€ç¿»ã€‘Next.js 13&description=Next.js 13"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lhrun.github.io/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/&t=ã€ç¿»ã€‘Next.js 13"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2024
    leo
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'LHS';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
