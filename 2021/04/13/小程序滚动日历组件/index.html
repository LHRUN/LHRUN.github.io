<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="LH_R"><title>小程序滚动日历组件 · LH'BLOG</title><meta name="description" content="小程序滚动日历组件前段时间产品提出这个需求，要求做一个日历容器，并要求是滚动，不能是那种每个月切换的容器，所以我就在网上大概查找了一下类似组件，滚动的容器较少，于是我就自己写了这个组件，以下是大概的js思路，wxml和css就不附上了，每个UI都有不同的想法

在ready中初始化组件数据

/**"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.2.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">首页</a></li><li> <a href="/archives">归档</a></li><li> <a href="/tags">标签</a></li><li> <a href="/about">关于</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo.jpeg" style="width:220px; border-radius:110px" alt="favicon"><h3 title=""><a href="/">LH'BLOG</a></h3><div class="description"><p>keep learning</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/lhrun"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://segmentfault.com/u/lh_s"><i class="fa fa-segmentfault"></i></a></li></ul></div><details class="ltr" open><summary>目录</summary><div class="tocmenu"><p><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%BB%9A%E5%8A%A8%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6"><span class="toclist-number">1.</span> <span class="toclist-text">小程序滚动日历组件</span></a></li></ol></p></div></details></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> LH_R</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo</a></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>小程序滚动日历组件</a></h3></div><div class="post-content"><p><h2 id="小程序滚动日历组件"><a href="#小程序滚动日历组件" class="headerlink" title="小程序滚动日历组件"></a>小程序滚动日历组件</h2><p>前段时间产品提出这个需求，要求做一个日历容器，并要求是滚动，不能是那种每个月切换的容器，所以我就在网上大概查找了一下类似组件，滚动的容器较少，于是我就自己写了这个组件，以下是大概的js思路，wxml和css就不附上了，每个UI都有不同的想法</p>
<ol>
<li>在ready中初始化组件数据</li>
</ol>
<pre><code class="js">/**
 * @description: 初始化
 */
ready() &#123;
  // 这两个数据是从页面中传过来的，起始时间和结束时间
  // 数组类型 [year, month, day]
  const &#123; endDate, startDate &#125; = this.data
  let monthList = [] // 这个用于wxml中遍历，以每月为item

  // 未跨年
  if ( endDate[0] === startDate[0]) &#123;
    let rangeMonth = endDate[1] - startDate[1]
    for (let i = 0; i &lt;= rangeMonth; i++) &#123;
      let date = [startDate[0], startDate[1] + i + 1]
      // monthInitData()初始化每月数据
      let days = this.monthInitData(startDate[0], startDate[1] + i)
      monthList.push(&#123;
        date,
        days,
      &#125;)
    &#125;
  &#125; else &#123;
    // 跨年前月份
    for (let i = 0, lng = 12 - startDate[1]; i &lt; lng; i++) &#123;
      let date = [startDate[0], startDate[1] + i + 1]
      let days = this.monthInitData(startDate[0], startDate[1] + i)
      monthList.push(&#123;
        date,
        days,
      &#125;)
    &#125;

    // 跨年后月份
    for (let i = 0; i &lt;= endDate[1]; i++) &#123;
      let date = [endDate[0], i + 1]
      let days = this.monthInitData(endDate[0], i)
      monthList.push(&#123;
        date,
        days,
      &#125;)
    &#125;
  &#125;
  this.setData(&#123;
    monthList,
  &#125;)
&#125;
</code></pre>
<ol start="2">
<li>初始化每月数据: <blockquote>
<p>逻辑是获取每个月第一天的星期数和每个月的最大天数，然后在之前和之后的空数据填充item占位<br>然后遍历，根据不同的需求，在遍历中处理，最后在html中flex布局即可</p>
</blockquote>
</li>
</ol>
<pre><code class="js">/**
 * @description: 初始化每月数据
 * @param: &#123; number &#125; year 年
 * @param: &#123; number &#125; month 月
 */
monthInitData(year, month) &#123;
  let &#123; calendarValue, startDate, endDate &#125;= this.data, // 当前点击时间，起始时间，结束时间
    firstWeek = new Date(year, month, 1).getDay(), // 本月的第一天的星期数
    days = [], // 日期数组
    max = this.getMonthMax(year, month + 1), // 每月最大天数
    lastWeek = new Date(year, (month + 1), 0).getDay() // 本月的最后一天的星期数

  // 填充每月一号之前的空数据
  if (firstWeek &gt; 0) &#123;
    for (let i = 0; i &lt; firstWeek; i++) &#123;
      days.push(&#123;
        day: 0
      &#125;)
    &#125;
  &#125;

  let currentTime = 0, 
      startTime = 0,
      endTime = 0

  if (calendarValue[0]) &#123;
    currentTime = new Date(calendarValue[0], calendarValue[1], calendarValue[2]).getTime()
  &#125;
  if (startDate[0]) &#123;
    startTime = new Date(startDate[0], startDate[1], startDate[2]).getTime()
  &#125;
  if (endDate[0]) &#123;
    endTime = new Date(endDate[0], endDate[1], endDate[2]).getTime()
  &#125;

  for (let i = 1; i &lt;= max; i++) &#123;
    // 以下状态是需要在html中判断处理，根据自己需求改变
    let current = false, // 当前点击状态
      disabled = false, // 禁止状态
      now = false, // 今天显示文案
      time = new Date(year, month, i).getTime(),
      nowTime = [new Date().getFullYear(), new Date().getMonth(), new Date().getDate()]
    if (currentTime &amp;&amp; currentTime == time) current = true
    if (startTime &amp;&amp; startTime &gt; time) disabled = true
    if (endTime &amp;&amp; endTime &lt; time) disabled = true
    if (year === nowTime[0] &amp;&amp; month === nowTime[1] &amp;&amp; i === nowTime[2]) now = true

    days.push(&#123;
      day: i,
      current,
      disabled,
      now,
    &#125;)
  &#125;

  // 填充每月最后一天之后的空数据
  if (lastWeek != 6) &#123;
    for (let i = 0, l = (6 - lastWeek); i &lt; l; i++) &#123;
      days.push(&#123;
        day: 0
      &#125;)
    &#125;
  &#125;
  return days
&#125;,

/**
 * 获取一个月最大天数
 * @method getMonthMax
 * @param: &#123; number &#125; year 年份
 * @param: &#123; number &#125; month 月份
 */
getMonthMax(year, month) &#123;
  let max = 31
  if (month == 4 || month == 6 || month == 9 || month == 11) &#123;
    max = 30
  &#125; else if (month == 2) &#123;
    if (((year % 4) == 0 &amp;&amp; (year % 100) &gt; 0) || (year % 400) == 0) &#123;
      max = 29
    &#125; else &#123;
      max = 28
    &#125; 
  &#125;

  return max
&#125;,
</code></pre>
<ul>
<li>以上就是核心逻辑，像一些弹窗事件和一些点击事件就不附上来了</li>
</ul>
</p><div class="tip">本文采用CC-BY-SA-3.0协议，转载请注明出处<br>作者: LH_R</div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2021-04-13</span><i class="fa fa-tag"></i><a class="tag" href="/tags/微信小程序/" title="微信小程序">微信小程序 </a><span class="leancloud_visitors"></span><span>大约737个字, 2分钟27秒读完</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://example.com/2021/04/13/小程序滚动日历组件/,LH'BLOG,小程序滚动日历组件,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2021/06/10/H5%E8%B7%B3%E8%BD%AC%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="H5跳转微信小程序">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/01/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%93%9D%E7%89%99%E6%8E%A7%E5%88%B6%E5%BC%80%E9%97%A8/" title="微信小程序蓝牙控制开门">下一篇</a></li></ul></div><script src="/js/visitors.js"></script><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = '[object Object]';
var disqus_identifier = '2021/04/13/小程序滚动日历组件/';
var disqus_title = '小程序滚动日历组件';
var disqus_url = 'http://example.com/2021/04/13/小程序滚动日历组件/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>