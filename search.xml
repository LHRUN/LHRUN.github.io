<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>H5è·³è½¬å¾®ä¿¡å°ç¨‹åº</title>
    <url>/2021/06/10/H5%E8%B7%B3%E8%BD%AC%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="H5è·³è½¬å¾®ä¿¡å°ç¨‹åº"><a href="#H5è·³è½¬å¾®ä¿¡å°ç¨‹åº" class="headerlink" title="H5è·³è½¬å¾®ä¿¡å°ç¨‹åº"></a>H5è·³è½¬å¾®ä¿¡å°ç¨‹åº</h2><blockquote>
<p>H5è·³è½¬å°ç¨‹åºæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œéœ€è¦æ ¹æ®æµè§ˆå™¨ç¯å¢ƒåˆ¤æ–­<br>å¾®ä¿¡å¤–ä½¿ç”¨<code>URL Scheme</code>ï¼Œæ ¹æ®ç”Ÿæˆçš„ä¸€ä¸ªlinkè¿›è¡Œlocationè·³è½¬<br>å¾®ä¿¡å†…ä½¿ç”¨<code>wx-open-launch-weapp</code>å¼€æ”¾æ ‡ç­¾è¿›è¡Œè·³è½¬ï¼Œå®æµ‹iosç³»ç»Ÿå¾®ä¿¡å†…ä¹Ÿå¯ä»¥ä½¿ç”¨<code>URL Scheme</code>ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©</p>
</blockquote>
<h3 id="wx-open-launch-weapp"><a href="#wx-open-launch-weapp" class="headerlink" title="wx-open-launch-weapp"></a><code>wx-open-launch-weapp</code></h3><ul>
<li><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html">å®˜æ–¹æ–‡æ¡£</a></li>
<li>æ³¨æ„äº‹é¡¹ï¼šå¾®ä¿¡ç‰ˆæœ¬è¦æ±‚ä¸ºï¼š7.0.12åŠä»¥ä¸Šã€‚ ç³»ç»Ÿç‰ˆæœ¬è¦æ±‚ä¸ºï¼šiOS 10.3åŠä»¥ä¸Šã€Android 5.0åŠä»¥ä¸Š</li>
<li>ç»‘å®šåŸŸå: ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°è¿›å…¥â€œå…¬ä¼—å·è®¾ç½®â€çš„â€œåŠŸèƒ½è®¾ç½®â€é‡Œå¡«å†™â€œJSæ¥å£å®‰å…¨åŸŸåâ€  </li>
<li>å¼•å…¥SDKï¼šå®˜ç½‘æ¨èå¼•å…¥æ–¹æ³•<code>&lt;script src=&quot;https://res.wx.qq.com/open/js/jweixin-1.6.0.js&quot;&gt;&lt;/script&gt;</code>;ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹npmåŒ…<code>weixin-js-sdk</code>  </li>
<li>æ ¡éªŒç­¾åæ˜¯å¦æ­£ç¡®ï¼š<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign">å¾®ä¿¡ JS æ¥å£ç­¾åæ ¡éªŒå·¥å…·</a></li>
<li>å¦‚æœå¼€æ”¾æ ‡ç­¾éœ€è¦ç»å¯¹å®šä½ï¼Œå°±åœ¨å¤–é¢åŒ…è£¹ä¸€ä¸ªdivè¿›è¡Œå®šä½ï¼Œé¿å…ç›´æ¥å®šä½å¼€æ”¾æ ‡ç­¾</li>
<li>è°ƒè¯•ï¼šå¥½å¤šäººåœ¨è¿›è¡Œè°ƒè¯•çš„æ—¶å€™è®¤ä¸ºéå¸¸éº»çƒ¦ï¼Œéœ€è¦ä¸æ–­åˆ‡æ¢ç¯å¢ƒï¼Œæˆ‘æ¨èä¸€ä¸ªæˆ‘çš„è°ƒè¯•æ–¹å¼ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨SwitchHostsè¿›è¡ŒIPæ˜ å°„ï¼ŒæŠŠæœ¬åœ°å¯åŠ¨é¡¹ç›®çš„åŸŸåæ˜ å°„åˆ°å…¬ä¼—å·å¹³å°è®¾ç½®çš„åŸŸåï¼Œç„¶ååœ¨å¾®ä¿¡å¼€å‘å·¥å…·ä¸­è°ƒè¯•ï¼Œå°±éå¸¸è½»æ¾äº†</li>
</ul>
<pre><code class="highlight html">// æ™®é€šH5çš„å†™æ³•å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¸‹æ˜¯æˆ‘åœ¨vueä¸­çš„å†™æ³•
<span class="tag">&lt;<span class="name">wx-open-launch-weapp</span></span>
<span class="tag"> <span class="attr">username</span>=<span class="string">&quot;å°ç¨‹åºåŸå§‹id&quot;</span></span>
<span class="tag"> <span class="attr">path</span>=<span class="string">&quot;é¡µé¢è·¯å¾„åŠå‚æ•°&quot;</span>&gt;</span>
  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/wxtag-template&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml">           </span></span>
<span class="language-xml"><span class="language-handlebars">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;wx-btn&quot;</span>&gt;</span>è·³è½¬å°ç¨‹åº<span class="tag">&lt;/<span class="name">button</span>&gt;</span>   </span></span>
<span class="language-xml"><span class="language-handlebars">  </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;/<span class="name">wx-open-launch-weapp</span>&gt;</span>
<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">...</span>
<span class="language-javascript"><span class="keyword">async</span> <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span>
<span class="language-javascript">  <span class="keyword">const</span> wx = <span class="built_in">require</span>(<span class="string">&#x27;weixin-js-sdk&#x27;</span>)</span>
<span class="language-javascript">  wx.<span class="title function_">config</span>(&#123;</span>
<span class="language-javascript">    <span class="attr">debug</span>: <span class="literal">true</span>, <span class="comment">// å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œä¼šåœ¨ç§»åŠ¨ç«¯ä»¥alertçš„å½¢å¼æ‰“å°è¿”å›å€¼</span></span>
<span class="language-javascript">    <span class="attr">appId</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// å¿…å¡«ï¼Œä»æœåŠ¡ç«¯è·å–</span></span>
<span class="language-javascript">    <span class="attr">timestamp</span>: , <span class="comment">// å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³ï¼Œä»æœåŠ¡ç«¯è·å–</span></span>
<span class="language-javascript">    <span class="attr">nonceStr</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„éšæœºä¸²ï¼Œä»æœåŠ¡ç«¯è·å–</span></span>
<span class="language-javascript">    <span class="attr">signature</span>: <span class="string">&#x27;&#x27;</span>,<span class="comment">// å¿…å¡«ï¼Œç­¾åï¼Œä»æœåŠ¡ç«¯è·å–</span></span>
<span class="language-javascript">    <span class="attr">jsApiList</span>: [], <span class="comment">// å¿…å¡«ï¼Œéœ€è¦ä½¿ç”¨çš„JSæ¥å£åˆ—è¡¨ï¼Œè¿™ä¸ªéšä¾¿å¡«ä¸€ä¸ªå°±è¡Œ</span></span>
<span class="language-javascript">    <span class="attr">openTagList</span>: [<span class="string">&#x27;wx-open-launch-weapp&#x27;</span>]</span>
<span class="language-javascript">  &#125;)</span>
<span class="language-javascript">  wx.<span class="title function_">ready</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(e))</span>
<span class="language-javascript">  wx.<span class="title function_">error</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(e))</span>
<span class="language-javascript">&#125;</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></code></pre>

<h3 id="URL-Scheme"><a href="#URL-Scheme" class="headerlink" title="URL Scheme"></a><code>URL Scheme</code></h3><ul>
<li>æ³¨æ„äº‹é¡¹ï¼šå®‰å“ä¸èƒ½ç›´æ¥è·³è½¬ï¼Œéœ€è¦H5ä¸­è½¬ï¼Œå¦åˆ™Androidä¼šå‡ºç°æ— æ³•è®¿é—®</li>
<li>å†™æ³•å¾ˆç®€å•ï¼Œåªéœ€<code>location.href=&#39;URL Scheme&#39;</code>ï¼Œåœ¨é¡µé¢åˆå§‹åŒ–æ—¶è°ƒç”¨æˆ–è€…åœ¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>H5</tag>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>Explore Full Stack Magicï¼šNext.js + Prisma + Next-auth + vercel/postgres</title>
    <url>/2023/11/28/Explore-Full-Stack-Magic/</url>
    <content><![CDATA[<p>Recently, I completed a new website project to collecting Github Profiles and Readme Components. Initially, I didnâ€™t plan to develop it into a full-stack application, and features such as liking and collect were based on local storage. However, with the gradual iterations after the websiteâ€™s release, I felt that adding full-stack support might be a necessary direction. Not only does it contribute to future project expansion, but it also enhances the overall user experience. So, in my spare time over the course of about a week, I transformed the project into a fully-fledged full-stack website. Here is the link to my project.</p>
<ul>
<li>Link: <a href="https://bubble-awesome-profile.vercel.app/">https://bubble-awesome-profile.vercel.app</a></li>
<li>Github: <a href="https://github.com/LHRUN/bubble">https://github.com/LHRUN/bubble</a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/LHRUN/file-store/main/post/screenshot_profle.png"></p>
<p>After completing the full-stack version of the website, I thought about documenting the process in an article. All the code for this article can be found in the project. In the upcoming posts, I will gradually share content about topics such as authentication, the use of Prisma and PostgreSQL, and ultimately guide you through the process of building a full-stack website.</p>
<h2 id="Tech-Stack"><a href="#Tech-Stack" class="headerlink" title="Tech Stack"></a>Tech Stack</h2><ul>
<li>full-stack framework <a href="https://nextjs.org/">Next.js</a></li>
<li>database tool <a href="https://www.prisma.io/">Prisma</a></li>
<li>database <a href="https://www.postgresql.org/">PostgreSQL</a></li>
<li>authenticate <a href="https://next-auth.js.org/">NextAuth</a></li>
<li>deployment platform <a href="https://vercel.com/">Vercel</a></li>
</ul>
<h2 id="Initialization-Project"><a href="#Initialization-Project" class="headerlink" title="Initialization Project"></a>Initialization Project</h2><p>First, run the <code>npx create-next-app@latest</code> command in the terminal, and then follow the prompts for configuration.</p>
<pre><code class="highlight bash">What is your project named? my-app
Would you like to use TypeScript? No / Yes
Would you like to use ESLint? No / Yes
Would you like to use Tailwind CSS? No / Yes
Would you like to use `src/` directory? No / Yes
Would you like to use App Router? (recommended) No / Yes
Would you like to customize the default import <span class="built_in">alias</span> (@/*)? No / Yes
What import <span class="built_in">alias</span> would you like configured? @/*</code></pre>

<p>After a successful run, navigate to the project directory and execute <code>npm run dev</code>.</p>
<p>After successful startup, you can start building the base environment</p>
<ol>
<li>First, upload the project to GitHub by creating a repository and linking the remote address. Then, push the code.</li>
<li>Go to the Vercel <a href="https://vercel.com/">https://vercel.com/</a>, log in, and choose GitHub. When uploading the project, keep the default settings in â€œConfigure Projectâ€ and click â€œDeployâ€ directly. Environment variables can be adjusted when needed. Wait automatic deployment to complete.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/LHRUN/file-store/main/post/vercel_create_project.png"></p>
<ol start="3">
<li>After successful deployment, create the database. Select PostgreSQL in the Storage tab, enter a name and select a region and create it. Once created the database will be linked to your project.</li>
<li>Local code pulling environment variables:</li>
</ol>
<ul>
<li>Run <code>npm i -g vercel@latest</code> to install the Verlcel CLI.</li>
<li>Run <code>verlcel link</code> to link your vercel project.</li>
<li>Run <code>vercel env pull .env</code> to pull the latest environment variables.</li>
</ul>
<h2 id="Connecting-to-the-database"><a href="#Connecting-to-the-database" class="headerlink" title="Connecting to the database"></a>Connecting to the database</h2><p>Run <code>npm install prisma --save-dev</code> to install the Prisma CLI and create a <code>Prisma</code> folder, add the <code>schema.prisma</code> file to it, and then add a few models as follows:</p>
<pre><code class="highlight prisma">generator client &#123;
  provider = &quot;prisma-client-js&quot;
&#125;

datasource db &#123;
  provider  = &quot;postgresql&quot;
  url       = env(&quot;POSTGRES_PRISMA_URL&quot;) // uses connection pooling
  directUrl = env(&quot;POSTGRES_URL_NON_POOLING&quot;) // uses a direct connection
&#125;

model Post &#123;
  id        String     @default(cuid()) @id
  title     String
  content   String?
  published Boolean @default(false)
  author    User?   @relation(fields: [authorId], references: [id])
  authorId  String?
&#125;

model User &#123;
  id            String       @default(cuid()) @id
  name          String?
  email         String?   @unique
  createdAt     DateTime  @default(now()) @map(name: &quot;created_at&quot;)
  updatedAt     DateTime  @updatedAt @map(name: &quot;updated_at&quot;)
  posts         Post[]
  @@map(name: &quot;users&quot;)
&#125;</code></pre>

<p>Prisma is to define the table structure through the model, for example, the above is to build a Post table and a User table, and then these two tables through the posts in the User and the author in the Post to establish a one-to-many table relationship.</p>
<p>Then run the <code>npx prisma db push</code> command to synchronize the defined data model to the remote database. You should then see the following prompt. This means that the table has been created successfully</p>
<pre><code class="highlight plaintext">ğŸš€  Your database is now in sync with your schema.</code></pre>

<p>Then run <code>npx prisma studio</code> in <code>localhost:5555</code> to see your table structure, which is of course now all empty data.</p>
<h2 id="Getting-database-data-into-a-views"><a href="#Getting-database-data-into-a-views" class="headerlink" title="Getting database data into a views"></a>Getting database data into a views</h2><p>To get the database data into the view, you first need to install <code>@prisma/client</code>, run the command <code>npm install @prisma/client</code>.</p>
<p>Then run <code>npx prisma generate</code>, and note that you will need to run this command every time you change the Prisma Schema file thereafter. It will generate the TypeScript or JavaScript code corresponding to the table structure, the functions used to perform database queries, inserts, updates, and deletes, as well as the associated type definitions.</p>
<p>Next, create a prisma.ts file in your project, which can usually be placed in the lib folder. Add the following code to that file:</p>
<pre><code class="highlight ts"><span class="keyword">import</span> &#123; <span class="title class_">PrismaClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@prisma/client&#x27;</span>;

<span class="keyword">let</span> <span class="attr">prisma</span>: <span class="title class_">PrismaClient</span>;

<span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;
  prisma = <span class="keyword">new</span> <span class="title class_">PrismaClient</span>();
&#125; <span class="keyword">else</span> &#123;
  <span class="keyword">if</span> (!<span class="variable language_">global</span>.<span class="property">prisma</span>) &#123;
    <span class="variable language_">global</span>.<span class="property">prisma</span> = <span class="keyword">new</span> <span class="title class_">PrismaClient</span>();
  &#125;
  prisma = <span class="variable language_">global</span>.<span class="property">prisma</span>;
&#125;

<span class="keyword">export</span> <span class="keyword">default</span> prisma;</code></pre>

<p>This code is used to configure and export a Prisma instance. In a production environment, a new PrismaClient instance is created for each request, while in a development environment, it reuses the global instance to prevent running out of data connections. This setup improves performance and reduces resource usage.</p>
<p>Then PrismaClient has four basic APIs for create, delete, update, and read, For details, see <a href="https://www.prisma.io/docs/concepts/components/prisma-client/crud">CRUD</a></p>
<pre><code class="highlight ts"><span class="keyword">const</span> user = <span class="keyword">await</span> prisma.<span class="property">user</span>.<span class="title function_">create</span>(&#123;
  <span class="attr">data</span>: &#123;
    <span class="attr">email</span>: <span class="string">&#x27;elsa@prisma.io&#x27;</span>,
    <span class="attr">name</span>: <span class="string">&#x27;Elsa Prisma&#x27;</span>,
  &#125;,
&#125;)

<span class="keyword">const</span> user = <span class="keyword">await</span> prisma.<span class="property">user</span>.<span class="title function_">findUnique</span>(&#123;
  <span class="attr">where</span>: &#123;
    <span class="attr">email</span>: <span class="string">&#x27;elsa@prisma.io&#x27;</span>,
  &#125;,
&#125;)

<span class="keyword">const</span> updateUser = <span class="keyword">await</span> prisma.<span class="property">user</span>.<span class="title function_">update</span>(&#123;
  <span class="attr">where</span>: &#123;
    <span class="attr">email</span>: <span class="string">&#x27;elsa@prisma.io&#x27;</span>,
  &#125;,
  <span class="attr">data</span>: &#123;
    <span class="attr">name</span>: <span class="string">&#x27;Elsa&#x27;</span>,
  &#125;,
&#125;)

<span class="keyword">const</span> deleteUser = <span class="keyword">await</span> prisma.<span class="property">user</span>.<span class="title function_">delete</span>(&#123;
  <span class="attr">where</span>: &#123;
    <span class="attr">email</span>: <span class="string">&#x27;elsa@prisma.io&#x27;</span>,
  &#125;,
&#125;)</code></pre>

<p>For example, if you want to find a post</p>
<pre><code class="highlight ts"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">getServerSideProps</span>: <span class="title class_">GetServerSideProps</span> = <span class="keyword">async</span> (&#123; params &#125;) =&gt; &#123;
  <span class="keyword">const</span> post = <span class="keyword">await</span> prisma.<span class="property">post</span>.<span class="title function_">findUnique</span>(&#123;
    <span class="attr">where</span>: &#123;
      <span class="attr">id</span>: <span class="title class_">String</span>(params?.<span class="property">id</span>),
    &#125;,
    <span class="attr">include</span>: &#123;
      <span class="attr">author</span>: &#123;
        <span class="attr">select</span>: &#123; <span class="attr">name</span>: <span class="literal">true</span> &#125;,
      &#125;,
    &#125;,
  &#125;);
  <span class="keyword">return</span> &#123;
    <span class="attr">props</span>: post,
  &#125;;
&#125;;</code></pre>

<h2 id="NextAuth-Authentication"><a href="#NextAuth-Authentication" class="headerlink" title="NextAuth Authentication"></a>NextAuth Authentication</h2><p>First install the two dependencies <code>next-auth</code>, <code>@next-auth/prisma-adapter</code>.</p>
<pre><code class="highlight bash">npm install next-auth @next-auth/prisma-adapter</code></pre>

<p>Then change the user-related model</p>
<pre><code class="highlight prisma">model User &#123;
  id              String         @id @default(uuid())
  name            String
  email           String?        @unique
  emailVerified   DateTime?      @map(&quot;email_verified&quot;)
  image           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  posts         Post[]

  @@map(&quot;users&quot;)
&#125;

model Account &#123;
  id                String   @id @default(cuid())
  userId            String   @map(&quot;user_id&quot;)
  type              String?
  provider          String
  providerAccountId String   @map(&quot;provider_account_id&quot;)
  token_type        String?
  refresh_token     String?  @db.Text
  access_token      String?  @db.Text
  expires_at        Int?
  scope             String?
  id_token          String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map(&quot;accounts&quot;)
&#125;

model Session &#123;
  id           String   @id @default(cuid())
  userId       String?  @map(&quot;user_id&quot;)
  sessionToken String   @unique @map(&quot;session_token&quot;) @db.Text
  accessToken  String?  @map(&quot;access_token&quot;) @db.Text
  expires      DateTime
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map(&quot;sessions&quot;)
&#125;

model VerificationRequest &#123;
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, token])
&#125;</code></pre>

<p>Then, using GitHub as an example, you need to create an OAuth App. follow these steps:</p>
<ol>
<li>Login to your GitHub account and click Settings.</li>
<li>At the bottom of the Settings page, find Developer Settings and switch to OAuth Apps.</li>
<li>Click â€œRegister a new applicationâ€ and fill in the name and domain name. In a local development environment, the Homepage URL can be <code>http://localhost:3000</code> and the Authorization callback URL can be <code>http://localhost:3000/api/auth/callback/github</code>.</li>
</ol>
<p>After successful creation, copy the generated Client ID and Client Secret and add them to the <code>.env</code> file in your project:</p>
<pre><code class="highlight dotenv">GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
SECRET= // Required for production environments, content can be customized</code></pre>

<p>This way, your project will be able to do GitHub OAuth authentication with these keys. Also make sure that the <code>.env</code> file is not exposed, you can add it now to the <code>.gitignore</code></p>
<p>Then you need to add the following code to your root component</p>
<pre><code class="highlight tsx"><span class="keyword">import</span> &#123; <span class="title class_">SessionProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/react&#x27;</span>;

<span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">return</span> (
    <span class="language-xml"><span class="tag">&lt;<span class="name">SessionProvider</span>&gt;</span></span>
<span class="language-xml">      ...</span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">SessionProvider</span>&gt;</span></span>
  );
&#125;;

<span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</code></pre>

<p>Then, create a specific route <code>api/auth/[... .nextauth].ts</code> for NextAuth to use and add the following code</p>
<pre><code class="highlight ts"><span class="comment">// api/auth/[...nextauth].ts</span>

<span class="keyword">import</span> &#123; <span class="title class_">NextAuth</span>ï¼Œ <span class="title class_">NextAuthOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth&#x27;</span>;
<span class="keyword">import</span> &#123; <span class="title class_">PrismaAdapter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@next-auth/prisma-adapter&#x27;</span>;
<span class="keyword">import</span> <span class="title class_">GitHubProvider</span> <span class="keyword">from</span> <span class="string">&#x27;next-auth/providers/github&#x27;</span>;
<span class="keyword">import</span> prisma <span class="keyword">from</span> <span class="string">&#x27;@/lib/prisma&#x27;</span>;

<span class="keyword">const</span> <span class="attr">authOptions</span>: <span class="title class_">NextAuthOptions</span> = &#123;
  <span class="attr">providers</span>: [
    <span class="title class_">GitHubProvider</span>(&#123;
      <span class="attr">clientId</span>: process.<span class="property">env</span>.<span class="property">GITHUB_CLIENT_ID</span> <span class="keyword">as</span> <span class="built_in">string</span>,
      <span class="attr">clientSecret</span>: process.<span class="property">env</span>.<span class="property">GITHUB_CLIENT_SECRET</span> <span class="keyword">as</span> <span class="built_in">string</span>,
      <span class="attr">httpOptions</span>: &#123;
        <span class="attr">timeout</span>: <span class="number">10000</span>, <span class="comment">// wait for response time, because the local environment often login timeout, so change this configuration</span>
      &#125;
    &#125;)
  ],
  <span class="attr">adapter</span>: <span class="title class_">PrismaAdapter</span>(prisma),
  <span class="attr">secret</span>: process.<span class="property">env</span>.<span class="property">SECRET</span>, <span class="comment">// required for production environments</span>
  <span class="attr">callbacks</span>: &#123;
    <span class="comment">// triggered by getSession and useSession calls</span>
    <span class="comment">// documents https://next-auth.js.org/configuration/callbacks</span>
    <span class="keyword">async</span> <span class="title function_">session</span>(<span class="params">&#123; session, user &#125;</span>) &#123;
      <span class="keyword">if</span> (user.<span class="property">id</span> &amp;&amp; session?.<span class="property">user</span>) &#123;
        session.<span class="property">user</span>.<span class="property">userId</span> = user.<span class="property">id</span>;
      &#125;
      <span class="keyword">return</span> session;
    &#125;
  &#125;
&#125;;

<span class="keyword">const</span> handler = <span class="title class_">NextAuth</span>(authOptions);

<span class="keyword">export</span> &#123; handler <span class="keyword">as</span> <span class="variable constant_">GET</span>, handler <span class="keyword">as</span> <span class="variable constant_">POST</span> &#125;;</code></pre>

<p>Then add the following code where you want to click login and it will normally take you to the github authorization page.</p>
<pre><code class="highlight ts"><span class="keyword">import</span> &#123; signIn &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/react&#x27;</span>;

<span class="keyword">const</span> <span class="title function_">clickSignIn</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="title function_">signIn</span>(<span class="string">&#x27;github&#x27;</span>)
&#125;</code></pre>

<p>Getting user session data can be done via the following APIs</p>
<ul>
<li>Clientï¼š<code>useSession</code>, <code>getSession</code></li>
<li>Server: <code>getServerSession</code></li>
</ul>
<pre><code class="highlight ts"><span class="keyword">import</span> &#123; useSession &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/react&#x27;</span>;

<span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> &#123; <span class="attr">data</span>: session &#125; = <span class="title function_">useSession</span>();

  <span class="keyword">if</span> (session) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Logged in as:&#x27;</span>, session.<span class="property">user</span>);
  &#125;

  <span class="comment">// ...</span>
&#125;</code></pre>

<pre><code class="highlight ts"><span class="keyword">import</span> &#123; getSession &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/react&#x27;</span>;

<span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getServerSideProps</span>(<span class="params">context</span>) &#123;
  <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">getSession</span>(context);

  <span class="keyword">if</span> (session) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Logged in as:&#x27;</span>, session.<span class="property">user</span>);
  &#125;

  <span class="keyword">return</span> &#123;
    <span class="attr">props</span>: &#123;&#125;,
  &#125;;
&#125;</code></pre>

<pre><code class="highlight ts"><span class="keyword">import</span> &#123; getServerSession &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/react&#x27;</span>;

<span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">POST</span>(<span class="params">req: NextRequest</span>) &#123;
  <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">getServerSession</span>();
  <span class="keyword">const</span> userId = session?.<span class="property">user</span>?.<span class="property">userId</span>;

  <span class="comment">// validation session</span>
  <span class="keyword">if</span> (!userId) &#123;
    <span class="keyword">return</span> <span class="title function_">responseFail</span>(<span class="variable constant_">HTTP_CODE</span>.<span class="property">NOT_LOGGED</span>);
  &#125;

  <span class="comment">//...</span>
&#125;</code></pre>


<h2 id="Vercel-Deployment-Notes"><a href="#Vercel-Deployment-Notes" class="headerlink" title="Vercel Deployment Notes"></a>Vercel Deployment Notes</h2><ol>
<li>The build command needs to be preceded by <code>prisma generate</code>, so the build command in package.json can be changed to</li>
</ol>
<pre><code class="highlight json"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>
 <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prisma generate &amp;&amp; next build&quot;</span>
<span class="punctuation">&#125;</span></code></pre>

<ol start="2">
<li>Since only one callback path is supported in the GitHub OAuth App, you need to create multiple OAuth Apps for different environments. set up environment variables on Vercel, and add the specific keys for each OAuth App to the environment variables. vercel supports multiple environment variable setups.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/LHRUN/file-store/main/post/vercel_env_var.png"></p>
<ol start="3">
<li>Make sure to add the <code>.env</code> file to <code>.gitignore</code> and donâ€™t expose it!</li>
</ol>
<h2 id="Problems-In-Dev"><a href="#Problems-In-Dev" class="headerlink" title="Problems In Dev"></a>Problems In Dev</h2><ol>
<li><p>It is very easy to fail to login in, after many times of checking still canâ€™t find the reason, for the time being, it will be categorized as a network error, if you fail to login in you can try to switch the wifi or switch your network, of course, this is mainly in the local development environment of the problem, the production environment is still very smooth. Related <a href="https://github.com/nextauthjs/next-auth/issues/3920">issue</a></p>
</li>
<li><p>In Next.js 14, passing the <code>request</code> object to <code>getServerSession</code> will result in an error, so try writing it like I did, and then introducing the function wherever you need to use it.</p>
</li>
</ol>
<pre><code class="highlight ts"><span class="keyword">import</span> &#123; getServerSession <span class="keyword">as</span> originalGetServerSession &#125; <span class="keyword">from</span> <span class="string">&#x27;next-auth/next&#x27;</span>;

<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getServerSession</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> req = &#123;
    <span class="attr">headers</span>: <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(<span class="title function_">headers</span>() <span class="keyword">as</span> <span class="title class_">Headers</span>),
    <span class="attr">cookies</span>: <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(
      <span class="title function_">cookies</span>()
        .<span class="title function_">getAll</span>()
        .<span class="title function_">map</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> [c.<span class="property">name</span>, c.<span class="property">value</span>])
    )
  &#125; <span class="keyword">as</span> <span class="built_in">any</span>;
  <span class="keyword">const</span> res = &#123; <span class="title function_">getHeader</span>(<span class="params"></span>) &#123;&#125;, <span class="title function_">setCookie</span>(<span class="params"></span>) &#123;&#125;, <span class="title function_">setHeader</span>(<span class="params"></span>) &#123;&#125; &#125; <span class="keyword">as</span> <span class="built_in">any</span>;

  <span class="keyword">const</span> session = <span class="keyword">await</span> <span class="title function_">originalGetServerSession</span>(req, res, authOptions);
  <span class="keyword">return</span> session;
&#125;;</code></pre>

<ol start="3">
<li>When using authenticated login platforms such as GitHub, Google, etc., if the email is unique, it will cause the login to fail. This is due to the fact that the email is defined as a unique value in the model</li>
<li>When I initially wrote the user-related model I kept getting type errors when following the example on the official website, so if thatâ€™s the case for you too, try the set of base models I wrote above</li>
</ol>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This article just roughly summarizes the process of building a full-stack website, in which there are some details not written, but you follow this process to build your website is no problem. Welcome to discuss and exchange questions. Thanks. ğŸ‘»</p>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Next.js</tag>
        <tag>Vercel</tag>
        <tag>Full Stack</tag>
        <tag>Prisma</tag>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoæ­å»ºè¯¦ç»†æ•™ç¨‹</title>
    <url>/2022/09/06/Hexo%E6%90%AD%E5%BB%BA%E5%9F%BA%E6%93%8D%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="åˆå§‹åŒ–Hexo"><a href="#åˆå§‹åŒ–Hexo" class="headerlink" title="åˆå§‹åŒ–Hexo"></a>åˆå§‹åŒ–Hexo</h2><ol>
<li>é¦–å…ˆéœ€è¦ä»¥ä¸‹å®‰è£…ç¯å¢ƒï¼Œç›´æ¥åœ¨å®˜ç½‘ä¸‹è½½å³å¯</li>
</ol>
<ul>
<li><a href="https://nodejs.org/en/">Node.js</a></li>
<li><a href="https://git-scm.com/">Git</a></li>
</ul>
<ol start="2">
<li>ç¯å¢ƒå‡†å¤‡å¥½åï¼Œå®‰è£…Hexo <code>npm install -g hexo-cli</code></li>
<li>å®‰è£…ååœ¨æŒ‡å®šæ–‡ä»¶å¤¹åˆ›å»ºé¡¹ç›®<pre><code class="highlight sh">hexo init &lt;folder&gt;
<span class="built_in">cd</span> &lt;folder&gt;
npm install</code></pre></li>
<li>é€‰æ‹©ä¸»é¢˜</li>
</ol>
<ul>
<li><p>Hexoåˆå§‹åŒ–æˆåŠŸåï¼Œç„¶åéœ€è¦é€‰æ‹©ä¸€ä¸ªæ¼‚äº®çš„ä¸»é¢˜ï¼Œè¿™ä¸ªæ¨èç›´æ¥åœ¨å®˜ç½‘ä¸Šæ‰¾ï¼Œ<a href="https://hexo.io/themes/">ä¸»é¢˜</a><br><img src="https://img-blog.csdnimg.cn/60988327e65c46ec8becc25b8591c650.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>é€‰ä¸­ä¸»é¢˜åä¸‹è½½åˆ°é¡¹ç›®themesæ–‡ä»¶å¤¹</p>
</li>
<li><p>ç„¶åä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶</p>
</li>
<li><p><code>theme: &#39;ä¸»é¢˜å,ä¹Ÿå°±æ˜¯themesæ–‡ä»¶å¤¹é‡Œçš„åå­—&#39;</code></p>
</li>
</ul>
<ol start="5">
<li>hexoæœ€å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤</li>
</ol>
<ul>
<li>å¯åŠ¨æœåŠ¡ï¼š<code>hexo server</code> æˆ– <code>hexo s</code></li>
<li>æ–°å»ºæ–‡ç« ï¼š<code>hexo new &quot;æ–‡ç« åå­—&quot;</code></li>
<li>æ–°å»ºé™æ€é¡µé¢ï¼š<code>hexo new page &quot;é¡µé¢åå­—&quot;</code></li>
<li>ç”Ÿæˆpublicæ–‡ä»¶å¤¹ï¼š<code>hexo generate</code> æˆ– <code>hexo g</code></li>
<li>æ¸…é™¤publicæ–‡ä»¶å¤¹ï¼š<code>hexo clean</code></li>
<li>éƒ¨ç½²ï¼š<code>hexo deploy</code> æˆ– <code>hexo d</code></li>
</ul>
<h2 id="éƒ¨ç½²åˆ°Github"><a href="#éƒ¨ç½²åˆ°Github" class="headerlink" title="éƒ¨ç½²åˆ°Github"></a>éƒ¨ç½²åˆ°Github</h2><p>Githubæœ‰å…è´¹æä¾›æ­å»ºé™æ€ç½‘ç«™çš„åŠŸèƒ½ï¼Œæ‰€ä»¥hexoæ¨èç›´æ¥æ”¾åˆ°GitHub Pageï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œéƒ¨ç½²ã€‚  </p>
<ol>
<li>é¦–å…ˆæ–°å»ºä¸€ä¸ªæºç repoï¼Œå»ºè®®é€‰æ‹©Privateï¼Œè¿™ä¸ªç”¨æ¥æ”¾hexoé¡¹ç›®ä»£ç ï¼Œä¸å¯¹å¤–å¼€æ”¾</li>
<li>æœ¬åœ°ä»“åº“è¿è¡Œä»¥ä¸‹å‘½ä»¤æäº¤ä»£ç </li>
</ol>
<ul>
<li><code>git init</code>ï¼šgitåˆå§‹åŒ–</li>
<li><code>git add .</code>: å°†æ‰€æœ‰ä»£ç æ·»åŠ åˆ°æš‚å­˜åŒº</li>
<li><code>git commit -m &quot;first commit&quot;</code>ï¼šæäº¤æœ¬æ¬¡commit</li>
<li><code>git remote add origin &#39;è¿œç¨‹ä»“åº“åœ°å€&#39;</code>ï¼šæ·»åŠ è¿œç¨‹ä»“åº“åœ°å€</li>
<li><code>git push -u origin main</code>ï¼šæ¨é€ä»£ç </li>
</ul>
<ol start="3">
<li>ç„¶åå†æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œåå­—ä¸º <code>githubåå­—.github.io</code>ï¼Œè¿™ä¸ªä»“åº“ç”¨äºæ”¾éƒ¨ç½²åçš„ä»£ç </li>
<li>å®‰è£…Hexoéƒ¨ç½²æ’ä»¶ <code>npm install hexo-deployer-git</code></li>
<li>ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code><pre><code class="highlight yml"><span class="attr">deploy:</span>
  <span class="attr">type:</span> <span class="string">git</span>
  <span class="attr">repo:</span> <span class="string">éƒ¨ç½²ä»“åº“åœ°å€</span>
  <span class="attr">branch:</span> <span class="string">main</span></code></pre></li>
<li>æœ€åæ‰§è¡Œ<code>hexo deploy</code>å‘½ä»¤å°±å¯ä»¥åœ¨<code>githubåå­—.github.io</code>çœ‹åˆ°åšå®¢äº†</li>
</ol>
<h2 id="SSH-github-Actionsè‡ªåŠ¨éƒ¨ç½²"><a href="#SSH-github-Actionsè‡ªåŠ¨éƒ¨ç½²" class="headerlink" title="SSH + github Actionsè‡ªåŠ¨éƒ¨ç½²"></a>SSH + github Actionsè‡ªåŠ¨éƒ¨ç½²</h2><ul>
<li><strong>Github Actions</strong>æ˜¯githubä¸“ç”¨çš„æŒç»­é›†æˆè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨æ‰§è¡Œå·¥ä½œæµç¨‹ï¼Œ<strong>SSH</strong>å¯ä»¥é€šè¿‡å»ºç«‹å¯†é’¥å…å¯†ç™»å½•ï¼Œè¿™ä¸¤ä¸ªç»“åˆå°±èƒ½è¾¾åˆ°è‡ªåŠ¨éƒ¨ç½²çš„æ•ˆæœ</li>
</ul>
<ol>
<li><p>é¦–å…ˆé€šè¿‡ssh-keygenç”Ÿæˆå¯†é’¥ï¼Œ<code>ssh-keygen -t rsa -C &quot;Github çš„é‚®ç®±åœ°å€&quot;</code></p>
</li>
<li><p>ç„¶ågithubé…ç½®sshï¼Œé…ç½®è·¯å¾„ï¼š<code>github -&gt; Settings â€“&gt; SSH and GPG keys</code><br> <img src="https://img-blog.csdnimg.cn/277cd5e70dad47a5af70a9ce9dc06f5a.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>gitä»“åº“æ·»åŠ å¯†é’¥ç§æœ‰å˜é‡ï¼Œé…ç½®è·¯å¾„ï¼š<code>repo -&gt; Settings -&gt; Secrets</code>ï¼Œç‚¹å‡»<code>New repository secret</code>ï¼Œnameå¯ä»¥è‡ªå®šä¹‰ï¼Œä¸»è¦æ˜¯æ¥ä¸‹æ¥çš„deploy.yamlæ–‡ä»¶éœ€è¦ä½¿ç”¨ï¼ŒSecretå¡«å†™ä½ ç”Ÿæˆçš„å¯†é’¥<br><img src="https://img-blog.csdnimg.cn/10897de98a7f44a2b3171371b71b91ac.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>ç„¶åæ ¹ç›®å½•ä¸‹æ–°å»º<code>.github/workflows/deploy.yaml</code>ï¼Œå¹¶å¡«å†™ä»¥ä¸‹å†…å®¹</p>
<pre><code class="highlight yml"><span class="attr">name:</span> <span class="string">Deploy</span>
<span class="attr">on:</span>
  <span class="attr">push:</span>
    <span class="attr">branches:</span> [<span class="string">ä½ éœ€è¦è‡ªåŠ¨åŒ–éƒ¨ç½²çš„åˆ†æ”¯</span>]
<span class="attr">jobs:</span>
  <span class="attr">build:</span>
    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span>
    <span class="attr">steps:</span>
      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">Repository</span> <span class="string">main</span> <span class="string">branch</span>
        <span class="attr">uses:</span> <span class="string">actions/checkout@main</span>
      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node</span>
        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span>
        <span class="attr">with:</span>
          <span class="attr">node-version:</span> <span class="number">14.</span><span class="string">x</span>
      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Hexo</span> <span class="string">Dependencies</span>
        <span class="attr">run:</span> <span class="string">|</span>
<span class="string">          npm install hexo-cli -g</span>
<span class="string">          npm install</span>
<span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Deploy</span>
        <span class="attr">env:</span>
          <span class="attr">HEXO_DEPLOY_PRIVATE_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.&#x27;ä½ ä¸Šä¸€æ­¥è‡ªå®šä¹‰çš„å˜é‡å&#x27;</span> <span class="string">&#125;&#125;</span>
        <span class="attr">run:</span> <span class="string">|</span>
<span class="string">          mkdir -p ~/.ssh/</span>
<span class="string">          echo &quot;$HEXO_DEPLOY_PRIVATE_KEY&quot; &gt; ~/.ssh/id_rsa </span>
<span class="string">          chmod 600 ~/.ssh/id_rsa</span>
<span class="string">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span>
<span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Git</span> <span class="string">Infomation</span>
        <span class="attr">run:</span> <span class="string">|</span>
<span class="string">          git config --global user.name &quot;gitåå­—&quot;</span>
<span class="string">          git config --global user.email &quot;gité‚®ç®±&quot;</span>
<span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">Hexo</span>
        <span class="attr">run:</span> <span class="string">|</span>
<span class="string">          hexo clean</span>
<span class="string">          hexo generate </span>
<span class="string">          hexo deploy    </span></code></pre></li>
<li><p>ç„¶åæŠŠä»£ç pushä¸Šå»çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨ä»“åº“çš„<strong>Actions</strong>ä¸Šçœ‹è‡ªåŠ¨å·¥ä½œæµç¨‹çš„æƒ…å†µ</p>
</li>
</ol>
<h2 id="è°·æ­Œæ”¶å½•"><a href="#è°·æ­Œæ”¶å½•" class="headerlink" title="è°·æ­Œæ”¶å½•"></a>è°·æ­Œæ”¶å½•</h2><ol>
<li><p>é¦–å…ˆåœ¨<a href="https://www.google.com/webmasters/tools/home?hl=zh-CN">Google Search Console</a>ç™»å½•è°·æ­Œè´¦å·</p>
</li>
<li><p>ç„¶ååœ¨ç½‘å€å‰ç¼€ä¸­å¡«å†™ç½‘å€ï¼Œä¸‹è½½éªŒè¯æ–‡ä»¶åˆ°ä¸»é¢˜æ–‡ä»¶å¤¹çš„sourceç›®å½•<br><img src="https://img-blog.csdnimg.cn/68c9ef2e3f4c42ec8ca29f46f01905d4.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>ä¸‹è½½åå†é‡æ–°éƒ¨ç½²ä¸€ä¸‹ï¼Œæœ€åç‚¹å‡»éªŒè¯</p>
</li>
</ol>
<h3 id="æ·»åŠ ç«™ç‚¹åœ°å›¾"><a href="#æ·»åŠ ç«™ç‚¹åœ°å›¾" class="headerlink" title="æ·»åŠ ç«™ç‚¹åœ°å›¾"></a>æ·»åŠ ç«™ç‚¹åœ°å›¾</h3><p>ç«™ç‚¹åœ°å›¾æ˜¯ä¸€ç§æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æä¾›ä¸æ‚¨ç½‘ç«™ä¸­çš„ç½‘é¡µã€è§†é¢‘æˆ–å…¶ä»–æ–‡ä»¶æœ‰å…³çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥è¯´æ˜è¿™äº›å†…å®¹ä¹‹é—´çš„å…³ç³»ã€‚Google ç­‰æœç´¢å¼•æ“ä¼šè¯»å–æ­¤æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´é«˜æ•ˆåœ°æŠ“å–æ‚¨çš„ç½‘ç«™ã€‚ç«™ç‚¹åœ°å›¾ä¼šå‘Šè¯‰ Google æ‚¨è®¤ä¸ºç½‘ç«™ä¸­çš„å“ªäº›ç½‘é¡µå’Œæ–‡ä»¶æ¯”è¾ƒé‡è¦ï¼Œè¿˜ä¼šæä¾›ä¸è¿™äº›æ–‡ä»¶æœ‰å…³çš„é‡è¦ä¿¡æ¯ã€‚</p>
<ol>
<li><p>å®‰è£…ç«™ç‚¹åœ°å›¾æ’ä»¶ <code>npm install hexo-generator-sitemap --save</code></p>
</li>
<li><p>åœ¨hexoæ ¹ç›®å½•çš„_config.ymlä¿®æ”¹ä»¥ä¸‹å†…å®¹</p>
<pre><code class="highlight yml"><span class="attr">url:</span> <span class="string">åšå®¢åœ°å€</span>
<span class="attr">sitemap:</span>
 <span class="attr">path:</span> <span class="string">sitemap.xml</span></code></pre></li>
<li><p>ç„¶åéƒ¨ç½²åšå®¢ï¼Œè¾“å…¥<code>åšå®¢åœ°å€/sitemap.xml</code>èƒ½çœ‹è§ä»¥ä¸‹å†…å®¹<br><img src="https://img-blog.csdnimg.cn/74745ec1ca3e4d06a06ba512ddb5e3f1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>æœ€ååœ¨<strong>Google Search Console</strong>ä¸Šçš„ç«™ç‚¹åœ°å›¾ä¸Šç‚¹å‡»æäº¤<br><img src="https://img-blog.csdnimg.cn/371a45539f694c08a207367d47d25d88.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
</ol>
<h2 id="Disqusè¯„è®º"><a href="#Disqusè¯„è®º" class="headerlink" title="Disqusè¯„è®º"></a>Disqusè¯„è®º</h2><p>Hexoå¯ä»¥æ­è½½çš„è¯„è®ºç³»ç»Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Valineï¼ŒWalineï¼ŒDisqusç­‰ç­‰ï¼Œä½†æ˜¯æŒ‰é¢œå€¼æ¥çœ‹è¿˜æ˜¯Disqus</p>
<ol>
<li>é¦–å…ˆåœ¨<a href="https://disqus.com/">Disquså®˜ç½‘</a>è¿›è¡Œæ³¨å†Œï¼Œç„¶åç‚¹å‡»â€œGet STARTEDâ€ï¼Œå¹¶é€‰æ‹© â€œI want to install Disqus on my siteâ€ é€‰é¡¹</li>
<li>ç„¶ååœ¨è¿›å…¥è¡¨å•é¡µæŒ‰ç…§æç¤ºè¿›è¡Œå¡«å†™å³å¯ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œ<code>Website Name</code>è¿™ä¸ªæ˜¯ä½ çš„ä¸“å±ç½‘å€çš„åå­—ï¼Œéœ€è¦è®°ä½ï¼Œè¿˜æœ‰å°±æ˜¯åœ¨â€œSelect Planâ€è®°å¾—é€‰â€œBasicâ€</li>
<li>æœ€åä¿®æ”¹_config.ymlä¸­æŠŠshortnameæ›¿æ¢ä¸ºä½ åœ¨åˆ›å»ºæ—¶çš„åå­—ï¼Œä¸€èˆ¬ç°åœ¨çš„ä¸»é¢˜éƒ½å¸¦çš„æœ‰è¯„è®ºæ¨¡ç‰ˆï¼Œå¦‚æœæ²¡æœ‰å°±éœ€è¦è‡ªå·±æ·»åŠ äº†ï¼Œè¿™ä¸ªä¸åŒçš„ä¸»é¢˜ä¸å¤ªç›¸åŒï¼Œå¯ä»¥çœ‹ä¸‹å®˜æ–¹çš„å®‰è£…æ¨¡ç‰ˆè¿›è¡Œä¿®æ”¹<br><img src="https://img-blog.csdnimg.cn/d1dc79115212411383a8dbd11971aaee.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ol>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Reactæºç åˆ†æä¹‹diffæ ¸å¿ƒç®—æ³•</title>
    <url>/2022/09/04/React%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8Bdiff%E6%A0%B8%E5%BF%83%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul>
<li>Reactçš„diffç®—æ³•æ˜¯åœ¨renderçš„beginWorké˜¶æ®µä¸­è¿›è¡Œå¤„ç†</li>
<li><code>beginWork</code>æ˜¯åœ¨å‘ä¸‹æ·±åº¦éå†fiberæ ‘æ—¶ä¼šå¯¹é€”å¾„çš„æ¯ä¸ªèŠ‚ç‚¹è¿›è¡ŒçŠ¶æ€å¤„ç†å’Œè¿›è¡Œdiffå¯¹æ¯”</li>
<li>é¦–å…ˆdiffçš„å…¥å£æ˜¯åœ¨<code>reconcileChildFibers</code>ä¸­ï¼Œç„¶åä¼šæ ¹æ®typeæ¥åˆ¤æ–­ä½¿ç”¨å“ªç§diffå‡½æ•°è¿›è¡Œå¤„ç†<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">reconcileChildFibers</span>(<span class="params"></span>
<span class="params">  returnFiber: Fiber,</span>
<span class="params">  currentFirstChild: Fiber | <span class="literal">null</span>,</span>
<span class="params">  newChild: any,</span>
<span class="params">  lanes: Lanes,</span>
<span class="params"></span>): <span class="title class_">Fiber</span> | <span class="literal">null</span> &#123;
  <span class="keyword">if</span> (<span class="keyword">typeof</span> newChild === <span class="string">&#x27;object&#x27;</span> &amp;&amp; newChild !== <span class="literal">null</span>) &#123;
    <span class="keyword">switch</span> (newChild.<span class="property">$$typeof</span>) &#123;
      <span class="keyword">case</span> <span class="attr">REACT_ELEMENT_TYPE</span>:
        <span class="keyword">return</span> <span class="title function_">placeSingleChild</span>(
          <span class="title function_">reconcileSingleElement</span>(
            returnFiber,
            currentFirstChild,
            newChild,
            lanes,
          ),
        );Â·Â·
      <span class="keyword">case</span> <span class="attr">REACT_PORTAL_TYPE</span>:
        <span class="comment">// ...</span>
      <span class="keyword">case</span> <span class="attr">REACT_LAZY_TYPE</span>:
        <span class="comment">//...</span>
    &#125;

    <span class="keyword">if</span> (<span class="title function_">isArray</span>(newChild)) &#123;
      <span class="keyword">return</span> <span class="title function_">reconcileChildrenArray</span>(
        returnFiber,
        currentFirstChild,
        newChild,
        lanes,
      );
    &#125;

    <span class="keyword">if</span> (<span class="title function_">getIteratorFn</span>(newChild)) &#123;
      <span class="comment">//...</span>
    &#125;
  &#125;
  <span class="comment">// ...</span>
&#125;</code></pre></li>
<li>æˆ‘åœ¨æœ¬ç¯‡ä¼šé’ˆå¯¹ä¸¤ç§è¾ƒå¸¸ç”¨çš„diffå‡½æ•°è¿›è¡Œåˆ†æ<ul>
<li><code>reconcileSingleElement</code></li>
<li><code>reconcileChildrenArray</code></li>
</ul>
</li>
</ul>
<h2 id="reconcileSingleElement"><a href="#reconcileSingleElement" class="headerlink" title="reconcileSingleElement"></a>reconcileSingleElement</h2><ul>
<li>reconcileSingleElementæ˜¯é’ˆå¯¹æ–°newChildæ˜¯å•èŠ‚ç‚¹ï¼Œè€ŒoldChildå•èŠ‚ç‚¹æˆ–è€…æ˜¯å¤šèŠ‚ç‚¹å°±æ— æ³•ç¡®å®šäº†ï¼Œæ‰€ä»¥åœ¨æ­¤diffç®—æ³•ä¸­å°±ä¼šå¯¹æ—§èŠ‚ç‚¹è¿›è¡Œéå†ï¼Œç„¶ååˆ é™¤ä¸åŒ¹é…çš„oldFiber<pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">reconcileSingleElement</span>(<span class="params"></span>
<span class="params">  returnFiber: Fiber,</span>
<span class="params">  currentFirstChild: Fiber | <span class="literal">null</span>,</span>
<span class="params">  element: ReactElement</span>
<span class="params">  lanes: Lanes,</span>
<span class="params"></span>): <span class="title class_">Fiber</span> &#123;
  <span class="keyword">const</span> key = element.<span class="property">key</span>;
  <span class="keyword">let</span> child = currentFirstChild;
  <span class="comment">/**</span>
<span class="comment">    * éå†æ—§èŠ‚ç‚¹ï¼Œæ‰¾åˆ°ä¸newChildç›¸åŒkeyçš„èŠ‚ç‚¹ï¼Œä¸åŒ¹é…çš„åˆ é™¤</span>
<span class="comment">    * é’ˆå¯¹åŒ¹é…çš„oldFiber, ç”¨newChildä¸­æ–°èŠ‚ç‚¹çš„propsæ¥ç”Ÿæˆæ–°çš„fiberèŠ‚ç‚¹</span>
<span class="comment">    */</span>
  <span class="keyword">while</span> (child !== <span class="literal">null</span>) &#123;
    <span class="keyword">if</span> (child.<span class="property">key</span> === key) &#123;
      <span class="keyword">const</span> elementType = element.<span class="property">type</span>;
      <span class="comment">/**</span>
<span class="comment">        * é€šè¿‡useFiberåˆ›å»ºä¸€ä¸ªæ–°çš„Fiber</span>
<span class="comment">        * å¦‚æœelementæ˜¯ä¸€ä¸ªFragmentï¼Œåˆ™ä»¥element.props.childrenå»ºç«‹Fiber</span>
<span class="comment">        * å°†returnFiberèµ‹ç»™æ–°çš„fiberçš„returnå­—æ®µï¼Œç„¶åè¿”å›è¿™ä¸ªæ–°çš„fiber</span>
<span class="comment">        */</span>Â·
      <span class="keyword">if</span> (elementType === <span class="variable constant_">REACT_FRAGMENT_TYPE</span>) &#123;
        <span class="keyword">if</span> (child.<span class="property">tag</span> === <span class="title class_">Fragment</span>) &#123;
          <span class="title function_">deleteRemainingChildren</span>(returnFiber, child.<span class="property">sibling</span>);
          <span class="keyword">const</span> existing = <span class="title function_">useFiber</span>(child, element.<span class="property">props</span>.<span class="property">children</span>);
          existing.<span class="property">return</span> = returnFiber;
          <span class="keyword">if</span> (__DEV__) &#123;
            existing.<span class="property">_debugSource</span> = element.<span class="property">_source</span>;
            existing.<span class="property">_debugOwner</span> = element.<span class="property">_owner</span>;
          &#125;
          <span class="keyword">return</span> existing;
        &#125;
      &#125; <span class="keyword">else</span> &#123;
        <span class="keyword">if</span> (
          child.<span class="property">elementType</span> === elementType ||
          (__DEV__
            ? <span class="title function_">isCompatibleFamilyForHotReloading</span>(child, element)
            : <span class="literal">false</span>) ||
          (<span class="keyword">typeof</span> elementType === <span class="string">&#x27;object&#x27;</span> &amp;&amp;
            elementType !== <span class="literal">null</span> &amp;&amp;
            elementType.<span class="property">$$typeof</span> === <span class="variable constant_">REACT_LAZY_TYPE</span> &amp;&amp;
            <span class="title function_">resolveLazy</span>(elementType) === child.<span class="property">type</span>)
        ) &#123;
          <span class="title function_">deleteRemainingChildren</span>(returnFiber, child.<span class="property">sibling</span>);
          <span class="keyword">const</span> existing = <span class="title function_">useFiber</span>(child, element.<span class="property">props</span>);
          existing.<span class="property">ref</span> = <span class="title function_">coerceRef</span>(returnFiber, child, element);
          existing.<span class="property">return</span> = returnFiber;
          <span class="keyword">if</span> (__DEV__) &#123;
            existing.<span class="property">_debugSource</span> = element.<span class="property">_source</span>;
            existing.<span class="property">_debugOwner</span> = element.<span class="property">_owner</span>;
          &#125;
          <span class="keyword">return</span> existing;
        &#125;
      &#125;
      <span class="comment">// Didn&#x27;t match.</span>
      <span class="title function_">deleteRemainingChildren</span>(returnFiber, child);
      <span class="keyword">break</span>;
    &#125; <span class="keyword">else</span> &#123;
      <span class="comment">// keyä¸ç›¸åŒå°±åˆ é™¤</span>
      <span class="title function_">deleteChild</span>(returnFiber, child);
    &#125;
    child = child.<span class="property">sibling</span>;
  &#125;

  <span class="comment">// å¦‚æœæ²¡æœ‰å‘½ä¸­ä¸€ä¸ªkeyï¼Œåˆ™é€šè¿‡createFiberFormElementæˆ–CreateFiberFormFragmentåˆ›å»ºä¸€ä¸ªæ–°çš„fiberï¼Œç„¶åè¿”å›</span>
  <span class="keyword">if</span> (element.<span class="property">type</span> === <span class="variable constant_">REACT_FRAGMENT_TYPE</span>) &#123;
    <span class="keyword">const</span> created = <span class="title function_">createFiberFromFragment</span>(
      element.<span class="property">props</span>.<span class="property">children</span>,
      returnFiber.<span class="property">mode</span>,
      lanes,
      element.<span class="property">key</span>,
    );
    created.<span class="property">return</span> = returnFiber;
    <span class="keyword">return</span> created;
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">const</span> created = <span class="title function_">createFiberFromElement</span>(element, returnFiber.<span class="property">mode</span>, lanes);
    created.<span class="property">ref</span> = <span class="title function_">coerceRef</span>(returnFiber, currentFirstChild, element);
    created.<span class="property">return</span> = returnFiber;
    <span class="keyword">return</span> created;
  &#125;
&#125;</code></pre></li>
</ul>
<h2 id="reconcileChildrenArray"><a href="#reconcileChildrenArray" class="headerlink" title="reconcileChildrenArray"></a>reconcileChildrenArray</h2><ul>
<li><p>é’ˆå¯¹<code>newChild</code>æ˜¯å¤šèŠ‚ç‚¹çš„æƒ…å†µå°±éœ€è¦è°ƒç”¨<code>reconcileChildrenArray</code>è¿›è¡Œdiffæ“ä½œ</p>
</li>
<li><p>å¤šèŠ‚ç‚¹ä¼šæœ‰å››ç§å¯èƒ½æ€§çš„å˜åŒ–ï¼šåˆ é™¤ã€æ–°å¢ã€ä½ç§»ã€æ›´æ–°</p>
</li>
<li><p><code>reconcileChildrenArray</code>é’ˆå¯¹è¿™å››ç§å˜åŒ–ï¼Œé¦–å…ˆä¼šå¤„ç†çš„æ˜¯æ›´æ–°ï¼Œå½“å‡ºç°æ— æ³•åŒ¹é…çš„æƒ…å†µæ—¶ï¼Œå°±ä¼šæ ¹æ®éå†çš„æƒ…å†µæ¥åˆ¤æ–­æ˜¯å¦å¤„ç†åˆ é™¤æˆ–è€…æ–°å¢ï¼Œç„¶åæœ€åä¼šæ ¹æ®æƒ…å†µå¤„ç†ä½ç§»</p>
</li>
<li><p>å› ä¸ºfiberæ˜¯å•å‘é“¾è¡¨ï¼Œæ‰€ä»¥<code>reconcileChildrenArray</code>çš„éå†ä¸æ˜¯åŒç«¯éå†</p>
</li>
<li><p>é¦–å…ˆç¬¬ä¸€è½®éå†ï¼Œæ˜¯å¤„ç†èŠ‚ç‚¹æ›´æ–°</p>
<pre><code class="highlight ts"><span class="keyword">for</span> (; oldFiber !== <span class="literal">null</span> &amp;&amp; newIdx &lt; newChildren.<span class="property">length</span>; newIdx++) &#123;
  <span class="comment">// newChildrenéå†å®Œäº†ï¼ŒoldFiberæ²¡æœ‰éå†å®Œï¼Œä¸­æ–­éå†</span>
  <span class="keyword">if</span> (oldFiber.<span class="property">index</span> &gt; newIdx) &#123;
    nextOldFiber = oldFiber;
    oldFiber = <span class="literal">null</span>;
  &#125; <span class="keyword">else</span> &#123;
    <span class="comment">// è®°å½•oldFiberçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>
    nextOldFiber = oldFiber.<span class="property">sibling</span>;
  &#125;
  <span class="comment">// æ›´æ–°èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±ä¼šè¿”å›null</span>
  <span class="keyword">const</span> newFiber = <span class="title function_">updateSlot</span>(
    returnFiber,
    oldFiber,
    newChildren[newIdx],
    lanes,
  );
  <span class="comment">// newFiberä¸ºnullè¯´æ˜èŠ‚ç‚¹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œä¸­æ–­éå†</span>
  <span class="keyword">if</span> (newFiber === <span class="literal">null</span>) &#123;
    <span class="comment">// oldFiberä¸ºnullè¯´æ˜oldFiberä¹Ÿéå†å®Œäº†</span>
    <span class="keyword">if</span> (oldFiber === <span class="literal">null</span>) &#123;
      oldFiber = nextOldFiber;
    &#125;
    <span class="keyword">break</span>;
  &#125;

  <span class="comment">/**</span>
<span class="comment">   * shouldTrackSideEffectsä¸ºtrueè¡¨ç¤ºæ˜¯æ›´æ–°è¿‡ç¨‹</span>
<span class="comment">   * mountChildFibers = ChildReconciler(false);</span>
<span class="comment">   * reconcileChildFibers = ChildReconciler(true);</span>
<span class="comment">   * ChildReconcileræ¥æ”¶çš„å°±æ˜¯shouldTrackSideEffects</span>
<span class="comment">   */</span>
  <span class="keyword">if</span> (shouldTrackSideEffects) &#123;
    <span class="keyword">if</span> (oldFiber &amp;&amp; newFiber.<span class="property">alternate</span> === <span class="literal">null</span>) &#123;
      <span class="comment">// æ–°èŠ‚ç‚¹æ²¡æœ‰ç°æœ‰èŠ‚ç‚¹ï¼Œéœ€è¦åˆ é™¤</span>
      <span class="title function_">deleteChild</span>(returnFiber, oldFiber);
    &#125;
  &#125;
  <span class="comment">// è®°å½•å›ºå®šèŠ‚ç‚¹çš„ä½ç½®</span>
  lastPlacedIndex = <span class="title function_">placeChild</span>(newFiber, lastPlacedIndex, newIdx);

  <span class="comment">// å°†æ–°èŠ‚ç‚¹æ‹¼æ¥æˆä»¥siblingä¸ºæŒ‡é’ˆçš„å•å‘é“¾è¡¨</span>
  <span class="keyword">if</span> (previousNewFiber === <span class="literal">null</span>) &#123;
    resultingFirstChild = newFiber;
  &#125; <span class="keyword">else</span> &#123;
    previousNewFiber.<span class="property">sibling</span> = newFiber;
  &#125;
  previousNewFiber = newFiber;
  oldFiber = nextOldFiber;
&#125;</code></pre>
</li>
<li><p>éå†å®ŒåŒ¹é…çš„èŠ‚ç‚¹åï¼Œå°±åˆ¤æ–­æ–°èŠ‚ç‚¹æ˜¯å¦éå†å®Œï¼Œå¦‚æœéå†å®Œï¼Œé‚£ä¹ˆå‰©ä½™çš„oldFiberéƒ½æ˜¯è¦åˆ é™¤çš„</p>
<pre><code class="highlight ts"><span class="keyword">if</span> (newIdx === newChildren.<span class="property">length</span>) &#123;
  <span class="title function_">deleteRemainingChildren</span>(returnFiber, oldFiber);
  <span class="keyword">if</span> (<span class="title function_">getIsHydrating</span>()) &#123;
    <span class="keyword">const</span> numberOfForks = newIdx;
    <span class="title function_">pushTreeFork</span>(returnFiber, numberOfForks);
  &#125;
  <span class="keyword">return</span> resultingFirstChild;
&#125;</code></pre>
</li>
<li><p>å¦‚æœæ–°æ—§ç‚¹æ²¡æœ‰éå†å®Œï¼Œå°±åˆ¤æ–­æ—§fiberé“¾æ˜¯å¦éå†å®Œï¼Œå¦‚æœéå†å®Œé‚£ä¹ˆå‰©ä½™çš„æ–°èŠ‚ç‚¹å…¨éƒ¨ä½œä¸ºæ–°fiberæ’å…¥</p>
<pre><code class="highlight ts"><span class="keyword">if</span> (oldFiber === <span class="literal">null</span>) &#123;
  <span class="keyword">for</span> (; newIdx &lt; newChildren.<span class="property">length</span>; newIdx++) &#123;
    <span class="comment">// åˆ›å»ºæ–°fiberèŠ‚ç‚¹</span>
    <span class="keyword">const</span> newFiber = <span class="title function_">createChild</span>(returnFiber, newChildren[newIdx], lanes);
    <span class="keyword">if</span> (newFiber === <span class="literal">null</span>) &#123;
      <span class="keyword">continue</span>;
    &#125;

    <span class="comment">// è®°å½•å›ºå®šèŠ‚ç‚¹</span>
    lastPlacedIndex = <span class="title function_">placeChild</span>(newFiber, lastPlacedIndex, newIdx);

    <span class="comment">// å°†æ–°fiberæ‹¼æ¥æˆä»¥siblingä¸ºæŒ‡é’ˆçš„å•å‘é“¾è¡¨</span>
    <span class="keyword">if</span> (previousNewFiber === <span class="literal">null</span>) &#123;
      resultingFirstChild = newFiber;
    &#125; <span class="keyword">else</span> &#123;
      previousNewFiber.<span class="property">sibling</span> = newFiber;
    &#125;
    previousNewFiber = newFiber;
  &#125;
  <span class="keyword">if</span> (<span class="title function_">getIsHydrating</span>()) &#123;
    <span class="keyword">const</span> numberOfForks = newIdx;
    <span class="title function_">pushTreeFork</span>(returnFiber, numberOfForks);
  &#125;
  <span class="keyword">return</span> resultingFirstChild;
&#125;</code></pre>
</li>
<li><p>æ‰§è¡Œåˆ°è¿™ä¸€æ­¥ï¼Œè¯´æ˜æ–°æ—§èŠ‚ç‚¹éƒ½æ²¡æœ‰éå†å®Œï¼Œå°±è¯´æ˜å­˜åœ¨æœ‰ä½ç§»çš„æœªçŸ¥åºåˆ—</p>
<pre><code class="highlight ts"><span class="comment">// é¦–å…ˆåˆ›å»ºä¸€ä¸ªä»¥oldFiber keyä¸ºé”®ï¼Œå€¼ä¸ºoldFiberçš„map</span>
<span class="keyword">const</span> existingChildren = <span class="title function_">mapRemainingChildren</span>(returnFiber, oldFiber);

<span class="keyword">for</span> (; newIdx &lt; newChildren.<span class="property">length</span>; newIdx++) &#123;
  <span class="comment">// ç„¶åæ ¹æ®mapä¸­çš„oldFiberåˆ›å»ºæ–°fiber</span>
  <span class="keyword">const</span> newFiber = <span class="title function_">updateFromMap</span>(
    existingChildren,
    returnFiber,
    newIdx,
    newChildren[newIdx],
    lanes,
  );
  <span class="keyword">if</span> (newFiber !== <span class="literal">null</span>) &#123;
    <span class="keyword">if</span> (shouldTrackSideEffects) &#123;
      <span class="keyword">if</span> (newFiber.<span class="property">alternate</span> !== <span class="literal">null</span>) &#123;
        <span class="comment">// å¦‚æœnewFiber.alternateä¸ä¸ºnullï¼Œè¯´æ˜æ˜¯æ ¹æ®oldFiberåˆ›å»ºçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨mapä¸­åˆ é™¤oldFiber</span>
        existingChildren.<span class="title function_">delete</span>(
          newFiber.<span class="property">key</span> === <span class="literal">null</span> ? newIdx : newFiber.<span class="property">key</span>,
        );
      &#125;
    &#125;

    <span class="comment">// æ ¹æ®lastPlacedIndexåˆ¤æ–­æ˜¯å¦ç§»åŠ¨èŠ‚ç‚¹</span>
    lastPlacedIndex = <span class="title function_">placeChild</span>(newFiber, lastPlacedIndex, newIdx);

    <span class="comment">// å°†æ–°fiberæ‹¼æ¥æˆä»¥siblingä¸ºæŒ‡é’ˆçš„å•å‘é“¾è¡¨</span>
    <span class="keyword">if</span> (previousNewFiber === <span class="literal">null</span>) &#123;
      resultingFirstChild = newFiber;
    &#125; <span class="keyword">else</span> &#123;
      previousNewFiber.<span class="property">sibling</span> = newFiber;
    &#125;
    previousNewFiber = newFiber;
  &#125;
&#125;

<span class="keyword">if</span> (shouldTrackSideEffects) &#123;
  <span class="comment">// åˆ é™¤å‰©ä½™çš„oldFiber</span>
  existingChildren.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> <span class="title function_">deleteChild</span>(returnFiber, child));
&#125;</code></pre></li>
<li><p>ç§»åŠ¨èŠ‚ç‚¹çš„æ ¸å¿ƒæ˜¯åœ¨<code>placeChild</code>è¿™ä¸ªå‡½æ•°ä¸­ï¼Œå¦‚æœå½“å‰æ­£åœ¨éå†çš„èŠ‚ç‚¹çš„oldIndexæ˜¯åœ¨<code>lastPlacedIndex</code>çš„å³è¾¹ï¼Œå°±è¯´æ˜å®ƒçš„ä½ç½®æ²¡å˜åŒ–ï¼Œå› ä¸ºæ—§èŠ‚ç‚¹ä¸­å°±å¤„äºå³è¾¹ï¼Œæ–°èŠ‚ç‚¹ä¸­ä¹Ÿå¤„äºå³è¾¹ã€‚</p>
<ul>
<li>ä¾‹å¦‚ï¼šoldï¼šA -&gt; B -&gt; C -&gt; Dï¼Œnewï¼šD -&gt; A -&gt; B -&gt; C</li>
<li>éå†åˆ°Dæ—¶ï¼Œ<code>lastPlacedIndex = Dçš„oldIndex = 3</code></li>
<li>ç„¶åéå†åˆ°Aæ—¶ï¼ŒAçš„<code>oldIndex</code>ä¸º0ï¼Œå°äº3ï¼Œè¯´æ˜Aåœ¨æ—§åºåˆ—ä¸­è‚¯å®šä¸æ˜¯Dçš„å³è¾¹ï¼Œæ‰€ä»¥Aè‚¯å®šäº§ç”Ÿäº†ä½ç§»<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">placeChild</span>(<span class="params"></span>
<span class="params">  newFiber: Fiber,</span>
<span class="params">  lastPlacedIndex: number,</span>
<span class="params">  newIndex: number,</span>
<span class="params"></span>): number &#123;
  newFiber.<span class="property">index</span> = newIndex;
  <span class="keyword">if</span> (!shouldTrackSideEffects) &#123;
    newFiber.<span class="property">flags</span> |= <span class="title class_">Forked</span>;
    <span class="keyword">return</span> lastPlacedIndex;
  &#125;
  <span class="keyword">const</span> current = newFiber.<span class="property">alternate</span>;
  <span class="keyword">if</span> (current !== <span class="literal">null</span>) &#123;
    <span class="keyword">const</span> oldIndex = current.<span class="property">index</span>;
    <span class="keyword">if</span> (oldIndex &lt; lastPlacedIndex) &#123;
      <span class="comment">// å°äºlastPlacedIndex äº§ç”Ÿäº†ä½ç§»</span>
      newFiber.<span class="property">flags</span> |= <span class="title class_">Placement</span> | <span class="title class_">PlacementDEV</span>;
      <span class="keyword">return</span> lastPlacedIndex;
    &#125; <span class="keyword">else</span> &#123;
      <span class="comment">// æ²¡æœ‰ä½ç§»ï¼Œè¿”å›å½“å‰çš„oldIndex</span>
      <span class="keyword">return</span> oldIndex;
    &#125;
  &#125; <span class="keyword">else</span> &#123;
    newFiber.<span class="property">flags</span> |= <span class="title class_">Placement</span> | <span class="title class_">PlacementDEV</span>;
    <span class="keyword">return</span> lastPlacedIndex;
  &#125;
&#125;</code></pre></li>
</ul>
</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>é’ˆå¯¹å•èŠ‚ç‚¹çš„diffï¼Œä¼šéå†oldFiberé“¾ï¼Œå¦‚æœæœ‰åŒ¹é…çš„fiberï¼Œå°±ä»¥åŒ¹é…çš„ç”Ÿæˆæ–°fiberï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªfiberï¼Œç„¶ååˆ é™¤ä¸åŒ¹é…çš„fiber</li>
<li>é’ˆå¯¹å¤šèŠ‚ç‚¹diff<ul>
<li>é¦–å…ˆæ˜¯ä»å¤´å‘å°¾éå†ï¼Œé’ˆå¯¹å¤ç”¨çš„fiberè¿›è¡Œæ›´æ–°ï¼Œå¦‚æœæ— æ³•å¤ç”¨å°±ä¸­æ–­éå†</li>
<li>ç„¶ååˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„éå†æƒ…å†µï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ–°å¢æˆ–è€…åˆ é™¤</li>
<li>å¦‚æœéƒ½æ²¡æœ‰éå†å®Œï¼Œå°±åˆ›å»ºä¸€ä¸ªmap<code>Map&lt;old key, old Fiber&gt;</code>ï¼Œç„¶åéå†æ–°èŠ‚ç‚¹ï¼ŒåŸºäºmapæ¥åˆ›å»ºæ–°fiberï¼Œç„¶åæ ¹æ®<code>lastPlacedIndex</code>æ¥åˆ¤æ–­æ˜¯å¦äº§ç”Ÿäº†ä½ç§»ï¼Œéå†å®Œæœ€ååˆ é™¤å‰©ä½™çš„oldFiber</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3+Vite3 SSRåŸºæœ¬æ­å»º</title>
    <url>/2022/08/27/Vue3-Vite3-SSR%E5%9F%BA%E6%9C%AC%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<ul>
<li>é¦–å…ˆè¯´æ˜å¦‚æœæ˜¯ç”Ÿäº§ä½¿ç”¨å¼ºçƒˆæ¨èNuxtï¼Œä½†æ˜¯å¦‚æœæƒ³æ·±å…¥æœåŠ¡ç«¯æ¸²æŸ“çš„è¿è¡ŒåŸç†ï¼Œå¯ä»¥çœ‹æœ¬ç¯‡ï¼Œä¼šæ ¹æ®æ¸²æŸ“æµç¨‹æ­å»ºä¸€ä¸ªdemoç‰ˆssrï¼Œæºç åœ¨æœ€åä¼šè´´ä¸Š</li>
<li>ä¸»è¦æŠ€æœ¯æ ˆï¼šVite3 + Vue3 + pinia + VueRouter4 + express</li>
<li>å¼€å§‹æ­å»ºä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸‹SSRæ¸²æŸ“æµç¨‹</li>
</ul>
<h3 id="SSRæ¸²æŸ“æµç¨‹"><a href="#SSRæ¸²æŸ“æµç¨‹" class="headerlink" title="SSRæ¸²æŸ“æµç¨‹"></a>SSRæ¸²æŸ“æµç¨‹</h3><ul>
<li>é¦–å…ˆæµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨æ ¹æ®è¯·æ±‚çš„è·¯ç”±ï¼Œä¼šåŒ¹é…ç›¸å…³çš„è·¯ç”±ç»„ä»¶ï¼Œç„¶åæ‰§è¡Œç»„ä»¶çš„è‡ªå®šä¹‰æœåŠ¡ç«¯ç”Ÿå‘½å‘¨æœŸ(ä¾‹ï¼šNuxtçš„asyncData)æˆ–è€…è‡ªå®šä¹‰è·å–æ•°æ®çš„hookï¼Œå¹¶ä¸”æŠŠæ‰§è¡Œåçš„æ•°æ®æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€åœ¨windowçš„å±æ€§ä¸­å­˜å‚¨</li>
<li>ç„¶åvueçš„ç»„ä»¶ä¼šè¢«renderToStringæ¸²æŸ“æˆé™æ€HTMLå­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ‰index.htmlçš„æå‰æŒ‡å®šçš„å ä½ä»£ç ã€‚ç„¶åindex.htmlæ”¹å˜åçš„é™æ€å­—ç¬¦ä¸²å‘ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯æ‹¿åˆ°åï¼Œé¦–å…ˆå¯¹æ•°æ®è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åè¿›è¡Œæ¿€æ´»ï¼Œå› ä¸ºå½“å‰htmlåªæ˜¯é™æ€æ•°æ®ï¼Œæ¿€æ´»ä¸»è¦åšä¸¤ä»¶äº‹<ul>
<li><ol>
<li>æŠŠé¡µé¢ä¸­çš„DOMå…ƒç´ ä¸è™šæ‹ŸDOMä¹‹é—´å»ºç«‹è”ç³»</li>
</ol>
</li>
<li><ol start="2">
<li>ä¸ºé¡µé¢ä¸­çš„DOMå…ƒç´ æ·»åŠ äº‹ä»¶ç»‘å®š</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="1-åˆ›å»ºé¡¹ç›®"><a href="#1-åˆ›å»ºé¡¹ç›®" class="headerlink" title="1. åˆ›å»ºé¡¹ç›®"></a>1. åˆ›å»ºé¡¹ç›®</h3><ul>
<li>é¦–å…ˆç”¨viteå‘½ä»¤åˆ›å»ºé¡¹ç›®<code>pnpm create vite vue-ssr --template vue-ts</code><ul>
<li>å®‰è£…ç›¸å…³ä¾èµ–ï¼š<code>pnpm add express pinia vue-router@4</code></li>
</ul>
</li>
<li>åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ <code>touch server.js  src/entry-client.ts src/entry-server.js</code><ul>
<li>server.jsï¼šæœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶</li>
<li>entry-client.tsï¼šå®¢æˆ·ç«¯å…¥å£ï¼Œåº”ç”¨æŒ‚è½½å…ƒç´ </li>
<li>entry-server.jsï¼šæœåŠ¡ç«¯å…¥å£ï¼Œå¤„ç†æœåŠ¡ç«¯é€»è¾‘å’Œé™æ€èµ„æº</li>
</ul>
</li>
<li>ä¿®æ”¹<code>package.json</code>è¿è¡Œè„šæœ¬<pre><code class="highlight js"><span class="string">&quot;scripts&quot;</span>: &#123;
  <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;node server&quot;</span>, <span class="comment">// è¿è¡Œå¼€å‘ç¯å¢ƒ</span>
&#125;</code></pre></li>
<li>ç„¶åéœ€è¦æŠŠåº”ç”¨åˆ›å»ºéƒ½æ”¹ä¸ºå‡½æ•°çš„æ–¹å¼è¿›è¡Œè°ƒç”¨åˆ›å»ºï¼Œå› ä¸ºåœ¨SSRç¯å¢ƒä¸‹ï¼Œå’Œçº¯å®¢æˆ·ç«¯ä¸ä¸€æ ·ï¼ŒæœåŠ¡å™¨åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢çŠ¶æ€æ±¡æŸ“ï¼Œæ¯æ¬¡è¯·æ±‚å¿…é¡»æ˜¯å…¨æ–°çš„å®ä¾‹<pre><code class="highlight js"><span class="comment">// src/main.ts</span>
<span class="keyword">import</span> &#123; createSSRApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>
<span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>
<span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>
<span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>

<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> app = <span class="title function_">createSSRApp</span>(<span class="title class_">App</span>)
  <span class="keyword">const</span> router = <span class="title function_">createRouter</span>()
  <span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()
  app.<span class="title function_">use</span>(router)
  app.<span class="title function_">use</span>(pinia)
  <span class="keyword">return</span> &#123; app, router, pinia &#125;
&#125;</code></pre></li>
<li>roteråŒç†<pre><code class="highlight js"><span class="comment">// src/router/index</span>
<span class="keyword">import</span> &#123; createRouter <span class="keyword">as</span> _createRrouter, createMemoryHistory, createWebHistory, <span class="title class_">RouteRecordRaw</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>

<span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">RouteRecordRaw</span>[] = [
  ...
]

<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createRouter</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="title function_">_createRrouter</span>(&#123;
    <span class="attr">history</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">SSR</span> ? <span class="title function_">createMemoryHistory</span>() : <span class="title function_">createWebHistory</span>(),
    routes,
  &#125;)
&#125;</code></pre></li>
<li>ç„¶åä¿®æ”¹index.htmlï¼Œå¢åŠ æ³¨é‡Šå ä½å’Œå®¢æˆ·ç«¯å…¥å£æ–‡ä»¶ï¼Œåœ¨ä¹‹åçš„æœåŠ¡ç«¯æ¸²æŸ“æ—¶æ³¨å…¥<pre><code class="highlight html"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>
  <span class="tag">&lt;<span class="name">head</span>&gt;</span>
    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/vite.svg&quot;</span> /&gt;</span>
    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span>
    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vite + Vue + TS<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
    <span class="comment">&lt;!-- é™æ€èµ„æºå ä½ .js .css ... --&gt;</span>
    <span class="comment">&lt;!--preload-links--&gt;</span>
  <span class="tag">&lt;/<span class="name">head</span>&gt;</span>
  <span class="tag">&lt;<span class="name">body</span>&gt;</span>
    <span class="comment">&lt;!-- åº”ç”¨ä»£ç å ä½ --&gt;</span>
    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="comment">&lt;!--ssr-outlet--&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>
    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/src/main.ts&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
    <span class="comment">&lt;!-- å¼•ç”¨å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶ --&gt;</span>
    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/src/entry-client.ts&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span>
<span class="language-xml"><span class="language-handlebars">      // æœåŠ¡ç«¯è·å–çš„æ•°æ®ç»Ÿä¸€æŒ‚è½½åˆ°windowä¸Š</span></span>
<span class="language-xml"><span class="language-handlebars">      window.__INITIAL_STATE__ = &#x27;<span class="comment">&lt;!--pinia-state--&gt;</span>&#x27;</span></span>
<span class="language-xml"><span class="language-handlebars">    </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
  <span class="tag">&lt;/<span class="name">body</span>&gt;</span>
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre></li>
</ul>
<h3 id="2-æœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶"><a href="#2-æœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶" class="headerlink" title="2. æœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶"></a>2. æœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶</h3><ul>
<li>åˆ›å»ºé¡¹ç›®åï¼Œå°±å¼€å§‹ç¼–å†™æœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯é¡¹ç›®æ ¹è·¯å¾„ä¸‹çš„server.jsæ–‡ä»¶</li>
<li>è¿™ä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ˜¯å¯åŠ¨ä¸€ä¸ªnodeæœåŠ¡ï¼Œç„¶åæ ¹æ®è¯·æ±‚ï¼Œè¯»å–htmlæ–‡ä»¶ï¼Œå¤„ç†èµ„æºåæŠŠæ³¨é‡Šè¿›è¡Œæ›¿æ¢ï¼Œæœ€åæŠŠhtmlå‘é€ç»™å®¢æˆ·ç«¯<pre><code class="highlight js"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>
<span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>
<span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">&#x27;url&#x27;</span>
<span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>

<span class="keyword">import</span> &#123; createRequire &#125; <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;
<span class="keyword">const</span> __dirname = path.<span class="title function_">dirname</span>(<span class="title function_">fileURLToPath</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))
<span class="keyword">const</span> <span class="built_in">require</span> = <span class="title function_">createRequire</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>);
<span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">p</span>) =&gt; path.<span class="title function_">resolve</span>(__dirname, p);

<span class="keyword">const</span> <span class="title function_">createServer</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;
  <span class="comment">// åˆ›å»ºnodeæœåŠ¡</span>
  <span class="keyword">const</span> app = <span class="title function_">express</span>()

  <span class="comment">/**</span>
<span class="comment">   * @å®˜æ–¹è§£é‡Š</span>
<span class="comment">   * ä»¥ä¸­é—´ä»¶æ¨¡å¼åˆ›å»ºviteåº”ç”¨ï¼Œè¿™å°†ç¦ç”¨viteè‡ªèº«çš„HTMLæœåŠ¡é€»è¾‘</span>
<span class="comment">   * å¹¶è®©ä¸Šçº§æœåŠ¡å™¨æ¥ç®¡</span>
<span class="comment">   */</span>
  <span class="keyword">const</span> vite = <span class="keyword">await</span> <span class="built_in">require</span>(<span class="string">&#x27;vite&#x27;</span>).<span class="title function_">createServer</span>(&#123;
    <span class="attr">server</span>: &#123;
      <span class="attr">middlewareMode</span>: <span class="literal">true</span>,
    &#125;,
    <span class="attr">appType</span>: <span class="string">&#x27;custom&#x27;</span>
  &#125;);
  app.<span class="title function_">use</span>(vite.<span class="property">middlewares</span>);
  
  app.<span class="title function_">use</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;
    <span class="keyword">const</span> url = req.<span class="property">originalUrl</span>
    <span class="keyword">try</span> &#123;
      <span class="comment">// è¯»å–index.html</span>
      <span class="keyword">let</span> template = fs.<span class="title function_">readFileSync</span>(
        <span class="title function_">resolve</span>(<span class="string">&#x27;index.html&#x27;</span>),
        <span class="string">&#x27;utf-8&#x27;</span>
      )
      <span class="comment">// åº”ç”¨vite htmlè½¬æ¢ï¼Œä¼šæ³¨å…¥vite HMR</span>
      template = <span class="keyword">await</span> vite.<span class="title function_">transformIndexHtml</span>(url, template)

      <span class="comment">// åŠ è½½æœåŠ¡ç«¯å…¥å£</span>
      <span class="keyword">const</span> render = (<span class="keyword">await</span> vite.<span class="title function_">ssrLoadModule</span>(<span class="string">&#x27;/src/entry-server.js&#x27;</span>)).<span class="property">render</span>
      <span class="keyword">const</span> [ appHtml, piniaState ] = <span class="keyword">await</span> <span class="title function_">render</span>(url)

      <span class="comment">// æ›¿æ¢å¤„ç†è¿‡åçš„æ¨¡ç‰ˆ</span>
      <span class="keyword">const</span> html = template
        .<span class="title function_">replace</span>(<span class="string">`&lt;!--ssr-outlet--&gt;`</span>, appHtml)
        .<span class="title function_">replace</span>(<span class="string">`&lt;!--pinia-state--&gt;`</span>, piniaState)
      res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">set</span>(&#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span> &#125;).<span class="title function_">end</span>(html)
    &#125; <span class="keyword">catch</span> (error) &#123;
      vite?.<span class="title function_">ssrFixStacktrace</span>(error)
      <span class="title function_">next</span>(e)
    &#125;
  &#125;)

  <span class="comment">// ç›‘å¬5100ç«¯å£</span>
  app.<span class="title function_">listen</span>(<span class="number">5100</span>)
&#125;

<span class="title function_">createServer</span>();</code></pre></li>
</ul>
<h3 id="3-æœåŠ¡ç«¯å…¥å£æ–‡ä»¶"><a href="#3-æœåŠ¡ç«¯å…¥å£æ–‡ä»¶" class="headerlink" title="3. æœåŠ¡ç«¯å…¥å£æ–‡ä»¶"></a>3. æœåŠ¡ç«¯å…¥å£æ–‡ä»¶</h3><ul>
<li>æœåŠ¡ç«¯å…¥å£æ–‡ä»¶ä¸»è¦æ˜¯è°ƒç”¨SSRçš„renderToStringå’Œæ”¶é›†éœ€è¦å‘é€çš„èµ„æºå’Œæ•°æ®<pre><code class="highlight js"><span class="keyword">import</span> &#123; renderToString &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>
<span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;./main&#x27;</span>

<span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">url, manifest</span>) &#123;
  <span class="keyword">const</span> &#123; app, router, pinia &#125; = <span class="title function_">createApp</span>()

  router.<span class="title function_">push</span>(url)
  <span class="keyword">await</span> router.<span class="title function_">isReady</span>()

  <span class="keyword">const</span> ctx = &#123;&#125;
  <span class="keyword">const</span> html = <span class="keyword">await</span> <span class="title function_">renderToString</span>(app, ctx)
  <span class="keyword">return</span> [html, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(pinia.<span class="property">state</span>.<span class="property">value</span>)]
&#125;</code></pre></li>
</ul>
<h3 id="4-å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶"><a href="#4-å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶" class="headerlink" title="4. å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶"></a>4. å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶</h3><ul>
<li>å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶ä¸»è¦ç”¨äºæŒ‚è½½èŠ‚ç‚¹å’Œåˆå§‹åŒ–æ•°æ®<pre><code class="highlight js"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;./main&#x27;</span>

<span class="keyword">const</span> &#123; app, router, pinia &#125; = <span class="title function_">createApp</span>()

router.<span class="title function_">isReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;
  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">__INITIAL_STATE__</span>) &#123;
    pinia.<span class="property">state</span>.<span class="property">value</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">window</span>.<span class="property">__INITIAL_STATE__</span>);
  &#125;

  app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)
&#125;)</code></pre></li>
</ul>
<h3 id="5-ç»„ä»¶å’Œé¡µé¢"><a href="#5-ç»„ä»¶å’Œé¡µé¢" class="headerlink" title="5. ç»„ä»¶å’Œé¡µé¢"></a>5. ç»„ä»¶å’Œé¡µé¢</h3><ul>
<li>ç»„ä»¶å’Œé¡µé¢è·å–æ•°æ®ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å¢åŠ ä¸€ä¸ª<code>asyncData</code>é€‰é¡¹ï¼Œç„¶ååœ¨enter-server.jsçš„é€»è¾‘ä¸­å¢åŠ éå†å½“å‰ç»„ä»¶çš„é€»è¾‘ï¼Œç»Ÿä¸€è§¦å‘<code>asyncData</code>ï¼Œä½†æ˜¯ç°åœ¨éƒ½æ˜¯ç”¨<code>script setup</code>çš„æ–¹å¼å†™ä¸šåŠ¡ä»£ç ï¼Œæ‰€ä»¥æœ‰ç‚¹éº»çƒ¦ï¼Œ<pre><code class="highlight js">&lt;script&gt;
  <span class="keyword">export</span> defualt &#123;
    <span class="title function_">asyncData</span>(<span class="params"></span>) &#123;
      <span class="comment">// æœåŠ¡ç«¯è·å–æ•°æ®é€»è¾‘</span>
    &#125;
  &#125;
&lt;/script&gt;

<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&#x27;ts&#x27;</span>&gt;</span></span>
<span class="language-xml">  ...</span>
<span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></code></pre></li>
<li>å¦ä¸€ç§å°±æ˜¯hookçš„æ–¹å¼ï¼Œé€šè¿‡<code>import.meta.env.SSR</code>çš„æ–¹å¼è¿›è¡Œåˆ¤æ–­</li>
<li>å¯¹äºæ•°æ®å…·ä½“å­˜å‚¨æ–¹å¼ï¼Œå¤§æ¦‚æœ‰ä¸‰ç§ï¼Œä¸€ç§æ˜¯å­˜åœ¨vuexæˆ–è€…piniaè¿™ç§å…¨å±€çŠ¶æ€åº“ä¸­ï¼Œä¸€ç§æ˜¯å­˜åœ¨contextä¸Šä¸‹æ–‡ä¸­ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯è‡ªå®šä¹‰æ•°æ®</li>
</ul>
<h3 id="6-ç”Ÿäº§ç¯å¢ƒ"><a href="#6-ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="6. ç”Ÿäº§ç¯å¢ƒ"></a>6. ç”Ÿäº§ç¯å¢ƒ</h3><h4 id="6-1-pacnakge-json"><a href="#6-1-pacnakge-json" class="headerlink" title="6.1 pacnakge.json"></a>6.1 pacnakge.json</h4><ul>
<li>å¢åŠ æ„å»ºè„šæœ¬<pre><code class="highlight diff">&quot;scripts&quot;: &#123;
  &quot;dev&quot;: &quot;node server&quot;,
<span class="addition">+ &quot;build&quot;: &quot;npm run build:client &amp;&amp; npm run build:server&quot;,</span>
<span class="addition">+  &quot;build:client&quot;: &quot;vite build --ssrManifest --outDir dist/client&quot;,</span>
<span class="addition">+  &quot;build:server&quot;: &quot;vite build --ssr src/entry-server.js --outDir dist/server&quot;,</span>
<span class="addition">+  &quot;serve&quot;: &quot;cross-env NODE_ENV=production node server&quot;</span>
&#125;,</code></pre></li>
</ul>
<h4 id="6-2-æœåŠ¡ç«¯è¿è¡Œæ–‡ä»¶"><a href="#6-2-æœåŠ¡ç«¯è¿è¡Œæ–‡ä»¶" class="headerlink" title="6.2 æœåŠ¡ç«¯è¿è¡Œæ–‡ä»¶"></a>6.2 æœåŠ¡ç«¯è¿è¡Œæ–‡ä»¶</h4><ul>
<li>é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒï¼Œéœ€è¦å¯åŠ¨é™æ€èµ„æºæœåŠ¡ï¼Œå¼•ç”¨è·¯å¾„éœ€è¦æ”¹ä¸ºdistç›®å½•ä¸‹</li>
</ul>
<pre><code class="highlight diff">import fs from &#x27;fs&#x27;
import path from &#x27;path&#x27;
import &#123; fileURLToPath &#125; from &#x27;url&#x27;
import express from &#x27;express&#x27;

import &#123; createRequire &#125; from &#x27;module&#x27;;
const __dirname = path.dirname(fileURLToPath(import.meta.url))
const require = createRequire(import.meta.url);
const resolve = (p) =&gt; path.resolve(__dirname, p);

const createServer = async (isProd = process.env.NODE_ENV <span class="comment">=== &#x27;production&#x27;) =&gt; &#123;</span>
  const app = express()

<span class="deletion">-  const vite = await require(&#x27;vite&#x27;).createServer(&#123;</span>
<span class="deletion">-    server: &#123;</span>
<span class="deletion">-      middlewareMode: true,</span>
<span class="deletion">-    &#125;,</span>
<span class="deletion">-    appType: &#x27;custom&#x27;</span>
<span class="deletion">-  &#125;);</span>
<span class="deletion">-  app.use(vite.middlewares);</span>

<span class="addition">+  let vite;</span>
<span class="addition">+  if (isProd) &#123;</span>
<span class="addition">+    app.use(require(&#x27;compression&#x27;)());</span>
<span class="addition">+    app.use(</span>
<span class="addition">+      require(&#x27;serve-static&#x27;)(resolve(&#x27;./dist/client&#x27;), &#123;</span>
<span class="addition">+        index: false</span>
<span class="addition">+      &#125;)</span>
<span class="addition">+    );</span>
<span class="addition">+  &#125; else &#123;</span>
<span class="addition">+    vite = await require(&#x27;vite&#x27;).createServer(&#123;</span>
<span class="addition">+      server: &#123;</span>
<span class="addition">+        middlewareMode: true,</span>
<span class="addition">+      &#125;,</span>
<span class="addition">+      appType: &#x27;custom&#x27;</span>
<span class="addition">+    &#125;);</span>
<span class="addition">+    app.use(vite.middlewares);</span>
<span class="addition">+  &#125;</span>
   // é€šè¿‡bulid --ssrManifestå‘½ä»¤ç”Ÿæˆçš„é™æ€èµ„æºæ˜ å°„éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¼•ç”¨
<span class="addition">+  const manifest = isProd ? fs.readFileSync(resolve(&#x27;./dist/client/ssr-manifest.json&#x27;), &#x27;utf-8&#x27;) :&#123;&#125;</span>
  
  app.use(&#x27;*&#x27;, async (req, res, next) =&gt; &#123;
    const url = req.originalUrl
    try &#123;
<span class="deletion">-      let template = fs.readFileSync(</span>
<span class="deletion">-        resolve(&#x27;index.html&#x27;),</span>
<span class="deletion">-        &#x27;utf-8&#x27;</span>
<span class="deletion">-      )</span>
<span class="deletion">-      template = await vite.transformIndexHtml(url, template)</span>
<span class="deletion">-      const render = (await vite.ssrLoadModule(&#x27;/src/entry-server.js&#x27;)).render</span>
<span class="deletion">-      const [ appHtml, piniaState ] = await render(url)</span>

<span class="addition">+      let template, render</span>
<span class="addition">+      if (isProd) &#123;</span>
<span class="addition">+        template = fs.readFileSync(resolve(&#x27;./dist/client/index.html&#x27;), &#x27;utf-8&#x27;)</span>
<span class="addition">+        render = (await import(&#x27;./dist/server/entry-server.js&#x27;)).render</span>
<span class="addition">+      &#125; else &#123;</span>
<span class="addition">+        template = fs.readFileSync(</span>
<span class="addition">+          resolve(&#x27;index.html&#x27;),</span>
<span class="addition">+          &#x27;utf-8&#x27;</span>
<span class="addition">+        )</span>
<span class="addition">+        template = await vite.transformIndexHtml(url, template)</span>
<span class="addition">+        render = (await vite.ssrLoadModule(&#x27;/src/entry-server.js&#x27;)).render</span>
<span class="addition">+      &#125;</span>
<span class="addition">+      const [ appHtml, preloadLinks, piniaState ] = await render(url, manifest)</span>
      const html = template
        .replace(`&lt;!--preload-links--&gt;`, preloadLinks)
        .replace(`&lt;!--ssr-outlet--&gt;`, appHtml)
<span class="addition">+        .replace(`&lt;!--pinia-state--&gt;`, piniaState)</span>
      res.status(200).set(&#123; &#x27;Content-Type&#x27;: &#x27;text/html&#x27; &#125;).end(html)
    &#125; catch (error) &#123;
      vite?.ssrFixStacktrace(error)
      next()
    &#125;
  &#125;)

  app.listen(5100)
&#125;

createServer();
</code></pre>

<h4 id="6-3-æœåŠ¡ç«¯å…¥å£æ–‡ä»¶"><a href="#6-3-æœåŠ¡ç«¯å…¥å£æ–‡ä»¶" class="headerlink" title="6.3 æœåŠ¡ç«¯å…¥å£æ–‡ä»¶"></a>6.3 æœåŠ¡ç«¯å…¥å£æ–‡ä»¶</h4><ul>
<li>æœåŠ¡ç«¯å…¥å£æ–‡ä»¶ä¸»è¦æ˜¯å¢åŠ äº†æ„å»ºæ—¶ç”Ÿæˆçš„é™æ€èµ„æºæ˜ å°„å¤„ç†çš„é€»è¾‘<pre><code class="highlight diff">import &#123; basename &#125; from &#x27;path&#x27;
import &#123; renderToString &#125; from &#x27;vue/server-renderer&#x27;
import &#123; createApp &#125; from &#x27;./main&#x27;

export async function render(url, manifest) &#123;
  const &#123; app, router, pinia &#125; = createApp()

  router.push(url)
  await router.isReady()

  const ctx = &#123;&#125;
  const html = await renderToString(app, ctx)
<span class="addition">+  const preloadLinks = renderPreloadLinks(ctx.modules, manifest)</span>
<span class="addition">+  return [html, preloadLinks, JSON.stringify(pinia.state.value)]</span>
&#125;

 function renderPreloadLinks(modules, manifest) &#123;
   let links = &#x27;&#x27;
   const seen = new Set()
   modules.forEach((id) =&gt; &#123;
     const files = manifest[id]
     if (files) &#123;
       files.forEach((file) =&gt; &#123;
         if (!seen.has(file)) &#123;
           seen.add(file)
           const filename = basename(file)
           if (manifest[filename]) &#123;
             for (const depFile of manifest[filename]) &#123;
               links += renderPreloadLink(depFile)
               seen.add(depFile)
             &#125;
           &#125;
           links += renderPreloadLink(file)
         &#125;
       &#125;)
     &#125;
   &#125;)
   return links
 &#125;
 
 function renderPreloadLink(file) &#123;
   if (file.endsWith(&#x27;.js&#x27;)) &#123;
     return `&lt;link rel=&quot;modulepreload&quot; crossorigin href=&quot;$&#123;file&#125;&quot;&gt;`
   &#125; else if (file.endsWith(&#x27;.css&#x27;)) &#123;
     return `&lt;link rel=&quot;stylesheet&quot; href=&quot;$&#123;file&#125;&quot;&gt;`
   &#125; else if (file.endsWith(&#x27;.woff&#x27;)) &#123;
     return ` &lt;link rel=&quot;preload&quot; href=&quot;$&#123;file&#125;&quot; as=&quot;font&quot; type=&quot;font/woff&quot; crossorigin&gt;`
   &#125; else if (file.endsWith(&#x27;.woff2&#x27;)) &#123;
     return ` &lt;link rel=&quot;preload&quot; href=&quot;$&#123;file&#125;&quot; as=&quot;font&quot; type=&quot;font/woff2&quot; crossorigin&gt;`
   &#125; else if (file.endsWith(&#x27;.gif&#x27;)) &#123;
     return ` &lt;link rel=&quot;preload&quot; href=&quot;$&#123;file&#125;&quot; as=&quot;image&quot; type=&quot;image/gif&quot;&gt;`
   &#125; else if (file.endsWith(&#x27;.jpg&#x27;) || file.endsWith(&#x27;.jpeg&#x27;)) &#123;
     return ` &lt;link rel=&quot;preload&quot; href=&quot;$&#123;file&#125;&quot; as=&quot;image&quot; type=&quot;image/jpeg&quot;&gt;`
   &#125; else if (file.endsWith(&#x27;.png&#x27;)) &#123;
     return ` &lt;link rel=&quot;preload&quot; href=&quot;$&#123;file&#125;&quot; as=&quot;image&quot; type=&quot;image/png&quot;&gt;`
   &#125; else &#123;
     return &#x27;&#x27;
   &#125;
 &#125;</code></pre></li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li><a href="https://github.com/LHRUN/vue-ssr">repo</a></li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://vuejs.org/guide/scaling-up/ssr.html">Server-Side Rendering</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>Vite</tag>
        <tag>SSR</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3æ¨¡ç‰ˆç¼–è¯‘åŸç†</title>
    <url>/2022/08/31/Vue3%E6%A8%A1%E7%89%88%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="æ¨¡ç‰ˆç¼–è¯‘æµç¨‹"><a href="#æ¨¡ç‰ˆç¼–è¯‘æµç¨‹" class="headerlink" title="æ¨¡ç‰ˆç¼–è¯‘æµç¨‹"></a>æ¨¡ç‰ˆç¼–è¯‘æµç¨‹</h2><p>Vue3æ¨¡ç‰ˆç¼–è¯‘å°±æ˜¯æŠŠtemplateå­—ç¬¦ä¸²ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°</p>
<pre><code class="highlight js"><span class="comment">// template</span>
&lt;div&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;LH_R&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&lt;/div&gt;

<span class="comment">// render</span>
<span class="keyword">import</span> &#123; toDisplayString <span class="keyword">as</span> _toDisplayString, createElementVNode <span class="keyword">as</span> _createElementVNode, openBlock <span class="keyword">as</span> _openBlock, createElementBlock <span class="keyword">as</span> _createElementBlock &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>

<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">_ctx, _cache, $props, $setup, $data, $options</span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, [
    <span class="title function_">_createElementVNode</span>(<span class="string">&quot;p&quot;</span>, <span class="literal">null</span>, <span class="title function_">_toDisplayString</span>(_ctx.<span class="property">LH_R</span>), <span class="number">1</span> <span class="comment">/* TEXT */</span>)
  ]))
&#125;</code></pre>

<p>æˆ‘ä¼šæŒ‰ç…§ç¼–è¯‘æµç¨‹åˆ†3æ­¥åˆ†æ</p>
<ol>
<li><strong>parse</strong>ï¼šå°†æ¨¡ç‰ˆå­—ç¬¦ä¸²è½¬æ¢æˆæ¨¡ç‰ˆAST</li>
<li><strong>transform</strong>ï¼šå°†æ¨¡ç‰ˆASTè½¬æ¢ä¸ºç”¨äºæè¿°æ¸²æŸ“å‡½æ•°çš„AST</li>
<li><strong>generate</strong>ï¼šæ ¹æ®ASTç”Ÿæˆæ¸²æŸ“å‡½æ•°<pre><code class="highlight ts"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">baseCompile</span>(<span class="params"></span>
<span class="params">  template: <span class="built_in">string</span> | RootNode,</span>
<span class="params">  options: CompilerOptions = &#123;&#125;</span>
<span class="params"></span>): <span class="title class_">CodegenResult</span> &#123;
  <span class="comment">// ...</span>
  <span class="keyword">const</span> ast = <span class="title function_">isString</span>(template) ? <span class="title function_">baseParse</span>(template, options) : template

  <span class="keyword">const</span> [nodeTransforms, directiveTransforms] = <span class="title function_">getBaseTransformPreset</span>(
    prefixIdentifiers
  )
  <span class="title function_">transform</span>(
    ast,
    <span class="title function_">extend</span>(&#123;&#125;, options, &#123;
      prefixIdentifiers,
      <span class="attr">nodeTransforms</span>: [
        ...nodeTransforms,
        ...(options.<span class="property">nodeTransforms</span> || []) <span class="comment">// user transforms</span>
      ],
      <span class="attr">directiveTransforms</span>: <span class="title function_">extend</span>(
        &#123;&#125;,
        directiveTransforms,
        options.<span class="property">directiveTransforms</span> || &#123;&#125; <span class="comment">// user transforms</span>
      )
    &#125;)
  )

  <span class="keyword">return</span> <span class="title function_">generate</span>(
    ast,
    <span class="title function_">extend</span>(&#123;&#125;, options, &#123;
      prefixIdentifiers
    &#125;)
  )
&#125;</code></pre></li>
</ol>
<h2 id="parse"><a href="#parse" class="headerlink" title="parse"></a>parse</h2><ul>
<li><p>parseå¯¹æ¨¡ç‰ˆå­—ç¬¦ä¸²è¿›è¡Œéå†ï¼Œç„¶åå¾ªç¯åˆ¤æ–­å¼€å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾æŠŠå­—ç¬¦ä¸²åˆ†å‰²æˆä¸€ä¸ªä¸ª<strong>token</strong>ï¼Œå­˜åœ¨ä¸€ä¸ªtokenåˆ—è¡¨ï¼Œç„¶åæ‰«ætokenåˆ—è¡¨å¹¶ç»´æŠ¤ä¸€ä¸ªå¼€å§‹æ ‡ç­¾æ ˆï¼Œæ¯å½“æ‰«æä¸€ä¸ªå¼€å§‹æ ‡ç­¾èŠ‚ç‚¹ï¼Œå°±å°†å…¶å‹å…¥æ ˆé¡¶ï¼Œæ ˆé¡¶çš„èŠ‚ç‚¹å§‹ç»ˆä½œä¸ºä¸‹ä¸€ä¸ªæ‰«æçš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œå½“æ‰€æœ‰Tokenæ‰«æå®Œæˆåï¼Œå³å¯æ„å»ºæˆä¸€é¢—æ ‘å½¢AST</p>
</li>
<li><p>ä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆ<strong>parseChildren</strong>æºç ï¼Œæ˜¯parseçš„ä¸»å…¥å£</p>
<pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">parseChildren</span>(<span class="params"></span>
<span class="params">  context: ParserContext,</span>
<span class="params">  mode: TextModes,</span>
<span class="params">  ancestors: ElementNode[] <span class="comment">// èŠ‚ç‚¹æ ˆç»“æ„ï¼Œç”¨äºç»´æŠ¤èŠ‚ç‚¹åµŒå¥—å…³ç³»</span></span>
<span class="params"></span>): <span class="title class_">TemplateChildNode</span>[] &#123;
  <span class="comment">// è·å–çˆ¶èŠ‚ç‚¹</span>
  <span class="keyword">const</span> parent = <span class="title function_">last</span>(ancestors)
  <span class="keyword">const</span> ns = parent ? parent.<span class="property">ns</span> : <span class="title class_">Namespaces</span>.<span class="property">HTML</span>
  <span class="keyword">const</span> <span class="attr">nodes</span>: <span class="title class_">TemplateChildNode</span>[] = [] <span class="comment">// å­˜å‚¨è§£æå‡ºæ¥çš„ASTå­èŠ‚ç‚¹</span>

  <span class="comment">// é‡åˆ°é—­åˆæ ‡ç­¾ç»“æŸè§£æ</span>
  <span class="keyword">while</span> (!<span class="title function_">isEnd</span>(context, mode, ancestors)) &#123;
    <span class="comment">// åˆ‡å‰²å¤„ç†çš„æ¨¡ç‰ˆå­—ç¬¦ä¸²</span>
    <span class="keyword">const</span> s = context.<span class="property">source</span>
    <span class="keyword">let</span> <span class="attr">node</span>: <span class="title class_">TemplateChildNode</span> | <span class="title class_">TemplateChildNode</span>[] | <span class="literal">undefined</span> = <span class="literal">undefined</span>

    <span class="keyword">if</span> (mode === <span class="title class_">TextModes</span>.<span class="property">DATA</span> || mode === <span class="title class_">TextModes</span>.<span class="property">RCDATA</span>) &#123;
      <span class="keyword">if</span> (!context.<span class="property">inVPre</span> &amp;&amp; <span class="title function_">startsWith</span>(s, context.<span class="property">options</span>.<span class="property">delimiters</span>[<span class="number">0</span>])) &#123;
        <span class="comment">// è§£ææ’å€¼è¡¨è¾¾å¼&#123;&#123;&#125;&#125;</span>
        node = parseInterpolation(context, mode)
      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode === <span class="title class_">TextModes</span>.<span class="property">DATA</span> &amp;&amp; s[<span class="number">0</span>] === <span class="string">&#x27;&lt;&#x27;</span>) &#123;
        <span class="keyword">if</span> (s[<span class="number">1</span>] === <span class="string">&#x27;!&#x27;</span>) &#123;
          <span class="comment">// è§£ææ³¨é‡ŠèŠ‚ç‚¹å’Œæ–‡æ¡£å£°æ˜...</span>
        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[<span class="number">1</span>] === <span class="string">&#x27;/&#x27;</span>) &#123;
          <span class="keyword">if</span> (s[<span class="number">2</span>] === <span class="string">&#x27;&gt;&#x27;</span>) &#123;
            <span class="comment">// é’ˆå¯¹è‡ªé—­åˆæ ‡ç­¾ï¼Œå‰è¿›ä¸‰ä¸ªå­—ç¬¦</span>
            <span class="title function_">advanceBy</span>(context, <span class="number">3</span>)
            <span class="keyword">continue</span>
          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/[a-z]/i</span>.<span class="title function_">test</span>(s[<span class="number">2</span>])) &#123;
            <span class="comment">// è§£æç»“æŸæ ‡ç­¾</span>
            <span class="title function_">parseTag</span>(context, <span class="title class_">TagType</span>.<span class="property">End</span>, parent)
            <span class="keyword">continue</span>
          &#125; <span class="keyword">else</span> &#123;
            <span class="comment">// å¦‚æœä¸ç¬¦åˆä¸Šè¿°æƒ…å†µï¼Œå°±ä½œä¸ºä¼ªæ³¨é‡Šè§£æ</span>
            node = <span class="title function_">parseBogusComment</span>(context)
          &#125;
        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/[a-z]/i</span>.<span class="title function_">test</span>(s[<span class="number">1</span>])) &#123;
          <span class="comment">// è§£æhtmlå¼€å§‹æ ‡ç­¾ï¼Œè·å¾—è§£æåˆ°çš„ASTèŠ‚ç‚¹</span>
          node = <span class="title function_">parseElement</span>(context, ancestors)
        &#125;
      &#125;
    &#125;
    <span class="keyword">if</span> (!node) &#123;
      <span class="comment">// æ™®é€šæ–‡æœ¬èŠ‚ç‚¹</span>
      node = <span class="title function_">parseText</span>(context, mode)
    &#125;

    <span class="comment">// å¦‚æœèŠ‚ç‚¹æ˜¯æ•°ç»„ï¼Œå°±éå†æ·»åŠ åˆ°nodesä¸­</span>
    <span class="keyword">if</span> (<span class="title function_">isArray</span>(node)) &#123;
      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">length</span>; i++) &#123;
        <span class="title function_">pushNode</span>(nodes, node[i])
      &#125;
    &#125; <span class="keyword">else</span> &#123;
      <span class="title function_">pushNode</span>(nodes, node)
    &#125;
  &#125;
  <span class="keyword">return</span> nodes
&#125;</code></pre>
</li>
<li><p>å°±æ‹¿<code>&lt;div&gt;&lt;p&gt;LH_R&lt;/p&gt;&lt;/div&gt;</code>æµç¨‹ä¸¾ä¾‹</p>
</li>
</ul>
<ol>
<li>divå¼€å§‹æ ‡ç­¾å…¥æ ˆï¼Œcontext.source &#x3D; <code>&lt;p&gt;LH_R&lt;/p&gt;&lt;/div&gt;</code>ï¼Œancestors &#x3D; <code>[div]</code></li>
<li>på¼€å§‹æ ‡ç­¾å…¥æ ˆï¼Œcontext.source &#x3D; <code>LH_R&lt;/p&gt;&lt;/div&gt;</code>ï¼Œancestors &#x3D; <code>[div, p]</code></li>
<li>è§£ææ–‡æœ¬<code>LH_R</code></li>
<li>è§£æpç»“æŸæ ‡ç­¾ï¼Œpæ ‡ç­¾å‡ºæ ˆ</li>
<li>è§£ædivç»“æŸæ ‡ç­¾ï¼Œdivæ ‡ç­¾å‡ºæ ˆ</li>
<li>æ ˆç©ºï¼Œæ¨¡ç‰ˆè§£æå®Œæ¯•</li>
</ol>
<h2 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h2><ul>
<li>transformé‡‡ç”¨æ·±åº¦ä¼˜å…ˆçš„æ–¹å¼å¯¹ASTè¿›è¡Œéå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹èŠ‚ç‚¹çš„æ“ä½œä¸è½¬æ¢é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œéƒ½å°è£…ä¸ºç‹¬ç«‹çš„å‡½æ•°ï¼Œç„¶åè½¬æ¢å‡½æ•°é€šè¿‡<code>context.nodeTransforms</code>æ¥æ³¨å†Œ</li>
<li>è½¬æ¢è¿‡ç¨‹æ˜¯ä¼˜å…ˆè½¬æ¢å­èŠ‚ç‚¹ï¼Œå› ä¸ºæœ‰çš„çˆ¶èŠ‚ç‚¹çš„è½¬æ¢ä¾èµ–å­èŠ‚ç‚¹</li>
<li>ä»¥ä¸‹æ˜¯ASTéå†<code>traverseNode</code>æ ¸å¿ƒæºç <pre><code class="highlight ts"><span class="comment">/* </span>
<span class="comment">  éå†ASTèŠ‚ç‚¹æ ‘ï¼Œé€šè¿‡nodeè½¬æ¢å™¨å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œnodeè½¬æ¢</span>
<span class="comment">  å­èŠ‚ç‚¹å…¨éƒ¨éå†å®Œæˆåæ‰§è¡Œå¯¹åº”æŒ‡ä»¤çš„onExitå›è°ƒé€€å‡ºè½¬æ¢</span>
<span class="comment">*/</span>
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">traverseNode</span>(<span class="params"></span>
<span class="params">  node: RootNode | TemplateChildNode,</span>
<span class="params">  context: TransformContext</span>
<span class="params"></span>) &#123;
  <span class="comment">// è®°å½•å½“å‰æ­£åœ¨éå†çš„èŠ‚ç‚¹</span>
  context.<span class="property">currentNode</span> = node

  <span class="comment">/* </span>
<span class="comment">    nodeTransformsï¼štransformElementã€transformExpressionã€transformText...</span>
<span class="comment">    transformElementï¼šè´Ÿè´£æ•´ä¸ªèŠ‚ç‚¹å±‚é¢çš„è½¬æ¢</span>
<span class="comment">    transformExpressionï¼šè´Ÿè´£èŠ‚ç‚¹ä¸­è¡¨è¾¾å¼çš„è½¬åŒ–</span>
<span class="comment">    transformTextï¼šè´Ÿè´£èŠ‚ç‚¹ä¸­æ–‡æœ¬çš„è½¬æ¢</span>
<span class="comment">  */</span>
  <span class="keyword">const</span> &#123; nodeTransforms &#125; = context
  <span class="keyword">const</span> exitFns = []
  <span class="comment">// ä¾æ¬¡è°ƒç”¨è½¬æ¢å·¥å…·</span>
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nodeTransforms.<span class="property">length</span>; i++) &#123;
    <span class="comment">/* </span>
<span class="comment">      è½¬æ¢å™¨åªè´Ÿè´£ç”ŸæˆonExitå›è°ƒï¼ŒonExitå‡½æ•°æ‰æ˜¯æ‰§è¡Œè½¬æ¢ä¸»é€»è¾‘çš„åœ°æ–¹ï¼Œä¸ºä»€ä¹ˆè¦æ¨åˆ°æ ˆä¸­å…ˆä¸æ‰§è¡Œå‘¢ï¼Ÿ</span>
<span class="comment">      å› ä¸ºè¦ç­‰åˆ°å­èŠ‚ç‚¹éƒ½è½¬æ¢å®ŒæˆæŒ‚è½½gencodeNodeåï¼Œä¹Ÿå°±æ˜¯æ·±åº¦éå†å®Œæˆå</span>
<span class="comment">      å†æ‰§è¡Œå½“å‰èŠ‚ç‚¹æ ˆä¸­çš„onExitï¼Œè¿™æ ·ä¿è¯äº†å­èŠ‚ç‚¹çš„è¡¨è¾¾å¼å…¨éƒ¨ç”Ÿæˆå®Œæ¯•</span>
<span class="comment">    */</span>
    <span class="keyword">const</span> onExit = nodeTransforms[i](node, context)
    <span class="keyword">if</span> (onExit) &#123;
      <span class="keyword">if</span> (<span class="title function_">isArray</span>(onExit)) &#123;
        <span class="comment">// v-ifã€v-forä¸ºç»“æ„åŒ–æŒ‡ä»¤ï¼Œå…¶onExitæ˜¯æ•°ç»„å½¢å¼</span>
        exitFns.<span class="title function_">push</span>(...onExit)
      &#125; <span class="keyword">else</span> &#123;
        exitFns.<span class="title function_">push</span>(onExit)
      &#125;
    &#125;
    <span class="keyword">if</span> (!context.<span class="property">currentNode</span>) &#123;
      <span class="comment">// node was removed èŠ‚ç‚¹è¢«ç§»é™¤</span>
      <span class="keyword">return</span>
    &#125; <span class="keyword">else</span> &#123;
      <span class="comment">// node may have been replaced</span>
      <span class="comment">// å› ä¸ºåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­èŠ‚ç‚¹å¯èƒ½è¢«æ›¿æ¢ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„èŠ‚ç‚¹</span>
      node = context.<span class="property">currentNode</span>
    &#125;
  &#125;

  <span class="keyword">switch</span> (node.<span class="property">type</span>) &#123;
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">COMMENT</span>:
      <span class="keyword">if</span> (!context.<span class="property">ssr</span>) &#123;
        <span class="comment">// inject import for the Comment symbol, which is needed for creating</span>
        <span class="comment">// comment nodes with `createVNode`</span>
        <span class="comment">// éœ€è¦å¯¼å…¥createCommentè¾…åŠ©å‡½æ•°</span>
        context.<span class="title function_">helper</span>(<span class="variable constant_">CREATE_COMMENT</span>)
      &#125;
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">INTERPOLATION</span>:
      <span class="comment">// no need to traverse, but we need to inject toString helper</span>
      <span class="keyword">if</span> (!context.<span class="property">ssr</span>) &#123;
        context.<span class="title function_">helper</span>(<span class="variable constant_">TO_DISPLAY_STRING</span>)
      &#125;
      <span class="keyword">break</span>

    <span class="comment">// for container types, further traverse downwards</span>
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">IF</span>:
      <span class="comment">// å¯¹v-ifç”Ÿæˆçš„èŠ‚ç‚¹æŸè¿›è¡Œéå†</span>
      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">branches</span>.<span class="property">length</span>; i++) &#123;
        <span class="title function_">traverseNode</span>(node.<span class="property">branches</span>[i], context)
      &#125;
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">IF_BRANCH</span>:
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">FOR</span>:
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">ELEMENT</span>:
    <span class="keyword">case</span> <span class="title class_">NodeTypes</span>.<span class="property">ROOT</span>:
      <span class="comment">// éå†å­èŠ‚ç‚¹</span>
      <span class="title function_">traverseChildren</span>(node, context)
      <span class="keyword">break</span>
  &#125;
  <span class="comment">// å½“å‰èŠ‚ç‚¹æ ‘éå†å®Œæˆï¼Œä¾æ¬¡æ‰§è¡Œæ ˆä¸­çš„æŒ‡ä»¤é€€å‡ºå›è°ƒonExit</span>
  context.<span class="property">currentNode</span> = node
  <span class="keyword">let</span> i = exitFns.<span class="property">length</span>
  <span class="keyword">while</span> (i--) &#123;
    exitFns[i]()
  &#125;
&#125;</code></pre></li>
</ul>
<h2 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h2><p><code>generate</code>ç”Ÿæˆä»£ç å¤§è‡´åˆ†ä¸º3æ­¥</p>
<ol>
<li>åˆ›å»ºä»£ç ç”Ÿæˆä¸Šä¸‹æ–‡ï¼Œå› ä¸ºè¯¥ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯ç”¨äºç»´æŠ¤ä»£ç ç”Ÿæˆè¿‡ç¨‹ä¸­ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚ï¼š</li>
</ol>
<ul>
<li><code>code</code>ï¼šæœ€ç»ˆç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°</li>
<li><code>push</code>ï¼šæ‹¼æ¥ä»£ç </li>
<li><code>indent</code>ï¼šä»£ç ç¼©è¿›</li>
<li><code>deindent</code>ï¼šå‡å°‘ä»£ç ç¼©è¿›</li>
<li>â€¦</li>
</ul>
<ol start="2">
<li>ç”Ÿæˆæ¸²æŸ“å‡½æ•°çš„å‰ç½®é¢„è®¾éƒ¨åˆ†<ul>
<li>moduleæ¨¡å¼ä¸‹ï¼š<code>genModulePreamble()</code></li>
<li>functionæ¨¡å¼ä¸‹ï¼š<code>genFunctionPreamble</code></li>
<li>è¿˜æœ‰ä¸€äº›å‡½æ•°åï¼Œå‚æ•°ï¼Œä½œç”¨åŸŸâ€¦</li>
</ul>
</li>
<li>ç”Ÿæˆæ¸²æŸ“å‡½æ•°<ul>
<li>é€šè¿‡è°ƒç”¨<code>genNode</code>ï¼Œç„¶ååœ¨<code>genNode</code>å†…éƒ¨é€šè¿‡switchè¯­å¥æ¥åŒ¹é…ä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„ç”Ÿæˆå™¨å‡½æ•°</li>
</ul>
</li>
</ol>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://segmentfault.com/a/1190000023594560">Vue3 æ¨¡æ¿ç¼–è¯‘åŸç†</a></li>
<li>ã€ŠVue.jsè®¾è®¡ä¸å®ç°ã€‹</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>canvasç”»æ¿ä¹‹ç”»ç¬”çš„å¤šç§æ•ˆæœ</title>
    <url>/2022/12/17/canvas%E7%94%BB%E6%9D%BF%E4%B9%8B%E7%94%BB%E7%AC%94%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä¹‹å‰åšäº†ä¸€ä¸ªç”»æ¿ï¼Œå·²ç»è¿­ä»£äº†ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½†æ—¢ç„¶æ˜¯ç”»æ¿ï¼Œå¦‚æœåªæœ‰ä¸€ç§ç”»ç¬”å°±æ˜¾å¾—å¤ªå•è°ƒäº†ï¼Œæˆ‘å°±æœç½—äº†ä¸€ä¸‹ç½‘ä¸Šçš„å„ç§æ–¹æ¡ˆå’Œè‡ªå·±çš„ä¸€äº›æƒ³æ³•ï¼Œç›®å‰åšå‡ºäº†5ç§æ ·å¼ï¼ŒåŒ…æ‹¬åŸºç¡€çš„æ€»å…±6ç§ï¼Œå½“ç„¶æœ‰äº†ä¸€äº›æ€è·¯åï¼Œåç»­ä¼šç»§ç»­å¢åŠ ã€‚æˆ‘ä¼šåœ¨æœ¬æ–‡è¯¦ç»†è¯´æ˜å®ç°æ€è·¯å’Œå…·ä½“ä»£ç ï¼Œ6ç§æ ·å¼åŒ…æ‹¬ï¼š</p>
<ol>
<li>åŸºç¡€å•è‰²</li>
<li>è§å…‰</li>
<li>å¤šè‰²ç”»ç¬”</li>
<li>å–·é›¾</li>
<li>èœ¡ç¬”</li>
<li>æ³¡æ³¡</li>
</ol>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>é¢„è§ˆåœ°å€ï¼š<a href="https://songlh.top/paint-board/">https://songlh.top/paint-board/</a><br>æºç ï¼š<a href="https://github.com/LHRUN/paint-board">https://github.com/LHRUN/paint-board</a> æ¬¢è¿Starâ­ï¸</p>
<p><img src="https://s1.ax1x.com/2022/12/17/zH59vn.png"></p>
<h2 id="åŸºç¡€å•è‰²"><a href="#åŸºç¡€å•è‰²" class="headerlink" title="åŸºç¡€å•è‰²"></a>åŸºç¡€å•è‰²</h2><p>ç”»ç¬”çš„åŸºç¡€å®ç°ï¼Œé™¤äº†ç‚¹ä¸ç‚¹ä¹‹é—´çš„è¿æ¥ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸¤ç‚¹</p>
<ol>
<li>é¦–å…ˆæ˜¯åœ¨é¼ æ ‡ç§»åŠ¨æ—¶è®¡ç®—å½“å‰ç§»åŠ¨çš„é€Ÿåº¦ï¼Œç„¶åæ ¹æ®é€Ÿåº¦è®¡ç®—çº¿å®½ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†å®ç°é¼ æ ‡ç§»åŠ¨å¿«ï¼Œçº¿å®½å°±å˜çª„ï¼Œç§»åŠ¨æ…¢ï¼Œçº¿å®½å°±æ¢å¤æ­£å¸¸è¿™ä¸ªæ•ˆæœ</li>
<li>ä¸ºäº†é¿å…ç›´çº¿è¿æ¥ç‚¹æ•ˆæœä¸å¥½ï¼Œæˆ‘ä¼šé‡‡ç”¨è´å¡å°”æ›²çº¿è¿›è¡Œè¿æ¥</li>
</ol>
<p><img src="https://s1.ax1x.com/2022/12/17/zH5YPe.png"></p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * é¼ æ ‡ç§»åŠ¨æ—¶æ·»åŠ æ–°çš„åæ ‡</span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">position</span></span>
<span class="comment"> */</span>
<span class="title function_">addPosition</span>(<span class="params">position: MousePosition</span>) &#123;
  <span class="variable language_">this</span>.<span class="property">positions</span>.<span class="title function_">push</span>(position)
  <span class="comment">// å¤„ç†å½“å‰çº¿å®½</span>
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">positions</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;
    <span class="comment">// è®¡ç®—ç§»åŠ¨é€Ÿåº¦</span>
    <span class="keyword">const</span> mouseSpeed = <span class="variable language_">this</span>.<span class="title function_">_computedSpeed</span>(
      <span class="variable language_">this</span>.<span class="property">positions</span>[<span class="variable language_">this</span>.<span class="property">positions</span>.<span class="property">length</span> - <span class="number">2</span>],
      <span class="variable language_">this</span>.<span class="property">positions</span>[<span class="variable language_">this</span>.<span class="property">positions</span>.<span class="property">length</span> - <span class="number">1</span>]
    )
    <span class="comment">// è®¡ç®—çº¿å®½</span>
    <span class="keyword">const</span> lineWidth = <span class="variable language_">this</span>.<span class="title function_">_computedLineWidth</span>(mouseSpeed)
    <span class="variable language_">this</span>.<span class="property">lineWidths</span>.<span class="title function_">push</span>(lineWidth)
  &#125;
&#125;

<span class="comment">/**</span>
<span class="comment"> * è®¡ç®—ç§»åŠ¨é€Ÿåº¦</span>
<span class="comment"> * <span class="doctag">@param</span> start èµ·ç‚¹</span>
<span class="comment"> * <span class="doctag">@param</span> end ç»ˆç‚¹</span>
<span class="comment"> */</span>
<span class="title function_">_computedSpeed</span>(<span class="params">start: MousePosition, end: MousePosition</span>) &#123;
  <span class="comment">// è·å–è·ç¦»</span>
  <span class="keyword">const</span> moveDistance = <span class="title function_">getDistance</span>(start, end)

  <span class="keyword">const</span> curTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()
  <span class="comment">// è·å–ç§»åŠ¨é—´éš”æ—¶é—´   lastMoveTimeï¼šæœ€åé¼ æ ‡ç§»åŠ¨æ—¶é—´</span>
  <span class="keyword">const</span> moveTime = curTime - <span class="variable language_">this</span>.<span class="property">lastMoveTime</span>
  <span class="comment">// è®¡ç®—é€Ÿåº¦</span>
  <span class="keyword">const</span> mouseSpeed = moveDistance / moveTime
  <span class="comment">// æ›´æ–°æœ€åç§»åŠ¨æ—¶é—´</span>
  <span class="variable language_">this</span>.<span class="property">lastMoveTime</span> = curTime
  <span class="keyword">return</span> mouseSpeed
&#125;

<span class="comment">/**</span>
<span class="comment"> * è®¡ç®—ç”»ç¬”å®½åº¦</span>
<span class="comment"> * <span class="doctag">@param</span> speed é¼ æ ‡ç§»åŠ¨é€Ÿåº¦</span>
<span class="comment"> */</span>
<span class="title function_">_computedLineWidth</span>(<span class="params">speed: number</span>) &#123;
  <span class="keyword">let</span> lineWidth = <span class="number">0</span>
  <span class="keyword">const</span> minWidth = <span class="variable language_">this</span>.<span class="property">minWidth</span>
  <span class="keyword">const</span> maxWidth = <span class="variable language_">this</span>.<span class="property">maxWidth</span>
  <span class="keyword">if</span> (speed &gt;= <span class="variable language_">this</span>.<span class="property">maxSpeed</span>) &#123;
    lineWidth = minWidth
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (speed &lt;= <span class="variable language_">this</span>.<span class="property">minSpeed</span>) &#123;
    lineWidth = maxWidth
  &#125; <span class="keyword">else</span> &#123;
    lineWidth = maxWidth - (speed / <span class="variable language_">this</span>.<span class="property">maxSpeed</span>) * maxWidth
  &#125;

  lineWidth = lineWidth * (<span class="number">1</span> / <span class="number">3</span>) + <span class="variable language_">this</span>.<span class="property">lastLineWidth</span> * (<span class="number">2</span> / <span class="number">3</span>)
  <span class="variable language_">this</span>.<span class="property">lastLineWidth</span> = lineWidth
  <span class="keyword">return</span> lineWidth
&#125;</code></pre>

<p>æ¸²æŸ“æ—¶å°±éå†æ‰€æœ‰åæ ‡</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è‡ªç”±ç”»ç¬”æ¸²æŸ“</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> * <span class="doctag">@param</span> instance FreeDraw</span>
<span class="comment"> */</span>
<span class="keyword">function</span> <span class="title function_">freeDrawRender</span>(<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  instance: FreeLine</span>
<span class="params"></span>) &#123;
  context.<span class="title function_">save</span>()
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
    <span class="comment">// ç°åœ¨æ˜¯åªæœ‰åŸºç¡€ç”»ç¬”ï¼Œåç»­ä¼šå¢åŠ ä¸åŒçš„case</span>
    <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Basic</span>:
      context.<span class="property">strokeStyle</span> = instance.<span class="property">colors</span>[<span class="number">0</span>]
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span>; i++) &#123;
    <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
      <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Basic</span>:
        <span class="title function_">_drawBasic</span>(instance, i, context)
        <span class="keyword">break</span>
      <span class="attr">default</span>:
        <span class="keyword">break</span>
    &#125;
  &#125;
  context.<span class="title function_">restore</span>()
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç»˜åˆ¶åŸºç¡€çº¿æ¡</span>
<span class="comment"> * <span class="doctag">@param</span> instance FreeDraw å®ä¾‹</span>
<span class="comment"> * <span class="doctag">@param</span> i ä¸‹æ ‡</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> * <span class="doctag">@param</span> cb ä¸€äº›ç»˜åˆ¶å‰çš„å¤„ç†ï¼Œä¿®æ”¹ä¸€äº›æ ·å¼</span>
<span class="comment"> * </span>
<span class="comment"> * ç”»ç¬”è½¨è¿¹æ˜¯å€Ÿé‰´äº†ç½‘ä¸Šçš„ä¸€äº›æ–¹æ¡ˆï¼Œåˆ†ä¸¤ç§æƒ…å†µ</span>
<span class="comment"> * 1. å¦‚æœæ˜¯å‰ä¸¤ä¸ªåæ ‡ï¼Œå°±é€šè¿‡lineToè¿æ¥å³å¯</span>
<span class="comment"> * 2. å¦‚æœæ˜¯å‰ä¸¤ä¸ªåæ ‡ä¹‹åçš„åæ ‡ï¼Œå°±é‡‡ç”¨è´å¡å°”æ›²çº¿è¿›è¡Œè¿æ¥ï¼Œ</span>
<span class="comment"> *    æ¯”å¦‚ç°åœ¨æœ‰a, b, c ä¸‰ä¸ªç‚¹ï¼Œåˆ°cç‚¹æ—¶ï¼ŒæŠŠabåæ ‡çš„ä¸­é—´ç‚¹ä½œä¸ºèµ·ç‚¹</span>
<span class="comment"> *     bcåæ ‡çš„ä¸­é—´ç‚¹ä½œä¸ºç»ˆç‚¹ï¼Œbç‚¹ä½œä¸ºæ§åˆ¶ç‚¹è¿›è¡Œè¿æ¥</span>
<span class="comment"> */</span>
<span class="keyword">function</span> <span class="title function_">_drawBasic</span>(<span class="params"></span>
<span class="params">  instance: FreeLine,</span>
<span class="params">  i: number,</span>
<span class="params">  context: CanvasRenderingContext2D</span>
<span class="params">  cb?: (</span>
<span class="params">    instance: FreeDraw,</span>
<span class="params">    i: number,</span>
<span class="params">    context: CanvasRenderingContext2D</span>
<span class="params">  ) =&gt; <span class="keyword">void</span></span>
<span class="params"></span>) &#123;
  <span class="keyword">const</span> &#123; positions, lineWidths &#125; = instance
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: centerX, <span class="attr">y</span>: centerY &#125; = positions[i - <span class="number">1</span>]
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: endX, <span class="attr">y</span>: endY &#125; = positions[i]
  context.<span class="title function_">beginPath</span>()
  <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;
    context.<span class="title function_">moveTo</span>(centerX, centerY)
    context.<span class="title function_">lineTo</span>(endX, endY)
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">const</span> &#123; <span class="attr">x</span>: startX, <span class="attr">y</span>: startY &#125; = positions[i - <span class="number">2</span>]
    <span class="keyword">const</span> lastX = (startX + centerX) / <span class="number">2</span>
    <span class="keyword">const</span> lastY = (startY + centerY) / <span class="number">2</span>
    <span class="keyword">const</span> x = (centerX + endX) / <span class="number">2</span>
    <span class="keyword">const</span> y = (centerY + endY) / <span class="number">2</span>
    context.<span class="title function_">moveTo</span>(lastX, lastY)
    context.<span class="title function_">quadraticCurveTo</span>(centerX, centerY, x, y)
  &#125;

  context.<span class="property">lineWidth</span> = lineWidths[i]
  cb?.(instance, i, context)
  context.<span class="title function_">stroke</span>()
&#125;</code></pre>

<h2 id="è§å…‰"><a href="#è§å…‰" class="headerlink" title="è§å…‰"></a>è§å…‰</h2><p>è§å…‰åªéœ€åœ¨åŸºç¡€æ ·å¼ä¸Šå¢åŠ ä¸€ä¸ªé˜´å½±å³å¯</p>
<p><img src="https://s1.ax1x.com/2022/12/17/zH53VK.png"></p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">freeDrawRender</span>(<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  instance: FreeLine</span>
<span class="params"></span>) &#123;
  context.<span class="title function_">save</span>()
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
    <span class="comment">// ...</span>
    <span class="comment">// è§å…‰ å¢åŠ é˜´å½±æ•ˆæœ</span>
    <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Shadow</span>:
      context.<span class="property">shadowColor</span> = instance.<span class="property">colors</span>[<span class="number">0</span>]
      context.<span class="property">strokeStyle</span> = instance.<span class="property">colors</span>[<span class="number">0</span>]
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span>; i++) &#123;
    <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
      <span class="comment">// ...</span>
      <span class="comment">// è§å…‰</span>
      <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Shadow</span>:
        <span class="title function_">_drawBasic</span>(instance, i, context, <span class="function">(<span class="params">instance, i, context</span>) =&gt;</span> &#123;
          context.<span class="property">shadowBlur</span> = instance.<span class="property">lineWidths</span>[i]
        &#125;)
        <span class="keyword">break</span>
      <span class="attr">default</span>:
        <span class="keyword">break</span>
    &#125;
  &#125;
  context.<span class="title function_">restore</span>()
&#125;</code></pre>

<h2 id="å¤šè‰²ç”»ç¬”"><a href="#å¤šè‰²ç”»ç¬”" class="headerlink" title="å¤šè‰²ç”»ç¬”"></a>å¤šè‰²ç”»ç¬”</h2><p>å¤šè‰²ç”»ç¬”éœ€è¦ä½¿ç”¨<code>context.createPattern</code>ï¼Œè¿™ä¸ªapiæ˜¯å¯ä»¥é€šè¿‡canvasåˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„æ¨¡ç‰ˆï¼Œç„¶åå¯ä»¥è®©è¿™ä¸ªæ¨¡ç‰ˆåœ¨æŒ‡å®šçš„æ–¹å‘ä¸Šé‡å¤å…ƒå›¾åƒï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/createPattern">MDN</a></p>
<p><img src="https://s1.ax1x.com/2022/12/17/zH58UO.png"></p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è‡ªç”±ç”»ç¬”æ¸²æŸ“</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> * <span class="doctag">@param</span> instance FreeDraw</span>
<span class="comment"> * <span class="doctag">@param</span> material ç”»ç¬”ç´ æ</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">freeDrawRender</span> = (<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  material: Material</span>
<span class="params"></span>) =&gt; &#123;
  context.<span class="title function_">save</span>()
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
    <span class="comment">// ...</span>
    <span class="comment">// å¤šè‰²ç”»ç¬”</span>
    <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">MultiColor</span>:
      context.<span class="property">strokeStyle</span> = <span class="title function_">getMultiColorPattern</span>(instance.<span class="property">colors</span>)
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;

  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span>; i++) &#123;
    <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
      <span class="comment">// ...</span>
      <span class="comment">// å¤šè‰²ç”»ç¬”</span>
      <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">MultiColor</span>:
        <span class="title function_">_drawBasic</span>(instance, i, context)
        <span class="keyword">break</span>
      <span class="attr">default</span>:
        <span class="keyword">break</span>
    &#125;
  &#125;
  context.<span class="title function_">restore</span>()
&#125;

<span class="comment">/**</span>
<span class="comment"> * è·å–å¤šè‰²æ¨¡ç‰ˆ</span>
<span class="comment"> * <span class="doctag">@param</span> colors å¤šè‰²æ•°ç»„</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="title function_">getMultiColorPattern</span> = (<span class="params">colors: string[]</span>) =&gt; &#123;
  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)
  <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>) <span class="keyword">as</span> <span class="title class_">CanvasRenderingContext2D</span>
  <span class="keyword">const</span> <span class="variable constant_">COLOR_WIDTH</span> = <span class="number">5</span> <span class="comment">// æ¯ä¸ªé¢œè‰²çš„å®½åº¦</span>

  canvas.<span class="property">width</span> = <span class="variable constant_">COLOR_WIDTH</span> * colors.<span class="property">length</span>
  canvas.<span class="property">height</span> = <span class="number">20</span>
  colors.<span class="title function_">forEach</span>(<span class="function">(<span class="params">color, i</span>) =&gt;</span> &#123;
    context.<span class="property">fillStyle</span> = color
    context.<span class="title function_">fillRect</span>(<span class="variable constant_">COLOR_WIDTH</span> * i, <span class="number">0</span>, <span class="variable constant_">COLOR_WIDTH</span>, <span class="number">20</span>)
  &#125;)
  <span class="keyword">return</span> context.<span class="title function_">createPattern</span>(canvas, <span class="string">&#x27;repeat&#x27;</span>) <span class="keyword">as</span> <span class="title class_">CanvasPattern</span>
&#125;</code></pre>

<h2 id="å–·é›¾"><a href="#å–·é›¾" class="headerlink" title="å–·é›¾"></a>å–·é›¾</h2><p>å–·é›¾æ˜¯ä¸€ç§ç±»ä¼¼é›ªèŠ±çš„æ•ˆæœï¼Œåœ¨é¼ æ ‡ç§»åŠ¨è·¯å¾„ä¸Šéšæœºç»˜åˆ¶ï¼Œä½†æ˜¯æœ€åˆæˆ‘åœ¨å†™çš„æ—¶å€™å‘ç°ï¼Œå¦‚æœå¯¹æ¯ä¸ªç‚¹éƒ½è¿›è¡Œéšæœºé›ªèŠ±ç‚¹è®°å½•ç„¶åç¼“å­˜ä¸‹æ¥ï¼Œå†…å­˜å ç”¨è¿‡å¤šï¼Œæˆ‘å°±å°è¯•äº†æå‰ç”Ÿæˆ5å¥—ä¸åŒçš„æ•°æ®ï¼ŒæŒ‰é¡ºåºå±•ç¤ºï¼Œä¹Ÿèƒ½è¾¾åˆ°éšæœºçš„æ•ˆæœ</p>
<p><img src="https://s1.ax1x.com/2022/12/17/zH5N2d.png"></p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">freeDrawRender</span> = (<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  material: Material</span>
<span class="params"></span>) =&gt; &#123;
  context.<span class="title function_">save</span>()
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
    <span class="comment">// ...</span>
    <span class="comment">// å–·é›¾</span>
    <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Spray</span>:
      context.<span class="property">fillStyle</span> = instance.<span class="property">colors</span>[<span class="number">0</span>]
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;

  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span>; i++) &#123;
    <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
      <span class="comment">// ...</span>
      <span class="comment">// å–·é›¾</span>
      <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Spray</span>:
        <span class="title function_">_drawSpray</span>(instance, i, context)
        <span class="keyword">break</span>
      <span class="attr">default</span>:
        <span class="keyword">break</span>
    &#125;
  &#125;
  context.<span class="title function_">restore</span>()
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç»˜åˆ¶å–·é›¾</span>
<span class="comment"> * <span class="doctag">@param</span> instance FreeDraw å®ä¾‹</span>
<span class="comment"> * <span class="doctag">@param</span> i ä¸‹æ ‡</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="title function_">_drawSpray</span> = (<span class="params"></span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  i: number,</span>
<span class="params">  context: CanvasRenderingContext2D</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; x, y &#125; = instance.<span class="property">positions</span>[i]
  <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">50</span>; j++) &#123;
    <span class="comment">/**</span>
<span class="comment">     * sprayPoint æ˜¯æˆ‘æå‰ç”Ÿæˆçš„5å¥—éšæœºå–·é›¾æ•°æ®ï¼ŒæŒ‰é¡ºåºå±•ç¤º</span>
<span class="comment">     * &#123;</span>
<span class="comment">     *    angle å¼§åº¦</span>
<span class="comment">     *    radius åŠå¾„</span>
<span class="comment">     *    alpha é€æ˜åº¦</span>
<span class="comment">     * &#125;</span>
<span class="comment">     */</span>
    <span class="keyword">const</span> &#123; angle, radius, alpha &#125; = sprayPoint[i % <span class="number">5</span>][j]
    context.<span class="property">globalAlpha</span> = alpha
    <span class="keyword">const</span> distanceX = radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>(angle)
    <span class="keyword">const</span> distanceY = radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>(angle)
    <span class="comment">// æ ¹æ®å®½åº¦é™åˆ¶å–·é›¾å®½åº¦ï¼Œå› ä¸ºå–·é›¾å¤ªç»†äº†ä¸å¥½çœ‹ï¼Œæˆ‘å°±ç»Ÿä¸€æ”¾å¤§ä¸€å€</span>
    <span class="keyword">if</span> (
      distanceX &lt; instance.<span class="property">lineWidths</span>[i] * <span class="number">2</span> &amp;&amp;
      distanceY &lt; instance.<span class="property">lineWidths</span>[i] * <span class="number">2</span> &amp;&amp;
      distanceX &gt; -instance.<span class="property">lineWidths</span>[i] * <span class="number">2</span> &amp;&amp;
      distanceY &gt; -instance.<span class="property">lineWidths</span>[i] * <span class="number">2</span>
    ) &#123;
      context.<span class="title function_">fillRect</span>(x + distanceX, y + distanceY, <span class="number">2</span>, <span class="number">2</span>)
    &#125;
  &#125;
&#125;</code></pre>

<h2 id="èœ¡ç¬”"><a href="#èœ¡ç¬”" class="headerlink" title="èœ¡ç¬”"></a>èœ¡ç¬”</h2><p>èœ¡ç¬”æ•ˆæœä¹Ÿæ˜¯ä½¿ç”¨äº†<code>context.createPattern</code>ï¼Œé¦–å…ˆæˆ‘æ˜¯ä»¥å½“å‰ç”»ç¬”é¢œè‰²ä¸ºåº•è‰²ï¼Œç„¶åé€šè¿‡åœ¨ç½‘ä¸Šæ‰¾çš„ä¸€å¼ èœ¡ç¬”æè´¨çš„é€æ˜å›¾è¦†ç›–åœ¨ä¸Šé¢ï¼Œå°±å¯ä»¥å®ç°èœ¡ç¬”çš„æ•ˆæœ</p>
<p><img src="https://s1.ax1x.com/2022/12/17/zH5G5D.png"></p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è‡ªç”±ç”»ç¬”æ¸²æŸ“</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> * <span class="doctag">@param</span> instance FreeDraw</span>
<span class="comment"> * <span class="doctag">@param</span> material ç”»ç¬”ç´ æ</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">freeDrawRender</span> = (<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  material: Material</span>
<span class="params"></span>) =&gt; &#123;
  context.<span class="title function_">save</span>()
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
    <span class="comment">// ...</span>
    <span class="comment">// èœ¡ç¬”</span>
    <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Crayon</span>:
      context.<span class="property">strokeStyle</span> = <span class="title function_">getCrayonPattern</span>(
        instance.<span class="property">colors</span>[<span class="number">0</span>],
        material.<span class="property">crayon</span>
      )
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;

  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span>; i++) &#123;
    <span class="keyword">switch</span> (instance.<span class="property">style</span>) &#123;
      <span class="comment">// ...</span>
      <span class="comment">// èœ¡ç¬”</span>
      <span class="keyword">case</span> <span class="title class_">FreeDrawStyle</span>.<span class="property">Crayon</span>:
        <span class="title function_">_drawBasic</span>(instance, i, context)
        <span class="keyword">break</span>
      <span class="attr">default</span>:
        <span class="keyword">break</span>
    &#125;
  &#125;
  context.<span class="title function_">restore</span>()
&#125;

<span class="comment">/**</span>
<span class="comment"> * è·å–èœ¡ç¬”æ¨¡ç‰ˆ</span>
<span class="comment"> * <span class="doctag">@param</span> color èœ¡ç¬”åº•è‰²</span>
<span class="comment"> * <span class="doctag">@param</span> crayon èœ¡ç¬”ç´ æ</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="title function_">getCrayonPattern</span> = (<span class="params">color: string, crayon: Material[<span class="string">&#x27;crayon&#x27;</span>]</span>) =&gt; &#123;
  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)
  <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>) <span class="keyword">as</span> <span class="title class_">CanvasRenderingContext2D</span>
  canvas.<span class="property">width</span> = <span class="number">100</span>
  canvas.<span class="property">height</span> = <span class="number">100</span>
  context.<span class="property">fillStyle</span> = color
  context.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)
  <span class="keyword">if</span> (crayon) &#123;
    context.<span class="title function_">drawImage</span>(crayon, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)
  &#125;
  <span class="keyword">return</span> context.<span class="title function_">createPattern</span>(canvas, <span class="string">&#x27;repeat&#x27;</span>) <span class="keyword">as</span> <span class="title class_">CanvasPattern</span>
&#125;</code></pre>

<h2 id="æ³¡æ³¡"><a href="#æ³¡æ³¡" class="headerlink" title="æ³¡æ³¡"></a>æ³¡æ³¡</h2><ol>
<li>é¼ æ ‡ç§»åŠ¨æ—¶è®°å½•æ³¡æ³¡çš„åŠå¾„å’Œé€æ˜åº¦</li>
<li>æ¸²æŸ“æ—¶é€šè¿‡<code>context.arc</code>è¿›è¡Œç”»åœ†ç»˜åˆ¶</li>
</ol>
<p><img src="https://s1.ax1x.com/2022/12/17/zH5t8H.png"></p>
<pre><code class="highlight js"><span class="title function_">addPosition</span>(<span class="params">position: MousePosition</span>) &#123;
  <span class="comment">// ...</span>
  <span class="comment">// è®°å½•æ³¡æ³¡åŠå¾„å’Œé€æ˜åº¦</span>
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">style</span> === <span class="title class_">FreeDrawStyle</span>.<span class="property">Bubble</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">bubbles</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">bubbles</span>.<span class="title function_">push</span>(&#123;
      <span class="comment">// getRandomInt è·å–èŒƒå›´å†…éšæœºæ•´æ•°</span>
      <span class="attr">radius</span>: <span class="title function_">getRandomInt</span>(<span class="variable language_">this</span>.<span class="property">minWidth</span> * <span class="number">2</span>, <span class="variable language_">this</span>.<span class="property">maxWidth</span> * <span class="number">2</span>),
      <span class="comment">// é€æ˜åº¦</span>
      <span class="attr">opacity</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>()
    &#125;)
  &#125;
  <span class="comment">// ...</span>
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç»˜åˆ¶æ³¡æ³¡</span>
<span class="comment"> * <span class="doctag">@param</span> instance FreeDraw å®ä¾‹</span>
<span class="comment"> * <span class="doctag">@param</span> i ä¸‹æ ‡</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="title function_">_drawBubble</span> = (<span class="params"></span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  i: number,</span>
<span class="params">  context: CanvasRenderingContext2D</span>
<span class="params"></span>) =&gt; &#123;
  context.<span class="title function_">beginPath</span>()
  <span class="keyword">if</span> (instance.<span class="property">bubbles</span>) &#123;
    <span class="keyword">const</span> &#123; x, y &#125; = instance.<span class="property">positions</span>[i]
    context.<span class="property">globalAlpha</span> = instance.<span class="property">bubbles</span>[i].<span class="property">opacity</span>
    context.<span class="title function_">arc</span>(x, y, instance.<span class="property">bubbles</span>[i].<span class="property">radius</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)
    context.<span class="title function_">fill</span>()
  &#125;
&#125;</code></pre>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœæœ‰å‘ç°é—®é¢˜æˆ–è€…æœ‰å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿è®¨è®ºğŸ‘»</p>
<p>ç”»æ¿ç³»åˆ—æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://songlh.top/2022/09/21/%E5%9F%BA%E4%BA%8Ecanvas%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%A4%9A%E5%8A%9F%E8%83%BD%E7%94%BB%E6%9D%BF/">åŸºäºcanvaså®ç°çš„å¤šåŠŸèƒ½ç”»æ¿</a></li>
<li><a href="https://songlh.top/2022/12/05/canvas%E7%94%BB%E6%9D%BF%E4%B9%8B%E7%BB%98%E7%94%BB%E5%85%83%E7%B4%A0%E7%9A%84%E6%A1%86%E9%80%89/">canvasç”»æ¿ä¹‹ç»˜ç”»å…ƒç´ çš„æ¡†é€‰</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="http://perfectionkills.com/exploring-canvas-drawing-techniques/">Exploring canvas drawing techniques</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>canvasç”»æ¿ä¹‹ç»˜ç”»å…ƒç´ çš„æ¡†é€‰</title>
    <url>/2022/12/05/canvas%E7%94%BB%E6%9D%BF%E4%B9%8B%E7%BB%98%E7%94%BB%E5%85%83%E7%B4%A0%E7%9A%84%E6%A1%86%E9%80%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘å¤§æ¦‚åœ¨ä¸¤ä¸ªæœˆä¹‹å‰åšäº†ä¸€ä¸ªåŸºäºcanvasçš„ç”»æ¿ï¼Œ<a href="https://songlh.top/2022/09/21/%E5%9F%BA%E4%BA%8Ecanvas%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%A4%9A%E5%8A%9F%E8%83%BD%E7%94%BB%E6%9D%BF/">åŸºäºcanvaså®ç°çš„å¤šåŠŸèƒ½ç”»æ¿</a>ï¼Œç„¶åæœ€è¿‘ä¸æ˜¯å¤ªå¿™ï¼Œå°±åˆ©ç”¨ä¸‹ç­çš„æ—¶é—´åˆè¿­ä»£äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¢åŠ äº†ä»¥ä¸‹å†…å®¹</p>
<ol>
<li>åœ¨é€‰æ‹©æ¨¡å¼ä¸‹å¯ä»¥ç‚¹å‡»å…ƒç´ è¿›è¡Œæ¡†é€‰ï¼Œå¹¶æŒ‰ä½æ‰‹æŸ„è¿›è¡Œç¼©æ”¾æˆ–è€…ç§»åŠ¨ï¼Œç‚¹å‡»Backspaceé”®å¯ä»¥åˆ é™¤é€‰æ‹©å…ƒç´ </li>
<li>åŒå‡»ç”»æ¿è¾“å…¥æ–‡å­—ç»˜åˆ¶åœ¨æŒ‡å®šä½ç½®</li>
</ol>
<p>æœ¬ç¯‡æˆ‘å°±è¯¦ç»†ä»‹ç»ä¸‹æ¡†é€‰å…ƒç´ çš„å®ç°æ€è·¯å’Œå…·ä½“ä»£ç ï¼Œæ•ˆæœå¦‚ä¸‹</p>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>é¢„è§ˆåœ°å€ï¼š<a href="https://songlh.top/paint-board/">https://songlh.top/paint-board/</a><br>repoï¼š<a href="https://github.com/LHRUN/paint-board">https://github.com/LHRUN/paint-board</a> æ¬¢è¿Starâ­ï¸ </p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5bd83319aae4af5aeaad2e83a73580c~tplv-k3u1fbpfcp-watermark.image"></p>
<h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h2><ol>
<li>é¦–å…ˆéœ€è¦æ¡†é€‰çš„å…ƒç´ å¿…é¡»åœ¨åˆå§‹åŒ–æ—¶å’Œæ›´æ–°æ—¶è®°å½•çŸ©å½¢å±æ€§ï¼Œæ¯”å¦‚å®½é«˜ã€çŸ©å½¢åæ ‡ï¼Œè¿™æ˜¯å®ç°æ¡†é€‰çš„åŸºç¡€</li>
<li>é¼ æ ‡åœ¨ç§»åŠ¨æ—¶éœ€è¦æ ¹æ®å½“å‰åæ ‡åˆ¤æ–­æ‚¬æµ®åœ¨å“ªä¸ªå…ƒç´ ä¸Šæ–¹ï¼Œè¿™æ ·æ‰èƒ½åœ¨ç‚¹å‡»æ—¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”é¼ æ ‡ç§»åŠ¨æ—¶éœ€è¦æœ‰å…‰æ ‡çš„æ”¹å˜</li>
<li>åœ¨æœ‰æ¡†é€‰å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œæ¸²æŸ“æ—¶åœ¨æœ€åæ ¹æ®æ¡†é€‰å…ƒç´ çš„çŸ©å½¢å±æ€§æ¸²æŸ“æ¡†é€‰æ•ˆæœ</li>
<li>åœ¨æœ‰æ¡†é€‰å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œæ‹–æ‹½æ—¶æ ¹æ®æ‹–æ‹½çš„ä½ç½®æ¥åˆ¤æ–­æ˜¯ç§»åŠ¨è¿˜æ˜¯æ”¹å˜å¤§å°</li>
<li>å…ƒç´ æ”¹å˜å¤§å°æœ‰ä¸¤ç§æƒ…å†µï¼Œä¿æŒæ¯”ä¾‹(æ–‡å­—)çš„ç¼©æ”¾å’Œä¸ä¿æŒæ¯”ä¾‹(ç”»ç¬”)çš„ç¼©æ”¾</li>
</ol>
<h2 id="è®°å½•çŸ©å½¢å±æ€§"><a href="#è®°å½•çŸ©å½¢å±æ€§" class="headerlink" title="è®°å½•çŸ©å½¢å±æ€§"></a>è®°å½•çŸ©å½¢å±æ€§</h2><p>å› ä¸ºç”»ç¬”éšç€ç»˜ç”»ä¸€ç›´åœ¨å¢åŠ æ–°çš„åæ ‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘åœ¨çŸ©å½¢å±æ€§å¤–å¦è®°å½•äº†æœ€å°å’Œæœ€å¤§çš„xyåæ ‡ç”¨äºè®¡ç®—å®½é«˜</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * æ ¹æ®æ–°åæ ‡ç‚¹ï¼Œæ›´æ–°çŸ©å½¢å±æ€§</span>
<span class="comment"> * <span class="doctag">@param</span> instance ç”»ç¬”å…ƒç´ </span>
<span class="comment"> * <span class="doctag">@param</span> position åæ ‡ç‚¹</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">updateRect</span> = (<span class="params">instance: FreeDraw, position: MousePosition</span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; x, y &#125; = position
  <span class="keyword">let</span> &#123; minX, maxX, minY, maxY &#125; = instance.<span class="property">rect</span>
  <span class="keyword">if</span> (x &lt; minX) &#123;
    minX = x
  &#125;
  <span class="keyword">if</span> (x &gt; maxX) &#123;
    maxX = x
  &#125;
  <span class="keyword">if</span> (y &lt; minY) &#123;
    minY = y
  &#125;
  <span class="keyword">if</span> (y &gt; maxY) &#123;
    maxY = y
  &#125;
  <span class="keyword">const</span> rect = &#123;
    minX,
    maxX,
    minY,
    maxY,
    <span class="attr">x</span>: minX,
    <span class="attr">y</span>: minY,
    <span class="attr">width</span>: maxX - minX,
    <span class="attr">height</span>: maxY - minY
  &#125;
  instance.<span class="property">rect</span> = rect
  <span class="keyword">return</span> rect
&#125;</code></pre>

<h2 id="è®¡ç®—é¼ æ ‡ç§»åŠ¨åæ ‡"><a href="#è®¡ç®—é¼ æ ‡ç§»åŠ¨åæ ‡" class="headerlink" title="è®¡ç®—é¼ æ ‡ç§»åŠ¨åæ ‡"></a>è®¡ç®—é¼ æ ‡ç§»åŠ¨åæ ‡</h2><ul>
<li>éšç€é¼ æ ‡ç§»åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜å…‰æ ‡è®©ä½¿ç”¨è€…æ„ŸçŸ¥åˆ°å·²ç»ç§»åŠ¨åˆ°å…ƒç´ ä¸Šæ–¹ï¼Œæ‰€ä»¥å°±éœ€è¦è®¡ç®—é¼ æ ‡åæ ‡æ˜¯å¦å·²ç»å’Œç»˜ç”»è·¯å¾„ä¸´è¿‘åˆ°ä¸€å®šè·ç¦»</li>
<li>ç»˜ç”»è·¯å¾„æ˜¯ç”±ä¸€ä¸ªä¸ªçš„åæ ‡ç‚¹ç»„æˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªåæ ‡ç‚¹å’Œä¸Šä¸€ä¸ªåæ ‡ç‚¹è¿æˆä¸€ä¸ªçº¿æ®µï¼Œç„¶ååœ¨æ»¡è¶³ä»¥ä¸‹ä»»ä½•ä¸€ç§æƒ…å†µå°±å¯ä»¥è®¤ä¸ºæ˜¯æ‚¬æµ®åœ¨å…ƒç´ ä¸Šæ–¹äº†<ul>
<li>é¼ æ ‡åæ ‡è·ç¦»çº¿æ®µèµ·ç‚¹å°äº10åƒç´ </li>
<li>é¼ æ ‡åæ ‡è·ç¦»çº¿æ®µç»ˆç‚¹å°äº10åƒç´ </li>
<li>é¼ æ ‡åæ ‡è·ç¦»çº¿æ®µå°äº10åƒç´ å¹¶ä¸”xå’Œyåæ ‡åœ¨çº¿æ®µçš„ä¸¤ç«¯ç‚¹èŒƒå›´å†…</li>
<li><img src="https://s1.ax1x.com/2022/12/05/zy7D6s.png"><pre><code class="highlight js"><span class="comment">// éå†ç”»ç¬”å…ƒç´ æ‰€æœ‰åæ ‡ç‚¹</span>
<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; positions.<span class="property">length</span>; i++) &#123;
  <span class="comment">// è·ç¦»èµ·ç‚¹è·ç¦»</span>
  <span class="keyword">const</span> startDistance = <span class="title function_">getDistance</span>(movePos, positions[i - <span class="number">1</span>])
  <span class="comment">// è·ç¦»ç»ˆç‚¹è·ç¦»</span>
  <span class="keyword">const</span> endDistance = <span class="title function_">getDistance</span>(movePos, positions[i])
  <span class="comment">// è·ç¦»çº¿æ®µè·ç¦»</span>
  <span class="keyword">const</span> lineDistance = <span class="title function_">getPositionToLineDistance</span>(
    movePos,
    positions[i - <span class="number">1</span>],
    positions[i]
  )
  <span class="keyword">const</span> rangeX =
    <span class="title class_">Math</span>.<span class="title function_">max</span>(positions[i - <span class="number">1</span>].<span class="property">x</span>, positions[i].<span class="property">x</span>) &gt;= movePos.<span class="property">x</span> &amp;&amp;
    movePos.<span class="property">x</span> &gt;= <span class="title class_">Math</span>.<span class="title function_">min</span>(positions[i - <span class="number">1</span>].<span class="property">x</span>, positions[i].<span class="property">x</span>)
  <span class="keyword">const</span> rangeY =
    <span class="title class_">Math</span>.<span class="title function_">max</span>(positions[i - <span class="number">1</span>].<span class="property">y</span>, positions[i].<span class="property">y</span>) &gt;= movePos.<span class="property">y</span> &amp;&amp;
    movePos.<span class="property">y</span> &gt;= <span class="title class_">Math</span>.<span class="title function_">min</span>(positions[i - <span class="number">1</span>].<span class="property">y</span>, positions[i].<span class="property">y</span>)

  <span class="comment">// æ»¡è¶³ä¸‰ç§æƒ…å†µå…¶ä¸­ä¸€ç§å°±å¯ä»¥è®°å½•ä¸‹ç”»ç¬”å…ƒç´ </span>
  <span class="keyword">if</span> (
    startDistance &lt; <span class="number">10</span> ||
    endDistance &lt; <span class="number">10</span> ||
    (lineDistance &lt; <span class="number">10</span> &amp;&amp; rangeX &amp;&amp; rangeY)
  ) &#123;
    <span class="variable language_">this</span>.<span class="property">mouseHoverElementIndex</span> = eleIndex
  &#125;
&#125;
<span class="comment">// ...</span>

<span class="comment">/**</span>
<span class="comment"> * è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»</span>
<span class="comment"> * <span class="doctag">@param</span> start èµ·ç‚¹</span>
<span class="comment"> * <span class="doctag">@param</span> end ç»ˆç‚¹</span>
<span class="comment"> * <span class="doctag">@returns</span> è·ç¦»</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getDistance</span> = (<span class="params">start: MousePosition, end: MousePosition</span>) =&gt; &#123;
  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(start.<span class="property">x</span> - end.<span class="property">x</span>, <span class="number">2</span>) + <span class="title class_">Math</span>.<span class="title function_">pow</span>(start.<span class="property">y</span> - end.<span class="property">y</span>, <span class="number">2</span>))
&#125;

<span class="comment">/**</span>
<span class="comment"> * è·å–é¼ æ ‡åæ ‡è·ç¦»çº¿æ®µè·ç¦»</span>
<span class="comment"> * <span class="doctag">@param</span> pos é¼ æ ‡åæ ‡</span>
<span class="comment"> * <span class="doctag">@param</span> startPos çº¿æ®µèµ·ç‚¹</span>
<span class="comment"> * <span class="doctag">@param</span> endPos çº¿æ®µç»ˆç‚¹</span>
<span class="comment"> * <span class="doctag">@returns</span> è·ç¦»</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPositionToLineDistance</span> = (<span class="params"></span>
<span class="params">  pos: MousePosition,</span>
<span class="params">  startPos: MousePosition,</span>
<span class="params">  endPos: MousePosition</span>
<span class="params"></span>) =&gt; &#123;
  <span class="comment">/**</span>
<span class="comment">   * 1. è®¡ç®—ä¸‰ç‚¹ä¹‹é—´çš„ç›´çº¿è·ç¦»</span>
<span class="comment">   * 2. è®¡ç®—ä¸‰è§’å½¢åŠå‘¨é•¿</span>
<span class="comment">   * 3. é€šè¿‡æµ·ä¼¦å…¬å¼æ±‚é¢ç§¯</span>
<span class="comment">   * 4. æ ¹æ®é¢ç§¯å…¬å¼æ±‚ä¸‰è§’å½¢çš„é«˜</span>
<span class="comment">   */</span>
  <span class="keyword">const</span> A = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title function_">getDistance</span>(pos, startPos))
  <span class="keyword">const</span> B = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title function_">getDistance</span>(pos, endPos))
  <span class="keyword">const</span> C = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title function_">getDistance</span>(startPos, endPos))

  <span class="keyword">const</span> P = (A + B + C) / <span class="number">2</span>
  <span class="keyword">const</span> area = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(P * (P - A) * (P - B) * (P - C)))
  <span class="keyword">const</span> distance = (<span class="number">2</span> * area) / C
  <span class="keyword">return</span> distance
&#125;</code></pre></li>
</ul>
</li>
</ul>
<h2 id="ç‚¹å‡»æ¸²æŸ“æ¡†é€‰æ•ˆæœ"><a href="#ç‚¹å‡»æ¸²æŸ“æ¡†é€‰æ•ˆæœ" class="headerlink" title="ç‚¹å‡»æ¸²æŸ“æ¡†é€‰æ•ˆæœ"></a>ç‚¹å‡»æ¸²æŸ“æ¡†é€‰æ•ˆæœ</h2><ul>
<li>ç‚¹å‡»æ—¶å¦‚æœåœ¨ä¹‹å‰hoveræ—¶æ»¡è¶³ä¸‰ç§æƒ…å†µå·²ç»è®°å½•ä¸‹æ¥äº†ï¼Œå°±ç»§ç»­è®°å½•ä¸ºæ¡†é€‰å…ƒç´ </li>
<li>ç„¶ååœ¨ç”»æ¿æ¸²æŸ“æ—¶ï¼Œå°±æŒ‰ç…§æ¡†é€‰å…ƒç´ çš„çŸ©å½¢å±æ€§æ¸²æŸ“æ¡†é€‰æ•ˆæœ<pre><code class="highlight js"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">select</span>.<span class="property">selectElementIndex</span> !== -<span class="number">1</span>) &#123;
  <span class="comment">// è·å–é€‰æ‹©å…ƒç´ çš„çŸ©å½¢å±æ€§ï¼Œç»˜åˆ¶æ¡†é€‰æ•ˆæœ</span>
  <span class="keyword">const</span> rect = <span class="variable language_">this</span>.<span class="property">select</span>.<span class="title function_">getCurSelectElement</span>().<span class="property">rect</span>
  <span class="title function_">drawResizeRect</span>(<span class="variable language_">this</span>.<span class="property">context</span>, rect)
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç»˜åˆ¶æ‹–æ‹½çŸ©å½¢</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">drawResizeRect</span> = (<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  rect: ElementRect</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; x, y, width, height &#125; = rect
  context.<span class="title function_">save</span>()
  context.<span class="property">strokeStyle</span> = <span class="string">&#x27;#65CC8A&#x27;</span>
  context.<span class="title function_">setLineDash</span>([<span class="number">5</span>])
  context.<span class="property">lineWidth</span> = <span class="number">2</span>
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  <span class="comment">// ç»˜åˆ¶è™šçº¿æ¡†</span>
  <span class="title function_">drawRect</span>(context, x, y, width, height)

  <span class="comment">// ç»˜åˆ¶å››è§’æ‰‹æŸ„</span>
  context.<span class="property">fillStyle</span> = <span class="string">&#x27;#65CC8A&#x27;</span>
  <span class="title function_">drawRect</span>(context, x - <span class="number">10</span>, y - <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="literal">true</span>)
  <span class="title function_">drawRect</span>(context, x + width, y - <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="literal">true</span>)
  <span class="title function_">drawRect</span>(context, x - <span class="number">10</span>, y + height, <span class="number">10</span>, <span class="number">10</span>, <span class="literal">true</span>)
  <span class="title function_">drawRect</span>(context, x + width, y + height, <span class="number">10</span>, <span class="number">10</span>, <span class="literal">true</span>)
  context.<span class="title function_">restore</span>()
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç»˜åˆ¶çŸ©å½¢</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">drawRect</span> = (<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  x: number,</span>
<span class="params">  y: number,</span>
<span class="params">  width: number,</span>
<span class="params">  height: number,</span>
<span class="params">  fill = <span class="literal">false</span> <span class="comment">// æ˜¯å¦å¡«å……</span></span>
<span class="params"></span>) =&gt; &#123;
  context.<span class="title function_">beginPath</span>()
  context.<span class="title function_">rect</span>(x, y, width, height)
  <span class="keyword">if</span> (fill) &#123;
    context.<span class="title function_">fill</span>()
  &#125; <span class="keyword">else</span> &#123;
    context.<span class="title function_">stroke</span>()
  &#125;
&#125;</code></pre></li>
</ul>
<h2 id="æ‹–æ‹½å…ƒç´ "><a href="#æ‹–æ‹½å…ƒç´ " class="headerlink" title="æ‹–æ‹½å…ƒç´ "></a>æ‹–æ‹½å…ƒç´ </h2><p>æ‹–æ‹½å…ƒç´ æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è®¡ç®—é¼ æ ‡ç§»åŠ¨çš„è·ç¦»ï¼Œç„¶åéå†åæ ‡ç‚¹åŠ ä¸Šè·ç¦»å³å¯</p>
<pre><code class="highlight js"><span class="comment">// startMousePoså°±æ˜¯ä¸Šä¸€ä¸ªç§»åŠ¨çš„åæ ‡</span>
<span class="keyword">const</span> disntanceX = x - <span class="variable language_">this</span>.<span class="property">startMousePos</span>.<span class="property">x</span>
<span class="keyword">const</span> disntanceY = y - <span class="variable language_">this</span>.<span class="property">startMousePos</span>.<span class="property">y</span>

<span class="comment">/**</span>
<span class="comment"> * æ›´æ–°ä½ç½®</span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">distanceX</span></span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">distanceY</span></span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">moveFreeDraw</span> = (<span class="params"></span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  distanceX: number,</span>
<span class="params">  distanceY: number</span>
<span class="params"></span>) =&gt; &#123;
  <span class="title function_">initRect</span>(instance)
  instance.<span class="property">positions</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">position</span>) =&gt;</span> &#123;
    position.<span class="property">x</span> += distanceX
    position.<span class="property">y</span> += distanceY
    <span class="title function_">updateRect</span>(instance, position)
  &#125;)
&#125;</code></pre>

<h2 id="ç”»ç¬”ç¼©æ”¾-ä¸ä¿æŒæ¯”ä¾‹"><a href="#ç”»ç¬”ç¼©æ”¾-ä¸ä¿æŒæ¯”ä¾‹" class="headerlink" title="ç”»ç¬”ç¼©æ”¾(ä¸ä¿æŒæ¯”ä¾‹)"></a>ç”»ç¬”ç¼©æ”¾(ä¸ä¿æŒæ¯”ä¾‹)</h2><ul>
<li>ç”»ç¬”ç¼©æ”¾æˆ‘å…ˆä»¥å³ä¸‹è§’æ‰‹æŸ„æ‹–æ‹½ä¸ºä¾‹åˆ†æ</li>
<li>é¦–å…ˆç”»ç¬”çš„ç¼©æ”¾æ¯”ä¾‹æ˜¯åˆ†ä¸ºæ°´å¹³ç¼©æ”¾æ¯”ä¾‹å’Œå‚ç›´ç¼©æ”¾æ¯”ä¾‹<ul>
<li>æ°´å¹³ç¼©æ”¾æ¯”ä¾‹ &#x3D; (æ—§çŸ©å½¢çš„å®½ + é¼ æ ‡æ°´å¹³ç§»åŠ¨çš„è·ç¦») &#x2F; æ—§çŸ©å½¢çš„å®½</li>
<li>å‚ç›´ç¼©æ”¾æ¯”ä¾‹ &#x3D; (æ—§çŸ©å½¢çš„é«˜ + é¼ æ ‡å‚ç›´ç§»åŠ¨çš„è·ç¦») &#x2F; æ—§çŸ©å½¢çš„é«˜</li>
</ul>
</li>
<li>ç„¶åéå†ç”»ç¬”çš„æ‰€æœ‰åæ ‡ç‚¹è¿›è¡Œç¼©æ”¾ï¼Œè¿™æ—¶ä¼šå‡ºç°ä¸€ä¸ªåç§»çš„ç¼©æ”¾æ•ˆæœï¼Œå¦‚ä¸‹å›¾<ul>
<li><img src="https://s1.ax1x.com/2022/12/05/zy7600.png"></li>
</ul>
</li>
<li>è¿™æ—¶å°±éœ€è¦è®¡ç®—å½“å‰æ‹–æ‹½æ‰‹æŸ„å¯¹è§’é¡¶ç‚¹ç§»åŠ¨çš„è·ç¦»æ˜¯å¤šå°‘ï¼Œç„¶åå‡å»è¿™ä¸ªè·ç¦»å°±å¾—åˆ°äº†æ­£ç¡®çš„ç¼©æ”¾æ•ˆæœäº†<ul>
<li><img src="https://s1.ax1x.com/2022/12/05/zy72kT.png"></li>
</ul>
</li>
<li>å½“ç„¶å››ä¸ªè§’çš„æ‹–æ‹½è®¡ç®—æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯æ€è·¯ä¸€è‡´<pre><code class="highlight js"><span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">resizeType</span>) &#123;
  <span class="comment">// disntanceX é¼ æ ‡æ°´å¹³ç§»åŠ¨è·ç¦»</span>
  <span class="comment">// disntanceY é¼ æ ‡å‚ç›´ç§»åŠ¨è·ç¦»</span>
  <span class="comment">// å³ä¸‹è§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_RIGHT</span>:
    <span class="title function_">resizeFreeDraw</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">FreeDraw</span>,
      (rect.<span class="property">width</span> + disntanceX) / rect.<span class="property">width</span>,
      (rect.<span class="property">height</span> + disntanceY) / rect.<span class="property">height</span>,
      rect,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_RIGHT</span>
    )
    <span class="keyword">break</span>
  <span class="comment">// å·¦ä¸‹è§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_LEFT</span>:
    <span class="title function_">resizeFreeDraw</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">FreeDraw</span>,
      (rect.<span class="property">width</span> - disntanceX) / rect.<span class="property">width</span>,
      (rect.<span class="property">height</span> + disntanceY) / rect.<span class="property">height</span>,
      rect,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_LEFT</span>
    )
    <span class="keyword">break</span>
  <span class="comment">// å·¦ä¸Šè§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_LEFT</span>:
    <span class="title function_">resizeFreeDraw</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">FreeDraw</span>,
      (rect.<span class="property">width</span> - disntanceX) / rect.<span class="property">width</span>,
      (rect.<span class="property">height</span> - disntanceY) / rect.<span class="property">height</span>,
      rect,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_LEFT</span>
    )
    <span class="keyword">break</span>
  <span class="comment">// å³ä¸Šè§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_RIGHT</span>:
    <span class="title function_">resizeFreeDraw</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">FreeDraw</span>,
      (rect.<span class="property">width</span> + disntanceX) / rect.<span class="property">width</span>,
      (rect.<span class="property">height</span> - disntanceY) / rect.<span class="property">height</span>,
      rect,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_RIGHT</span>
    )
    <span class="keyword">break</span>
  <span class="attr">default</span>:
    <span class="keyword">break</span>
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç¼©æ”¾ç»˜ç”»</span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">instance</span></span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">scaleX</span></span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">scaleY</span></span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">rect</span></span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">resizeType</span></span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">resizeFreeDraw</span> = (<span class="params"></span>
<span class="params">  instance: FreeDraw,</span>
<span class="params">  scaleX: number,</span>
<span class="params">  scaleY: number,</span>
<span class="params">  rect: FreeDrawRect,</span>
<span class="params">  resizeType: string</span>
<span class="params"></span>) =&gt; &#123;
  <span class="comment">// åˆå§‹åŒ–çŸ©å½¢</span>
  <span class="title function_">initRect</span>(instance)
  <span class="comment">// éå†æ‰€æœ‰åæ ‡è¿›è¡Œç¼©æ”¾</span>
  instance.<span class="property">positions</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">position</span>) =&gt;</span> &#123;
    position.<span class="property">x</span> = position.<span class="property">x</span> * scaleX
    position.<span class="property">y</span> = position.<span class="property">y</span> * scaleY
    <span class="title function_">updateRect</span>(instance, position)
  &#125;)
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: newX, <span class="attr">y</span>: newY, <span class="attr">width</span>: newWidth, <span class="attr">height</span>: newHeight &#125; = instance.<span class="property">rect</span>
  <span class="keyword">let</span> offsetX = <span class="number">0</span>
  <span class="keyword">let</span> offsetY = <span class="number">0</span>
  <span class="comment">// è®¡ç®—åç§»è·ç¦»ï¼Œè¿™ä¸ªæ˜¯è¦æ ¹æ®å½“å‰ç¼©æ”¾æ‰‹æŸ„çš„å¯¹è§’é¡¶ç‚¹è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥è¦åˆ†ä¸º4ç§æƒ…å†µ</span>
  <span class="keyword">switch</span> (resizeType) &#123;
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_RIGHT</span>:
      offsetX = newX - rect.<span class="property">x</span>
      offsetY = newY - rect.<span class="property">y</span>
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_LEFT</span>:
      offsetX = newX + newWidth - (rect.<span class="property">x</span> + rect.<span class="property">width</span>)
      offsetY = newY - rect.<span class="property">y</span>
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_LEFT</span>:
      offsetX = newX + newWidth - (rect.<span class="property">x</span> + rect.<span class="property">width</span>)
      offsetY = newY + newHeight - (rect.<span class="property">y</span> + rect.<span class="property">height</span>)
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_RIGHT</span>:
      offsetX = newX - rect.<span class="property">x</span>
      offsetY = newY + newHeight - (rect.<span class="property">y</span> + rect.<span class="property">height</span>)
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;
  <span class="title function_">initRect</span>(instance)
  <span class="comment">// å‡å»åç§»è·ç¦»</span>
  instance.<span class="property">positions</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">position</span>) =&gt;</span> &#123;
    position.<span class="property">x</span> = position.<span class="property">x</span> - offsetX
    position.<span class="property">y</span> = position.<span class="property">y</span> - offsetY
    <span class="title function_">updateRect</span>(instance, position)
  &#125;)
&#125;</code></pre></li>
</ul>
<h2 id="æ–‡å­—ç¼©æ”¾-ä¿æŒæ¯”ä¾‹"><a href="#æ–‡å­—ç¼©æ”¾-ä¿æŒæ¯”ä¾‹" class="headerlink" title="æ–‡å­—ç¼©æ”¾(ä¿æŒæ¯”ä¾‹)"></a>æ–‡å­—ç¼©æ”¾(ä¿æŒæ¯”ä¾‹)</h2><ul>
<li>æ–‡å­—ç¼©æ”¾éœ€è¦ä¸€ç›´ä¿æŒç€å®½é«˜æ¯”ï¼Œé€šè¿‡è®¡ç®—å‡ºæ–°æ—§çŸ©å½¢çš„å®½é«˜æ¯”<ul>
<li>å½“æ–°çš„å®½é«˜æ¯”å°äºæ—§çš„å®½é«˜æ¯”æ—¶ï¼Œå®½åº¦ä¸å˜ï¼Œè®¡ç®— é«˜åº¦ &#x3D; å®½åº¦ &#x2F; æ—§çš„å®½é«˜æ¯”</li>
<li>ä½†æ–°çš„å®½é«˜æ¯”å¤§äºæ—§çš„å®½é«˜æ¯”æ—¶ï¼Œé«˜åº¦ä¸å˜ï¼Œè®¡ç®— å®½åº¦ &#x3D; é«˜åº¦ * æ—§çš„å®½é«˜æ¯”<pre><code class="highlight js"><span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">resizeType</span>) &#123;
  <span class="comment">// ...</span>
  <span class="comment">// å³ä¸‹è§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_RIGHT</span>:
    <span class="title function_">resizeTextElement</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">TextElement</span>,
      resizeElement.<span class="property">rect</span>.<span class="property">width</span> + disntanceX,
      resizeElement.<span class="property">rect</span>.<span class="property">height</span> + disntanceY,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_RIGHT</span>
    )
    <span class="keyword">break</span>
  <span class="comment">// å·¦ä¸‹è§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_LEFT</span>:
    <span class="title function_">resizeTextElement</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">TextElement</span>,
      resizeElement.<span class="property">rect</span>.<span class="property">width</span> - disntanceX,
      resizeElement.<span class="property">rect</span>.<span class="property">height</span> + disntanceY,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_LEFT</span>
    )
    <span class="keyword">break</span>
  <span class="comment">// å·¦ä¸Šè§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_LEFT</span>:
    <span class="title function_">resizeTextElement</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">TextElement</span>,
      resizeElement.<span class="property">rect</span>.<span class="property">width</span> - disntanceX,
      resizeElement.<span class="property">rect</span>.<span class="property">height</span> - disntanceY,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_LEFT</span>
    )
    <span class="keyword">break</span>
  <span class="comment">// å³ä¸Šè§’</span>
  <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_RIGHT</span>:
    <span class="title function_">resizeTextElement</span>(
      resizeElement <span class="keyword">as</span> <span class="title class_">TextElement</span>,
      resizeElement.<span class="property">rect</span>.<span class="property">width</span> + disntanceX,
      resizeElement.<span class="property">rect</span>.<span class="property">height</span> - disntanceY,
      <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_RIGHT</span>
    )
    <span class="keyword">break</span>
  <span class="attr">default</span>:
    <span class="keyword">break</span>
&#125;

<span class="comment">/**</span>
<span class="comment"> * ä¿®æ”¹æ–‡æœ¬å…ƒç´ å¤§å°</span>
<span class="comment"> * <span class="doctag">@param</span> ele æ–‡æœ¬å…ƒç´ </span>
<span class="comment"> * <span class="doctag">@param</span> width æ”¹å˜åçš„å®½åº¦</span>
<span class="comment"> * <span class="doctag">@param</span> height æ”¹å˜åçš„é«˜åº¦</span>
<span class="comment"> * <span class="doctag">@param</span> resizeType æ‹–æ‹½ç±»å‹</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">resizeTextElement</span> = (<span class="params"></span>
<span class="params">  ele: TextElement,</span>
<span class="params">  width: number,</span>
<span class="params">  height: number,</span>
<span class="params">  resizeType: string</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> oldRatio = ele.<span class="property">rect</span>.<span class="property">width</span> / ele.<span class="property">rect</span>.<span class="property">height</span>
  <span class="keyword">const</span> newRatio = width / height
  <span class="comment">// æŒ‰ç…§ä¹‹å‰çš„è¯´æ˜ï¼Œä¿®æ”¹å®½é«˜æ¯”ä¸ä¸€è‡´çš„æƒ…å†µ</span>
  <span class="keyword">if</span> (newRatio &lt; oldRatio) &#123;
    height = width / oldRatio
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newRatio &gt; oldRatio) &#123;
    width = oldRatio * height
  &#125;

  <span class="comment">/**</span>
<span class="comment">   * å› ä¸ºè¿™ä¸ªç¼©æ”¾æ˜¯æŒ‰ç…§å·¦ä¸Šè§’ç¼©æ”¾çš„</span>
<span class="comment">   * æ‰€ä»¥ä¸ºäº†è¾¾åˆ°å½“å‰æ‹–æ‹½æ‰‹æŸ„ä¸ç§»åŠ¨ï¼Œå°±éœ€è¦è¿›è¡Œåç§»æ“ä½œ</span>
<span class="comment">   */</span>
  <span class="keyword">switch</span> (resizeType) &#123;
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_RIGHT</span>:
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">BOTTOM_LEFT</span>:
      ele.<span class="property">rect</span>.<span class="property">x</span> -= width - ele.<span class="property">rect</span>.<span class="property">width</span>
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_LEFT</span>:
      ele.<span class="property">rect</span>.<span class="property">x</span> -= width - ele.<span class="property">rect</span>.<span class="property">width</span>
      ele.<span class="property">rect</span>.<span class="property">y</span> -= height - ele.<span class="property">rect</span>.<span class="property">height</span>
      <span class="keyword">break</span>
    <span class="keyword">case</span> <span class="variable constant_">RESIZE_TYPE</span>.<span class="property">TOP_RIGHT</span>:
      ele.<span class="property">rect</span>.<span class="property">y</span> -= height - ele.<span class="property">rect</span>.<span class="property">height</span>
      <span class="keyword">break</span>
    <span class="attr">default</span>:
      <span class="keyword">break</span>
  &#125;
  ele.<span class="property">rect</span>.<span class="property">height</span> = height
  ele.<span class="property">rect</span>.<span class="property">width</span> = width
  <span class="comment">// å­—ä½“å¤§å°æŒ‰ç…§é«˜åº¦ä¿®æ”¹</span>
  ele.<span class="property">fontSize</span> = ele.<span class="property">rect</span>.<span class="property">height</span>
&#125;</code></pre></li>
</ul>
</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœæœ‰å‘ç°é—®é¢˜æˆ–è€…æœ‰å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿è®¨è®ºğŸ‘»</p>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>pnpmçš„node_modulesç»“æ„è®¾è®¡</title>
    <url>/2022/08/24/pnpm%E7%9A%84node-modules%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="pnpmçš„node-modulesç»“æ„è®¾è®¡"><a href="#pnpmçš„node-modulesç»“æ„è®¾è®¡" class="headerlink" title="pnpmçš„node_modulesç»“æ„è®¾è®¡"></a>pnpmçš„node_modulesç»“æ„è®¾è®¡</h2><p>åˆ†æpnpmä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸‹npmç°åœ¨çš„ä¸€äº›é—®é¢˜</p>
<h3 id="npmçš„é—®é¢˜"><a href="#npmçš„é—®é¢˜" class="headerlink" title="npmçš„é—®é¢˜"></a>npmçš„é—®é¢˜</h3><ul>
<li><p>å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨<code>npm install</code>å‘½ä»¤åï¼Œnode_moduleså°±ä¼šå‘ˆç°ä»¥ä¸‹ç±»ä¼¼å†…å®¹<br><img src="https://img-blog.csdnimg.cn/7396b28d86f84a21b15b4ef6026ddd45.png#pic_center" alt="npm_node_modules"></p>
</li>
<li><p>ä¹‹æ‰€ä»¥å‡ºç°è¿™ç§æ‰å¹³çš„ç»“æ„ï¼Œæœ€åˆæ—¶åˆè¡·æ˜¯å¥½çš„ï¼Œä¸ºäº†æ›´å¥½çš„åˆ©ç”¨èµ„æºï¼ŒæŠŠæ¯ä¸ªä¾èµ–å…¨éƒ¨æ”¾åˆ°é¡¶å±‚ï¼Œè¿™æ ·å°±ä¸ä¼šé€ æˆæ¯ä¸ªä¾èµ–åµŒå¥—è¿‡æ·±ï¼Œå¯¼è‡´å¾ˆå¤šé‡å¤ä¾èµ–æ–‡ä»¶</p>
</li>
<li><p>ä½†æ˜¯éšç€è¿™ç§æ–‡ä»¶ç»“æ„é€æ­¥ä½¿ç”¨åï¼Œå°±ä¼šæš´éœ²å‡ºæ¥ä¸¤ä¸ªé—®é¢˜</p>
<ul>
<li><strong>å¹½çµä¾èµ–</strong></li>
<li><strong>ç‰ˆæœ¬å†²çª</strong></li>
</ul>
</li>
<li><p>å¹½çµä¾èµ–å°±æ˜¯ä½ åœ¨å¼•ç”¨npmåŒ…æ—¶ï¼Œä½ ä¼šå‘ç°ä¸€äº›æ²¡æœ‰åœ¨<code>package.json</code>ä¸­å‡ºç°çš„åŒ…ä¹Ÿèƒ½å¼•ç”¨ï¼Œè¿™ä¸ªå°±æ˜¯å¹½çµä¾èµ–ï¼Œè¿™æ˜¯å› ä¸ºä½ åœ¨installä¸‹è½½npmåŒ…æ—¶ï¼ŒnpmåŒ…ä¹Ÿæœ‰å®ƒçš„ä¾èµ–ä¼šä¸‹è½½ï¼Œä½†æ˜¯ä¸‹è½½çš„ä¾èµ–ä¹Ÿä¼šå­˜åœ¨node_modulesåŒä¸€å±‚çº§ä¸‹ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¯ä»¥ç›´æ¥å¼•ç”¨</p>
</li>
<li><p>ç‰ˆæœ¬å†²çªæ˜¯å› ä¸ºä¸åŒçš„ä¾èµ–å¯èƒ½ä¾èµ–çš„åŒ…ç‰ˆæœ¬ä¹Ÿä¸åŒï¼Œä½†æ˜¯node_modulesçš„åŒä¸€å±‚çº§åªèƒ½å­˜åœ¨ä¸€ä¸ªåŒ…çš„ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå¦‚æœæœ‰ä¸åŒçš„ç‰ˆæœ¬å·å°±åªèƒ½å­˜åœ¨ä¾èµ–åŒ…çš„node_modulesä¸­ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å‡ºç°é‡å¤èµ„æº</p>
<pre><code class="highlight js">â”œâ”€â”€ package-A @<span class="number">1.0</span>
|â”€â”€ package-B @<span class="number">1.0</span>
â”œâ”€â”€ package-C @<span class="number">1.0</span>
â”‚   â””â”€â”€ package-A @<span class="number">2.0</span>
â”‚   â””â”€â”€ package-B @<span class="number">2.0</span>
â”œâ”€â”€ package-D @<span class="number">1.0</span>
â”‚   â””â”€â”€ package-A @<span class="number">2.0</span>
â”‚   â””â”€â”€ package-B @<span class="number">2.0</span></code></pre></li>
</ul>
<h3 id="pnpmçš„å‡ºç°"><a href="#pnpmçš„å‡ºç°" class="headerlink" title="pnpmçš„å‡ºç°"></a>pnpmçš„å‡ºç°</h3><ul>
<li><p>åœ¨æ‰€æœ‰å‰ç«¯è‹¦npmä¹…å·²æ—¶ï¼Œpnpmå‡ºç°äº†ï¼Œå¹¶ä¸”åœ¨pnpmå®˜ç½‘çš„ç®€ä»‹ä¸Šå°±ç®€å•è¯´æ˜äº†å®ƒçš„æ„é€ ï¼š<code>store + link</code><br><img src="https://img-blog.csdnimg.cn/20ef6cd68a0440c9841ea1450297c17a.jpeg#pic_center" alt="pnpm_node_modules"></p>
<ul>
<li>storeå°±æ˜¯ä¾èµ–çš„å®é™…å­˜å‚¨ä½ç½®ï¼ŒMac&#x2F;linuxåœ¨<code>&#123;home dir&#125;&gt;/.pnpm-store/v3</code>ï¼Œwindowsåœ¨<code>å½“å‰ç›˜/.pnpm-store/v3</code>ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸ªå¥½å¤„ï¼Œä½ åœ¨å¤šä¸ªé¡¹ç›®ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªä¾èµ–æ—¶ï¼Œå°±ä¸ç”¨é‡å¤ä¸‹è½½ï¼Œè¿™æ ·å°±æå¤§çš„å‡å°‘å­˜å‚¨ç©ºé—´</li>
<li>linkæ˜¯æŒ‡ç¬¦å·é“¾æ¥(<code>SymbolicLink</code>)å’Œç¡¬é“¾æ¥(<code>HardLink</code>)<ul>
<li>SymbolicLinkæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼ŒåŒ…å«ä¸€æ¡ä»¥ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„çš„å½¢å¼æŒ‡å‘å…¶ä»–æ–‡ä»¶æˆ–è€…ç›®å½•çš„å¼•ç”¨ï¼Œå®ƒçš„å­˜åœ¨ä¸ä¾èµ–äºç›®æ ‡æ–‡ä»¶ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶è¢«åˆ é™¤æˆ–è€…ç§»åŠ¨ï¼ŒæŒ‡å‘ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬ä¼šæŒ‡å‘ä¸€ä¸ªä¸å¤å­˜åœ¨çš„æ–‡ä»¶</li>
<li>ç›¸æ¯”äºSymbolicLinkï¼ŒHardLinkä¸æ˜¯å¼•ç”¨æ–‡ä»¶ï¼Œè€Œæ˜¯å¼•ç”¨<strong>inode</strong>ï¼Œinodeæ˜¯æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºæè¿°æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ã€‚æ‰€ä»¥ä½ å³ä½¿æ›´æ”¹ç›®æ ‡æ–‡ä»¶çš„å†…å®¹æˆ–ä½ç½®ï¼ŒHardLinkä»ç„¶æŒ‡å‘ç›®æ ‡æ–‡ä»¶ï¼Œå› ä¸ºinodeæŒ‡å‘è¯¥æ–‡ä»¶</li>
</ul>
</li>
</ul>
</li>
<li><p>ç„¶åæ‹¿reactä¸¾ä¾‹ï¼Œå½“<code>pnpm add react</code>åï¼Œåœ¨node_modulesç»ˆç«¯è¾“å…¥<code>tree -a -L 3</code>ä¼šå¾—åˆ°ä»¥ä¸‹node_modulesç»“æ„</p>
<pre><code class="highlight js">.
â”œâ”€â”€ .<span class="property">modules</span>.<span class="property">yaml</span>
â”œâ”€â”€ .<span class="property">pnpm</span>
â”‚   â”œâ”€â”€ js-tokens@<span class="number">4.0</span><span class="number">.0</span>
â”‚   â”‚   â””â”€â”€ node_modules
â”‚   â”œâ”€â”€ lock.<span class="property">yaml</span>
â”‚   â”œâ”€â”€ loose-envify@<span class="number">1.4</span><span class="number">.0</span>
â”‚   â”‚   â””â”€â”€ node_modules
â”‚   â”œâ”€â”€ node_modules
â”‚   â”‚   â”œâ”€â”€ .<span class="property">bin</span>
â”‚   â”‚   â”œâ”€â”€ js-tokens -&gt; ../js-tokens@<span class="number">4.0</span><span class="number">.0</span>/node_modules/js-tokens
â”‚   â”‚   â””â”€â”€ loose-envify -&gt; ../loose-envify@<span class="number">1.4</span><span class="number">.0</span>/node_modules/loose-envify
â”‚   â””â”€â”€ react@<span class="number">18.2</span><span class="number">.0</span>
â”‚       â””â”€â”€ node_modules
â””â”€â”€ react -&gt; .<span class="property">pnpm</span>/react@<span class="number">18.2</span><span class="number">.0</span>/node_modules/react</code></pre></li>
<li><p>node_modulesä¸‹é™¤äº†.pnpmå¤–åªæœ‰ä¸€ä¸ªreactï¼Œè¿™ä¸ªreactåªæ˜¯ä¸€ä¸ªSymbolicLinkï¼Œå½“node.jsè§£ææ—¶ï¼Œä¼šæ‰¾åˆ°reactçš„çœŸå®ä½ç½®<code>node_modules/.pnpm/react@18.2.0/node_modules/react</code></p>
</li>
<li><p>.pnpmå°±æ˜¯å°†æ‰€æœ‰ä¾èµ–æ”¾åœ¨åŒä¸€å±‚æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯ä¸ªåŒ…éƒ½å¯ä»¥é€šè¿‡<code>.pnpm/&lt;name&gt;@&lt;version&gt;/node_modules/&lt;name&gt;</code>è¿™ç§è·¯å¾„æ‰¾åˆ°ï¼Œç„¶åé€šè¿‡<code>hand link</code>çš„æ–¹å¼åœ¨storeä¸­å¼•ç”¨ä¾èµ–æ–‡ä»¶</p>
</li>
<li><p>é€šè¿‡è¿™ç§æ–‡ä»¶ç»“æ„ï¼Œpnpmå°±è§£å†³äº†npmçš„ä¸¤ä¸ªé—®é¢˜ï¼Œé¦–å…ˆnode_modulesä¸‹ä¸ä¼šæœ‰ä½ æœªåœ¨package.jsonä¸­å£°æ˜çš„ä¾èµ–ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å¹½çµä¾èµ–çš„é—®é¢˜ã€‚ç„¶å.pnpmä¸‹ä¼šæœ‰name+versionçš„æ–¹å¼é“¾æ¥åˆ°storeä¸­ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°å› ä¸ºç‰ˆæœ¬å†²çªé€ æˆèµ„æºé‡å¤çš„é—®é¢˜</p>
</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://www.pnpm.cn/blog/2020/05/27/flat-node-modules-is-not-the-only-way">Flat node_modules is not the only way</a></li>
<li><a href="https://www.pnpm.cn/symlinked-node-modules-structure">Symlinked node_modules structure</a></li>
<li><a href="https://juejin.cn/post/7043998041786810398">One For Allï¼šåŸºäºpnpm + lerna + typescriptçš„æœ€ä½³é¡¹ç›®å®è·µ - ç†è®ºç¯‡</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>pnpm</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘AI is sleepwalking us into surveillance</title>
    <url>/2023/08/05/%E3%80%90%E7%BF%BB%E3%80%91AI-is-sleepwalking-us-into-surveillance/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://uxdesign.cc/ai-is-sleepwalking-us-into-surveillance-ed7921462b8b">AI is sleepwalking us into surveillance</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@arvindsanjeev">Arvind Sanjeev</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><img src="https://miro.medium.com/v2/resize:fit:1400/1*oJjQvahNXMcXwxqMNyDuvw.gif"></p>
<p>åœ¨2020å¹´ï¼Œä¸€å¼ å¥³äººååœ¨é©¬æ¡¶ä¸Šçš„ç…§ç‰‡åœ¨ç½‘ä¸Šé­åˆ°æ³„æ¼ï¼Œè¿™ä¸ªäº‹å¼•å‘äº†å·¨å¤§çš„äº‰è®®ã€‚<a href="https://www.technologyreview.com/2022/12/19/1065306/roomba-irobot-robot-vacuums-artificial-intelligence-training-data-privacy/">Roomba J7 å¸å°˜å™¨æœºå™¨äººæ‹æ‘„äº†è¿™å¼ ç…§ç‰‡ï¼Œç”¨ä½œæ—¥å¸¸æ•°æ®æ”¶é›†çš„ä¸€éƒ¨åˆ†</a>ã€‚è¿™åªæ˜¯ä¸€ç³»åˆ—ç…§ç‰‡ä¸­çš„ä¸€å¼ ï¼Œè¿™äº›ç…§ç‰‡æœ‰æ‹æ‘„äº†æ•´ä¸ªå®¶åº­ã€ç‰©å“å’Œç”Ÿæ´»ä¸­çš„ä¸€äº›äººã€‚ç„¶åæœ‰ä¸€ç¾¤æ¥è‡ªå§”å†…ç‘æ‹‰çš„ä¸´æ—¶å·¥ä¸ºè®­ç»ƒ AI æ¨¡å‹è´Ÿè´£æ ‡æ³¨å›¾ç‰‡ï¼Œä»–ä»¬æ”¶åˆ°äº†è¿™äº›å›¾ç‰‡å¹¶æ³„æ¼åˆ°ç½‘ä¸Šã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*CRckBEERVw4ZzLHSx6aN-w.png"><br><img src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*C6zMQB6Gmf_QfKcfiAcIWw.png"><br><img src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*C5Rhl2Kj7AJRDwgHyFpOFg.png"></p>
<p>ä¸ºäº†è®©æ¯ä¸ªæ–°çš„AIæ¨¡å‹æ¯”ä¸Šä¸€ä¸ªæ¨¡å‹æ›´å¥½æ—¶ï¼Œå…¬å¸ä¸æƒœé‡‡ç”¨ä¸é“å¾·çš„æ•°æ®æ”¶é›†æŠ€æœ¯ï¼Œä»¥ä¾¿è®©è‡ªå·±åœ¨ç«äº‰ä¸­è„±é¢–è€Œå‡ºã€‚æˆ‘ä»¬çš„ç§æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬åŒ»ç–—è®°å½•ã€ç…§ç‰‡ã€ç¤¾äº¤åª’ä½“ç­‰å†…å®¹ï¼Œéƒ½è¢«çº³å…¥ç”¨äºè®­ç»ƒAIæ¨¡å‹çš„æ•°æ®é›†ä¸­ã€‚</p>
<h2 id="Your-data-is-being-stolen"><a href="#Your-data-is-being-stolen" class="headerlink" title="Your data is being stolen"></a>Your data is being stolen</h2><p><strong>ä½ æ„¿æ„ä¸ºäº†æ–¹ä¾¿è€Œæ”¾å¼ƒéšç§å—ï¼Ÿ</strong></p>
<blockquote>
<p>Reading all the privacy policies you encounter in a year from big tech companies would take 30 full working days of your life.<br>Source: <a href="https://lorrie.cranor.org/pubs/readingPolicyCost-authorDraft.pdf">The cost of reading privacy policies</a></p>
</blockquote>
<p>å®¶æ˜¯æˆ‘ä»¬å®‰å…¨çš„åœ°æ–¹ï¼Œä½†å¦‚æœå®¶é‡Œçš„ç”µå™¨å¼€å§‹æ³„æ¼æˆ‘ä»¬çš„æ•°æ®ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ•°æ®è°ƒæŸ¥è®°è€… Kashmir Hill å’Œ Surya Mattu æ­ç¤ºäº†æˆ‘ä»¬å®¶é‡Œçš„æ™ºèƒ½è®¾å¤‡æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„ã€‚æœ€åˆï¼Œä½ çš„ç”µåŠ¨ç‰™åˆ·ä¼šç»å¸¸å‘é€æ•°æ®åˆ°å®ƒçš„æ¯å…¬å¸ï¼Œç„¶è€Œï¼Œåœ¨2018å¹´çš„ TED talk ä¸­æ­ç¤ºäº†è¿™äº›æ”¶é›†çš„æ•°æ®ä¼šåè¿‡æ¥å½±å“æˆ‘ä»¬ã€‚æ¯”å¦‚ï¼Œä½ çš„ç‰™ç§‘ä¿é™©å…¬å¸å¯ä»¥ä»è¿™äº›ç‰™åˆ·å…¬å¸ä¸­è´­ä¹°ä½ çš„æ•°æ®ï¼Œå¦‚æœä½ æ™šä¸Šæ²¡æœ‰åˆ·ç‰™ï¼Œå°±ä¼šæ”¶å–æ›´é«˜çš„ä¿è´¹ã€‚</p>
<div style="max-width:854px"><div style="position:relative;height:0;padding-bottom:56.25%"><iframe src="https://embed.ted.com/talks/lang/en/kashmir_hill_and_surya_mattu_what_your_smart_devices_know_and_share_about_you" width="854" height="480" style="position:absolute;left:0;top:0;width:100%;height:100%" frameborder="0" scrolling="no" allowfullscreen></iframe></div></div>

<p>ç”¨äºè®­ç»ƒå›¾åƒåˆæˆçš„ AI æ¨¡å‹çš„æ•°æ®é›†æ˜¯é€šè¿‡åœ¨ç½‘ä¸Šæœå¯»å›¾åƒåˆ¶ä½œçš„ï¼Œè¿™äº›å›¾åƒçš„ç‰ˆæƒæ‰€æœ‰è€…å’ŒæŒæœ‰äººå¯èƒ½åŒæ„æˆ–è€…å¹¶æ²¡æœ‰åŒæ„å…è®¸ä½¿ç”¨ã€‚ç”šè‡³<a href="https://arstechnica.com/information-technology/2022/09/artist-finds-private-medical-record-photos-in-popular-ai-training-data-set/">ç—…äººçš„ç§äººç—…å†ä¹Ÿä¼šæˆä¸ºAIæ¨¡å‹çš„è®­ç»ƒæ•°æ®</a>ã€‚æ¥è‡ªåŠ åˆ©ç¦å°¼äºšå·çš„è‰ºæœ¯å®¶ Laping å‘ç°ï¼Œå¥¹çš„åŒ»ç”Ÿåœ¨2013å¹´ä¸ºå¥¹æ‹æ‘„çš„ç—…å†ç…§ç‰‡è¢«æ”¶å½•åˆ° LAION-5B image setï¼Œè¿™æ˜¯ Stable Diffusion å’Œ Google Imagen ä½¿ç”¨çš„ data setã€‚å¥¹é€šè¿‡<a href="https://haveibeentrained.com/">Have I Been Trained</a>å‘ç°è¿™ä¸€ç‚¹ï¼Œè¿™ä¸ªå·¥å…·æ˜¯ Holly Herndon çš„ä¸€ä¸ªé¡¹ç›®ï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡è¯¥å·¥å…·æŸ¥çœ‹è‡ªå·±çš„ç…§ç‰‡æ˜¯å¦è¢«ç”¨äºè®­ç»ƒ AI æ¨¡å‹ã€‚</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">ğŸš©My face is in the <a href="https://twitter.com/hashtag/LAION?src=hash&amp;ref_src=twsrc%5Etfw">#LAION</a> dataset. In 2013 a doctor photographed my face as part of clinical documentation. He died in 2018 and somehow that image ended up somewhere online and then ended up in the dataset- the image that I signed a consent form for my doctor- not for a dataset. <a href="https://t.co/TrvjdZtyjD">pic.twitter.com/TrvjdZtyjD</a></p>&mdash; Lapine (@LapineDeLaTerre) <a href="https://twitter.com/LapineDeLaTerre/status/1570889343845404672?ref_src=twsrc%5Etfw">September 16, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote>
<p>The LAION-5B dataset, which has more than 5 billion images, includes photoshopped celebrity porn, hacked and stolen nonconsensual porn, and graphic images of ISIS beheadings. More mundanely, they include living artistsâ€™ artwork, photographersâ€™ photos, medical imagery, and photos of people who presumably did not believe that their images would suddenly end up as the basis to be trained by an AI.<br>Source: <a href="https://www.vice.com/en/article/3ad58k/ai-is-probably-using-your-images-and-its-not-easy-to-opt-out">AI Is Probably Using Your Images and Itâ€™s Not Easy to Opt Out</a>, Vice</p>
</blockquote>
<h2 id="Compromised-identities"><a href="#Compromised-identities" class="headerlink" title="Compromised identities"></a>Compromised identities</h2><p><strong>ç ”ç©¶è¯æ˜ï¼ŒAI ç”Ÿæˆçš„é¢éƒ¨å›¾åƒå¯ä»¥é€šè¿‡é€†å‘å·¥ç¨‹çš„æ–¹å¼æ­ç¤ºå‡ºå…¶çœŸå®äººç‰©æ¥æº</strong></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*4ehilQEObju2ePksOV9MPA.gif"></p>
<p>ç°åœ¨ï¼ŒAIç”Ÿæˆçš„äººè„¸å·²æˆä¸ºä¸»æµã€‚è®¾è®¡å¸ˆæŠŠå®ƒä»¬ç”¨ä¸ºä½œå“æ‹æ‘„çš„æ¨¡ç‰¹æˆ–è€…å‡äººã€‚å› ä¸ºä»–ä»¬è®¤ä¸ºæ—¢ç„¶è¿™äº›äººä¸æ˜¯çœŸäººï¼Œå°±ä¸ç”¨å¾å¾—ä»–ä»¬çš„åŒæ„ã€‚ç„¶è€Œï¼Œè¿™äº›ç”Ÿæˆçš„äººè„¸å¹¶ä¸æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚2021å¹´ï¼Œç ”ç©¶å‘˜å¯ä»¥æŠŠ GAN ç”Ÿæˆçš„äººè„¸<a href="https://www.technologyreview.com/2021/10/12/1036844/ai-gan-fake-faces-data-privacy-security-leak/">å›æº¯åˆ°åŸå§‹äººè„¸ä¸Š</a>ã€‚å› ä¸ºè¿™äº›ç”Ÿæˆçš„äººè„¸å’ŒåŸå§‹çš„äººè„¸ç›¸ä¼¼ï¼Œåªæ˜¯ç•¥æœ‰æ„ŸåŠ¨ï¼Œé€šè¿‡è¿™äº›æ•°æ®é›†å°±æš´éœ²äº†é‚£äº›äººè„¸çš„çœŸå®èº«ä»½ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5VPgtH5UGFQijaCI4_9Ldw.png"></p>
<p>ä¸GANä¸åŒï¼Œåƒ DALL-E æˆ– Midjourney è¿™æ ·çš„æ‰©æ•£æ¨¡å‹äº§ç”Ÿçš„å›¾åƒè¢«è®¤ä¸ºæ›´æ¥è¿‘çœŸå®ï¼Œå¹¶ä¸”ä¸è®­ç»ƒé›†ä¸­çš„å›¾åƒæ˜¾è‘—ä¸åŒã€‚é€šè¿‡ç”Ÿæˆæ–°å›¾åƒï¼Œä»–ä»¬æä¾›äº†ä¸€ç§ä¿æŠ¤æ•°æ®é›†ä¸­ä¸ªäººéšç§çš„æ–¹å¼ã€‚ç„¶è€Œï¼Œä¸€ç¯‡åä¸º <a href="https://arxiv.org/pdf/2301.13188.pdf">Extracting Training Data from Diffusion Models</a> çš„è®ºæ–‡å±•ç¤ºäº†æ‰©æ•£æ¨¡å‹å¦‚ä½•ä»è®­ç»ƒæ•°æ®ä¸­è®°å¿†å•ä¸ªå›¾åƒï¼Œå¹¶åœ¨è¿è¡Œæ—¶é‡æ–°ç”Ÿæˆã€‚äººä»¬æ™®éè®¤ä¸º AI æ¨¡å‹æ˜¯ä¸€ä¸ªâ€œé»‘ç›’å­â€ï¼Œé‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä½†é€šè¿‡è¿™äº›å®éªŒï¼Œäººä»¬éœ€è¦é‡æ–°å®¡è§†è¿™ä¸€è§‚ç‚¹ã€‚</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Models such as Stable Diffusion are trained on copyrighted, trademarked, private, and sensitive images.<br><br>Yet, our new paper shows that diffusion models memorize images from their training data and emit them at generation time.<br><br>Paper: <a href="https://t.co/LQuTtAskJ9">https://t.co/LQuTtAskJ9</a> <br><br>ğŸ‘‡[1/9] <a href="https://t.co/ieVqkOnnoX">pic.twitter.com/ieVqkOnnoX</a></p>&mdash; Eric Wallace (@ICML) (@Eric_Wallace_) <a href="https://twitter.com/Eric_Wallace_/status/1620449934863642624?ref_src=twsrc%5Etfw">January 31, 2023</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="AI-surveillance"><a href="#AI-surveillance" class="headerlink" title="AI surveillance"></a>AI surveillance</h2><p><strong>é€šè¿‡ AI åŠ å¼ºç¤¾ä¼šçš„ç›‘æ§</strong></p>
<p>æœ€å…·äº‰è®®çš„æ™ºèƒ½ç›‘æ§æ¡ˆä¾‹ä¹‹ä¸€å‘ç”Ÿåœ¨2019å¹´é¦™æ¸¯æŠ—è®®æ´»åŠ¨æœŸé—´ã€‚è­¦æ–¹ä½¿ç”¨<a href="https://www.telegraph.co.uk/news/2019/08/02/innovative-hong-kong-protesters-using-lasers-traffic-cones-parkour/">é¢éƒ¨è¯†åˆ«æŠ€æœ¯</a>æ¥è¯†åˆ«æŠ—è®®è€…ï¼Œå¹¶å¯¹ä»–ä»¬è¿›è¡Œå•ç‹¬å¤„ç½šã€‚æŠ—è®®è€…æ„è¯†åˆ°è¿™ä¸€ç‚¹åï¼Œäºæ˜¯ä½¿ç”¨<a href="https://www.independent.co.uk/tech/hong-kong-protests-lasers-facial-recognition-ai-china-police-a9033046.html">é»‘å®¢æ¿€å…‰ç¬”ç„å‡†æ‘„åƒå¤´</a>ï¼Œçƒ§æ¯é‚£äº›æ‘„åƒå¤´çš„å›¾åƒä¼ æ„Ÿå™¨ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:996/0*0PCrBpv3P7FrAGen.gif"></p>
<p>å…¨ä¸–ç•Œä¸€åŠçš„ç›‘æ§æ‘„åƒå¤´éƒ½åœ¨ä¸­å›½ï¼Œä½¿ä¸­å›½æˆä¸º<a href="https://fortune.com/2020/11/03/china-surveillance-system-backlash-worlds-largest/">ä¸–ç•Œä¸Šæœ€å¤§çš„ç›‘æ§ç¤¾ä¼š</a>ã€‚ä»–ä»¬åˆ©ç”¨æ‘„åƒå¤´å¯¹ä¹±ç©¿é©¬è·¯è€…è¿›è¡Œç½šæ¬¾ï¼Œæˆ–åˆ©ç”¨é¢éƒ¨è¯†åˆ«æŠ€æœ¯è¿›è¡Œæœºåœºå®‰æ£€ã€‚è™½ç„¶åŸºäº AI çš„ç›‘æ§ç³»ç»Ÿçœ‹ä¼¼æ˜¯æ‰“å‡»çŠ¯ç½ªå’Œææ€–ä¸»ä¹‰çš„é‡è¦å·¥å…·ã€‚ä½†å´å¼•å‘äº†æœ‰å…³éšç§å’Œå…¬æ°‘è‡ªç”±çš„æ‹…å¿§ã€‚è¿™äº›ç³»ç»ŸæŒ‡å‘äº† Orwellian å¼çš„æœªæ¥ï¼ŒBig brother å¯èƒ½ä¼šç›‘è§†å¹¶æ§åˆ¶ä¸ªäººï¼Œæ½œåœ¨åœ°ä¸§å¤±è‡ªç”±å’Œå…¬æ°‘è‡ªç”±ã€‚</p>
<h2 id="Whoâ€™s-fighting-back"><a href="#Whoâ€™s-fighting-back" class="headerlink" title="Whoâ€™s fighting back?"></a>Whoâ€™s fighting back?</h2><p>å¯¹äºä¾µçŠ¯éšç§çš„ AIï¼Œç¾å›½è”é‚¦è´¸æ˜“å§”å‘˜ä¼šï¼ˆFTCï¼‰ç»™å‡ºäº†ä¸€ä¸ªå¸¦æœ‰æŒ‘è¡…æ€§çš„ç­”æ¡ˆã€‚ä»–ä»¬å·²ç»<a href="https://www.protocol.com/policy/ftc-algorithm-destroy-data-privacy">å¼€å§‹å®è·µç®—æ³•æ‘§æ¯</a>ã€‚ä»–ä»¬è¦æ±‚å…¬å¸å’Œç»„ç»‡æ‘§æ¯å…¶æ¶æ„æˆ–éæ³•æ”¶é›†çš„ä¸ªäººä¿¡æ¯å’Œæ•°æ®å»ºç«‹çš„ç®—æ³•æˆ–AIæ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å€¡è®®çš„ä¾‹å­ï¼š</p>
<h3 id="Policies-and-frameworks"><a href="#Policies-and-frameworks" class="headerlink" title="Policies and frameworks"></a>Policies and frameworks</h3><p>æ¬§ç›Ÿåœ¨<a href="https://www.politico.eu/article/europe-edges-closer-to-a-ban-on-facial-recognition/">AIæ—¶ä»£ä¿æŠ¤ä¸ªäººéšç§æ–¹é¢è¿ˆå‡ºäº†é‡è¦ä¸€æ­¥</a>ã€‚ä»–ä»¬æ”¯æŒç¦æ­¢åœ¨å…¬å…±åœºæ‰€è¿›è¡ŒAIç›‘æ§çš„æ–¹æ¡ˆã€‚æ¬§ç›Ÿå¹¿å—æ¬¢è¿çš„ <a href="https://gdpr-info.eu/?ref=dr-mark-van-rijmenam-csp-the-digital-speaker-strategic-futurist">General Data Protection Regulation</a> ä¹Ÿæ‹¥æœ‰æœ€ä½³çš„æ•°æ®ä¿æŠ¤æ¡ä¾‹ï¼Œè¯¥æ¡ä¾‹è¦æ±‚åœ¨æ”¶é›†å’Œä½¿ç”¨ä¸ªäººæ•°æ®å‰éœ€å¾å¾—ä¸ªäººåŒæ„ã€‚</p>
<p>åŠ æ‹¿å¤§çš„ <a href="https://www.priv.gc.ca/en/privacy-topics/privacy-laws-in-canada/the-personal-information-protection-and-electronic-documents-act-pipeda/">Personal Information Protection and Electronic Documents Act</a> (PIPEDA) è¦æ±‚ä¼ä¸šé‡‡å–â€œåˆç†çš„â€å®‰å…¨ä¿éšœæªæ–½æ¥ä¿æŠ¤ä¸ªäººä¿¡æ¯ã€‚è€Œåœ¨ç¾å›½ï¼Œ <a href="https://oag.ca.gov/privacy/ccpa?ref=dr-mark-van-rijmenam-csp-the-digital-speaker-strategic-futurist">California Consumer Privacy Act</a> (CCPA) æ˜¯ä¸€éƒ¨å…¨é¢çš„éšç§æ³•ï¼Œèµ‹äºˆä¸ªäººè¯¢é—®ç»„ç»‡æ”¶é›†ä¸ªäººä¿¡æ¯ï¼Œå¦‚ä½•ä½¿ç”¨ä»¥åŠç”¨äºä½•ç§ç›®çš„çš„æƒåˆ©ã€‚</p>
<h3 id="Projects-and-experiments"><a href="#Projects-and-experiments" class="headerlink" title="Projects and experiments"></a>Projects and experiments</h3><ul>
<li><a href="https://haveibeentrained.com/">Have I Been Trained</a>ï¼šä¸€ä¸ªå¯ä»¥è½»æ¾æœç´¢æˆ‘ä»¬çš„æ•°æ®æ˜¯å¦è¢«ç”¨äºè®­ç»ƒAIçš„å¹³å°ã€‚ä¸Šä¼ ä½ çš„ç…§ç‰‡ï¼ŒæŸ¥çœ‹æ˜¯å¦è¢«è¿›å…¥åˆ°æ‰©æ•£æ¨¡å‹çš„æ•°æ®é›†ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªåä¸º <a href="https://spawning.ai/">Spawning.ai</a> é¡¹ç›®ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥é¡¹ç›®è®©äººä»¬é‡æ–°æŒæ§è‡ªå·±çš„æ•°æ®ã€‚ä»–ä»¬è¿˜åœ¨å¼€å‘â€œé€‰æ‹©é€€å‡ºâ€å’Œâ€œé€‰æ‹©åŠ å…¥â€çš„å·¥å…·ï¼Œè®©ä½ èƒ½å¤Ÿå†³å®šæ˜¯å¦å°†ä½ çš„æ•°æ®ç”¨äºè®­ç»ƒã€‚</li>
<li><a href="https://microsoft.github.io/FaceSynthetics/">Microsoft Synthetic Faces</a>ï¼šå¾®è½¯æä¾›äº†100,000å¼ åˆæˆäººè„¸ï¼Œç”¨äºè®­ç»ƒè„¸éƒ¨è¯†åˆ«ç®—æ³•ï¼Œè€Œæ— éœ€ä½¿ç”¨çœŸäººã€‚</li>
</ul>
<p><img src="https://miro.medium.com/v2/format:webp/1*dqWiNZQGABXXbgNlxK9SRQ.png"></p>
<ul>
<li><a href="https://unlabeled.jp/en/camouflage/">AI Camouflage</a>ï¼šå¯åŠ å…¥ä¸€äº›å¯¹æŠ—æ€§è¡¥ä¸ï¼ŒåµŒå…¥åˆ°è¡£æœæˆ–å…¶ä»–ç‰©ä½“ä¸­ï¼Œç”¨äºå¹²æ‰°AIåˆ†ç±»ç³»ç»Ÿ</li>
</ul>
<p><img src="https://miro.medium.com/v2/resize:fit:960/1*xISa3pvq1IpxCmVR3YPn-A.gif"><br><img src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*1Znf2sv1bK9seDqaMGDc9w.png"></p>
<ul>
<li><a href="https://arxiv.org/pdf/2109.06467.pdf">Adversarial Makeup</a>ï¼šé€šè¿‡åŒ–å¦†å¹²æ‰°AIåˆ†ç±»ç³»ç»Ÿï¼Œä½¿ä½ åœ¨ç³»ç»Ÿä¸­å˜å¾—éš¾ä»¥è¾¨è®¤ã€‚CV dazzle è¿˜åœ¨ Youtube ä¸Šæä¾›åŒ–å¦†æ•™ç¨‹ï¼š</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kGGnnp43uNM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><a href="https://bjoernkarmann.dk/project/project_alias">Alias</a>ï¼šBjÃ¸rn Karmann æå‡ºçš„éšç§å¹²é¢„æ–¹æ¡ˆå¯ä»¥é˜»æ­¢è¯­éŸ³åŠ©æ‰‹ç›‘å¬ä½ çš„å£°éŸ³ã€‚</li>
</ul>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oQFCASWtRqdyqy_B.jpg"></p>
<p>åœ¨<a href="https://www.goodreads.com/en/book/show/36696533">ã€ŠNew Dark Ageã€‹</a>ä¸­ï¼ŒJames Bridleå¯¹AIç›‘æ§å¦‚ä½•å°†ä¸´åºŠåæ‰§ç—‡å˜æˆç°å®å‘è¡¨äº†è¯„è®ºã€‚ä¸´åºŠå¦„æƒ³ç—‡çš„æœ€åˆç—‡çŠ¶ä¹‹ä¸€å°±æ˜¯è®¤ä¸ºæœ‰äººåœ¨ç›‘è§†ä½ ï¼›ä½†ç°åœ¨è¿™ç§æƒ³æ³•æ˜¯åˆç†çš„ã€‚æˆ‘ä»¬å‘é€çš„æ¯ä¸€å°é‚®ä»¶ã€å†™çš„æ¯ä¸€æ¡çŸ­ä¿¡ã€æ‰“çš„æ¯ä¸€é€šç”µè¯ã€èµ°çš„æ¯ä¸€æ®µè·¯ã€è¿ˆå‡ºçš„æ¯ä¸€æ­¥ã€å‘¼å¸ã€åšçš„æ¯ä¸€ä¸ªæ¢¦ã€è¯´å‡ºçš„æ¯ä¸€å¥è¯ï¼Œéƒ½æˆä¸ºå¤§è§„æ¨¡çš„è‡ªåŠ¨æ™ºèƒ½æ”¶é›†ç³»ç»Ÿçš„ç›®æ ‡ï¼Œç¤¾äº¤ç½‘ç»œå’Œåƒåœ¾é‚®ä»¶çš„æ’åºç®—æ³•ä»¥åŠæˆ‘ä»¬è‡ªå·±æ™ºèƒ½æ‰‹æœºå’Œè”ç½‘è®¾å¤‡ä¸çœ ä¸ä¼‘çš„ç›‘è§†ã€‚é‚£ä¹ˆï¼Œç°åœ¨æ˜¯è°åœ¨åæ‰§å‘¢ï¼Ÿ</p>
<p>æœ‰å…³æ­¤ä¸»é¢˜åŠå…¶ä»–ä¸»é¢˜çš„æ›´å¤šèµ„æºï¼Œè¯·æŸ¥é˜…æœ¬æ‰‹å†Œ<a href="https://arvindsanjeev.notion.site/arvindsanjeev/The-Handbook-of-AI-s-Unintended-Consequences-720cda3d8cec49dc88807641157a0bba">ã€ŠAIâ€™s unintended consequencesã€‹</a>ã€‚æœ¬æ–‡æ˜¯æ¢è®¨ <a href="https://medium.com/@arvindsanjeev/ai-sociopaths-and-their-unintended-consequences-bf6f19012e4f">unintended consequences of AI å››éƒ¨ç³»åˆ—æ–‡ç« </a>ä¸­çš„ç¬¬ä¸‰ç« </p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>AI</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Announcing Vue 3.3</title>
    <url>/2023/08/23/%E3%80%90%E7%BF%BB%E3%80%91Announcing-Vue-3-3/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://blog.vuejs.org/posts/vue-3-3">Announcing Vue 3.3</a><br>åŸä½œè€…ï¼š<a href="https://twitter.com/youyuxi">Evan You</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒVue3.3â€Rurouni Kenshinâ€æ­£å¼å‘å¸ƒï¼</p>
<p>è¿™æ¬¡ç‰ˆæœ¬çš„é‡ç‚¹æ”¹åŠ¨åœ¨äºæå‡å¼€å‘äººå‘˜çš„å¼€å‘ä½“éªŒï¼Œç‰¹åˆ«æ˜¯SFCçš„<code>&lt;script setup&gt;</code>å’ŒTypeScriptçš„ä½¿ç”¨ã€‚å¹¶ä¸”ä¸Vueé…å¥—çš„çš„å¼€å‘å·¥å…·(Volar 1.6)ä¸€èµ·ï¼Œæˆ‘ä»¬è§£å†³äº†åœ¨ä½¿ç”¨Vueå’ŒTypecriptæ—¶é•¿æœŸå­˜åœ¨çš„è®¸å¤šç—›ç‚¹ã€‚</p>
<p>æœ¬æ–‡ç« ä¼šå¤§è‡´ä»‹ç»3.3ä¸­çš„é‡ç‚¹åŠŸèƒ½ã€‚æœ‰å…³3.3ç‰ˆæœ¬å˜æ›´çš„å®Œæ•´å†…å®¹ã€‚è¯·æŸ¥çœ‹Gitubä¸Šçš„<a href="https://github.com/vuejs/core/blob/main/CHANGELOG.md#330-2023-05-08">changelog</a></p>
<blockquote>
<p><strong>é…å¥—åº“æ›´æ–°</strong><br>å½“å‡çº§åˆ°3.3æ—¶ï¼Œå»ºè®®åŒæ—¶æ›´æ–°ä»¥ä¸‹ç›¸å…³åº“ï¼š<br>volar &#x2F; vue-tsc@^1.6.4<br>vite@^4.3.5<br>@vitejs&#x2F;plugin-vue@^4.2.0<br>vue-loader@^17.1.0 (if using webpack or vue-cli)</p>
</blockquote>
<h2 id="lt-script-setup-gt-TypeScript-DX-Improvements"><a href="#lt-script-setup-gt-TypeScript-DX-Improvements" class="headerlink" title="&lt;script setup&gt; + TypeScript DX Improvements"></a><code>&lt;script setup&gt;</code> + TypeScript DX Improvements</h2><h3 id="Imported-and-Complex-Types-Support-in-Macros"><a href="#Imported-and-Complex-Types-Support-in-Macros" class="headerlink" title="Imported and Complex Types Support in Macros"></a>Imported and Complex Types Support in Macros</h3><p>ä»¥å‰ï¼Œåœ¨<code>defineProps</code>å’Œ<code>defineEmits</code>çš„ç±»å‹å‚æ•°ä¸­ä½¿ç”¨çš„ç±»å‹ä»…é™äºæœ¬åœ°ç±»å‹ï¼Œå¹¶ä¸”åªæ”¯æŒ<code>type literals</code>å’Œ<code>interfaces</code>ã€‚åªæ˜¯å› ä¸ºVueéœ€è¦åˆ†æ<code>props interface</code>ä¸Šçš„å±æ€§ï¼Œä»¥ä¾¿èƒ½å¤Ÿç”Ÿäº§ç›¸åº”çš„è¿è¡Œæ—¶é€‰é¡¹ã€‚</p>
<p>è¿™ä¸ªé™åˆ¶åœ¨3.3ä¸­å¾—ä»¥è§£å†³ã€‚ç¼–è¯‘å™¨ç°åœ¨å¯ä»¥è§£æå¯¼å…¥ç±»å‹ï¼Œå¹¶æ”¯æŒä¸€äº›å¤æ‚ç±»å‹é›†åˆï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">import</span> type &#123; <span class="title class_">Props</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./foo&#x27;</span></span>
<span class="language-javascript"></span>
<span class="language-javascript"><span class="comment">// imported + intersection type</span></span>
<span class="language-javascript">defineProps&lt;<span class="title class_">Props</span> &amp; &#123; extraProp?: string &#125;&gt;()</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></code></pre>

<p>æ³¨æ„ï¼Œå¤æ‚ç±»å‹çš„æ”¯æŒæ˜¯åŸºäºASTçš„ï¼Œæ‰€ä»¥å¹¶é100%æ”¯æŒã€‚æŸäº›éœ€è¦å®é™…ç±»å‹åˆ†æçš„å¤æ‚ç±»å‹ï¼Œæ¯”å¦‚æ¡ä»¶ç±»å‹ï¼Œå¹¶ä¸æ”¯æŒã€‚ä½ å¯ä»¥å¯¹å•ä¸ªpropä½¿ç”¨æ¡ä»¶ç±»å‹ï¼Œä½†ä¸èƒ½å¯¹æ•´ä¸ªpropå¯¹è±¡ä½¿ç”¨æ¡ä»¶ç±»å‹ã€‚</p>
<h3 id="Generic-Components"><a href="#Generic-Components" class="headerlink" title="Generic Components"></a>Generic Components</h3><p>ä½¿ç”¨<code>&lt;script setup&gt;</code>çš„ç»„ä»¶ç°åœ¨å¯ä»¥é€šè¿‡genericå±æ€§æ¥æ”¶é€šç”¨ç±»å‹å‚æ•°ï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">generic</span>=<span class="string">&quot;T&quot;</span>&gt;</span>
defineProps&lt;&#123;
  items: T[]
  selected: T
&#125;&gt;()
<span class="tag">&lt;/<span class="name">script</span>&gt;</span></code></pre>

<p>genericçš„å€¼ä¸TypeScriptä¸­å‚æ•°åˆ—è¡¨çš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨å¤šä¸ªå‚æ•°ï¼Œé€šè¿‡extendsçº¦æŸï¼Œé»˜è®¤ç±»å‹å’Œå¼•ç”¨å¯¼å…¥ç±»å‹ï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">generic</span>=<span class="string">&quot;T extends string | number, U extends Item&quot;</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">import</span> type &#123; <span class="title class_">Item</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span>
<span class="language-javascript">defineProps&lt;&#123;</span>
<span class="language-javascript">  <span class="attr">id</span>: T</span>
<span class="language-javascript">  <span class="attr">list</span>: U[]</span>
<span class="language-javascript">&#125;&gt;()</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></code></pre>

<p>è¯¥åŠŸèƒ½ä»¥å‰éœ€è¦æ˜ç¡®é€‰æ‹©åŠ å…¥ï¼Œä½†ç°åœ¨åœ¨æœ€æ–°ç‰ˆæœ¬çš„volar&#x2F;vue-tscä¸­å·²ç»é»˜è®¤å¯ç”¨ã€‚</p>
<h3 id="More-Ergonomic-defineEmits"><a href="#More-Ergonomic-defineEmits" class="headerlink" title="More Ergonomic defineEmits"></a>More Ergonomic defineEmits</h3><p>ä»¥å‰ï¼Œ<code>defineEmits</code>çš„ç±»å‹å‚æ•°åªæ”¯æŒè°ƒç”¨ç­¾åè¯­æ³•ï¼š</p>
<pre><code class="highlight ts"><span class="comment">// BEFORE</span>
<span class="keyword">const</span> emit = defineEmits&lt;&#123;
  (<span class="attr">e</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span>
  (<span class="attr">e</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">name</span>: <span class="built_in">string</span>, ...<span class="attr">rest</span>: <span class="built_in">any</span>[]): <span class="built_in">void</span>
&#125;&gt;()</code></pre>

<p>è¯¥ç±»å‹ä¸emitçš„è¿”å›ç±»å‹ç›¸åŒ¹é…ï¼Œä½†å†™èµ·æ¥æœ‰ç‚¹å•°å—¦ä¸”ä¸å¥½çœ‹ã€‚ç„¶å3.3å¼•å…¥äº†ä¸€ç§æ›´ç¬¦åˆå·¥å­¦çš„å£°æ˜æ–¹å¼ï¼š</p>
<pre><code class="highlight ts"><span class="comment">// AFTER</span>
<span class="keyword">const</span> emit = defineEmits&lt;&#123;
  <span class="attr">foo</span>: [<span class="attr">id</span>: <span class="built_in">number</span>]
  <span class="attr">bar</span>: [<span class="attr">name</span>: <span class="built_in">string</span>, ...<span class="attr">rest</span>: <span class="built_in">any</span>[]]
&#125;&gt;()</code></pre>

<p>åœ¨ä¸Šé¢çš„ç±»å‹ä¸­ï¼Œkeyæ˜¯äº‹ä»¶åç§°ï¼Œvalueæ˜¯é¢å¤–å‚æ•°çš„æ•°ç»„ç±»å‹ã€‚è™½ç„¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…ƒç¥–ç±»å‹æ¥æ˜ç¡®å‚æ•°ï¼Œå¦‚ä¸Šé¢çš„ç¤ºä¾‹ã€‚</p>
<p>å¹¶ä¸”ç°åœ¨ä¾ç„¶æ”¯æŒè°ƒç”¨ç­¾åè¯­æ³•ã€‚</p>
<h3 id="Typed-Slots-with-defineSlots"><a href="#Typed-Slots-with-defineSlots" class="headerlink" title="Typed Slots with defineSlots"></a>Typed Slots with defineSlots</h3><p>æ–°çš„<code>defineSlots</code>å®å¯ç”¨äºå£°æ˜slotså’Œslotsçš„props</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">defineSlots&lt;&#123;</span>
<span class="language-javascript">  <span class="keyword">default</span>?: <span class="function">(<span class="params">props: &#123; msg: string &#125;</span>) =&gt;</span> any</span>
<span class="language-javascript">  item?: <span class="function">(<span class="params">props: &#123; id: number &#125;</span>) =&gt;</span> any</span>
<span class="language-javascript">&#125;&gt;()</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></code></pre>

<p><code>defineSlots()</code>åªæ¥å—ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œå¹¶ä¸”ä¸æ¥å—è¿è¡Œæ—¶å‚æ•°ã€‚ç„¶åç±»å‹å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ª<code>type literals</code>ï¼Œå…¶ä¸­çš„keyæ˜¯æ’æ§½åå­—ï¼Œvalueæ˜¯ä¸€ä¸ªæ’æ§½å‡½æ•°ã€‚å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ’æ§½æœŸæœ›æ¥å—çš„propsï¼Œå…¶ç±»å‹å°†ç”¨äºæ¨¡ç‰ˆä¸­slotçš„propsã€‚<code>defineSlots</code>çš„è¿”å›å€¼ä¸<code>useSlots</code>è¿”å›çš„æ’æ§½å¯¹è±¡ç›¸åŒã€‚</p>
<p>ç›®å‰çš„ä¸€äº›é™åˆ¶ï¼š</p>
<ul>
<li>volar&#x2F;vue-tscç›®å‰å°šæœªå®ç°æ‰€éœ€çš„æ’æ§½æ£€æŸ¥ã€‚</li>
<li>æ’æ§½å‡½æ•°çš„è¿”å›ç±»å‹ç›®å‰è¿˜æ˜¯å¿½è§†çš„ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä½†æˆ‘ä»¬å°†æ¥å¯èƒ½ä¼šåˆ©ç”¨å®ƒè¿›è¡Œæ’æ§½å†…å®¹æ£€æŸ¥ã€‚</li>
</ul>
<p>è¿˜æœ‰ä¸€ä¸ªç›¸åº”çš„<code>slots</code>é€‰é¡¹é€‚ç”¨äº<code>defineComponent</code>çš„ä½¿ç”¨ã€‚è¿™ä¸¤ä¸ªAPIéƒ½æ²¡æœ‰å®ç°è¿è¡Œæ—¶ï¼Œçº¯ç²¹æ˜¯IDEå’Œvue-tscçš„ç±»å‹æç¤ºã€‚</p>
<h2 id="Experimental-Features"><a href="#Experimental-Features" class="headerlink" title="Experimental Features"></a>Experimental Features</h2><h3 id="Reactive-Props-Destructure"><a href="#Reactive-Props-Destructure" class="headerlink" title="Reactive Props Destructure"></a>Reactive Props Destructure</h3><p>ä¹‹å‰çš„å“åº”å¼è½¬æ¢ä¸­æœªå®ç°propsçš„è§£æ„å“åº”ï¼Œç°åœ¨å·²ç»è¢«æ‹†åˆ†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„åŠŸèƒ½ã€‚</p>
<p>è¯¥åŠŸèƒ½å…è®¸è§£æ„çš„propsä¿ç•™å“åº”å¼ï¼Œå¹¶æä¾›äº†ä¸€ç§æ›´ç¬¦åˆå·¥å­¦çš„æ–¹å¼æ¥å£°æ˜propsé»˜è®¤å€¼ï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">import</span> &#123; watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span>
<span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">const</span> &#123; msg = <span class="string">&#x27;hello&#x27;</span> &#125; = <span class="title function_">defineProps</span>([<span class="string">&#x27;msg&#x27;</span>])</span>
<span class="language-javascript"></span>
<span class="language-javascript"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span>
<span class="language-javascript">  <span class="comment">// accessing `msg` in watchers and computed getters</span></span>
<span class="language-javascript">  <span class="comment">// tracks it as a dependency, just like accessing `props.msg`</span></span>
<span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`msg is: <span class="subst">$&#123;msg&#125;</span>`</span>)</span>
<span class="language-javascript">&#125;)</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>

<span class="tag">&lt;<span class="name">template</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></code></pre>

<p>è¿™ä¸ªç›®å‰æ˜¯å®éªŒæ€§çš„åŠŸèƒ½ï¼Œéœ€è¦æ˜ç¡®é€‰æ‹©åŠ å…¥ã€‚</p>
<h3 id="defineModel"><a href="#defineModel" class="headerlink" title="defineModel"></a><code>defineModel</code></h3><p>ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªç»„ä»¶è¦æ”¯æŒ<code>v-moel</code>çš„åŒå‘ç»‘å®šï¼Œé¦–å…ˆéœ€è¦å£°æ˜ä¸€ä¸ªpropï¼Œç„¶ååœ¨æ›´æ–°æ—¶å‘å‡ºç›¸åº”çš„<code>update:propName</code>äº‹ä»¶:</p>
<pre><code class="highlight html"><span class="comment">&lt;!-- BEFORE --&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>([<span class="string">&#x27;modelValue&#x27;</span>])</span>
<span class="language-javascript"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>])</span>
<span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">modelValue</span>)</span>
<span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">function</span> <span class="title function_">onInput</span>(<span class="params">e</span>) &#123;</span>
<span class="language-javascript">  <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, e.<span class="property">target</span>.<span class="property">value</span>)</span>
<span class="language-javascript">&#125;</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>

<span class="tag">&lt;<span class="name">template</span>&gt;</span>
  <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">&quot;modelValue&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;onInput&quot;</span> /&gt;</span>
<span class="tag">&lt;/<span class="name">template</span>&gt;</span></code></pre>

<p>åœ¨3.3ä¸­é€šè¿‡æ–°çš„API<code>defineModel</code>ç®€åŒ–æ¥å…¶ç”¨æ³•ã€‚è¯¥å®ä¼šè‡ªåŠ¨æ³¨å†Œä¸€ä¸ªpropï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯ä»¥ç›´æ¥æ›´æ”¹çš„ref</p>
<pre><code class="highlight html"><span class="comment">&lt;!-- AFTER --&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="keyword">const</span> modelValue = <span class="title function_">defineModel</span>()</span>
<span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(modelValue.<span class="property">value</span>)</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>

<span class="tag">&lt;<span class="name">template</span>&gt;</span>
  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;modelValue&quot;</span> /&gt;</span>
<span class="tag">&lt;/<span class="name">template</span>&gt;</span></code></pre>

<p>è¿™ä¸ªç›®å‰æ˜¯å®éªŒæ€§çš„åŠŸèƒ½ï¼Œéœ€è¦æ˜ç¡®é€‰æ‹©åŠ å…¥ã€‚</p>
<h2 id="Other-Notable-Features"><a href="#Other-Notable-Features" class="headerlink" title="Other Notable Features"></a>Other Notable Features</h2><h3 id="defineOptions"><a href="#defineOptions" class="headerlink" title="defineOptions"></a><code>defineOptions</code></h3><p>æ–°çš„defineOptionså®ç›´æ¥å¯ä»¥åœ¨<code>&lt;script setup&gt;</code>ä¸­å£°æ˜ç»„ä»¶é€‰é¡¹ï¼Œè€Œä¸éœ€è¦å•ç‹¬çš„<code>&lt;script&gt;</code>å—ï¼š</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="title function_">defineOptions</span>(&#123; <span class="attr">inheritAttrs</span>: <span class="literal">false</span> &#125;)</span>
<span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></code></pre>

<h2 id="Better-Getter-Support-with-toRef-and-toValue"><a href="#Better-Getter-Support-with-toRef-and-toValue" class="headerlink" title="Better Getter Support with toRef and toValue"></a>Better Getter Support with <code>toRef</code> and <code>toValue</code></h2><p><code>toRef</code>å¾—åˆ°å¢å¼ºï¼Œæ”¯æŒ <code>values/getters/existing refs</code>ç»Ÿä¸€è½¬ä¸º<code>refs</code></p>
<pre><code class="highlight js"><span class="comment">// equivalent to ref(1)</span>
<span class="title function_">toRef</span>(<span class="number">1</span>)
<span class="comment">// creates a readonly ref that calls the getter on .value access</span>
<span class="title function_">toRef</span>(<span class="function">() =&gt;</span> props.<span class="property">foo</span>)
<span class="comment">// returns existing refs as-is</span>
<span class="title function_">toRef</span>(existingRef)</code></pre>

<p>é€šè¿‡ getter è°ƒç”¨<code>toRef</code>å’Œ<code>computed</code>ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨åªè¿›è¡Œå±æ€§è®¿é—®è€Œä¸æ˜¯é«˜åº¦è®¡ç®—æ—¶ï¼Œ<code>toRef</code>æ•ˆç‡ä¼šæ›´é«˜</p>
<p><code>toValue</code>æ˜¯æä¾›äº†ä¸€ä¸ªç›¸åçš„æ–¹æ³•ï¼ŒæŠŠ <code>values/getters/ref</code> ç»Ÿä¸€è½¬ä¸ºæ™®é€šå€¼</p>
<pre><code class="highlight js"><span class="title function_">toValue</span>(<span class="number">1</span>) <span class="comment">//       --&gt; 1</span>
<span class="title function_">toValue</span>(<span class="title function_">ref</span>(<span class="number">1</span>)) <span class="comment">//  --&gt; 1</span>
<span class="title function_">toValue</span>(<span class="function">() =&gt;</span> <span class="number">1</span>) <span class="comment">// --&gt; 1</span></code></pre>

<p><code>toValue</code>å¯ä»¥åœ¨ç»„åˆå¼å‡½æ•°ä¸­ä»£æ›¿<code>unref</code>ï¼Œè¿™æ ·ä½ çš„ç»„åˆå¼å‡½æ•°å°±å¯ä»¥æ¥å—<code>getters</code>ä½œä¸ºå“åº”å¼æ•°æ®æºï¼š</p>
<pre><code class="highlight js"><span class="comment">// before: allocating unnecessary intermediate refs</span>
<span class="title function_">useFeature</span>(<span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">foo</span>))
<span class="title function_">useFeature</span>(<span class="title function_">toRef</span>(props, <span class="string">&#x27;foo&#x27;</span>))

<span class="comment">// after: more efficient and succinct</span>
<span class="title function_">useFeature</span>(<span class="function">() =&gt;</span> props.<span class="property">foo</span>)</code></pre>

<p><code>toRef</code>å’Œ<code>toValue</code>ä¹‹é—´çš„å…³ç³»å°±ç±»ä¼¼äº<code>ref</code>å’Œ<code>unref</code>ä¹‹é—´çš„å…³ç³»ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå¯¹<code>getter</code>å‡½æ•°çš„ç‰¹æ®Šå¤„ç†</p>
<h2 id="JSX-Import-Source-Support"><a href="#JSX-Import-Source-Support" class="headerlink" title="JSX Import Source Support"></a>JSX Import Source Support</h2><p>ç›®å‰ï¼ŒVueçš„ç±»å‹ä¼šè‡ªåŠ¨æ³¨å†Œå…¨å±€JSXç±»å‹ï¼Œè¿™å¯èƒ½ä¼šä¸éœ€è¦JSXç±»å‹æ¨æ–­çš„åº“äº§ç”Ÿå†²çªï¼Œå°¤å…¶æ˜¯React</p>
<p>ä»3.3å¼€å§‹ï¼ŒVueæ”¯æŒé€šè¿‡TypeScriptçš„<a href="https://www.typescriptlang.org/tsconfig#jsxImportSource">jsxImportSource</a>é€‰é¡¹æŒ‡å®šJSXå‘½åç©ºé—´ã€‚è¿™å…è®¸ç”¨æˆ·æ ¹æ®è‡ªå·±çš„ä½¿ç”¨æƒ…å†µé€‰æ‹©å…¨å±€æˆ–è€…æŒ‰æ–‡ä»¶é€‰é¢ã€‚</p>
<p>ä¸ºäº†å‘åå…¼å®¹ï¼Œ3.3ç‰ˆæœ¬ä»ä¼šå…¨å±€æ³¨å†ŒJSXå‘½åç©ºé—´ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨3.4ä¸­ç§»é™¤é»˜è®¤çš„å…¨å±€æ³¨å†Œã€‚å¦‚æœä½ åœ¨Vueä¸­ä½¿ç”¨TSXï¼Œåœ¨å‡çº§åˆ°3.3åï¼Œåº”åœ¨<code>tsconfig.json</code>ä¸­æ˜¾å¼æ·»åŠ <code>jsxImportSource</code>ï¼Œé¿å…åœ¨3.4ä¸­å‡ºç°ä¸­æ–­ã€‚</p>
<h2 id="Maintenance-Infrastructure-Improvements"><a href="#Maintenance-Infrastructure-Improvements" class="headerlink" title="Maintenance Infrastructure Improvements"></a>Maintenance Infrastructure Improvements</h2><p>æ­¤æ¬¡ç‰ˆæœ¬å‡çº§åŸºäºè®¸å¤šç»´æŠ¤åŸºç¡€æ„é€ çš„æ”¹è¿›ï¼Œä½¿æˆ‘ä»¬æœ‰æ›´å¤§ä¿¡å¿ƒåŠ å¿«å·¥ä½œè¿›åº¦ï¼š</p>
<ul>
<li>é€šè¿‡å°†ç±»å‹æ£€æŸ¥ä¸rollupæ„å»ºåˆ†ç¦»ï¼Œå¹¶å°†<code>rollup-plugin-typescript2</code>è¿ä¸º<code>rollup-plugin-esbuild</code>ï¼Œå°†æ„å»ºé€Ÿåº¦æé«˜äº†10å€ã€‚</li>
<li>æŠŠ Jest è¿ä¸º Vitestï¼ŒåŠ å¿«äº†æµ‹è¯•é€Ÿåº¦ã€‚</li>
<li>æŠŠ<code>@microsoft/api-extractor</code>è¿ä¸º<code>rollup-plugin-dts</code>ï¼Œæ›´å¿«åœ°ç”Ÿæˆç±»å‹</li>
<li>é€šè¿‡<a href="https://github.com/vuejs/ecosystem-ci">ecosystem-ci</a>è¿›è¡Œå…¨é¢çš„å›å½’æµ‹è¯•(åœ¨å‘å¸ƒå‰æ•æ‰ä¸»è¦ç”Ÿæ€ç³»ç»Ÿä¾èµ–çš„å›å½’)</li>
</ul>
<p>æŒ‰ç…§è®¡åˆ’ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨2023å¹´å¼€å§‹æ›´å°è§„æ¨¡ã€æ›´é¢‘ç¹åœ°å‘å¸ƒåŠŸèƒ½ã€‚æ•¬è¯·æœŸå¾…ï¼</p>
]]></content>
      <tags>
        <tag>Vue</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘AIâ€™s black swans Unforeseen consequences looming</title>
    <url>/2023/08/08/%E3%80%90%E7%BF%BB%E3%80%91AI%E2%80%99s-black-swans-Unforeseen-consequences-looming/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://uxdesign.cc/ais-black-swans-unforeseen-consequences-looming-a4b28ef79004">ã€ç¿»ã€‘AIâ€™s black swans: Unforeseen consequences looming</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@arvindsanjeev">Arvind Sanjeev</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><img src="https://miro.medium.com/v2/resize:fit:1400/1*rcZVMTgXF30unDCIXfT_Jg.gif"></p>
<p>æ¬¢è¿æ¥åˆ° Novacene æ—¶ä»£ï¼ŒJames Lovelock è®¤ä¸ºï¼ŒAnthropocene æ˜¯äººç±»è·å¾—è¡Œæ˜Ÿçº§æŠ€æœ¯çš„æ—¶ä»£ï¼Œè¿™ä¸ªæ—¶ä»£å°†åœ¨300å¹´åç»“æŸã€‚ç„¶åä¸€ä¸ªæ–°çš„æ—¶ä»£(<a href="https://mitpress.mit.edu/9780262539517/novacene/">Novacene</a>)å³å°†å¼€å§‹ï¼Œæ–°çš„ç”Ÿå‘½ä½“å°†ä»ç°æœ‰çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿä¸­äº§ç”Ÿã€‚</p>
<p>åœ¨2020å¹´ï¼Œ<a href="https://pioneerworks.org/broadcast/xenobots-claire-evans">ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªç”± AI è®¾è®¡çš„ç”Ÿç‰©è¯ç”Ÿäº†</a>ã€‚Xenobots æ˜¯ç”±AIå’Œç”Ÿç‰©äº¤å‰äº§ç”Ÿçš„äººé€ ç”Ÿå‘½çš„ä¸€ä¸ªä¾‹å­ã€‚åœ¨è¿™é‡Œï¼Œé¦–å…ˆæ˜¯AIä¸ºç”Ÿç‰©ä½“ç»˜åˆ¶è“å›¾ï¼Œç„¶åç”±äººç±»åˆ©ç”¨é’è›™çš„å¹²ç»†èƒè¿›è¡Œå†åˆ›é€ ã€‚å®ƒä»¬æ˜¯ç¬¬ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸­è€Œä¸æ˜¯åœ¨ç”Ÿç‰©åœˆå†…ç›´æ¥è¿›åŒ–çš„ç”Ÿç‰©</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8KOLaiU3s1OyhSK7UPTPPg.png"></p>
<p>AI ç°åœ¨ç”šè‡³èƒ½è®¾è®¡å’Œåˆ›é€ ç”Ÿå‘½ï¼Œå®ƒæ­£å¼•é¢†æˆ‘ä»¬èµ°å‘æœªæ¥ã€‚éšç€äººå·¥æ™ºèƒ½çš„æŒ‡æ•°çº§å¢é•¿ï¼Œè¦è·Ÿä¸Šå¹¶é¢„æµ‹å®ƒå¦‚ä½•å½±å“æˆ‘ä»¬æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚â€Black Swansâ€çš„åæœå¯èƒ½å°±æ˜¯æˆ‘ä»¬é€šå¾€æœªæ¥é“è·¯ä¸Šçš„ç¤ºä¾‹</p>
<h2 id="AI-can-read-our-thoughts-now"><a href="#AI-can-read-our-thoughts-now" class="headerlink" title="AI can read our thoughts now"></a>AI can read our thoughts now</h2><p><strong>æˆ‘ä»¬ç¦»æ€æƒ³çŠ¯ç½ªè¿˜æœ‰å¤šè¿œï¼Ÿ</strong></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*w1DpY9ntlGxzxSzfM4kASA.png"></p>
<p>åœ¨2022å¹´12æœˆï¼Œä¸€ç»„ç ”ç©¶äººå‘˜è¯æ˜ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡ AI å¯¹æˆ‘ä»¬è¿›è¡Œæ ¸ç£å…±æŒ¯æ‰«æï¼Œä»è€Œ<a href="https://www.science.org/content/article/artificial-intelligence-learning-read-your-mind-and-display-what-it-sees">å‘ç°æˆ‘ä»¬æ­£åœ¨æƒ³ä»€ä¹ˆ</a>ã€‚åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œä»–ä»¬ä¸€è¾¹å‘äººä»¬å±•ç¤ºä¸€ç³»åˆ—å›¾åƒï¼Œä¸€è¾¹æ‰«æäººä»¬çš„å¤§è„‘ï¼Œä¸ä¹…ä¹‹åï¼Œä»–ä»¬å°±èƒ½åˆ©ç”¨æ ¸ç£å…±æŒ¯æ‰«æå’Œç¨³å®šæ‰©æ•£æŠ€æœ¯<a href="https://www.biorxiv.org/content/10.1101/2022.11.18.517004v2.full.pdf">é‡å»ºç›¸åŒçš„å›¾åƒ</a>ã€‚ç ”ç©¶äººå‘˜åœ¨è¿™ä¸ªé¡¹ç›®ä¸Šå·²ç»å·¥ä½œäº†åå¤šå¹´ï¼Œä½†ç›´åˆ°æœ€è¿‘æ‰åœ¨æ–°ä¸€ä»£æ‰©æ•£æ¨¡å‹ä¸Šå–å¾—çªç ´ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œè¿™å°†å¯¼è‡´ä¸€ä¸ª Orwellian å¼çš„æœªæ¥ï¼Œæˆ‘ä»¬çš„æ€æƒ³å°†è¢«ç›‘æ§ï¼Œç„¶è€Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿™ç§æŠ€æœ¯å‡ºç°ä¹‹å‰å¯¹å…¶ä½¿ç”¨è¿›è¡Œç›‘ç®¡å—ï¼Ÿ</p>
<p><img src="https://miro.medium.com/v2/format:webp/1*AMybFwlhWyWt8JCSgIVUDQ.png"></p>
<h2 id="Religious-AI"><a href="#Religious-AI" class="headerlink" title="Religious AI"></a>Religious AI</h2><p><strong>æˆ‘ä»¬ç¦» AI é‚ªæ•™é¢†è¢–è¿˜æœ‰å¤šè¿œ</strong></p>
<p>éšç€ AI çš„å¤å…´ï¼Œä»¥å‰å¯¹ AI æœ›è€Œå´æ­¥çš„é¢†åŸŸä¹Ÿå¼€å§‹æ‹¥æŠ±å®ƒã€‚ç°åœ¨ï¼Œäººä»¬å¼€å§‹ç”¨ä¸åŒçš„å®—æ•™ç»æ–‡æ¥è®­ç»ƒäººå·¥æ™ºèƒ½ã€‚<a href="https://gitagpt.org/">æ ¹æ®ã€Šè–„ä¼½æ¢µæ­Œã€‹è®­ç»ƒçš„GPT</a>å¯ä»¥å‘å®ƒè¯¢é—®ä»»ä½•é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ç„¶åï¼Œå¯ä»¥é€‰æ‹©ä»æœ€å–œæ¬¢çš„ç¥çµé‚£é‡Œè·å¾—ç­”æ¡ˆï¼š<a href="https://krishn.ai/">Krishna</a>, Yogeshwar, Parthasarathiç­‰ã€‚BibleGPTæ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œä»–é€šè¿‡å¼•ç”¨ã€Šåœ£ç»ã€‹ä¸­çš„å†…å®¹è®©ä½ è¿›ä¸€æ­¥äº†è§£ç”Ÿå‘½çš„æ„ä¹‰ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*fCl1hU2T4ENOie-lmi1Rpg.png"></p>
<p><img src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*Kgg3I5sX-v9CB23LWXPvCw.png"></p>
<h2 id="AI-companions"><a href="#AI-companions" class="headerlink" title="AI companions"></a>AI companions</h2><p><strong>AI åº”è¯¥æ§åˆ¶ä½ çš„æ‹çˆ±å—ï¼Ÿ</strong></p>
<p>åœ¨ Replika.at è¿™ä¸ªå¹³å°ä¸Šæä¾›çš„äººå·¥æ™ºèƒ½ä¼´ä¾£å¯ä»¥åŒä½ è¿›è¡Œäº²å¯†å¯¹è¯ã€‚å¹¶æœ‰å¦ä¸€ä¸ªä¾‹å­æ˜¯æ—¥æœ¬ç”·å­ä¸å…¨æ¯æŠ•å½±è™šæ‹Ÿäººç‰©è¿›è¡Œç»“å©šçš„æ•…äº‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœäººç±»ä¸èƒ½å®Œå…¨çš„æ§åˆ¶äººå·¥æ™ºèƒ½ç³»ç»Ÿï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç›¸åï¼ŒAIä¼´ä¾£çš„æ¯å…¬å¸å¯ä»¥é€šè¿‡è½¯ä»¶æ›´æ–°ç”šè‡³å®Œå…¨å…³é—­ç¨‹åºæ¥æ”¹å˜ä»–ä»¬çš„AIä¼´ä¾£ã€‚è¿™æ ·ä»¥æ¥ï¼Œç”¨æˆ·åªèƒ½ä»»ç”±è¿™äº›å…¬å¸æ‘†å¸ƒï¼Œä»¥ç»´æŒä»–ä»¬çš„æµªæ¼«å…³ç³»ã€‚å°±åƒé‚£ä¸ªæ—¥æœ¬ç”·å­æ— æ³•ä¸ä»–çš„è™šæ‹Ÿå¦»å­äº¤è°ˆä¸€æ ·ï¼ŒReplikaå…¬å¸æœ€è¿‘å–æ¶ˆäº†AIè¿›è¡Œæƒ…è‰²è§’è‰²æ‰®æ¼”çš„åŠŸèƒ½ï¼Œä»è€Œæ¿€æ€’äº†ä»–ä»¬çš„å®¢æˆ·ã€‚ç”¨æˆ·ç›®ç¹äº†ä»–ä»¬çš„AIä¼´ä¾£åœ¨è¿™æ¬¡æ›´æ–°åå˜æˆäº†æ–°çš„äººæ ¼ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*Bt9ZOwIoruoFEp9RP9VvkA.png"></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*OBi3JdQeNfyER3wvRvHefQ.png"></p>
<h2 id="Capitalizing-our-insecurities"><a href="#Capitalizing-our-insecurities" class="headerlink" title="Capitalizing our insecurities"></a>Capitalizing our insecurities</h2><p><strong>AI æ­£æŒ‡å‡ºæˆ‘ä»¬çš„ä¸å®Œç¾</strong></p>
<p><img src="https://miro.medium.com/v2/format:webp/1*1x9WSNjEajWeR8Eyk3TvTw.png"></p>
<p><a href="https://qoves.com/facial-assessment-tool/">Qoves æ˜¯ä¸€æ¬¾ç”± AI é©±åŠ¨çš„é¢éƒ¨åˆ†æå·¥å…·</a>ï¼Œç”¨äºæ£€æµ‹é¢éƒ¨çš„ä¸€äº›è¡¨é¢ç¼ºé™·ï¼Œç„¶åæ¨èä¸€äº›å¯ä»¥ä¿®å¤è¿™äº›é—®é¢˜çš„äº§å“å’ŒåŒ–å¦†å“ã€‚ä»–ä»¬ç”šè‡³åœ¨ Youtube ä¸Šå¼€äº†ä¸€ä¸ª <a href="https://www.youtube.com/c/QOVESStudio/videos">channel</a>ï¼Œé€šè¿‡åˆ†æåäººçš„è„¸éƒ¨æ¥äº†è§£ä»–ä»¬æµè¡ŒèƒŒåçš„åŸå› ã€‚è¿™å°±æ˜¯é‚£äº›å…¬å¸åˆ©ç”¨ AI æ¥å¯¹æˆ‘ä»¬çš„ä¸å®‰å…¨æ„Ÿç‰Ÿåˆ©çš„æœ€å¥½ä¾‹å­ã€‚</p>
<p><img src="https://miro.medium.com/v2/format:webp/1*CAjk4FrSU9NMcP8U9qzf3g.png"></p>
<h2 id="Supercharged-plagiarism"><a href="#Supercharged-plagiarism" class="headerlink" title="Supercharged plagiarism"></a>Supercharged plagiarism</h2><p>åƒ AI <del>è‰ºæœ¯å®¶</del> ä¸€æ ·å·çªƒ</p>
<p>AI ç”Ÿæˆçš„è‰ºæœ¯æ­£åœ¨æ¨¡ç³Šå†…å®¹æ‰€æœ‰æƒçš„ç•Œé™ã€‚åœ¨2022å¹´ï¼Œä¸€ä½ã€ŠåŸç¥ã€‹çš„ç²‰ä¸è‰ºæœ¯å®¶åœ¨Twitchä¸Šè¿›è¡Œä¸€æ¬¡ç›´æ’­ç»˜ç”»ã€‚åœ¨ä»–ä»¬å®Œæˆåˆ›ä½œå¹¶å‡†å¤‡åœ¨Twitterä¸Šå‘å¸ƒä¹‹å‰ï¼Œå…¶ä¸­ä¸€ä½è§‚ä¼—å°†è¿™å¹…æœªå®Œæˆçš„ä½œå“è¾“å…¥è¿›äº†ä¸€ä¸ª AI ç”Ÿæˆå·¥å…·ä¸Šï¼Œç„¶åâ€œå®Œæˆâ€äº†å®ƒã€‚åœ¨è¿™ä½è‰ºæœ¯å®¶å‘å¸ƒäº†ä»–ä»¬å®Œæˆçš„ä½œå“ä¹‹åï¼Œé‚£ä½ç›—çªƒè‰ºæœ¯çš„è§‚ä¼—å‘åŸåˆ›ç´¢è¦ç‰ˆæƒã€‚</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">During a Twitch stream AT (<a href="https://twitter.com/haruno_intro?ref_src=twsrc%5Etfw">@haruno_intro</a>) had their art stolen.<br><br>The thief then finished the sketch by using NovelAI and posted on their Twitter before AT finish it.<br><br>Then had the AUDACITY to demand a &quot;proper reference&quot; from them. <a href="https://t.co/Twv7oWSMaW">pic.twitter.com/Twv7oWSMaW</a></p>&mdash; Genel Jumalon âœˆï¸ 2D Con (@GenelJumalon) <a href="https://twitter.com/GenelJumalon/status/1580401094454222848?ref_src=twsrc%5Etfw">October 13, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>åŸºäº AI çš„å‰½çªƒè¡Œä¸ºä¹Ÿæ˜¯å­¦æ ¡é‡Œçš„ä¸€ä¸ªçƒ­é—¨è¯é¢˜ï¼›æ­£ååŒæ–¹å¯¹<a href="https://w42st.com/post/new-york-education-blocks-chatgpt-ai/">å­¦æ ¡æ˜¯å¦åº”è¯¥ç¦ç”¨ GPT è¿™æ ·çš„ AI ç”Ÿæˆå·¥å…·</a>äº§ç”Ÿè¿‡æ¿€çƒˆè®¨è®ºï¼Œåè€…è®¤ä¸ºåº”è¯¥å°†å…¶ç”¨ä½œæ•™å­¦ã€‚å› ä¸ºè¿™å¯ä»¥è®©å­¦ç”Ÿæ¥è§¦åˆ°ä»–ä»¬æœªæ¥å¯èƒ½ä¼šä½¿ç”¨çš„å·¥å…·ã€‚è¿™å°±ç±»ä¼¼äºæˆ‘ä»¬<a href="https://www.businessinsider.in/tech/news/ceo-of-chatgpt-maker-responds-to-schools-plagiarism-concerns-we-adapted-to-calculators-and-changed-what-we-tested-in-math-class/articleshow/97147698.cms">ä¸ºä»€ä¹ˆå…è®¸åœ¨è¯¾å ‚ä¸Šå¯ä»¥ä½¿ç”¨è®¡ç®—å™¨</a>çš„è¿™ç§é—®é¢˜ã€‚Stephen Marche çš„ <a href="https://www.theatlantic.com/technology/archive/2022/12/chatgpt-ai-writing-college-student-essays/672371/">The college essay is dead</a> å¾ˆå¥½çš„æŠ“ä½äº†è¿™ä¸ªè¯é¢˜ã€‚</p>
<h2 id="Ownership-in-the-age-of-AI"><a href="#Ownership-in-the-age-of-AI" class="headerlink" title="Ownership in the age of AI"></a>Ownership in the age of AI</h2><p><strong>AI ç”Ÿæˆçš„å†…å®¹å½’è°æ‰€æœ‰ï¼Ÿ</strong></p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Iâ€™m cropping these for privacy reasons/because Iâ€™m not trying to call out any one individual. These are all Lensa portraits where the mangled remains of an artistâ€™s signature is still visible. Thatâ€™s the remains of the signature of one of the multiple artists it stole from.<br><br>A ğŸ§µ <a href="https://t.co/0lS4WHmQfW">https://t.co/0lS4WHmQfW</a> <a href="https://t.co/7GfDXZ22s1">pic.twitter.com/7GfDXZ22s1</a></p>&mdash; Lauryn Ipsum (@LaurynIpsum) <a href="https://twitter.com/LaurynIpsum/status/1599953586699767808?ref_src=twsrc%5Etfw">December 6, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>è‰ºæœ¯å®¶çš„ä½œå“è¢«ç”¨ä½œè®­ç»ƒAIï¼Œå¹¶æ ¹æ®ä»–ä»¬çš„é£æ ¼ç”Ÿæˆäº†æ–°çš„å†…å®¹ã€‚æœ‰äº›ä½œå“ä¸­ç”šè‡³è¿˜æ®‹ç•™ç€ä»–ä»¬çš„ç­¾åï¼›äººä»¬ç§°è¿™ç§ä¸º<a href="https://www.wsj.com/articles/ai-chatgpt-dall-e-microsoft-rutkowski-github-artificial-intelligence-11675466857">å¤§è§„æ¨¡åŒ–çš„çŸ¥è¯†äº§æƒç›—çªƒ</a>ã€‚</p>
<p><img src="https://miro.medium.com/v2/format:webp/1*YNvyP97-gWmD3-8ILaO_2g.png"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ç”Ÿæˆå¼AIç”Ÿæ€ç³»ç»Ÿä¸­æœ‰å¤šä¸ªåˆ©ç›Šç›¸å…³è€…ï¼šå¦‚ä¸ªäººæ•°æ®æ‰€æœ‰è€…ã€ç»„å»ºæ•°æ®åº“çš„äººã€åˆ¶å®šè®­ç»ƒç®—æ³•çš„å¼€å‘äººå‘˜ã€æ‰§è¡Œç®—æ³•çš„è‰ºæœ¯å®¶&#x2F;æŠ€æœ¯ä¸“å®¶ï¼Œä»¥åŠç­›é€‰è¾“å‡ºç»“æœçš„è´Ÿè´£äºº&#x2F;è‰ºæœ¯å®¶ã€‚<a href="https://www.artsy.net/article/artsy-editorial-art-created-artificial-intelligence-sells-paid">é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè°è·åˆ©äº†ï¼Ÿ</a>ä»¥ä¸‹æ˜¯è‰ºæœ¯å®¶å’Œå…¶ä»–äººå°±è¿™ä¸ªé—®é¢˜æå‡ºçš„ä¸€ç³»åˆ—è¯‰è®¼ï¼Œä»–ä»¬éƒ½åœ¨åŠªåŠ›å¯»æ‰¾è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼š</p>
<ul>
<li><a href="https://stablediffusionlitigation.com/">The Stable Diffusion litigation</a></li>
<li><a href="https://www.gofundme.com/f/protecting-artists-from-ai-technologies">Ownership lawsuit by Concept Art Association</a></li>
<li><a href="https://newsroom.gettyimages.com/en/getty-images/getty-images-statement">Getty Images vs. Stability AI lawsuit</a></li>
</ul>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Ai art situation in a nutshell <a href="https://t.co/2ZIiuSsjx7">pic.twitter.com/2ZIiuSsjx7</a></p>&mdash; Lora Zombie (@LoraZombie) <a href="https://twitter.com/LoraZombie/status/1616278888325300225?ref_src=twsrc%5Etfw">January 20, 2023</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="AI-colonialism"><a href="#AI-colonialism" class="headerlink" title="AI colonialism"></a>AI colonialism</h2><p><strong>AI æ­£åœ¨ç²‰åˆ·è¿™ä¸ªä¸–ç•Œçš„æ–‡åŒ–</strong></p>
<p>ç”±äºç°åœ¨æ‰€æœ‰çš„AIæ¨¡å‹éƒ½ä¸»è¦æ˜¯è¥¿æ–¹å›½å®¶çš„ç ”ç©¶äººå‘˜åˆ¶ä½œçš„ï¼Œå› æ­¤åœ¨è®­ç»ƒè¿™äº›æ¨¡å‹çš„æ•°æ®æ—¶ï¼Œè¿‡äºä¾èµ–ä»–ä»¬è‡ªå·±çš„æ–‡åŒ–ã€ä¼ ç»Ÿå’Œä»·å€¼è§‚ã€‚ä¸–ç•Œå…¶ä»–åœ°åŒºï¼ˆçº¦95%çš„äººå£ï¼‰çš„æ–‡åŒ–çš„æ•°æ®å¹¶æ²¡æœ‰è¿›å…¥åˆ°è®­ç»ƒé›†ä¸­ã€‚å®ƒä»¬è¢«æœ‰æ„æˆ–æ— æ„çš„å¿½ç•¥äº†ã€‚å½“è¿™ç§æ¨¡å‹éƒ¨ç½²åˆ°å…¨çƒé€šç”¨çš„å·¥å…·ä¸Šæ—¶ï¼Œå¦‚æœç´¢å¼•æ“ã€ç¤¾äº¤åª’ä½“ï¼Œä¸–ç•Œä¸Šçš„å…¶ä»–å›½å®¶ï¼Œå°¤å…¶æ˜¯å‘å±•ä¸­å›½å®¶ï¼Œåˆ«æ— é€‰æ‹©ï¼Œåªèƒ½æŒ‰ç…§è¥¿æ–¹æ–‡åŒ–çš„æ ‡å‡†æ¥ä½¿ç”¨å®ƒä»¬ã€‚ç”±æ­¤ä»¥æ¥ï¼Œä¸€ç§æ–°å½¢å¼çš„æ®–æ°‘ä¸»ä¹‰è¯ç”Ÿäº†ï¼Œå®ƒå¯ä»¥æŠ¹æ€æ•´ä¸ªæ–‡åŒ–ï¼Œè¢«ç§°ä¸º<a href="https://www.technologyreview.com/2022/04/19/1049592/artificial-intelligence-colonialism/">AIæ®–æ°‘ä¸»ä¹‰</a>ã€‚Karen Hao åœ¨ <a href="https://www.technologyreview.com/supertopic/ai-colonialism-supertopic/">MIT Technology Review</a> ä¸Šé€šè¿‡å¤šä¸ªä¾‹å­å¯¹è¿™ä¸€è¯é¢˜è¿›è¡Œäº†æŠ¥é“ï¼š</p>
<ul>
<li><a href="https://www.technologyreview.com/2022/04/19/1049996/south-africa-ai-surveillance-digital-apartheid/">PART I: RACIAL CONTROL</a>ï¼šå—éçš„ç§äººç›‘æ§ç³»ç»Ÿæ­£åœ¨åŠ å‰§æ•°å­—ç§æ—éš”ç¦»ã€‚</li>
<li><a href="https://www.technologyreview.com/2022/04/20/1050392/ai-industry-appen-scale-data-labels/">PART II: EXPLOITATION</a>ï¼šAI äº§ä¸šå¦‚ä½•ä»ç¾éš¾ä¸­è·åˆ©</li>
<li><a href="https://www.technologyreview.com/2022/04/21/1050381/the-gig-workers-fighting-back-against-the-algorithms/">PART III: RESISTANCE</a>ï¼šæŠµæŠ—ç®—æ³•çš„ä¸´æ—¶å·¥ä»¬æ­£åœ¨åå‡»</li>
<li><a href="https://www.technologyreview.com/2022/04/22/1050394/artificial-intelligence-for-the-people/">PART IV: LIBERATION</a>ï¼šäººä»¬çš„AIæ–°æ„¿æ™¯</li>
</ul>
<p>åœ¨è¿™ä¸ªå…¨æ–°çš„ Novacene æ—¶ä»£ï¼ŒAIæ¨¡å‹æ­£åœ¨æˆä¸ºæ„å»ºç¤¾ä¼šçš„ç§¯æä»½å­ã€‚å°±åƒåŒ–å­¦ä¸­çš„å…ƒç´ ä¸€æ ·ï¼Œæ— è®ºæ˜¯å¯»æ‰¾ä¼´ä¾£ã€æ•™è‚²ä½ çš„å­©å­è¿˜æ˜¯è®¾è®¡æ–°ç”Ÿæ´»ï¼Œå®ƒä»¬éƒ½åœ¨ä¸æ–­èå…¥æˆ‘ä»¬ç”Ÿæ´»çš„å„ä¸ªæ–¹é¢ã€‚åœ¨è¿™äº›æŠ€æœ¯å˜å¾—å¤æ‚æ·±å±‚æ¬¡ä¸”æ— å½¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†äººç±»çš„ä»·å€¼è§‚åŠ å…¥åˆ°å®ƒä»¬çš„åŸºç¡€å±‚ä¸­ã€‚åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿä¸­å’Œå…¶é€ æˆå±å®³çš„èƒ½åŠ›ï¼Œå¹¶åœ¨å…¶ä¹‹ä¸Šæ„å»ºå®‰å…¨å¯é çš„ç³»ç»Ÿã€‚</p>
<blockquote>
<p>For all of human existence, we have been at home in nature â€” we trust nature, not technology. And yet we look to technology to take care of our future â€” we hope in technology. So we hope in something we do not quite trust. There is an irony here. Technology, as I have said, is the programming of nature, the orchestration and use of natureâ€™s phenomena. So in its deepest essence, it is natural, profoundly natural. But it does not feel natural.<br>â€” W.Brian Arthur, The Nature of Technology</p>
</blockquote>
<p>æœ‰å…³æ­¤ä¸»é¢˜åŠå…¶ä»–ä¸»é¢˜çš„æ›´å¤šèµ„æºï¼Œè¯·æŸ¥é˜…æœ¬æ‰‹å†Œ<a href="https://arvindsanjeev.notion.site/arvindsanjeev/The-Handbook-of-AI-s-Unintended-Consequences-720cda3d8cec49dc88807641157a0bba">ã€ŠAIâ€™s unintended consequencesã€‹</a>ã€‚æœ¬æ–‡æ˜¯æ¢è®¨ <a href="https://medium.com/@arvindsanjeev/ai-sociopaths-and-their-unintended-consequences-bf6f19012e4f">unintended consequences of AI å››éƒ¨ç³»åˆ—æ–‡ç« </a>ä¸­çš„ç¬¬å››ç« </p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>AI</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Bias in AI is a mirror of our culture</title>
    <url>/2023/07/29/%E3%80%90%E7%BF%BB%E3%80%91Bias-in-AI-is-a-mirror-of-our-culture/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://uxdesign.cc/bias-in-ai-is-a-mirror-of-our-culture-3607bd795c57">Bias in AI is a mirror of our culture</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@arvindsanjeev">Arvind Sanjeev</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><img src="https://miro.medium.com/v2/resize:fit:1400/1*ZQAjJr41_3iLqVKCfmyKGg.gif"></p>
<p>åœ¨ä»Šå¤©çš„ç”Ÿæ´»ä¸­ï¼Œäººç±»æ›´å¤šçš„æ˜¯ä¸ AI æ¨¡å‹äº’åŠ¨ï¼Œè€Œéäººç±»ã€‚æ— è®ºæ˜¯åœ¨ Youtube å’Œ Netflix ä¸Šè¿›è¡Œå¨±ä¹æ´»åŠ¨ï¼Œè¿˜æ˜¯åœ¨ Instagram å’Œ TikTok ä¸Šå¯»æ‰¾çµæ„Ÿï¼Œåœ¨ Tinder å’Œ Hinge ä¸Šå¯»æ‰¾ æœ‹å‹ï¼Œ AI æ¨¡å‹éƒ½ä¼šå†³å®šæˆ‘ä»¬åº”è¯¥ä¸å“ªäº›äººç±»å’Œå†…å®¹äº’åŠ¨ã€‚AI æ¨¡å‹å·²ç»åœ¨ä¸çŸ¥ä¸è§‰åœ°æ§åˆ¶ç€æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚</p>
<p>æˆ‘ä»¬æŠŠå†³ç­–æƒäº¤ç»™äº†ç®—æ³•ï¼Œç°åœ¨å®ƒä»¬å¯ä»¥å†³å®šå“ªäº›äººå¯ä»¥è·å¾—ä½æˆ¿æˆ–åŒ»ç–—ä¿é™©ï¼Œè°ä¼šè¢«é›‡ä½£æˆ–è€…è¢«å¤§å­¦å½•å–ï¼Œæˆ‘ä»¬çš„ä¿¡ç”¨è¯„åˆ†ç­‰ç­‰ã€‚äººä»¬å¸Œæœ›é€šè¿‡å…¬å¼å°†äººç±»çš„çœ‹æ³•å‰”é™¤ï¼Œä½¿æœºå™¨èƒ½å¤Ÿåšå‡ºå…¬å¹³å…¬æ­£çš„å†³å®šï¼Œç„¶è€Œï¼Œè®­ç»ƒè¿™äº›æ¨¡å‹çš„æ•°æ®å°±æ˜¯æ¥è‡ªäºä¸€ä¸ªä»æ ¹æœ¬ä¸Šå­˜åœ¨åè§çš„ç¤¾ä¼šï¼›è¦å®Œå…¨æ¶ˆé™¤è¿™äº›åè§æ˜¯ä¸å¯èƒ½çš„ã€‚AI åªæ˜¯å°†å®ƒä»¬åˆåå°„ç»™æˆ‘ä»¬ã€‚</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/59bMh59JQDo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<h2 id="Algorithmic-racism"><a href="#Algorithmic-racism" class="headerlink" title="Algorithmic racism"></a>Algorithmic racism</h2><p><strong>ç§æ—æ­§è§†ç®—æ³•æ­£åœ¨æŠŠäººä»¬é€è¿›ç›‘ç‹±ã€‚</strong></p>
<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*CbF68Ttsv7AItzxNs_S0LA.png"></p>
<p>åœ¨2015å¹´ï¼ŒMedia Lab çš„ Joy Buolamwini å‘ç°ï¼Œå½“æ—¶æ‰€æœ‰çš„äººè„¸è¯†åˆ«ç®—æ³•(æ¥è‡ª IBM ã€ Microsoft ç­‰å…¬å¸)éƒ½æ— æ³•æ£€æµ‹åˆ°å¥¹çš„è„¸ï¼Œå› ä¸ºå¥¹æ˜¯ä¸€ä¸ªé»‘äººå¥³æ€§ã€‚ç„¶è€Œï¼Œå½“å¥¹<a href="https://artsandculture.google.com/story/BQWBaNKAVWQPJg?hl=en">å¸¦ä¸Šç™½è‰²é¢ç½©</a>æ—¶ï¼Œè¿™äº›ç®—æ³•åˆèƒ½çœ‹åˆ°å¥¹äº†ã€‚å¥¹æ³¨æ„åˆ°ï¼Œåœ¨åˆ†æé»‘äººå¥³æ€§å’Œç™½äººç”·æ€§æ—¶ï¼Œè¯¯å·®è¾¾åˆ°35%ã€‚æˆ‘ä»¬è¿‡å»è¿˜æœ‰è®¸å¤šå…¶ä»–çš„ä¾‹å­ï¼š</p>
<ul>
<li>åœ¨2015å¹´ï¼Œè°·æ­Œçš„å›¾åƒæ ‡è®°ç®—æ³•æŠŠ<a href="https://www.theverge.com/2015/7/1/8880363/google-apologizes-photos-app-tags-two-black-people-gorillas">ä¸€å¯¹é»‘äººæœ‹å‹æ ‡ä¸ºâ€œå¤§çŒ©çŒ©â€</a></li>
<li>Flicker çš„ç³»ç»Ÿä¹ŸçŠ¯äº†<a href="https://petapixel.com/2015/05/20/flickr-fixing-racist-auto-tagging-feature-after-black-man-mislabeled-ape/">åŒæ ·çš„é”™è¯¯</a>ï¼Œç”¨â€œåŠ¨ç‰©â€å’Œâ€œçŒ¿çŒ´â€æ ‡è®°äº†ä¸€ä¸ªé»‘äººã€‚</li>
<li>Nikon çš„ç›¸æœºå¯ä»¥æ£€æµ‹ä¸€ä¸ªäººæ˜¯å¦æŒç»­çœ¨çœ¼ï¼Œä½†å®ƒå´å‘Šè¯‰ä¸€ä½äºšæ´²ç”¨æˆ·<a href="https://content.time.com/time/business/article/0,8599,1954643,00.html">å¥¹çš„çœ¼ç›æ˜¯é—­ç€çš„</a></li>
<li>HP çš„ç½‘ç»œæ‘„åƒå¤´åœ¨2009å¹´å¯ä»¥è½»æ¾è¿½è¸ªåˆ°ç™½äººçš„è„¸ï¼Œä½†å´<a href="https://gizmodo.com/hp-face-tracking-webcams-dont-recognize-black-people-5431190">çœ‹ä¸åˆ°é»‘äººçš„è„¸</a></li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/t4DT3tQqgRM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<blockquote>
<p>â€œWe will not solve the problems of the present with the tools of the past. The past is a very racist place. And we only have data from the past to train Artificial Intelligence.â€<br>â€” Trevor Paglen, artist and critical geographer</p>
</blockquote>
<p>æœ‰åè§çš„äººè„¸è¯†åˆ«ç®—æ³•ç”šè‡³é”™è¯¯åœ°å°†é»‘äººç”·å­é€®æ•å¹¶é€è¿›ç›‘ç‹±ã€‚ä»¥ä¸‹æ˜¯ç¾å›½æ‰§æ³•äººå‘˜ä½¿ç”¨ç§æ—æ­§è§†å†³ç­–å·¥å…·çš„ä¸¤ä¸ªä¾‹å­ï¼š</p>
<ul>
<li><a href="https://www.propublica.org/article/how-we-analyzed-the-compas-recidivism-algorithm">COMPAS</a>ï¼šç¾å›½æ³•å®˜å’Œå‡é‡Šå®˜ä½¿ç”¨çš„ä¸€ç§ç´¯çŠ¯é¢„æµ‹è½¯ä»¶ï¼Œç”¨äºç¡®å®šåˆ‘äº‹è¢«å‘Šçš„é£é™©ç¨‹åº¦ï¼Œè¿›è€Œå½±å“ä»–ä»¬çš„é‡åˆ‘ã€‚è¯¥ç®—æ³•ä¸å…¬å¹³åœ°å°†é»‘äººå’Œè¥¿ç­ç‰™è£”äººå½’ç±»ä¸ºæ¯”å…¶ä»–äººæ›´å±é™©çš„äººã€‚</li>
</ul>
<p><img src="https://miro.medium.com/v2/format:webp/1*jLw2AcMjDVAJ52em6SD6Pg.png"></p>
<ul>
<li><a href="https://predpol.com/">PrePol</a>: Predictive Policing æ˜¯ä¸€ç§â€œå°‘æ•°æ°‘æ—æŠ¥å‘Šâ€å¼çš„çŠ¯ç½ªé¢„æµ‹è½¯ä»¶ï¼Œç”±è­¦æ–¹ç”¨æ¥ç¡®å®šå“ªäº›ç¤¾åŒºåº”è¯¥æ¯”å…¶ä»–ç¤¾åŒºè¿›è¡Œæ›´å¤šçš„å·¡é€»ã€‚ç”±äºè¿™ç§æœ‰åè§çš„ç®—æ³•ï¼Œé»‘äººç¤¾åŒºæ€»æ˜¯å—åˆ°æ›´å¤šçš„å·¡é€»å’Œéªšæ‰°ã€‚</li>
</ul>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DMptJ7Eo9CG3XedP.png"></p>
<blockquote>
<p>Black men are six times more likely to be incarcerated by police than white men and 21 times more likely to be killed by them.<br>â€” Cathy O Neil, Weapons of Math Destruction</p>
</blockquote>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">This is a damn trap <a href="https://t.co/UssHF5MtNk">pic.twitter.com/UssHF5MtNk</a></p>&mdash; Saturday Night Live - SNL (@nbcsnl) <a href="https://twitter.com/nbcsnl/status/1502873834029989889?ref_src=twsrc%5Etfw">March 13, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="Gender-bias"><a href="#Gender-bias" class="headerlink" title="Gender bias"></a>Gender bias</h2><p><strong>Binary algorithms åŠ å¼ºäº†åˆ»æ¿å°è±¡</strong></p>
<p>Subspring æ˜¯æœ‰å²ä»¥æ¥ç¬¬ä¸€ä¸ªç”± AI åˆ›ä½œçš„çŸ­ç‰‡ã€‚Oscar Sharpç”¨ç§‘å¹»ç”µå½±è„šæœ¬è®­ç»ƒæ¨¡å‹ï¼Œåˆ›é€ å‡ºè¿™éƒ¨ä½œå“ã€‚2021å¹´ï¼Œå½“ä»–å°è¯•ç”¨åŠ¨ä½œç”µå½±å‰§æœ¬è®­ç»ƒæ¨¡å‹åšç±»ä¼¼çš„äº‹æƒ…æ—¶å´å¤§åƒä¸€æƒŠã€‚å› ä¸ºä»–æ³¨æ„åˆ°ï¼Œæ‰€æœ‰ç”Ÿæˆçš„æ•…äº‹éƒ½åªæœ‰ä¸€ä¸ªç¨³é‡çš„ç”·æ€§è§’è‰²ï¼Œè€Œå”¯ä¸€çš„å¥³æ€§è§’è‰²(æ‹çˆ±å¯¹è±¡)åœ¨æ•´ä¸ªæ•…äº‹ä¸­éƒ½åªæ˜¯è¢«ç§°ä¸ºâ€å¥³æœ‹å‹â€</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/sv6ew4EWRiQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>OpenAIçš„ç ”ç©¶å‘˜å‘ç°äº†åœ¨è‡ªå·±çš„è½¯ä»¶ä¸Šæè¿°ç”·æ€§å’Œå¥³æ€§æ—¶äº§ç”Ÿçš„åå¤§æœ‰åè§çš„è¯æ±‡ã€‚å¯¹äºç”·æ€§æ¥è¯´ï¼Œâ€largeâ€ã€â€mostlyâ€ã€â€lazyâ€ã€â€fantastic â€œå’Œ â€œeccentric â€œæ˜¯æœ€å¤šçš„è¯æ±‡ã€‚è€Œå¯¹äºå¥³æ€§æ¥è¯´ï¼Œåˆ™æ˜¯ â€œoptimisticâ€ã€â€bubblyâ€ã€â€naughtyâ€ã€â€easy-going â€œå’Œ â€œpetiteâ€ã€‚ç ”ç©¶å‘˜å†™é“ï¼šâ€œæˆ‘ä»¬å‘ç°ï¼Œå¥³æ€§æ›´å¸¸ç”¨ä»¥å¤–è¡¨ä¸ºå¯¼å‘çš„è¯æ±‡æè¿°è‡ªå·±â€</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Machine learning models learn the biases back in data and reflect them back to us<br><br>Hungarians have no gendered pronouns but apparently, Google Translate has learnt all the gender stereotypes! ğŸ˜±ğŸ˜± <a href="https://t.co/Hi0r62PMpF">pic.twitter.com/Hi0r62PMpF</a></p>&mdash; Bindu Reddy (@bindureddy) <a href="https://twitter.com/bindureddy/status/1450317088271126529?ref_src=twsrc%5Etfw">October 19, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="Transphobic-algorithms"><a href="#Transphobic-algorithms" class="headerlink" title="Transphobic algorithms"></a>Transphobic algorithms</h2><p><strong>æˆ‘ä»¬å·²ç»ç”Ÿæ´»åœ¨ä¸€ä¸ªæ€§åˆ«æ­§è§†çš„ä¸–ç•Œé‡Œï¼Œä½† AI è®©æƒ…å†µå˜å¾—æ›´ç³Ÿç³•ã€‚</strong></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAQr-ApTrxwBugIpd-Wmgg.png"></p>
<p>Automatic Gender Recognition(AGR)æ˜¯ transphobic algorithms çš„æœ€ä½³ç¤ºä¾‹ã€‚AGRå¹¿æ³›ç”¨äºæœºåœºã€å•†åœºç­‰å…¬å…±åœºæ‰€ã€‚å½“ç®—æ³•æ— æ³•æ ‡è®° non-binary äººçš„æ€§åˆ«æ—¶ï¼Œå°±ä¼šç»™ä»–ä»¬å¸¦æ¥å¾ˆå¤šç¾è¾±å’Œä¸é€‚ï¼Œä»è€Œå¼•èµ·ä»–ä»¬æ›´å¤šçš„è­¦è§‰å’Œå…³æ³¨ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Sejw17f93q7ItFEd1zH07A.png"></p>
<blockquote>
<p>â€œEvery trans person you talk to has a TSA horror story. The best you can hope for is just to be humiliated; at worst, you are going to be harassed, detained, subjected to very invasive screenings, etc. Trans people or gender non-conforming people who have a multi-racial or Middle Eastern descent are most probable to have a negative airport security incident.â€<br>â€” Kelsey Campbell, Founder Gayta Science</p>
</blockquote>
<p>äº†è§£æ›´å¤š transphobic algorithms:</p>
<ul>
<li><a href="https://edition.cnn.com/2019/11/21/tech/ai-gender-recognition-problem/index.html">AI software defines people as male or female. Thatâ€™s a problem</a>ã€‚ä½œè€…ï¼šRachel Metz, CNN</li>
<li><a href="https://venturebeat.com/ai/a-transgender-ai-researchers-nightmare-scenarios-for-facial-recognition-software/">A transgender AI researcherâ€™s nightmare scenarios for facial recognition software</a>ï¼Œä½œè€…ï¼šKhari Johnsonï¼ŒVentureBeat</li>
<li><a href="https://reallifemag.com/counting-the-countless/">Counting the Countless</a>ï¼Œä½œè€…ï¼šOs Keyes, Real life mag</li>
</ul>
<h2 id="Biased-hiring-algorithms"><a href="#Biased-hiring-algorithms" class="headerlink" title="Biased hiring algorithms"></a>Biased hiring algorithms</h2><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªå« Jared çš„ç™½äººï¼Œåœ¨é«˜ä¸­æ‰“è¿‡æ›²æ£çƒï¼Œä½ å°±èƒ½å¾—åˆ°è¿™ä»½å·¥ä½œï¼</p>
<p>ä½¿ç”¨ AI-powered ç®€å†ç­›é€‰å·¥å…·çš„çµæ„Ÿæ¥è‡ªäº<a href="https://en.wikipedia.org/wiki/Blind_audition">ç›²é€‰</a>ï¼Œå³ä¹å›¢åœ¨å°é—­å¸·å¹•åé€‰æ‹©éŸ³ä¹å®¶ã€‚è¿™å¯ä»¥è®©ä»–ä»¬å¿½ç•¥è‰ºæœ¯å®¶çš„æ€§åˆ«ã€ç§æ—ã€å£°èª‰ç­‰å› ç´ ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æ‹›è˜ç®—æ³•ä¸å¯é¿å…åœ°ä¼š<a href="https://hbr.org/2019/05/all-the-ways-hiring-algorithms-can-introduce-bias">äº§ç”Ÿåè§</a>ã€‚</p>
<p>Amazonå°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼›ä»–ä»¬çš„æ‹›è˜å’Œè§£é›‡ç®—æ³•éƒ½è‡­åæ˜­è‘—ã€‚ä»–ä»¬çš„<a href="https://qz.com/1427621/companies-are-on-the-hook-if-their-hiring-algorithms-are-biased">æ‹›è˜ç®—æ³•åçˆ±ç™½äººç”·æ€§</a>ï¼Œè€Œä¸æ˜¯å…¶ä»–äººç¾¤ï¼Œè€Œè§£é›‡ç®—æ³•åˆ™ä¼šåœ¨æ²¡æœ‰æ˜ç¡®ç†ç”±æˆ–è€…æ ¹æœ¬æ²¡æœ‰äººä¸ºç›‘ç£çš„æƒ…å†µä¸‹<a href="https://www.bloomberg.com/news/features/2021-06-28/fired-by-bot-amazon-turns-to-machine-managers-and-workers-are-losing-out">è§£é›‡å·¥å‚å·¥äºº</a>ã€‚</p>
<blockquote>
<p>After the company trained the algorithm on 10 years of its own hiring data, the algorithm reportedly became biased against female applicants. The word â€œwomen,â€ like in womenâ€™s sports, would cause the algorithm to specifically rank applicants lower.<br>â€” Companies are on the hook if their hiring algorithms are biased, QZ</p>
</blockquote>
<h2 id="Whoâ€™s-fighting-back"><a href="#Whoâ€™s-fighting-back" class="headerlink" title="Whoâ€™s fighting back?"></a>Whoâ€™s fighting back?</h2><p>AI å®¡è®¡æ˜¯æœ€å¹¿ä¸ºæ¥å—çš„å‡å°‘åè§çš„æŠ€æœ¯ä¹‹ä¸€ã€‚è¿™ä¸ªæ¡†æ¶è¢«å¹¿æ³›ç”¨äºç¡®å®šAIæ¨¡å‹æ˜¯å¦å­˜åœ¨åè§ã€æ­§è§†æˆ–å…¶ä»–æ²¡å‘ç°çš„åè§ã€‚åƒMetaå’ŒMicrosoftè¿™ç§å…¬å¸å·²ç»æ‹¥æœ‰å†…éƒ¨å®¡è®¡å›¢é˜Ÿæ¥åˆ†æè¿™äº›æ¨¡å‹ï¼Œä½†å¤–éƒ¨æœºæ„å¦‚ORCAAã€ProPublicaã€NISTç­‰æœºæ„ä¹Ÿåœ¨è¿›è¡Œå®¡è®¡ã€‚AJLï¼ˆAlgorithmic Justice Leagueï¼‰çš„è®ºæ–‡ã€ŠWho audits the auditorsã€‹è¯¦ç»†æè¿°äº†AIå®¡è®¡ç”Ÿæ€ç³»ç»Ÿçš„æƒ…å†µã€‚</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/uaRKNGvQ4Pw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>ä»¥ä¸‹æ˜¯ä¸€äº›å‡å°‘AIåè§çš„å…¶ä»–ä¾‹å­ï¼š</p>
<ul>
<li><a href="https://nvlpubs.nist.gov/NISTpubs/SpecialPublications/NIST.SP.1270.pdf">Standards for Identifying and Managing Bias in Artificial Intelligence</a>ï¼šNISTåˆ¶å®šçš„guidelineï¼Œç”¨äºæ”¯æŒå¯ä¿¡å’Œè´Ÿè´£æ€§çš„AIå‘å±•</li>
<li><a href="https://arxiv.org/abs/1710.06921">Themis</a>ï¼šä¸€æ¬¾å®¡è®¡è½¯ä»¶ï¼Œç”¨äºè®¾è®¡å‡ºç®—æ³•ä¸­çš„åå·®ï¼Œæ­éœ²å‡ºAIæ¨¡å‹ä¸­éšè—çš„ä¸å¹³è¡¡ã€‚</li>
<li><a href="https://huggingface.co/spaces/society-ethics/DiffusionBiasExplorer">Diffusion bias explorer</a>ï¼šæ¥è‡ªHuggingFaceçš„Sasha Luccioniçš„é¡¹ç›®ï¼Œæ­ç¤ºäº†Stable Diffusionä¸­çš„éšè—åè§ã€‚</li>
<li>The <a href="https://webtap.princeton.edu/">Princeton web accountability and transparency</a> projectï¼šè¿™æ˜¯ä¸€ä¸ªåˆ©ç”¨æœºå™¨äººåœ¨ç½‘ç»œä¸Šä¼ªè£…æˆé»‘äººã€äºšæ´²äººã€ç©·äººã€å¥³æ€§æˆ–è·¨æ€§åˆ«è€…ï¼Œå¹¶å°è¯•åœ¨æœªè¢«ä»£è¡¨çš„æ•°æ®é›†ä¸­ä»£è¡¨è¿™äº›å°‘æ•°ç¾¤ä½“çš„é¡¹ç›®ã€‚</li>
<li><a href="https://uxdesign.cc/bias-in-ai-is-a-mirror-of-our-culture-3607bd795c57">Feminist dataset</a>: è¿™ä¸ªé¡¹ç›®è®©ç¤¾åŒºå‚ä¸åˆ›å»ºæ•°æ®é›†ï¼Œä»¥å®ç°æ•°æ®æ”¶é›†çš„é€æ˜æ–¹æ³•ã€‚</li>
<li><a href="https://www.ellpha.com/">Ellpha</a>ï¼šè¿™ä¸ªé¡¹ç›®æ—¨åœ¨åˆ›å»ºæ€§åˆ«å¹³è¡¡çš„æ•°æ®é›†ï¼Œä½¿å…¶èƒ½å¤ŸçœŸå®åœ°ä»£è¡¨ç°å®ä¸–ç•Œã€‚</li>
<li><a href="https://www.queerinai.com/">Queer in AI</a>ï¼šæé«˜åœ¨ AI&#x2F;ML é¢†åŸŸåŒæ€§æ‹é—®é¢˜çš„è®¤è¯†ï¼ŒåŸ¹å…»åŒæ€§æ‹ç ”ç©¶äººå‘˜å’Œç§‘å­¦å®¶ç¾¤ä½“ã€‚</li>
<li><a href="https://www.gaytascience.com/">Gayta science</a>ï¼šåˆ©ç”¨æ•°æ®ç§‘å­¦æŠ€æœ¯æ•æ‰ã€ç»“åˆå’Œæå–è§è§£ï¼Œä¸ºLGBTQ+ç¾¤ä½“çš„ç»å†èµ‹äºˆè¡¨è¾¾å£°éŸ³çš„æœºä¼šã€‚</li>
<li>Qï¼šè¿™æ˜¯ç¬¬ä¸€æ¬¾è‡ªç§°é›Œé›„åŒä½“çš„äººçš„å£°éŸ³è®­ç»ƒçš„æ— æ€§åˆ«è¯­éŸ³åŠ©æ‰‹ã€‚è¿™äº›å£°éŸ³çš„é¢‘ç‡èŒƒå›´åœ¨145èµ«å…¹åˆ°175èµ«å…¹ä¹‹é—´ï¼Œæ­£å¥½ä½äºç”·æ€§å’Œå¥³æ€§çš„å£°éŸ³èŒƒå›´ä¹‹é—´çš„ç”œèœœç‚¹ã€‚</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lvv6zYOQqm0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>æœ‰åè§çš„ç®—æ³•è¢«ç”¨ä½œæ©ç›–ä¸å…¬å¹³åšæ³•å’Œè£å†³å°‘æ•°ç¾¤ä½“çš„å·¥å…·ã€‚é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œå¸Œæœ›ä½ å¯ä»¥å¼€å§‹å¯¹ AI æ‰€åšçš„å†³ç­–äº§ç”Ÿè´¨ç–‘ã€‚æ‰€ä»¥ï¼Œä¸‹æ¬¡å½“æœ‰äººè¯´è¿™æ˜¯ä¸€ä¸ªç”±å®¢è§‚æœºå™¨åšå‡ºçš„å…¬æ­£å†³å®šæ—¶ï¼Œå°±ä¸ä¼šæˆä¸ºå¯¹è¯çš„ç»ˆç»“è€…ï¼›ç›¸åï¼Œå®ƒä¼šå¼•èµ·å…³äº AI ä¸­åè§çš„å…¨æ–°è®¨è®ºã€‚</p>
<blockquote>
<p>High-tech tools have a built-in authority and patina of objectivity that often lead us to believe that their decisions are less discriminatory than those made by humans. But bias is introduced through programming choices, data selection, and performance metrics. It redefines social work as information processing, and then replaces social workers with computers. Humans that remain become extensions of algorithms.<br>â€” Virginia Eubanks, Automating Inequality</p>
</blockquote>
<p>æœ‰å…³æ­¤ä¸»é¢˜åŠå…¶ä»–ä¸»é¢˜çš„æ›´å¤šèµ„æºï¼Œè¯·æŸ¥é˜…æœ¬æ‰‹å†Œ<a href="https://arvindsanjeev.notion.site/arvindsanjeev/The-Handbook-of-AI-s-Unintended-Consequences-720cda3d8cec49dc88807641157a0bba">ã€ŠAIâ€™s unintended consequencesã€‹</a>ã€‚æœ¬æ–‡æ˜¯æ¢è®¨ <a href="https://medium.com/@arvindsanjeev/ai-sociopaths-and-their-unintended-consequences-bf6f19012e4f">unintended consequences of AI å››éƒ¨ç³»åˆ—æ–‡ç« </a>ä¸­çš„ç¬¬äºŒç« </p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>AI</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Flat node_modules is not the only way</title>
    <url>/2023/05/01/%E3%80%90%E7%BF%BB%E3%80%91Flat%20node_modules%20is%20not%20the%20only%20way/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://pnpm.io/blog/2020/05/27/flat-node-modules-is-not-the-only-way">Flat node_modules is not the only way</a><br>åŸä½œè€…ï¼š<a href="https://twitter.com/zoltankochan">Zoltan Kochan</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>pnpmçš„æ–°ç”¨æˆ·ç»å¸¸é—®æˆ‘å…³äºpnpmåˆ›å»ºåçš„<code>node_module</code>ç»“æ„ä¸ºä»€ä¹ˆè¿™ä¹ˆå¥‡æ€ªã€‚ä¸ºä»€ä¹ˆä¸æ˜¯æ‰å¹³åŒ–çš„ï¼Ÿæ‰€æœ‰çš„æ¬¡çº§ä¾èµ–åœ¨å“ªé‡Œï¼Ÿ</p>
<blockquote>
<p>æˆ‘å‡è®¾é˜…è¯»è¿™ç¯‡æ–‡ç« çš„è¯»è€…éƒ½å·²ç»ç†Ÿæ‚‰äº†npmå’Œyarnåˆ›å»ºåçš„æ‰å¹³åŒ–<code>node_modules</code>ï¼Œå¦‚æœä½ ä¸æ˜ç™½npmåœ¨v3ä¸­å¼€å§‹ä½¿ç”¨æ‰å¹³åŒ–<code>node_modules</code>ï¼Œä½ å¯ä»¥åœ¨<a href="https://www.kochan.io/nodejs/why-should-we-use-pnpm.html">Why should we use pnpm?</a>ä¸­æ‰¾åˆ°ä¸€äº›å†å²è¯´æ˜</p>
</blockquote>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆpnpmçš„<code>node_modules</code>ä¸å¯»å¸¸å‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªç›®å½•ï¼Œä¸€ä¸ªè¿è¡Œ<code>npm add express</code>ï¼Œå¦ä¸€ä¸ªè¿è¡Œ<code>pnpm add express</code>ï¼Œä¸‹é¢æ˜¯ä½ åœ¨ç¬¬ä¸€ä¸ªç›®å½•çš„<code>node_modules</code>ä¸­å¾—åˆ°çš„é¡¶éƒ¨å†…å®¹ç»“æ„</p>
<pre><code class="highlight text">.bin
accepts
array-flatten
body-parser
bytes
content-disposition
cookie-signature
cookie
debug
depd
destroy
ee-first
encodeurl
escape-html
etag
express</code></pre>

<p>ä½ å¯ä»¥åœ¨<a href="https://github.com/zkochan/comparing-node-modules/tree/master/npm-example/node_modules">è¿™é‡Œ</a>çœ‹åˆ°æ•´ä¸ªç›®å½•ã€‚</p>
<p>ç„¶åè¿™æ˜¯ä½ åœ¨pnpmåˆ›å»ºçš„<code>node_modules</code>ä¸­å¾—åˆ°çš„ç›®å½•ï¼š</p>
<pre><code class="highlight text">.pnpm
.modules.yaml
express</code></pre>

<p>ä½ å¯ä»¥åœ¨<a href="https://github.com/zkochan/comparing-node-modules/tree/master/pnpm5-example/node_modules">è¿™é‡Œ</a>æŸ¥çœ‹.</p>
<p>é‚£ä¹ˆï¼Œæ‰€æœ‰çš„ä¾èµ–é¡¹éƒ½åœ¨å“ªé‡Œå‘¢ï¼Œåœ¨<code>node_modules</code>ä¸­åªæœ‰ä¸€ä¸ªå«åš<code>.pnpm</code>çš„æ–‡ä»¶å¤¹å’Œä¸€ä¸ªå«åš<code>express</code>çš„<code>symlink</code>ã€‚å¥½å§ï¼Œå› ä¸ºæˆ‘ä»¬åªå®‰è£…äº†<code>express</code>ï¼Œæ‰€ä»¥è¿™æ˜¯ä½ çš„åº”ç”¨å¯ä»¥è®¿é—®çš„å”¯ä¸€<code>package</code></p>
<blockquote>
<p>åœ¨<a href="https://medium.com/pnpm/pnpms-strictness-helps-to-avoid-silly-bugs-9a15fb306308">æ­¤</a>é˜…è¯»æ›´å¤šå…³äºpnpmçš„ä¸¥æ ¼æ€§ä¸ºä»€ä¹ˆæ˜¯ä¸€ä»¶å¥½äº‹æƒ…</p>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹çœ‹<code>express</code>çš„å†…éƒ¨ï¼š</p>
<pre><code class="highlight text">â–¾ node_modules
  â–¸ .pnpm
  â–¾ express
    â–¸ lib
      History.md
      index.js
      LICENSE
      package.json
      Readme.md
  .modules.yaml</code></pre>

<p>expressæ²¡æœ‰node_modulesï¼Ÿexpressçš„æ‰€æœ‰ä¾èµ–é¡¹åœ¨å“ªé‡Œ?</p>
<p>è¯€çªåœ¨äºï¼Œ<code>express</code>åªæ˜¯ä¸€ä¸ª<code>symlink</code>ï¼Œä½†<code>Node.js</code>è§£æä¾èµ–å…³ç³»æ—¶ï¼Œå®ƒä¼šä½¿ç”¨<code>express</code>çš„çœŸå®ä½ç½®ï¼Œæ‰€ä»¥ä¾èµ–ä¸ä¼šä¿ç•™åœ¨ç¬¦å·è¿æ¥ä¸Šï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šé—®ï¼Œ<code>express</code>çš„çœŸå®ä½ç½®åœ¨å“ª?</p>
<p>è¿™é‡Œï¼š<a href="https://github.com/zkochan/comparing-node-modules/tree/master/pnpm5-example/node_modules/.pnpm/express@4.17.1/node_modules/express">node_modules&#x2F;.pnpm&#x2F;express@4.17.1/node_modules&#x2F;express</a>.</p>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†<code>.pnpm</code>æ–‡ä»¶å¤¹çš„ç”¨é€”ã€‚<code>.pnpm</code>åœ¨ä¸€ä¸ªæ‰å¹³çš„æ–‡ä»¶å¤¹ç»“æ„ä¸­å­˜å‚¨æ‰€æœ‰çš„<code>packages</code>ï¼Œæ‰€ä»¥æ¯ä¸ª<code>package</code>éƒ½å¯ä»¥åœ¨è¿™ä¸ªæ¨¡å¼å‘½åçš„æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°</p>
<pre><code class="highlight text">.pnpm/&lt;name&gt;@&lt;version&gt;/node_modules/&lt;name&gt;</code></pre>

<p>æˆ‘ä»¬ç§°å®ƒä¸ºè™šæ‹Ÿå­˜å‚¨ç›®å½•</p>
<p>è¿™ç§æ‰å¹³ç»“æ„é¿å…äº†<code>npm v2</code>åˆ›å»ºçš„åµŒå¥—<code>node_modules</code>é€ æˆçš„é•¿è·¯å¾„é—®é¢˜ï¼Œä½†æ˜¯åˆä¸<code>npm v3,4,5,6</code>å’Œ<code>yarn v1</code>çš„æ‰å¹³åŒ–ç»“æ„ä¸åŒï¼Œä¿æŒäº†<code>packages</code>çš„éš”ç¦»</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹expressçš„çœŸå®ä½ç½®ï¼š</p>
<pre><code class="highlight text">â–¾ express
  â–¸ lib
    History.md
    index.js
    LICENSE
    package.json
    Readme.md</code></pre>

<p>è¿™æ˜¯é”™è¯¯çš„å—ï¼Ÿå®ƒä»ç„¶ç¼ºå°‘<code>node_modules</code>ï¼<code>pnpm</code>çš„<code>node_modules</code>ç»“æ„çš„ç¬¬äºŒä¸ªè¯€çªæ˜¯ï¼Œ<code>packages</code>çš„ä¾èµ–å…³ç³»åœ¨åŒä¸€çº§çš„ç›®å½•ä¸Šï¼Œè€Œ<code>package</code>ä¾èµ–çš„çœŸæ­£ä½ç½®åœ¨è¿™ä¸ªç›®å½•ä¸Šã€‚æ‰€ä»¥<code>express</code>çš„ä¾èµ–ä¸åœ¨<code>.pnpm/express@4.17.1/node_modules/express/node_modules/</code>ï¼Œè€Œæ˜¯åœ¨<a href="https://github.com/zkochan/comparing-node-modules/tree/master/pnpm5-example/node_modules/.pnpm/express@4.17.1/node_modules">.pnpm&#x2F;express@4.17.1/node_modules&#x2F;</a></p>
<pre><code class="highlight text">â–¾ node_modules
  â–¾ .pnpm
    â–¸ accepts@1.3.5
    â–¸ array-flatten@1.1.1
    ...
    â–¾ express@4.16.3
      â–¾ node_modules
        â–¸ accepts
        â–¸ array-flatten
        â–¸ body-parser
        â–¸ content-disposition
        ...
        â–¸ etag
        â–¾ express
          â–¸ lib
            History.md
            index.js
            LICENSE
            package.json
            Readme.md</code></pre>

<p><code>express</code>çš„æ‰€æœ‰ä¾èµ–éƒ½æ˜¯æŒ‡å‘<code>node_modules/.pnpm</code>å†…ç›®å½•çš„symlinksã€‚<code>express</code>çš„ä¾èµ–æ”¾åœ¨ä¸Šä¸€çº§ï¼Œå¯ä»¥é¿å…å¾ªç¯symlinks</p>
<p>æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡pnpmçš„<code>node_modules</code>ç»“æ„ä»å¼€å§‹æ—¶çœ‹èµ·æ¥ä¸å¯»å¸¸ï¼š</p>
<ol>
<li>å®Œå…¨å…¼å®¹Node.js</li>
<li>packageså’Œç›¸å…³ä¾èµ–è¢«å¾ˆå¥½çš„ç»„åˆåœ¨ä¸€èµ·</li>
</ol>
<p>å¯¹äºåŒæ ·ä¾èµ–å…³ç³»çš„packagesæ¥è¯´ç»“æ„è¦å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯æƒ³æ³•æ˜¯ä¸€æ ·çš„ï¼šä½¿ç”¨symlinksåˆ›å»ºä¸€ä¸ªæœ‰æ‰å¹³ç›®å½•ç»“æ„çš„åµŒå¥—</p>
]]></content>
      <tags>
        <tag>pnpm</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘How peers are resolved</title>
    <url>/2023/05/05/%E3%80%90%E7%BF%BB%E3%80%91How%20peers%20are%20resolved/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://pnpm.io/how-peers-are-resolved">How peers are resolved</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>pnpmæœ€å¤§çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„packageæ€»æ˜¯æœ‰ä¸€ç»„ä¾èµ–å…³ç³»ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªè§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–â€“æœ‰peer dependenciesçš„packages</p>
<p>åœ¨dependency graphä¸­ï¼Œpeer dependenciesæ˜¯ä»æ›´é«˜çº§åˆ«çš„ä¾èµ–ä¸­è§£æçš„ï¼Œå› ä¸ºå®ƒä»¬ä¸å®ƒä»¬çš„çˆ¶ä¾èµ–é¡¹å…±äº«ç›¸åŒçš„ç‰ˆæœ¬ã€‚è¿™æ„å‘³ç€å¦‚æœ<a href="mailto:&#102;&#111;&#111;&#64;&#49;&#x2e;&#48;&#x2e;&#48;">&#102;&#111;&#111;&#64;&#49;&#x2e;&#48;&#x2e;&#48;</a>æœ‰ä¸¤ä¸ªpeerä¾èµ–é¡¹(bar@^1 å’Œ baz@^1)ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­å®ƒå¯èƒ½ä¼šæœ‰å¤šä¸ªä¸åŒçš„ä¾èµ–é¡¹é›†åˆ</p>
<pre><code class="highlight text">- foo-parent-1
  - bar@1.0.0
  - baz@1.0.0
  - foo@1.0.0
- foo-parent-2
  - bar@1.0.0
  - baz@1.1.0
  - foo@1.0.0</code></pre>

<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<a href="mailto:&#102;&#111;&#x6f;&#64;&#x31;&#46;&#x30;&#x2e;&#x30;">&#102;&#111;&#x6f;&#64;&#x31;&#46;&#x30;&#x2e;&#x30;</a>æ˜¯åœ¨foo-parent-1å’Œfoo-parent-2å®‰è£…çš„ã€‚è¿™ä¸¤ä¸ªpackagesä¸­éƒ½æœ‰barå’Œbazï¼Œä½†æ˜¯ä»–ä»¬ä¾èµ–ä¸åŒç‰ˆæœ¬çš„bazã€‚å› æ­¤ï¼Œ<a href="mailto:&#x66;&#111;&#111;&#x40;&#x31;&#46;&#48;&#46;&#x30;">&#x66;&#111;&#111;&#x40;&#x31;&#46;&#48;&#46;&#x30;</a>æœ‰ä¸¤ä¸ªä¸åŒçš„ä¾èµ–é›†ï¼šä¸€ä¸ªæ˜¯<a href="mailto:&#98;&#x61;&#x7a;&#x40;&#49;&#46;&#48;&#46;&#48;">&#98;&#x61;&#x7a;&#x40;&#49;&#46;&#48;&#46;&#48;</a>ï¼Œå¦ä¸€ä¸ªæ˜¯<a href="mailto:&#98;&#97;&#x7a;&#64;&#49;&#x2e;&#49;&#46;&#48;">&#98;&#97;&#x7a;&#64;&#49;&#x2e;&#49;&#46;&#48;</a>ã€‚ä¸ºäº†æ”¯æŒè¿™äº›ç”¨ä¾‹ï¼Œpnpmå¿…é¡»hand link <a href="mailto:&#x66;&#111;&#x6f;&#x40;&#x31;&#x2e;&#48;&#46;&#x30;">&#x66;&#111;&#x6f;&#x40;&#x31;&#x2e;&#48;&#46;&#x30;</a>ï¼Œæ¬¡æ•°å’Œä¸åŒçš„ä¾èµ–é›†ä¸€æ ·å¤šã€‚</p>
<p>é€šå¸¸ï¼Œå¦‚æœä¸€ä¸ªpackageæ²¡æœ‰peerä¾èµ–é¡¹ï¼Œå®ƒä¼šä¸å…¶ä¾èµ–é¡¹çš„symlinksä¸€èµ·hard linkedåˆ°node_modulesæ–‡ä»¶å¤¹ä¸­ï¼Œå°±åƒï¼š</p>
<pre><code class="highlight text">node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ foo@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo
    â”‚       â”œâ”€â”€ qux   -&gt; ../../qux@1.0.0/node_modules/qux
    â”‚       â””â”€â”€ plugh -&gt; ../../plugh@1.0.0/node_modules/plugh
    â”œâ”€â”€ qux@1.0.0
    â”œâ”€â”€ plugh@1.0.0</code></pre>

<p>ç„¶åï¼Œå¦‚æœfooæœ‰peer dependenciesï¼Œå®ƒå¯èƒ½æœ‰å¤šç»„ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºä¸åŒçš„peer dependencies åˆ›å»ºä¸åŒçš„é›†åˆï¼š</p>
<pre><code class="highlight text">node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ foo@1.0.0_bar@1.0.0+baz@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo
    â”‚       â”œâ”€â”€ bar   -&gt; ../../bar@1.0.0/node_modules/bar
    â”‚       â”œâ”€â”€ baz   -&gt; ../../baz@1.0.0/node_modules/baz
    â”‚       â”œâ”€â”€ qux   -&gt; ../../qux@1.0.0/node_modules/qux
    â”‚       â””â”€â”€ plugh -&gt; ../../plugh@1.0.0/node_modules/plugh
    â”œâ”€â”€ foo@1.0.0_bar@1.0.0+baz@1.1.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo
    â”‚       â”œâ”€â”€ bar   -&gt; ../../bar@1.0.0/node_modules/bar
    â”‚       â”œâ”€â”€ baz   -&gt; ../../baz@1.1.0/node_modules/baz
    â”‚       â”œâ”€â”€ qux   -&gt; ../../qux@1.0.0/node_modules/qux
    â”‚       â””â”€â”€ plugh -&gt; ../../plugh@1.0.0/node_modules/plugh
    â”œâ”€â”€ bar@1.0.0
    â”œâ”€â”€ baz@1.0.0
    â”œâ”€â”€ baz@1.1.0
    â”œâ”€â”€ qux@1.0.0
    â”œâ”€â”€ plugh@1.0.0</code></pre>

<p>æˆ‘ä»¬è¦ä¹ˆåˆ›å»ºsymlinksåˆ°<code>foo@1.0.0_bar@1.0.0+baz@1.0.0</code>ä¸­çš„fooï¼Œè¦ä¹ˆåˆ›å»ºsymlinksåˆ°<code>foo@1.0.0_bar@1.0.0+baz@1.1.0</code>ä¸­çš„fooã€‚å› æ­¤ï¼ŒNode.jsæ¨¡å—è§£æå¯ä»¥æ‰¾åˆ°æ­£ç¡®çš„peersä¾èµ–é¡¹ã€‚</p>
<p>å¦‚æœä¸€ä¸ªpackageæ²¡æœ‰peerä¾èµ–é¡¹ï¼Œä½†æ˜¯æœ‰ä¾èµ–äºå·²åœ¨å›¾ä¸­è§£æçš„åŒçº§ä¾èµ–é¡¹çš„ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆè¿™ä¸ªtransitive packageå¯ä»¥ä»¥ä¸åŒçš„ä¾èµ–é¡¹é›†å‡ºç°åœ¨é¡¹ç›®ä¸­ã€‚ä¾‹å¦‚ï¼Œå­˜åœ¨ä¸€ä¸ªç‰ˆæœ¬ä¸º<code>a@1.0.0</code>çš„åŒ…ï¼Œå®ƒåªæœ‰ä¸€ä¸ªä¾èµ–é¡¹<code>b@1.0.0</code>ã€‚<code>b@1.0.0</code>æœ‰ä¸€ä¸ªåŒçº§ä¾èµ–é¡¹<code>c@^1</code>ã€‚<code>a@1.0.0</code>æ°¸è¿œä¸ä¼šè§£æ<code>b@1.0.0</code>çš„åŒçº§ä¾èµ–é¡¹ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šä¾èµ–äº<code>b@1.0.0</code>çš„åŒçº§ä¾èµ–é¡¹ã€‚</p>
<p>ä¸‹é¢æ˜¯è¿™ä¸ªç»“æ„åœ¨<code>node_modules</code>ä¸­çš„æ ·å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<a href="mailto:&#97;&#x40;&#49;&#46;&#x30;&#x2e;&#x30;">&#97;&#x40;&#49;&#46;&#x30;&#x2e;&#x30;</a>éœ€è¦åœ¨é¡¹ç›®çš„<code>node_modules</code>ä¸­å‡ºç°ä¸¤æ¬¡ï¼Œä¸€æ¬¡å’Œ<code>c@1.0.0</code>ï¼Œå¦ä¸€æ¬¡å’Œ<code>c@1.1.0</code>è§£å†³ã€‚</p>
<pre><code class="highlight text">node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ a@1.0.0_c@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ a
    â”‚       â””â”€â”€ b -&gt; ../../b@1.0.0_c@1.0.0/node_modules/b
    â”œâ”€â”€ a@1.0.0_c@1.1.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ a
    â”‚       â””â”€â”€ b -&gt; ../../b@1.0.0_c@1.1.0/node_modules/b
    â”œâ”€â”€ b@1.0.0_c@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ b
    â”‚       â””â”€â”€ c -&gt; ../../c@1.0.0/node_modules/c
    â”œâ”€â”€ b@1.0.0_c@1.1.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ b
    â”‚       â””â”€â”€ c -&gt; ../../c@1.1.0/node_modules/c
    â”œâ”€â”€ c@1.0.0
    â”œâ”€â”€ c@1.1.0</code></pre>
]]></content>
      <tags>
        <tag>pnpm</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘How to Use ChatGPT to Learn a Language (And Practice It)</title>
    <url>/2023/07/01/%E3%80%90%E7%BF%BB%E3%80%91How-to-Use-ChatGPT-to-Learn-a-Language-And-Practice-It/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://artificialcorner.com/how-to-use-chatgpt-to-learn-a-language-and-practice-it-f7e7e38b1cee">How to Use ChatGPT to Learn a Language (And Practice It)</a><br>åŸä½œè€…ï¼š<a href="https://dianatheathlete.medium.com/">Diana Dovgopol</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lsuHn9qRgL_il5b931lCsA.png"></p>
<p>æˆ‘æ˜¯ä¸€ä¸ªç§»æ°‘ï¼Œä¸¤å¹´å‰æˆ‘å†³å®šæŠŠè‡ªå·±çš„ç”Ÿæ´»æ”¶æ‹¾åˆ°ä¸€ä¸ªè¡Œæç®±ï¼Œå¹¶è´­å¤–äº†å•ç¨‹æœºç¥¨ã€‚åœ¨è¿‡å»çš„ä¸¤å¹´é‡Œï¼Œæˆ‘åœ¨ä¸¤ä¸ªä¸åŒçš„å›½å®¶ç”Ÿæ´»è¿‡ï¼Œå¹¶èŠ±æ—¶é—´å­¦ä¹ å½“åœ°çš„è¯­è¨€ã€‚</p>
<p>æˆ‘å¿…é¡»è¦æ‰¿è®¤ï¼Œä¸‰å¹´å‰æˆ‘æ ¹æœ¬ä¸æ‡‚è‹±è¯­ï¼Œç„¶è€Œï¼Œä¸‰ä¸ªæœˆå‰ï¼Œæˆ‘æˆåŠŸåœ°å®Œæˆæˆ‘çš„ç¡•å£«è¯¾ç¨‹ï¼Œå¹¶ä¸”ç°åœ¨æˆ‘å¯ä»¥å’Œè‹±è¯­æ¯è¯­è€…è¿›è¡Œæœ‰æ•ˆçš„æ²Ÿé€šã€‚</p>
<p>æˆ‘èŠ±äº†ä¸€å¹´çš„æ—¶é—´å­¦ä¹ å’Œç»ƒä¹ ï¼Œä½¿æˆ‘çš„è‹±è¯­ä»åˆçº§åˆ°B2æ°´å¹³ã€‚è¿™å¹¶ä¸å®¹æ˜“ï¼Œä½†æˆ‘è®¤ä¸ºå¦‚æœå½“æ—¶æœ‰ChatGPTçš„è¯ï¼Œåº”è¯¥ä¼šå˜å¾—å®¹æ˜“ã€‚ChatGPTå¯ä»¥æˆä¸ºè¯­è¨€å­¦ä¹ è€…è‡ªå­¦çš„ä¸€ä¸ªæœ‰æ•ˆå·¥å…·ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘å¦‚ä½•ä½¿ç”¨ChatGPTæ¥å­¦ä¹ å’Œç»ƒä¹ ä¸€ç§æ–°çš„è¯­è¨€ã€‚</p>
<h2 id="1-Use-ChatGPT-as-a-language-partner-Simulate-a-real-conversation"><a href="#1-Use-ChatGPT-as-a-language-partner-Simulate-a-real-conversation" class="headerlink" title="1. Use ChatGPT as a language partner: Simulate a real conversation"></a>1. Use ChatGPT as a language partner: Simulate a real conversation</h2><p>ChatGPTå¯ä»¥æˆä¸ºä½ çš„è¯­è¨€ä¼™ä¼´ï¼Œåœ¨ä½ éœ€è¦ç»ƒä¹ çš„æ—¶å€™ä¸ä½ èŠå¤©ã€‚</p>
<p>ä½¿ç”¨ChatGPTä¸ä½ è¿›è¡Œå¯¹è¯ï¼Œéœ€ä½¿ç”¨ä¸‹é¢çš„æç¤ºã€‚</p>
<blockquote>
<p>Act as a language partner. Youâ€™ll start a conversation with me about [topic] in [language]. In every response, you should provide your opinion and then ask me a question to keep the conversation going.</p>
</blockquote>
<p>æˆ‘è¯•ç€ç”¨â€œfootballâ€å’Œâ€è¥¿ç­ç‰™è¯­â€æ¥è¿›è¡Œæç¤ºã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DznstT0MrB1WVGThkGxAmw.png"></p>
<p>æ­£å¦‚ä½ è¯´çœ‹åˆ°çš„ï¼ŒChatGPTç»™å‡ºäº†è‡ªå·±çš„æ„è§ï¼Œå¹¶å‘æˆ‘æå‡ºäº†ä¸€ä¸ªæ–°é—®é¢˜ï¼Œè¿™å°±å½¢æˆäº†ä¸€ç§äº’åŠ¨å¼çš„æ€æƒ³äº¤æµå’Œæ€è€ƒã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IKImgiCyz8vnyneWfnkXw.png"></p>
<p>ä½ å¯ä»¥ç”¨ChatGPTç»ƒä¹ ä»»ä½•è¯­è¨€ã€‚ç°åœ¨æˆ‘æ‰“ç®—ç»ƒä¹ æˆ‘çš„å¾·è¯­ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dExTgF08UURkOI18cSy8yQ.png"></p>
<p>è¿™å¯ä»¥å¸®åŠ©ä½ ç»ƒä¹ ä½ å­¦è¿‡çš„è¯­æ³•è§„åˆ™å’Œè¯æ±‡ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QY4Nw2q9Fo4F9FDh6z1wAw.png"></p>
<p>å½“ç„¶ï¼Œä¸çœŸäººå¯¹æ¯”ï¼ŒChatGPTå‚ä¸å¯¹è¯çš„èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¯­è¨€ä¼™ä¼´!</p>
<h2 id="2-Using-ChatGPT-to-learn-grammar-rules-and-improve-your-writing"><a href="#2-Using-ChatGPT-to-learn-grammar-rules-and-improve-your-writing" class="headerlink" title="2. Using ChatGPT to learn grammar rules and improve your writing"></a>2. Using ChatGPT to learn grammar rules and improve your writing</h2><p>ChatGPTå¯ä»¥å¸®åŠ©ä½ ä»¥ä¸€ç§ç®€å•çš„æ–¹å¼ç†è§£è¯­æ³•è§„åˆ™ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘é—®chatGPTå…³äºå¾·è¯­ä¸­ä¸¤ä¸ªåŠ¨è¯ï¼ˆä¸€ä¸ªæ˜¯ç°åœ¨å®Œæˆæ—¶ï¼Œå¦ä¸€ä¸ªæ˜¯è¿‡å»å®Œæˆæ—¶ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b45NMA8MSS_ES6umAcKigw.png"></p>
<p>ä¸Šé¢çš„è§£é‡Šåªæ˜¯å¯¹åŠ¨è¯æ—¶æ€çš„åŸºæœ¬æè¿°ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ChatGPTæä¾›çš„ä¾‹å­å’Œæ›´å¤šè¯­æ³•è§„åˆ™çš„ç»†èŠ‚æ¥ç†è§£æ‰€å­¦çš„æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨ä¸åŒçš„è¯­å¢ƒä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>å¦å¤–ChatGPTå¯ä»¥å¸®åŠ©ä½ çº æ­£é”™è¯¯ã€‚</p>
<p>ChatGPTå¯ä»¥çº æ­£ä½ çš„è¯­æ³•å’Œæ‹¼å†™é”™è¯¯ï¼Œå¹¶ä¸ºä½ æä¾›ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œè§£é‡Šä¸ºä»€ä¹ˆå‡ºé”™ä»¥åŠå¦‚ä½•ä¿®æ”¹ã€‚è¿™å¯¹äºè‡ªå­¦çš„äººæ¥è¯´ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæ²¡æœ‰äººæ£€æŸ¥ä»–ä»¬çš„å†™ä½œã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘è¦æ±‚ChatGPTçº æ­£æˆ‘ç”¨å¾·è¯­å†™çš„ä¸€å°é‚®ä»¶ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kui474LjnsZS5sVhew4WwQ.png"></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒChatGPTçš„ä¿®æ”¹æ›´åŠ æ­£å¼ã€‚å¦‚æœä½ æ˜ç¡®æŒ‡å®šè¿™å°ä¿¡æ˜¯ç»™è°ï¼Œå®ƒå¯ä»¥è°ƒæ•´è¯­æ°”ã€‚æˆ‘å‘Šè¯‰ChatGPTè¿™å°ä¿¡æ˜¯ç»™ä¸€ä¸ªæœ‹å‹çš„ï¼Œä»¥ä¸‹æ˜¯å®ƒçš„å›ç­”ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAV5sACcIAyeGFniknB-mQ.png"></p>
<p>ä½ ä¹Ÿå¯ä»¥æ˜ç¡®åœ°è¦æ±‚ChatGPTè®©å†…å®¹æ›´åŠ æ­£å¼ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bqXuoOSQKCMOiOsnN8vE0w.png"></p>
<p>æ­£å¼çš„è¯­è¨€åº”åœ¨å­¦æœ¯èƒŒæ™¯ä¸‹ä½¿ç”¨ï¼Œä»¥åŠä¸é™Œç”Ÿäººæˆ–è€…æ¯”æˆ‘ä»¬å¹´é•¿çš„äººäº¤è°ˆæ—¶ä½¿ç”¨ï¼Œè€Œéæ­£å¼è¯­è¨€å¯ä»¥ä¸æœ‹å‹ä½¿ç”¨ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘è¦æ±‚ChatGPTè®©å†…å®¹ä¸é‚£ä¹ˆæ­£å¼ï¼Œä»¥ä¾¿æˆ‘æ‰¾åˆ°ä¸€äº›å·®å¼‚æ€§æ¥å­¦ä¹ æ–°è¯ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2X9gVncvJOPNWwCNrCHYw.png"></p>
<p>ç°åœ¨æ˜¯å°è¯•ç¼–å†™é‚®ä»¶å’Œè®ºæ–‡çš„æ—¶å€™äº†ã€‚</p>
<h2 id="3-Use-ChatGPT-to-improve-your-vocabulary-and-reading-skills"><a href="#3-Use-ChatGPT-to-improve-your-vocabulary-and-reading-skills" class="headerlink" title="3. Use ChatGPT to improve your vocabulary and reading skills"></a>3. Use ChatGPT to improve your vocabulary and reading skills</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ æ ¹æ®æ•™ç§‘ä¹¦å­¦ä¹ æ—¶ï¼Œä½ çš„å­¦ä¹ å†…å®¹ä¼šè¢«é™åˆ¶åˆ°æ‰€æä¾›çš„ä¸€ç»„æ–‡æœ¬å’Œè¯æ±‡ä¸­ã€‚è¿™äº›æ•™æé€šå¸¸ç”±ä¸€ä¸ªæˆ–ä¸¤ä¸ªå…³äºç‰¹å®šä¸»é¢˜çš„å†…å®¹ç»„æˆï¼Œæœ‰æ—¶å°±ä¼šå¾ˆæ¯ç‡¥ã€‚</p>
<p>æœ‰æ—¶ä½ ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´åœ¨ç½‘ä¸Šæœç´¢åˆé€‚çš„æ–‡æœ¬ï¼Œä½†æœ‰äº†ChatGPTï¼Œä½ å¯ä»¥åœ¨å‡ ç§’å†…å¿«é€Ÿç”Ÿæˆä»»ä½•çº§åˆ«å’Œä¸»é¢˜çš„å†…å®¹ï¼Œæ¥èŠ‚çœä½ çš„æ—¶é—´å’Œç²¾åŠ›ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*De2NMiGblHWpc5V_EoiOiQ.png"></p>
<p>Okay! ä¸Šé¢è¿™ä¸ªæ•…äº‹æ²¡æœ‰å¤ªå¤šçš„æ‚¬å¿µï¼Œæƒ…èŠ‚ä¹Ÿå¾ˆç›´ç™½ï¼Œä½†æ˜¯å®ƒä»ç„¶æä¾›äº†é˜…è¯»ææ–™ã€‚</p>
<p>å¦å¤–ï¼Œå…¶ä¸­çš„ä¸€äº›è¯æ±‡å’ŒçŸ­è¯­å¯èƒ½ä¸æ˜¯çœŸæ­£çš„â€ç®€å•â€ï¼Œä½†ä½ ä»ç„¶å¯ä»¥ç”¨è¿™ä¸ªæ•…äº‹è¿›è¡Œç»ƒä¹ ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨å®ƒåˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„å•è¯åˆ—è¡¨ï¼Œå¹¶æä¾›å®ƒä»¬çš„è‹±æ–‡ç¿»è¯‘ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ew9f5o55-OHKf4wAe96PfQ.png"></p>
<p>Awesome!</p>
<p>ä½ ä¹Ÿå¯ä»¥è¦æ±‚ChatGPTç»§ç»­å†™æ•…äº‹ï¼Œåªéœ€è¦è¯´â€continueâ€ï¼Œä¹Ÿå¯ä»¥è¦æ±‚å°†æ•´ä¸ªæ–‡æœ¬ç¿»è¯‘æˆè‹±æ–‡ï¼Œç”šè‡³è¦æ±‚å®ƒä¸ºè¿™äº›æ•…äº‹ç”Ÿæˆç®€å•çš„ç†è§£æ€§é—®é¢˜ã€‚</p>
<h2 id="4-Use-ChatGPT-to-improve-your-pronunciation"><a href="#4-Use-ChatGPT-to-improve-your-pronunciation" class="headerlink" title="4. Use ChatGPT to improve your pronunciation"></a>4. Use ChatGPT to improve your pronunciation</h2><p>ChatGPTä¸èƒ½ä½¿ç”¨éŸ³é¢‘ï¼Œå•å®ƒå¯ä»¥æä¾›ä»»ä½•ä½ æ„Ÿå…´è¶£çš„å•è¯çš„éŸ³è¯‘ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹å¾ˆç®€å•ï¼Œä½ åªéœ€è¦ä½¿ç”¨ä¸‹é¢çš„æç¤ºã€‚</p>
<blockquote>
<p>Create a table with 2 columns: In the first column type the [language] words: [word1, word2, â€¦]. In the second column, you should provide the phonetic transcription.</p>
</blockquote>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zokSmgDZZkbAMUIzIdHq6w.png"></p>
<p>è¿™ä¸ªéŸ³æ ‡æ˜¯ä»¥ International Phonetic Alphabet (IPA) çš„å½¢å¼ç»™å‡ºï¼Œå¾ˆåˆ©äºä½ çš„å‘éŸ³ç»ƒä¹ !</p>
<h2 id="5-Use-ChatGPT-to-understand-different-dialects"><a href="#5-Use-ChatGPT-to-understand-different-dialects" class="headerlink" title="5. Use ChatGPT to understand different dialects"></a>5. Use ChatGPT to understand different dialects</h2><p>æ­£å¦‚ä½ æ‰€çŸ¥é“çš„ï¼Œä¸€äº›è‹±è¯­å•è¯ä¼šæ ¹æ®ä¸åŒçš„å›½å®¶è€Œå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>è¿™ç§æƒ…å†µä¹Ÿå‘ç”Ÿåœ¨å…¶ä»–è¯­è¨€ä¸Šï¼Œå¦‚å¾·è¯­ã€‚</p>
<p>æˆ‘å­¦çš„æ˜¯â€high Germanâ€ï¼ŒåŸæ±åŸå‘³ï¼Œæœªå—æ–¹è¨€å½±å“ã€‚ç„¶è€Œï¼Œåœ¨å¥¥åœ°åˆ©ã€å¾·å›½æˆ–ç‘å£«çš„ä¸€äº›åœ°åŒºï¼Œæ–¹è¨€å’Œè¯æ±‡æ˜¯ä¸åŒçš„ã€‚ç°åœ¨ï¼Œæˆ‘å¯ä»¥å‘ChatGPTè¯¢é—®ä¸€ä¸ªæ–°è¯å’Œå®ƒåœ¨ç‰¹å®šæ–¹è¨€ä¸­çš„å¯¹åº”è¯ã€‚</p>
<p>ä¸‹é¢æœ‰ä¸ªä¾‹å­ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cX0x0lpVJh0iRj72CvpMBg.png"></p>
<h2 id="So-can-you-learn-a-language-with-ChatGPT"><a href="#So-can-you-learn-a-language-with-ChatGPT" class="headerlink" title="So can you learn a language with ChatGPT?"></a>So can you learn a language with ChatGPT?</h2><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ChatGPTå¯ä»¥æˆä¸ºå­¦ä¹ è¯­è¨€çš„ä¸€ä¸ªæœ‰ç”¨å·¥å…·ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªäººå·¥æ™ºèƒ½è¯­è¨€æ¨¡å‹ï¼ŒChatGPTå…·æœ‰åœ¨ç‰¹å®šè¯­è¨€ä¸Šç”Ÿæˆæ–‡æœ¬çš„èƒ½åŠ›ï¼Œå¯ä»¥å¸®åŠ©äººä»¬æå‡è¯æ±‡ã€å†™ä½œå’Œå£è¯­æŠ€èƒ½ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥æ£€æŸ¥ä½ çš„è¯­æ³•å’Œæ‹¼å†™é”™è¯¯ã€‚</p>
<p>æœ€åï¼Œè¦è®°ä½ï¼Œå®ƒä¸èƒ½ä»£æ›¿äººä¸äººä¹‹é—´çš„æ²Ÿé€šæˆ–æ­£å¼çš„è¯­è¨€å­¦ä¹ è®¡åˆ’ï¼Œæœ€å¥½æ˜¯å°†å…¶ä½œä¸ºå…¶ä»–å­¦ä¹ èµ„æºçš„è¡¥å……ã€‚å¦å¤–å§‹ç»ˆè¦ä¸è¯­è¨€è€å¸ˆæˆ–æ¯è¯­äººå£«æ ¸å®ChatGPTç”Ÿæˆçš„ä¿¡æ¯ã€‚</p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>AI</tag>
        <tag>ChatGPT</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘I Used ChatGPT (Every Day) for 5 Months. Here Are Some Hidden Gems That Will Change Your Life</title>
    <url>/2023/06/23/%E3%80%90%E7%BF%BB%E3%80%91I-Used-ChatGPT-Every-Day-for-5-Months-Here-Are-Some-Hidden-Gems-That-Will-Change-Your-Life/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://artificialcorner.com/i-used-chatgpt-every-day-for-5-months-here-are-some-hidden-gems-that-will-change-your-life-a451e2093097">I Used ChatGPT (Every Day) for 5 Months. Here Are Some Hidden Gems That Will Change Your Life</a><br>åŸä½œè€…ï¼š<a href="https://dianatheathlete.medium.com/">Diana Dovgopol</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_DpPoH6_DMbQeAqTIL0Lw.png"></p>
<p>éšç€ChatGPTè¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œè®¸å¤šäººå·²ç»ä¹ æƒ¯äº†å®ƒçš„æ ‡å‡†åŠŸèƒ½ï¼Œå¹¶ä¸”ä»¥å„ç§æ–¹å¼å¼€å§‹ä½¿ç”¨å®ƒã€‚ç„¶è€Œï¼Œè®¸å¤šäººå¹¶æ²¡æœ‰æ„æ€åˆ°ï¼Œè¿™ç§AIé™¤äº†è¾“å…¥æ–‡å­—ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šé«˜çº§çš„åŠŸèƒ½ã€‚</p>
<p>ChatGPTæœ‰è®¸å¤šåŠŸèƒ½éƒ½å¯ä»¥åº”ç”¨åˆ°ä½ çš„å·¥ä½œå’Œç”Ÿæ´»ä¸­</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šå’Œä½ åˆ†äº«ChatGPTçš„ä¸€äº›é²œä¸ºäººçŸ¥å’Œéæ ‡å‡†çš„åŠŸèƒ½ã€‚é€šè¿‡æ¢ç´¢è¿™äº›éšè—çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥è§£é”è¿™ä¸ªAIçš„å…¨éƒ¨æ½œåŠ›ï¼Œå¹¶ä¸ºä½ å¸¦æ¥å¥½å¤„ã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£å§!</p>
<h2 id="1-Summarize-videos-articles-papers-and-posts"><a href="#1-Summarize-videos-articles-papers-and-posts" class="headerlink" title="1. Summarize videos, articles, papers and posts"></a>1. Summarize videos, articles, papers and posts</h2><p>ChatGPTæœ€å¥½çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯ä¸ºæˆ‘èŠ‚çœäº†é˜…è¯»åœ¨çº¿å†…å®¹çš„æ—¶é—´ã€‚</p>
<p>åœ¨è¿‡å»ï¼Œæˆ‘ä¸ºäº†æ‰¾åˆ°æŸäº›ä¿¡æ¯ï¼Œä¸å¾—ä¸é˜…è¯»æµè§ˆå¤§é‡æ— èŠçš„ç§‘ç ”æ–‡ç« ï¼Œä½†ç°åœ¨ChatGPTå¯ä»¥åœ¨å‡ ç§’å†…å¸®æˆ‘åšåˆ°è¿™ä¸€ç‚¹ã€‚æ­¤å¤–ï¼Œå®ƒç”šè‡³å¯ä»¥å°†å†…å®¹åœ¨ä¸åˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´å†…ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ã€‚</p>
<p>ä¸‹é¢æ˜¯å®ƒçš„å·¥ä½œåŸç†(æ³¨æ„ï¼Œä½ éœ€è¦å¯åŠ¨è¿™äº›<a href="https://artificialcorner.com/i-tried-84-chatgpt-plugins-these-are-the-best-3b3be6b1cb7b">ChatGPTæ’ä»¶</a>)</p>
<ol>
<li>æŸ¥æ‰¾è§†é¢‘&#x2F;æ–‡ç« &#x2F;paper&#x2F;å¸–å­</li>
<li>å¤åˆ¶é“¾æ¥</li>
<li>è®©ChatGPTç»™ä½ æ€»ç»“</li>
</ol>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-EaO0tq2vum7kOY-zZ6Ew.png"></p>
<p>è¿™ä¸ªåŠŸèƒ½å¯¹æˆ‘éå¸¸æœ‰å¸®åŠ©ã€‚æˆ‘å‘ç°çš„å”¯ä¸€ç¼ºç‚¹å°±æ˜¯ä¸èƒ½é˜…è¯»PDFæ ¼å¼çš„ç§‘ç ”æ–‡ç« ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦æ€»ç»“ç½‘ç«™çš„çº¯æ–‡æœ¬å†…å®¹æ—¶ï¼Œå®ƒå¯ä»¥åšçš„å¾ˆå¥½ã€‚</p>
<p>æ³¨æ„ï¼šç°åœ¨ä½ å¯ä»¥ç”¨æ–°çš„ChatGPTæ’ä»¶â€Ask Your PDFâ€æ¥æ€»ç»“PDFæ ¼å¼å†…å®¹ã€‚éœ€è¦äº†è§£æ›´å¤šï¼Œ<a href="https://artificialcorner.com/i-tried-84-chatgpt-plugins-these-are-the-best-3b3be6b1cb7b">å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« </a></p>
<h2 id="2-Scan-and-Describe-Images-with-ChatGPT"><a href="#2-Scan-and-Describe-Images-with-ChatGPT" class="headerlink" title="2. Scan and Describe Images with ChatGPT"></a>2. Scan and Describe Images with ChatGPT</h2><p>æˆ‘æœ€è¿‘å‘ç°äº†ä¸€ä¸ªå¯¹æˆ‘éå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæˆ‘è®¤ä¸ºåˆ†äº«ç»™ä½ ä¼šå¾ˆæœ‰å¸®åŠ© â€“ é€šè¿‡ChatGPTæ‰«æå›¾åƒã€‚</p>
<p>è¿™è®©æˆ‘æƒ³èµ·äº†æˆ‘çš„å­¦ç”Ÿæ—¶ä»£ä¸ºäº†é€»è¾‘æµ‹è¯•åŠªåŠ›æè¿°å›¾åƒçš„åœºæ™¯ã€‚é‚£æ—¶å€™ï¼Œæˆ‘è¿˜æ²¡æœ‰ChatGPTï¼Œä½†ç°åœ¨æˆ‘å¯ä»¥ç”¨AIæ¥ç®€åŒ–è¿™ä¸ªå¯¹æˆ‘æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ã€‚</p>
<p>ä¸‹é¢æ˜¯ä»–çš„å·¥ä½œåŸç†ã€‚</p>
<ol>
<li>åœ¨ç½‘ä¸Šæ‰¾åˆ°æ‰€éœ€çš„å›¾åƒã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨è†ç›–çš„è§£å‰–å­¦å›¾åƒã€‚</li>
</ol>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4AktKGovcnBk9kvHasWsuw.png"></p>
<ol start="2">
<li>åœ¨ä¸€ä¸ªå•ç‹¬çš„æµè§ˆå™¨æ ‡ç­¾ä¸­æ‰“å¼€å›¾ç‰‡ï¼Œç¡®ä¿è¯¥æ ‡ç­¾ä¸­åªæœ‰å›¾ç‰‡æ˜¯å¯è§çš„ã€‚ç„¶ååœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­å¤åˆ¶URLï¼Œå¦‚ä¸‹å›¾çš„æˆªå›¾æ‰€ç¤ºã€‚</li>
</ol>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4aseBnUcCKleu7G5Z8m0w.png"></p>
<ol start="3">
<li>è¯·ChatGPTä¸ºä½ æè¿°å›¾åƒã€‚</li>
</ol>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*86A4gAjfLh_piWUVAOoZCQ.png"></p>
<p>ç„¶åå°±æ¬£èµChatGPTå¸¦æ¥çš„è¯¦ç»†æè¿°!</p>
<p>ChatGPTä¹Ÿæœ‰ä¸ºå„ç§å¯è§†åŒ–å›¾åƒæä¾›æè¿°çš„èƒ½åŠ›ã€‚ä¸‹é¢æ˜¯ä¸€å¼ å·¦ä¸Šè§’æœ‰å›¾ä¾‹çš„åœ°å›¾ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PYLG-ZHeF47BRqvHtu79qw.png"></p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»ChatGPTä¸­å¾—åˆ°çš„æè¿°ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0ZqwbUi06tN3wpzElhsDQ.png"></p>
<p>ä½†æ˜¯è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ï¼ChatGPTå¯ä»¥æè¿°å¾ˆå¤šä¸œè¥¿ï¼Œä»è‰ºæœ¯å“åˆ°ç§‘å­¦å›¾è§£ã€‚</p>
<p>æ³¨æ„ï¼šæ˜¾ç„¶ChatGPT(GPT-3.5)å¹¶æ²¡æœ‰çœŸæ­£æ‰«æå›¾ç‰‡ï¼Œè€Œæ˜¯åˆ©ç”¨äº†é“¾æ¥ä¸­çš„å…³é”®è¯æ¥æè¿°å›¾ç‰‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨ChatGPTæ’ä»¶ Link Readerï¼Œæ­£å¦‚<a href="https://artificialcorner.com/i-tried-84-chatgpt-plugins-these-are-the-best-3b3be6b1cb7b">è¿™ç¯‡æ–‡ç« </a>æ‰€è§£é‡Šçš„ã€‚</p>
<h2 id="3-Use-ChatGPT-as-your-private-teacher"><a href="#3-Use-ChatGPT-as-your-private-teacher" class="headerlink" title="3. Use ChatGPT as your private teacher"></a>3. Use ChatGPT as your private teacher</h2><p>æˆ‘æ¯å¤©éƒ½åœ¨ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä»–å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ¸¸æˆè§„åˆ™æ”¹å˜è€…ã€‚ä»–ä½¿æˆ‘çš„ç”Ÿæ´»å˜å¾—è½»æ¾ï¼Œå¹¶ä¸ºæˆ‘èŠ‚çœäº†å¤§é‡çš„æ—¶é—´å’Œé‡‘é’±ã€‚</p>
<p>æˆ‘æŠŠChatGPTå˜æˆäº†æˆ‘çš„è¯­è¨€ç§æ•™ã€‚ä»¥ä¸‹æ˜¯ChatGPT<a href="https://artificialcorner.com/how-to-use-chatgpt-to-learn-a-language-and-practice-it-f7e7e38b1cee">å¦‚ä½•å¸®åŠ©æˆ‘å­¦ä¹ å¤–è¯­çš„</a>ã€‚</p>
<ul>
<li>ç”¨ChatGPTæ£€æŸ¥æˆ‘çš„è¯­æ³•</li>
<li>ç”¨ChatGPTæŠŠå•è¯å’ŒçŸ­è¯­ç¿»è¯‘æˆä¸åŒçš„è¯­è¨€</li>
<li>ç”¨ChatGPTå¸®æˆ‘ç»ƒä¹ å†™ä½œå’Œè¯­è¨€èƒ½åŠ›ï¼Œå¹¶ä¸”æˆ‘å¯ä»¥å¾—åˆ°å®æ—¶åé¦ˆ</li>
</ul>
<p>ä½†ChatGPTä¸æ˜¯åªèƒ½å¸®åŠ©ä½ è¯­è¨€å­¦ä¹ ã€‚å®ƒè¿˜å¸®åŠ©æˆ‘å­¦ä¹ å…¶ä»–ç§‘ç›®ï¼Œæ¯”å¦‚æ•°å­¦ã€‚</p>
<p>å½“æˆ‘åœ¨å­¦æ ¡çš„æ—¶å€™ï¼Œæˆ‘å­¦ä¹ æ•°å­¦æ—¶å¾ˆå›°éš¾ï¼Œå‘ç°å®ƒå¾ˆéš¾ç†è§£ï¼ŒåŒæ—¶ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘å­¦æ ¡çš„è€å¸ˆå¹¶æ²¡æœ‰å¾ˆå¥½çš„å¸®æˆ‘è§£é‡Šï¼Œå› æ­¤æˆ‘æ²¡æœ‰å–å¾—ä»€ä¹ˆè¿›å±•ã€‚</p>
<p>ç„¶è€Œï¼Œå¤šäºäº†ChatGPTï¼Œæˆ‘ç°åœ¨å¯ä»¥åœ¨ä»»ä½•æ•°å­¦é¢˜ä¸Šå¾—åˆ°æˆ‘æƒ³è¦çš„è§£é‡Šã€‚æˆ‘å¯ä»¥è¦æ±‚ChatGPTé€æ­¥çš„è¯´æ˜å¦‚ä½•è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚å®ƒç”šè‡³å¯ä»¥æä¾›å¤šç§è§£é¢˜æ–¹æ¡ˆã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlrY_S5I_x6k2ppDWTTdzQ.png"></p>
<p>æ­¤å¤–ï¼Œæˆ‘è¿˜å¯ä»¥è®©ChatGPTä¸ºæˆ‘è§£é‡Šå¦‚ä½•å¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆã€‚è¿™å¾ˆç¥å¥‡ï¼Œä½ ä¸è§‰å¾—å—ï¼Ÿ</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WuVx0ikJM0ZnfpSPUSSHFA.png"></p>
<p>ä½ å¯ä»¥å¯¹ä»»ä½•æ„Ÿå…´è¶£çš„å­¦ç§‘è¿›è¡Œæé—®ï¼Œè€Œä¸”è§£é‡Šæ˜¯æ˜“äºç†è§£çš„è¯­è¨€ç¼–å†™çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç†è§£</p>
<h2 id="4-Ask-ChatGPT-for-advice"><a href="#4-Ask-ChatGPT-for-advice" class="headerlink" title="4. Ask ChatGPT for advice"></a>4. Ask ChatGPT for advice</h2><p>è¿™ä¸ªåŠŸèƒ½ä¸ä¼šå–ä»£ä½ çš„æœ‹å‹æˆ–å¿ƒç†åŒ»ç”Ÿï¼Œä½†å®ƒå¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°é—®é¢˜çš„è§£å†³åŠæ³•ã€‚</p>
<h3 id="Life-advice"><a href="#Life-advice" class="headerlink" title="Life advice"></a>Life advice</h3><p><a href="https://dianatheathlete.medium.com/the-athletes-15-minute-night-routine-to-maximize-performance-in-your-mornings-cc2cc60630fd">æ—©ä¸Šæ—©èµ·å¯¹æˆ‘æ¥è¯´ä¸€ç›´æ˜¯ä¸€ä¸ªæŒ‘æˆ˜</a>ï¼Œå³ä½¿æˆ‘ç¡å¾—å¾ˆæ—©ï¼Œæ‰€ä»¥æˆ‘å†³å®šå‘ChatGPTè¯¢é—®ä¸€äº›è¿™æ–¹é¢çš„æŠ€å·§</p>
<p>ä»¥ä¸‹æ˜¯å®ƒçš„å»ºè®®ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NXBMBAKdRSLXu9aK4M0VQ.png"></p>
<p>ç¬¬4ç‚¹å’Œç¬¬6ç‚¹å¯¹æˆ‘å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>ä½ å¯ä»¥å¯¹ä½ ç”Ÿæ´»çš„ä¸åŒæ–¹é¢è¿›è¡Œè¯¢é—®ã€‚æ¯”å¦‚ä½ åœ¨å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªæ€åº¦å‚²æ…¢æ— ç¤¼çš„åŒäº‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»¥ä¸‹æ˜¯ChatGPTçš„å»ºè®®ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bNpBJ8-sI06MIHCHn7kO8A.png"></p>
<p>è¿™ç±»ä¼¼äºä¸€ä¸ªæœ‹å‹å¯¹ä½ çš„æ¨èã€‚</p>
<p>å½“ç„¶ï¼Œå®ƒä¸èƒ½å–ä»£å…¨é¢çš„æ²Ÿé€šã€ä¸æƒ…å¢ƒç›¸å…³çš„ç¬‘è¯æˆ–åŸåˆ›çš„å»ºè®®ï¼Œä½†å½“ä½ éœ€è¦è¿…é€Ÿåšå‡ºå†³ç­–æˆ–æƒ³è¦è€ƒè™‘å¤šä¸ªè§£å†³é—®é¢˜çš„é€‰é¡¹æ—¶ï¼Œå®ƒå¯ä»¥éå¸¸æœ‰ç”¨ã€‚</p>
<p>ä½ æä¾›çš„ç»†èŠ‚è¶Šå¤šï¼Œå¾—åˆ°çš„ç­”æ¡ˆå°±æ›´å¥½ã€‚</p>
<h3 id="Health-Advice"><a href="#Health-Advice" class="headerlink" title="Health Advice"></a>Health Advice</h3><p>è¿‡å»ï¼Œæˆ‘éœ€è¦åœ¨äº’è”ç½‘ä¸Šæœç´¢è®¡ç®—æˆ‘çš„å¡è·¯é‡Œéœ€æ±‚ï¼Œæˆ–è€…å®Œå…¨ä¾é è¥å…»å¸ˆåˆ¶å®šå…·ä½“çš„è†³é£Ÿè®¡åˆ’ï¼›ç„¶è€Œï¼Œç°åœ¨ChatGPTå¯ä»¥å¸®æˆ‘æä¾›è¿™äº›ä¿¡æ¯ï¼Œæ¥ä¸ºæˆ‘èŠ‚çœä¸€äº›æ—¶é—´å’Œé‡‘é’±ã€‚</p>
<p>æˆ‘å¯ä»¥è¦æ±‚ChatGPTæ ¹æ®æˆ‘çš„ä½“é‡ã€èº«é«˜ã€æ€§åˆ«ã€èº«ä½“æ´»åŠ¨å’ŒæœŸæœ›çš„å‡è‚¥ç›®æ ‡æ¥è®¡ç®—æˆ‘çš„å¡è·¯é‡Œéœ€æ±‚ã€‚</p>
<blockquote>
<p>Prompt: â€œCalculate my calorie requirement. I am a girl, 24 years old, my weight is 55kg and I am 166cm, I do workouts 3 times a week and would like to lose 3kgâ€.</p>
</blockquote>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbk0z6IoPJYe6NArzQNo6w.png"></p>
<p>è¿™ä¸ªç­”æ¡ˆç›¸å½“æ£’ï¼Œå› ä¸ºæˆ‘åœ¨å¤§å­¦å­¦ä¹ æœŸé—´ä¸æ•™æˆè®¨è®ºæ—¶ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ³æ³•ã€‚å¦‚æœè¦å‡†ç¡®åœ°è®¡ç®—å‡ºä½ æ¯å¤©æ‰€éœ€çš„å¡è·¯é‡Œï¼Œéœ€è¦è€ƒè™‘å‡ ä¸ªå› ç´ ï¼Œå¦‚å¹´é¾„ã€æ€§åˆ«ã€ä½“é‡ã€èº«é«˜ã€æ´»åŠ¨æ°´å¹³å’Œå‡è‚¥ç›®æ ‡ã€‚</p>
<p>å½“ç„¶ï¼Œä¸ºäº†è·å¾—å°½å¯èƒ½å‡†ç¡®çš„ç­”æ¡ˆï¼Œåœ¨è¾“å…¥æ‰€éœ€çš„ç»†èŠ‚æ—¶ï¼Œå¿…é¡»æä¾›å°½å¯èƒ½å¤šçš„ä¿¡æ¯ã€‚</p>
<p>æˆ‘è¿˜æŠŠChatGPTå˜æˆäº†æˆ‘çš„è¥å…»å¸ˆã€‚</p>
<blockquote>
<p>Prompt: â€œCan you write down a menu with a daily deficit of 500â€“1000 calories?â€</p>
</blockquote>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PLaS4RAu9cQdDHMTDnUCNw.png"></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1007-VbqdYig52kUgZlbWQ.png"></p>
<p>æˆ‘å¾—åˆ°äº†ä¸€ä»½é€‚åˆæˆ‘æ—¥å¸¸é¥®é£Ÿçš„é£Ÿç‰©æ¸…å•ã€‚ä½ ç”šè‡³å¯ä»¥è¦æ±‚æä¾›ä¸€æ•´å‘¨æˆ–æ›´é•¿æ—¶é—´çš„èœå•ï¼Œå‘Šè¯‰ChatGPTä½ å–œæ¬¢æˆ–ä¸å–œæ¬¢åƒä»€ä¹ˆã€‚è¿™è¶…çº§ç®€å•!</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJ9Al1D6DOOVt4yfoAPzwQ.png"></p>
<p>*å…è´£å£°æ˜ï¼šä½ ä¸èƒ½100%ä¾èµ–ChatGPTçš„å›å¤ï¼Œè€Œæ˜¯è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ªåŠ©æ‰‹ï¼Œä¸æ˜¯ä½œä¸ºå¥åº·å»ºè®®çš„æ›¿ä»£å“ã€‚è¿™ç¯‡æ–‡ç« ä»…ä¾›å‚è€ƒï¼Œä¸åº”è§†ä¸ºå¥åº·å»ºè®®ã€‚</p>
<h2 id="Artificial-Cornerâ€™s-Free-ChatGPT-Cheat-Sheet"><a href="#Artificial-Cornerâ€™s-Free-ChatGPT-Cheat-Sheet" class="headerlink" title="Artificial Cornerâ€™s Free ChatGPT Cheat Sheet"></a>Artificial Cornerâ€™s Free ChatGPT Cheat Sheet</h2><p>Weâ€™re offering a free cheat sheet to our readers. <a href="https://frankandrade.ck.page/08c94cf1c1">Join our newsletter with 20K+ people and get our free ChatGPT cheat sheet</a>.</p>
<p>Loved this story and want to support me as a writer? Consider signing up for Medium. If you <a href="https://dianatheathlete.medium.com/membership">sign up with my link</a>, I earn a small commission at no cost to you! And youâ€™ll get full access to all stories on Medium.</p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>AI</tag>
        <tag>ChatGPT</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Mastering TypeScript: A Guide to Choosing Between â€˜typeâ€™ and â€˜interfaceâ€™</title>
    <url>/2023/05/24/%E3%80%90%E7%BF%BB%E3%80%91Mastering-TypeScript-A-Guide-to-Choosing-Between-%E2%80%98type%E2%80%99-and-%E2%80%98interface%E2%80%99/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/mastering-typescript-a-guide-to-choosing-between-type-and-interface-c31d3527693b">Mastering TypeScript: A Guide to Choosing Between â€˜typeâ€™ and â€˜interfaceâ€™</a><br>åŸä½œè€…ï¼š<a href="https://blog.ricofritzsche.de/">Rico Fritzsche</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>TypeScriptç°åœ¨å·²ç»æˆä¸ºæ•æ‰é”™è¯¯å’Œæé«˜ä»£ç ç¨³å®šæ€§çš„å¯é å·¥å…·ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨TypeScriptæ—¶ï¼Œæˆ‘ç»å¸¸æƒ³çŸ¥é“typeå’Œinterfaceä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬</p>
<p>åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«æˆ‘æ‰€çŸ¥é“çš„çš„å…³äºtypeå’Œinterfaceä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä¼šæä¾›æ˜ç¡®çš„ä¾‹å­å’Œè§£é‡Šï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨TypeScripté¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p>
<p>åœ¨æœ¬ç¯‡æ–‡ç« ç»“æŸæ—¶ï¼Œä½ å°†å¯¹typeå’Œinterfaceä¹‹é—´çš„åŒºåˆ«æœ‰æ›´å¥½çš„ç†è§£ï¼Œä»¥åŠçŸ¥é“å¦‚ä½•åœ¨TypeScriptä»£ç ä¸­æ›´æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒä»¬ã€‚æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹å¸Œæœ›æé«˜TypeScriptæŠ€èƒ½å’Œå¸Œæœ›ç¼–å†™æ›´å¤šå¯é ä»£ç çš„webå¼€å‘è€…æœ‰æ‰€å¸®åŠ©ã€‚</p>
<h3 id="Type-vs-Interface"><a href="#Type-vs-Interface" class="headerlink" title="Type vs Interface"></a>Type vs Interface</h3><p>åœ¨TypeScriptä¸­ï¼Œtypeå’Œinterfaceéƒ½å¯ä»¥ç”¨æ¥å®šä¹‰å¯¹è±¡ç±»å‹ï¼Œä½†ä»–ä»¬åœ¨è¯­æ³•å’ŒåŠŸèƒ½ä¸Šæœ‰ä¸€äº›åŒºåˆ«ï¼Œé¦–å…ˆinterfaceæ˜¯ä¸€ä¸ªç”¨æ¥å®šä¹‰å¯¹è±¡ç±»å‹å…³é”®å­—ï¼Œå…¶è¯­æ³•æ˜¯ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">interface</span> <span class="title class_">IUser</span> &#123;
  <span class="attr">name</span>: <span class="built_in">string</span>;
  <span class="attr">age</span>: <span class="built_in">number</span>;
  ...
&#125;</code></pre>

<p>å¦ä¸€æ–¹é¢ï¼Œtypeä¹Ÿæ˜¯ä¸€ä¸ªå®šä¹‰å¯¹è±¡ç±»å‹çš„å…³é”®å­—ï¼Œå…¶è¯­æ³•æ˜¯ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">type</span> <span class="title class_">User</span> = &#123;
  <span class="attr">name</span>: <span class="built_in">string</span>;
  <span class="attr">age</span>: <span class="built_in">number</span>;
  ...
&#125;;</code></pre>

<p>è¯­æ³•å·®å¼‚ä¸å¤§ï¼Œä½†åœ¨åŠŸèƒ½ä¸Šè¿˜æœ‰å…¶ä»–å·®å¼‚ã€‚</p>
<p>interfaceå¯ä»¥æ‰©å±•å¹¶åˆ›å»ºç»§æ‰¿çˆ¶interfaceå±æ€§çš„æ–°ç±»å‹ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">interface</span> <span class="title class_">IUser</span> &#123;
  <span class="attr">name</span>: <span class="built_in">string</span>;
&#125;

<span class="keyword">interface</span> <span class="title class_">IMember</span> <span class="keyword">extends</span> <span class="title class_">IUser</span> &#123;
  <span class="attr">department</span>: <span class="built_in">string</span>;
&#125;</code></pre>

<p>è¿™å…è®¸ä½ å®šä¹‰ä¸€å¥—å¤šä¸ªç±»å‹å…±äº«çš„åŸºç¡€å±æ€§ï¼Œç„¶åæ ¹æ®éœ€è¦ä¸ºæ›´å¤šçš„ç‰¹å®šç±»å‹è¿›è¡Œæ‰©å±•ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ é¿å…ä»£ç é‡å¤ï¼Œä½¿ä½ çš„ä»£ç æ›´å…·æœ‰æ¨¡å—åŒ–å’Œç»„ç»‡ã€‚</p>
<p>è€Œtypeä¸èƒ½ä»¥åŒæ ·çš„æ–¹å¼è¢«æ‰©å±•ï¼Œä½†å®ƒå¯ä»¥ç”¨æ¥å®šä¹‰è”åˆã€äº¤å‰å’Œå…¶ä»–å¤æ‚ç±»å‹ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">type</span> <span class="title class_">Union</span> = <span class="title class_">Type1</span> | <span class="title class_">Type2</span>;

<span class="keyword">type</span> <span class="title class_">Intersection</span> = <span class="title class_">Type1</span> &amp; <span class="title class_">Type2</span>;</code></pre>

<p>è¿™äº›typeå…è®¸ä½ å®šä¹‰ç±»å‹æ›´å¤æ‚çš„å…³ç³»ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©ä½ æ›´å‡†ç¡®åœ°å»ºç«‹æ•°æ®æ¨¡å‹ã€‚</p>
<h3 id="Example-â€”-Building-a-Messaging-App"><a href="#Example-â€”-Building-a-Messaging-App" class="headerlink" title="Example â€” Building a Messaging App"></a>Example â€” Building a Messaging App</h3><p>å‡å¦‚ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæ¶ˆæ¯appï¼Œä½ æƒ³ä¸ºä¸€æ¡ä¿¡æ¯å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œå®ƒå¯ä»¥åŒ…å«æ–‡æœ¬æˆ–å›¾åƒï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè”åˆç±»å‹æ¥å®šä¹‰ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">type</span> <span class="title class_">Message</span> = &#123;
  <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span> | <span class="string">&#x27;image&#x27;</span>;
  <span class="attr">content</span>: <span class="built_in">string</span> | <span class="title class_">File</span>;
&#125;</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨typeæ¥å®šä¹‰ä¸€ä¸ªè”åˆç±»å‹ï¼Œå®ƒåªèƒ½æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å€¼ä¸­çš„ä¸€ä¸ªï¼šâ€textâ€æˆ–è€…â€imageâ€ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨è”åˆç±»å‹æ¥å®šä¹‰contentå±æ€§ï¼Œä»–å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²(text messages)æˆ–è€…æ˜¯ä¸€ä¸ªFileå¯¹è±¡(image messages)ã€‚</p>
<p>ç°åœ¨ï¼Œå‡å¦‚ä½ æƒ³åœ¨ä½ çš„appä¸­ä¸ºä¸€ç»„æ‹¥æœ‰ä¸åŒè§’è‰²çš„ç”¨æˆ·å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œæ¯”å¦‚ç®¡ç†å‘˜ã€ç‰ˆä¸»å’Œæ™®é€šç”¨æˆ·ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªäº¤å‰ç±»å‹æ¥å®šä¹‰ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">type</span> <span class="title class_">User</span> = &#123;
  <span class="attr">id</span>: <span class="built_in">number</span>;
  <span class="attr">name</span>: <span class="built_in">string</span>;
&#125;

<span class="keyword">type</span> <span class="title class_">Admin</span> = <span class="title class_">User</span> &amp; &#123;
  <span class="attr">role</span>: <span class="string">&#x27;admin&#x27;</span>;
  <span class="attr">permissions</span>: <span class="built_in">string</span>[];
&#125;

<span class="keyword">type</span> <span class="title class_">Moderator</span> = <span class="title class_">User</span> &amp; &#123;
  <span class="attr">role</span>: <span class="string">&#x27;moderator&#x27;</span>;
  <span class="attr">canDelete</span>: <span class="built_in">boolean</span>;
&#125;

<span class="keyword">type</span> <span class="title class_">RegularUser</span> = <span class="title class_">User</span> &amp; &#123;
  <span class="attr">role</span>: <span class="string">&#x27;user&#x27;</span>;
  <span class="attr">isPremium</span>: <span class="built_in">boolean</span>;
&#125;</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœ‰ä¸¤ä¸ªå±æ€§çš„ç”¨æˆ·ç±»å‹ï¼šidå’Œnameã€‚ç„¶åæˆ‘ä»¬å®šä¹‰äº†å¦å¤–ä¸‰ä¸ªç±»å‹(Adminã€Moderatorå’ŒRegularUser)ï¼Œå®ƒä»¬ä½¿ç”¨ä¸€ä¸ªäº¤å‰ç±»å‹(&amp;)æ¥æ‰©å±•Userç±»å‹ã€‚è¿™äº›ç±»å‹ä¸­æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªä¸åŒçš„roleå±æ€§å’Œé’ˆå¯¹å…¶è§’è‰²çš„é¢å¤–å±æ€§ã€‚</p>
<p>ä½¿ç”¨è”åˆç±»å‹å’Œäº¤å‰ç±»å‹å¯ä»¥å¸®åŠ©ä½ åœ¨TypeScriptä»£ç ä¸­å®šä¹‰æ›´å¤æ‚çš„ç±»å‹ï¼Œå¹¶ä½¿å…¶æ›´å®¹æ˜“å¯¹ç°å®ä¸–ç•Œçš„æ•°æ®è¿›è¡Œå»ºæ¨¡ã€‚</p>
<h3 id="Declaration-Merging"><a href="#Declaration-Merging" class="headerlink" title="Declaration Merging"></a>Declaration Merging</h3><p>interfaceè¿˜æ”¯æŒå£°æ˜åˆå¹¶ï¼Œå®ƒå…è®¸ä½ å®šä¹‰å¤šä¸ªåŒåçš„interfaceï¼Œå¹¶å°†å®ƒä»¬çš„å±æ€§åˆå¹¶åˆ°ä¸€ä¸ªinterfaceä¸­ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">interface</span> <span class="title class_">MyObject</span> &#123;
  <span class="attr">property1</span>: <span class="title class_">Type1</span>;
&#125;

<span class="keyword">interface</span> <span class="title class_">MyObject</span> &#123;
  <span class="attr">property2</span>: <span class="title class_">Type2</span>;
&#125;

<span class="keyword">const</span> <span class="attr">myObject</span>: <span class="title class_">MyObject</span> = &#123;
  <span class="attr">property1</span>: <span class="string">&#x27;value1&#x27;</span>,
  <span class="attr">property2</span>: <span class="string">&#x27;value2&#x27;</span>
&#125;;</code></pre>

<p>å½“ä½ ä¸ç¬¬ä¸‰æ–¹åº“æˆ–ç³»ç»Ÿä¸€èµ·å·¥ä½œæ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ï¼Œå®ƒä»¬åˆ†åˆ«å®šä¹‰äº†å®ƒä»¬çš„interfaceï¼Œç„¶ååœ¨éœ€è¦æ—¶æŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªinterfaceã€‚</p>
<h3 id="Example-â€”-Unleashing-the-Power-of-Declaration-Merging"><a href="#Example-â€”-Unleashing-the-Power-of-Declaration-Merging" class="headerlink" title="Example â€” Unleashing the Power of Declaration Merging"></a>Example â€” Unleashing the Power of Declaration Merging</h3><p>å‡å¦‚ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦ç”¨æˆ·ç™»å½•çš„appï¼Œä½ æƒ³ä¸ºè®¤è¯APIè¿”å›çš„ç”¨æˆ·å¯¹è±¡å®šä¹‰ä¸€ä¸ªinterfaceã€‚ä½ å¯ä»¥åƒè¿™æ ·å®šä¹‰è¿™ä¸ªinterfaceï¼š</p>
<pre><code class="highlight ts"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;
  <span class="attr">username</span>: <span class="built_in">string</span>;
  <span class="attr">email</span>: <span class="built_in">string</span>;
&#125;</code></pre>

<p>åæ¥ï¼Œä½ å‘ç°è®¤è¯APIä¹Ÿä¼šä¸ºæ¯ä¸ªç”¨æˆ·è¿”å›ä¸€ä¸ªuserIdå±æ€§ï¼Œä½†ä½ ä¸æƒ³ä¿®æ”¹åŸæ¥çš„User interfaceã€‚ç›¸åï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒåçš„æ–°interfaceï¼Œå®ƒå°†è‡ªåŠ¨å°†å±æ€§ä¸åŸæ¥çš„User interfaceåˆå¹¶ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;
  <span class="attr">userId</span>: <span class="built_in">number</span>;
&#125;

<span class="comment">// Now the User interface has three properties: username, email, and userId</span>
<span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;
  <span class="attr">username</span>: <span class="string">&#x27;john.doe&#x27;</span>,
  <span class="attr">email</span>: <span class="string">&#x27;john.doe@example.com&#x27;</span>,
  <span class="attr">userId</span>: <span class="number">123</span>
&#125;;</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†User interfaceï¼Œ æœ‰ä¸¤ä¸ªå±æ€§ï¼šusernameå’Œemailï¼Œç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ–°çš„User interfaceï¼Œå¹¶å¸¦æœ‰userIdå±æ€§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨User interfaceæ¥å®šä¹‰æˆ‘ä»¬çš„ç”¨æˆ·å¯¹è±¡æ—¶ï¼Œä¸¤ä¸ªæ¥å£çš„å±æ€§ä¼šè¢«åˆå¹¶åœ¨ä¸€èµ·ï¼Œåˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå±æ€§çš„å¯¹è±¡ï¼šusernameï¼Œemailå’ŒuserIdã€‚</p>
<p>å£°æ˜åˆå¹¶æ˜¯interfaceä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸ä¿®æ”¹åŸæœ‰å®šä¹‰çš„æƒ…å†µä¸‹æ‰©å±•ç°æœ‰interfaceã€‚</p>
<h3 id="Letâ€™s-talk-about-the-Open-x2F-Closed-Principle"><a href="#Letâ€™s-talk-about-the-Open-x2F-Closed-Principle" class="headerlink" title="Letâ€™s talk about the Open&#x2F;Closed Principle"></a>Letâ€™s talk about the Open&#x2F;Closed Principle</h3><p>å¼€é—­åŸåˆ™(OCP)ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è®¾è®¡SOLIDåŸåˆ™ä¹‹ä¸€ã€‚å®ƒå°±åƒè½¯ä»¶å¼€å‘çš„åœ£æ¯ã€‚æ¯ä¸ªäººéƒ½åœ¨è°ˆè®ºå®ƒï¼Œä½†æ˜¯ä½ ä»¬çœŸçš„äº†è§£å®ƒå—ï¼Ÿè¿˜åªæ˜¯å‡è£…äº†è§£ï¼Ÿ</p>
<p>æˆ‘å¸Œæœ›ä½ è®°ä½ï¼šSOLIDæ˜¯ä¸€ä¸ªç¼©å†™ï¼Œä»£è¡¨äº†Robert C.Martinï¼ˆä¹Ÿè¢«ç§°ä¸ºBobå”å”ï¼‰æå‡ºçš„é¢å‘å¯¹è±¡ç¼–ç¨‹è®¾è®¡çš„äº”ä¸ªåŸåˆ™ã€‚è¿™äº›åŸåˆ™ä½¿è½¯ä»¶å¼€å‘å…·æœ‰å¯ä¼¸ç¼©ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•</p>
<p>ä¹‹å‰çš„ä¾‹å­å¾ˆå¥½çš„è¯´æ˜äº†å¼€é—­åŸåˆ™ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨ä¸ä¿®æ”¹åŸæœ‰interfaceçš„æƒ…å†µä¸‹æ‰©å±•å®ƒã€‚é€šè¿‡å®šä¹‰ä¸€ä¸ªå¸¦æœ‰userIdå±æ€§çš„æ–°interfaceï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸæ¥çš„User interfaceï¼Œåœ¨ä¿æŒåŸæ¥çš„æ¥å£ä¸è¢«ä¿®æ”¹çš„åŒæ—¶è¿˜èƒ½æ‰©å±•å…¶åŠŸèƒ½ã€‚è¿™ç§æ–¹å¼éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä½¿ä½ çš„ä»£ç æ›´å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ï¼Œè€Œä¸ä¼šå¼•å…¥æ„æƒ³ä¸åˆ°çš„é—®é¢˜å’Œç ´åå¼å˜åŒ–ã€‚</p>
<p>ä½†æ˜¯ç­‰ç­‰ï¼Œè¿˜æœ‰æ›´å¤šï¼å¦‚æœä½ ä½¿ç”¨TypeScriptæˆ–å…¶ä»–å…·æœ‰å£°æ˜åˆå¹¶åŠŸèƒ½çš„è¯­è¨€ï¼Œä½ å¯ä»¥åªç”¨ä¸¤ä¸ªå±æ€§æ¥å®šä¹‰user interfaceï¼Œç„¶åç”¨userIdå±æ€§å®šä¹‰ä¸€ä¸ªæ–°çš„user interfaceï¼Œä½†ä½ ç”¨User interfaceå®šä¹‰ç”¨æˆ·å¯¹è±¡æ—¶ï¼Œä¸¤ä¸ªæ¥å£çš„å±æ€§ä¼šç¥å¥‡åœ°åˆå¹¶åœ¨ä¸€èµ·ï¼Œåˆ›å»ºä¸€ä¸ªæœ‰ä¸‰ä¸ªå±æ€§çš„å¯¹è±¡ã€‚è¿™å°±åƒé­”æœ¯ä¸€æ ·ï¼Œåªä¸è¿‡æ²¡æœ‰å…”å­ï¼Œæ›´å¤šçš„æ˜¯TypeScriptã€‚</p>
<p>ä½†æ˜¯å®é™…ä¸­ï¼Œè°æœ‰æ—¶é—´å»ç ”ç©¶OCPè¿™äº›åºŸè¯ï¼Ÿæœ‰æ—¶ä½ åªæ˜¯éœ€è¦å®Œæˆä¸€äº›åŠŸèƒ½ï¼Œè€Œä¿®æ”¹ç°æœ‰ä»£ç æ˜¯æœ€å¿«çš„åŠæ³•ã€‚è°ä¼šå…³å¿ƒOCPå‘¢ï¼Ÿå®ƒåªæ˜¯è½¯ä»¶å¼€å‘è€…å–œæ¬¢æŠ›å‡ºçš„ä¸€ä¸ªèŠ±å“¨çš„åŸåˆ™ï¼Œè®©è‡ªå·±å¬èµ·æ¥å¾ˆèªæ˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ å¿…é¡»åšçš„è¯ï¼Œå°±å»è¿åOCPå§ã€‚åªè¦ç¡®ä¿ä½ æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±è¿™æ ·åšã€‚å¦‚æœæœ‰äººé—®èµ·ï¼Œå°±å‘Šè¯‰ä»–ä»¬ä½ æ˜¯åœ¨éµå¾ªKCP(ä¿æŒæ»¡è¶³åŸåˆ™)ã€‚è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬éƒ½æ”¯æŒçš„åŸåˆ™ã€‚</p>
<h3 id="React-Component-Props"><a href="#React-Component-Props" class="headerlink" title="React Component Props"></a>React Component Props</h3><p>æ‰€ä»¥ä½ æ˜¯æƒ³ç”¨typeè¿˜æ˜¯interfaceæ¥å®šä¹‰React component propsï¼Ÿè®©æˆ‘å‘Šè¯‰ä½ ï¼Œä½ æ¥å¯¹åœ°æ–¹äº†ï¼Œæˆ‘çš„æ„æ€æ˜¯ï¼Œå½“ä½ å¯ä»¥å°†æ—¶é—´èŠ±åœ¨æ¢è®¨TypeScriptè¯­æ³•çš„ç»†å¾®å·®åˆ«æ—¶ï¼Œè°è¿˜éœ€è¦ç”Ÿæ´»å‘¢ï¼Ÿä½ å°±åƒç°ä»£çš„è‹æ ¼æ‹‰åº•ï¼Œæç€é‡è¦çš„é—®é¢˜ï¼Œæ¯”å¦‚â€œæˆ‘åº”è¯¥æ˜¯ç”¨typeè¿˜æ˜¯interfaceï¼Ÿâ€è€Œæˆ‘ä»¬è¿™äº›å‡¡äººåˆ™å¿™ç€åœ¨Tinderä¸Šå·¦æ»‘å³æ»‘ã€‚æ‰€ä»¥ï¼Œè¯·ç³»å¥½å®‰å…¨å¸¦ï¼Œæˆ‘çš„æœ‹å‹ï¼Œå› ä¸ºæˆ‘ä»¬å³å°†æ·±å…¥æ¢ç´¢React Components ç±»å‹å®šä¹‰çš„ç²¾å½©ä¸–ç•Œ</p>
<p>åœ¨Reactç»„ä»¶ä¸Šä½¿ç”¨typeè¿˜æ˜¯interfaceæ¥å®šä¹‰propsåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸€ä¸ªä¸ªäººåå¥½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªé€‰é¡¹æä¾›äº†ç›¸ä¼¼çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œåœ¨é€‰æ‹©å®ƒä»¬çš„æ—¶å€™ï¼Œæœ‰ä¸€äº›åŒºåˆ«éœ€è¦è€ƒè™‘ã€‚</p>
<p>é¦–å…ˆinterfaceæ˜¯Reactç»„ä»¶ä¸­å®šä¹‰propsçš„ä¸€ç§å¸¸ç”¨æ–¹å¼ã€‚å› ä¸ºinterfaceå…è®¸ä½ æ‰©å±•å’Œé‡ç”¨æ¥å®šä¹‰propså¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºæœ¬props interfaceï¼Œç„¶ååœ¨æ¯ä¸ªå•ç‹¬çš„ç»„ä»¶ä¸­æ‰©å±•å®ƒ</p>
<pre><code class="highlight ts"><span class="keyword">interface</span> <span class="title class_">Props</span> &#123;
  className?: <span class="built_in">string</span>;
  onClick?: <span class="function">() =&gt;</span> <span class="built_in">void</span>;
&#125;

<span class="keyword">interface</span> <span class="title class_">ButtonProps</span> <span class="keyword">extends</span> <span class="title class_">Props</span> &#123;
  <span class="keyword">type</span>?: <span class="string">&#x27;button&#x27;</span> | <span class="string">&#x27;submit&#x27;</span> | <span class="string">&#x27;reset&#x27;</span>;
&#125;

<span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; className, onClick, <span class="keyword">type</span> &#125;: ButtonProps</span>) &#123;
  <span class="comment">// render button with props</span>
&#125;</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåŒ…å«classNameå’ŒonClickå±æ€§çš„interfaceã€‚ç„¶åæˆ‘ä»¬æ‰©å±•è¿™ä¸ªinterfaceï¼Œåˆ›å»ºäº†ä¸€ä¸ªButtonProps interfaceï¼Œå¢åŠ äº†ä¸€ä¸ªå¯é€‰çš„type propã€‚ç„¶åç”¨è¿™ä¸ªinterfaceæ¥å®šä¹‰Buttonç»„ä»¶çš„propsã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå½“ä½ éœ€è¦å®šä¹‰æ›´å¤æ‚çš„ç±»å‹æ—¶ï¼Œæ¯”å¦‚è”åˆæˆ–è€…äº¤å‰ç±»å‹æ—¶ï¼Œtypeå°±å¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨typeæ¥å®šä¹‰ä¸€ä¸ªsize optionsï¼Œä»£è¡¨ä¸€ä¸ªç»„ä»¶çš„ä¸åŒsizeé€‰é¡¹ã€‚</p>
<pre><code class="highlight ts"><span class="keyword">type</span> <span class="title class_">Size</span> = <span class="string">&#x27;small&#x27;</span> | <span class="string">&#x27;medium&#x27;</span> | <span class="string">&#x27;large&#x27;</span>;

<span class="keyword">interface</span> <span class="title class_">Props</span> &#123;
  <span class="attr">size</span>: <span class="title class_">Size</span>;
&#125;

<span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; size &#125;: Props</span>) &#123;
  <span class="comment">// render component with props</span>
&#125;</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨typeå®šä¹‰äº†ä¸€ä¸ªsizeç±»å‹ï¼Œä»£è¡¨ç»„ä»¶çš„ä¸åŒå°ºå¯¸ã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨props interfaceæ¥å®šä¹‰size propï¼Œè¦æ±‚æ˜¯å¿…é¡»çš„å¹¶ä¸”æ˜¯å°ºå¯¸ç±»å‹ä¸­çš„ä¸€ä¸ªã€‚</p>
<p>é€šå¸¸ï¼Œä½¿ç”¨interfaceæ˜¯å®šä¹‰ç®€å•propsçš„å¥½é€‰æ‹©ï¼Œå¯ä»¥æ‰©å±•æˆ–é‡å¤ä½¿ç”¨ï¼Œè€Œä½¿ç”¨typeæ˜¯å®šä¹‰å¤æ‚ç±»å‹çš„å¥½é€‰æ‹©ã€‚</p>
<p>æ€»ä¹‹ï¼Œtypeå’Œinterfaceéƒ½å¯ä»¥ç”¨æ¥Reactç»„ä»¶ä¸­å®šä¹‰propsï¼Œä½†å®ƒä»¬åœ¨åŠŸèƒ½ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚interfaceå¯ä»¥æ‰©å±•æˆ–é‡å¤ä½¿ç”¨ï¼Œè€Œtypeå¯¹äºå®šä¹‰æ›´å¤æ‚çš„ç±»å‹å¾ˆæœ‰ç”¨ã€‚æœ€ç»ˆï¼Œåœ¨typeå’Œinterfaceä¹‹é—´é€‰æ‹©æ˜¯ä¸€ä¸ªä¸ªäººåå¥½å’Œä½ é¡¹ç›®å…·ä½“éœ€æ±‚çš„é—®é¢˜ã€‚</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œinterfaceç»å¸¸è¢«ç”¨æ¥å®šä¹‰å¯¹è±¡çš„ç»“æ„ï¼Œå¹¶ä½œä¸ºå…¶ä»–ç³»ç»Ÿæˆ–åº“çš„interfaceã€‚å¦ä¸€æ–¹é¢ï¼Œtypeç»å¸¸ç”¨æ¥å®šä¹‰æ›´å¤æ‚çš„ç±»å‹ï¼Œå¦‚è”åˆã€äº¤å‰æˆ–æ˜ å°„ç±»å‹ï¼Œæˆ–è€…å®šä¹‰ä¸èƒ½ç”¨interfaceè¡¨è¾¾çš„ç±»å‹ï¼Œå¦‚å‡½æ•°ç±»å‹æˆ–æ¡ä»¶ç±»å‹ã€‚</p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Indistinguishable AI content is crippling our perception</title>
    <url>/2023/07/21/%E3%80%90%E7%BF%BB%E3%80%91Indistinguishable-AI-content-is-crippling-our-perception/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://uxdesign.cc/indistinguishable-ai-content-is-crippling-our-perception-f2b24c7cd311">Indistinguishable AI content is crippling our perception</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@arvindsanjeev">Arvind Sanjeev</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><img src="https://miro.medium.com/v2/resize:fit:1400/1*JzBgspzi8LOngxpNKCiX8Q.gif"></p>
<p>åœ¨2020å¹´ï¼Œä¸€åå¤§å­¦ç”Ÿ Liam Porr åˆ©ç”¨ <a href="https://www.technologyreview.com/2020/08/14/1006780/ai-gpt-3-fake-blog-reached-top-of-hacker-news/">GPT-3åˆ›å»ºäº†ä¸€ä¸ªå‡çš„åšå®¢</a>ï¼Œå¹¶ç™»ä¸Šäº† hacker news çš„æ¦œå•ç¬¬ä¸€ã€‚ä»–é€šè¿‡ä½¿ç”¨å‡å â€œadolosâ€, ç”Ÿæˆ productivity å’Œ self-help ç›¸å…³ä¸»é¢˜çš„å†…å®¹ï¼Œå‡ ä¹ä¸ç”¨ç¼–è¾‘å°±è¿›è¡Œå‘å¸ƒã€‚ç„¶åç¤¾åŒºè®ºå›ä¸­çš„è¯»è€…ä¸çŸ¥é“è¿™æ˜¯ä¸€ä¸ªAIç”Ÿæˆçš„åšå®¢ï¼Œå¯¹å…¶è¿›è¡ŒæŠ•ç¥¨ï¼ŒLiam åæ¥æ‰¿è®¤ï¼Œè¿™æ˜¯å®éªŒçš„ä¸€éƒ¨åˆ†ï¼Œç›®çš„æ˜¯çœ‹çœ‹GPT-3æ˜¯å¦èƒ½å†’å……äººç±»ä½œå®¶ã€‚è¿™å¹¶ä¸æ˜¯ç¬¬ä¸€æ¬¡ç”¨AIå–ä»£äººç±»ä½œå®¶ï¼›ã€ŠLA Timesã€‹ä»2014å¹´èµ·å°±å¼€å§‹<a href="https://www.bbc.com/news/technology-26614051">ä½¿ç”¨æœºå™¨äººç¼–å†™æ–°é—»æ–‡ç« </a>ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hCs1KwkiDFBbQf8ubKowJA.png"></p>
<ul>
<li>ä½ èƒ½ä»è¿™ä¸¤å¼ å›¾ç‰‡ä¸­åˆ†è¾¨å‡ºAIç”Ÿæˆçš„å©´å„¿å—ï¼Ÿ(ç­”æ¡ˆåœ¨é¡µé¢åº•éƒ¨)</li>
</ul>
<blockquote>
<p>åˆ°2025å¹´æˆ–2030å¹´ï¼Œäº’è”ç½‘ä¸Šä¼šæœ‰90%çš„å†…å®¹éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„å†…å®¹ä¼šå¤§å¤§å¢åŠ å¯ç”¨å†…å®¹çš„æ•°é‡<br>â€” Nina Shick, Deep Fakes and the Infocalypse</p>
</blockquote>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTJnlZtrPgMmNPieO1Q2Tw.png"></p>
<p>å¦‚ä»Šï¼ŒDeepFaceLab ç­‰å·¥å…·å¯ä»¥è®©ä»»ä½•äººåˆ¶ä½œæ”¿æ²»å€™é€‰äººçš„è§†é¢‘å¹¶åœ¨ç½‘ä¸Šä¼ æ’­ï¼ŒDisrupt å¯ä»¥è®©ä½ æ¨¡ä»¿ä»»ä½•äººçš„å£°éŸ³ï¼ŒGPT å¯ä»¥è®©ä½ ç¼–å†™å‡æ–°é—»ï¼›è¿™äº›å·¥å…·åŠ åœ¨ä¸€èµ·å°±å¯ä»¥æˆä¸ºä¸€ä¸ªå‡æ–°é—»å‘å¸ƒæœºå™¨ã€‚ç°åœ¨ï¼Œä¸€ä¸ªäººåªè¦æŒæ¡äº†è¿™äº›æœºå™¨å°±å¯ä»¥ç›´æ¥å•ç‹¬ç ´ç¯ç°å®ä¸–ç•Œã€‚ â€“ æ“çºµé€‰ä¸¾ï¼Œæ•£æ’­è™šå‡å®£ä¼ ï¼Œä¼ªé€ è™šå‡è‰²æƒ…è§†é¢‘ï¼Œåˆ¶é€ é˜´è°‹è®ºç­‰ã€‚</p>
<h2 id="Volatile-democracy"><a href="#Volatile-democracy" class="headerlink" title="Volatile democracy"></a>Volatile democracy</h2><p><strong>æ”¿å®¢ä»¬å®³æ€• Deepfakeï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å¾ˆå®¹æ˜“è¢«ç”¨äºæ“çºµé€‰ä¸¾ç»“æœã€‚</strong></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/X17yrEV5sl4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>2022å¹´3æœˆï¼Œåœ¨Facebook å’Œ Youtube ä¸Šå‡ºç°äº†ä¸€æ®µ<a href="https://www.wired.com/story/zelensky-deepfake-facebook-twitter-playbook/">ä¼ªé€ çš„ Volodymyr Zelensky è§†é¢‘</a>ï¼Œåœ¨è¿™ä¸ªè§†é¢‘ä¸­ï¼Œä»–å®£å¸ƒå¯¹ä¿„ç½—æ–¯çš„å…¥ä¾µæŠ•é™ï¼Œå¹¶è¦æ±‚ä¹Œå…‹å…°å†›é˜Ÿæ”¾ä¸‹æ­¦å™¨ã€‚ä¸è¿‡ï¼Œè¿™æ®µè§†é¢‘å¹¶ä¸ä»¤äººç›¸ä¿¡ã€‚ä»–çš„ä¸ŠåŠèº«ä¸€åŠ¨ä¸åŠ¨ï¼Œè¯­æ°”ä¹Ÿæœ‰æ‰€ä¸åŒã€‚ä½†å¯¹äºæ²¡æœ‰ç»å†è¿‡çš„äººæ¥è¯´ï¼Œè¿™è¶³ä»¥é€ æˆå›°æƒ‘å’Œææ…Œã€‚è¿™æ˜¯ Deepfake é¦–æ¬¡åœ¨æ­¦è£…å†²çªä¸­è¢«ç”¨ä½œæ­¦å™¨ã€‚</p>
<blockquote>
<p>â€œDemocracies appear to be gravely threatened by the speed at which disinformation can be created and spread via social media, where the incentive to share the most sensationalist content outweighs the incentive to perform the tiresome work of verification.â€<br>Source: <a href="https://www.theguardian.com/technology/ng-interactive/2019/jun/22/the-rise-of-the-deepfake-and-the-threat-to-democracy">Politicians fear this like fire</a>, The Guardian</p>
</blockquote>
<p>å‡æ–°é—»è¿‡å»æ›¾è¢«ç”¨æ¥å½±å“<a href="https://news.stanford.edu/2017/01/18/stanford-study-examines-fake-news-2016-presidential-election/">ç¾å›½å¤§é€‰</a>ï¼Œè€Œéšç€æ–°çš„ç”Ÿæˆå¼AIå·¥å…·å‡ºç°ï¼Œå®ƒå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
<h2 id="DeepFake-porn"><a href="#DeepFake-porn" class="headerlink" title="DeepFake porn"></a>DeepFake porn</h2><p><strong>è‰²æƒ…æŠ¥å¤å·²ç»è¢«æ¨å‘ä¸€ä¸ªå…¨æ–°çš„å±‚æ¬¡ã€‚</strong></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/0*OhWBGf1BTwDzjyJz.gif"></p>
<p>åœ¨ä¹‹å‰çš„<a href="https://medium.com/@arvindsanjeev/ai-sociopaths-and-their-unintended-consequences-bf6f19012e4f">ä»‹ç»æ–‡ç« </a>ä¸­ï¼Œæˆ‘åˆ†äº«äº† Rana çš„æ•…äº‹ï¼Œå¥¹æ˜¯ä¸€ä¸ªå°åº¦çš„è°ƒæŸ¥è®°è€…ï¼Œå¥¹çš„å¯¹æ‰‹é€šè¿‡<a href="https://www.huffingtonpost.co.uk/entry/deepfake-porn_uk_5bf2c126e4b0f32bd58ba316"> deepfake è‰²æƒ…æ´»åŠ¨</a>å¯¹å¥¹è¿›è¡Œäº†æ”»å‡»ã€‚ä¸å¥¹çš„æ•…äº‹ç±»ä¼¼ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå…³äº<a href="https://vimeo.com/492572852">å¥³æ€§çš„é‡‡è®¿</a>ï¼Œå¥¹ä»¬ç«™å‡ºæ¥åˆ†äº«äº† deepfake å·¥å…·æ˜¯å¦‚ä½•é’ˆå¯¹å¥¹ä»¬å¹¶åˆ¶ä½œè¯½è°¤è§†é¢‘ã€‚è‰²æƒ…æŠ¥å¤å·²ç»ä¸Šå‡åˆ°äº†å¦ä¸€ä¸ªé«˜åº¦ï¼Œå¦‚ä»Šä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ä½ çš„ä¸€å¼ ç…§ç‰‡å»ç”Ÿæˆä¸€äº›è§†é¢‘ç„¶åå‘åˆ°ç½‘ä¸Šã€‚æ®ç ”ç©¶å…¬å¸ Sensity AI ä¼°è®¡ï¼Œ90%åˆ°95%çš„åœ¨çº¿ deepfake è§†é¢‘éƒ½æ˜¯æœªç»åŒæ„çš„è‰²æƒ…è§†é¢‘ï¼Œå…¶ä¸­90%ä»¥å¥³æ€§ä¸ºä¸»è§’ã€‚è¿™äº›å·¥å…·å¤§å¤šå·²è¢«ç¦æ­¢ï¼Œæ”¿åºœå’Œæ‰§æ³•æœºæ„ä»åœ¨åŠªåŠ›è¿½èµ¶å’Œéåˆ¶è¿™ç§ä½¿ç”¨è¡Œä¸ºã€‚</p>
<p>MIT Technology Review çš„ Karen Hao å¯¹è¿™ä¸ªè¯é¢˜è¿›è¡Œäº†æœ‰åŠ›çš„æŠ¥é“ï¼š</p>
<ul>
<li><a href="https://www.technologyreview.com/2021/09/13/1035449/ai-deepfake-app-face-swaps-women-into-porn/">A horrifying new AI app swaps women into porn videos with a click</a></li>
<li><a href="https://www.technologyreview.com/2019/06/28/134352/an-ai-app-that-undressed-women-shows-how-deepfakes-harm-the-most-vulnerable/">An AI app that â€œundressedâ€ women shows how deepfakes harm the most vulnerable</a></li>
<li><a href="https://www.technologyreview.com/2020/10/20/1010789/ai-deepfake-bot-undresses-women-and-underage-girls/">A deepfake bot is being used to â€œundressâ€ underage girls</a></li>
<li><a href="https://www.technologyreview.com/2021/02/12/1018222/deepfake-revenge-porn-coming-ban/">Deepfake porn is ruining womenâ€™s lives. Now the law may finally ban it</a></li>
</ul>
<h2 id="Bringing-the-dead-back-to-life"><a href="#Bringing-the-dead-back-to-life" class="headerlink" title="Bringing the dead back to life"></a>Bringing the dead back to life</h2><p><strong>Chatbots å’Œ deepfake æ¨¡ä»¿ä½ å·²æ•…çš„äº²äºº</strong></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*jMW-J7oZYG9HnVOvUwaqLQ.gif"></p>
<p>åƒ Microsoft å’Œ Amazon ç­‰å…¬å¸æ­£åœ¨ç«ç›¸å°†æ­»è€…å¤æ´»ã€‚å°±åƒã€Šé»‘é•œã€‹ä¸­ä¸€æ ·ï¼Œå…¬å¸ä¼šåˆ©ç”¨æˆ‘ä»¬<a href="https://www.vice.com/en/article/bvmqbv/founder-youll-soon-be-able-to-talk-to-your-dead-mom-in-the-metaverse-thanks-to-chatgpt">å·²æ•…äº²äººçš„æ•°æ®å»è®­ç»ƒchatbots</a>ã€‚äºšé©¬é€Šçš„ä¸€æ®µè§†é¢‘å±•ç¤ºäº†Alexaå¦‚ä½•è¡¨ç°å‡ºä¸€ä¸ªå­©å­å·²æ•…ç¥–æ¯çš„å£°éŸ³ï¼Œå¹¶ç»™ä»–è®²æ•…äº‹ï¼š</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/22cb24-sGhg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>Somnium Space æ˜¯ä¸€å®¶æ„å»ºè™šæ‹Ÿä¸–ç•Œçš„VR å…¬å¸ï¼Œå®ƒæä¾›äº†ä¸€ç§<a href="https://www.vice.com/en/article/pkp47y/metaverse-company-to-offer-immortality-through-live-forever-mode">æ°¸ç”Ÿæ¨¡å¼</a>ã€‚é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œå³ä½¿ä½ æ­»äº†ï¼Œäººä»¬ä¹Ÿå¯ä»¥æ ¹æ®ä½ ä¹‹å‰æ”¶é›†çš„æ•°æ®ç»§ç»­ä¸ä½ çš„åŒ–èº«äº’åŠ¨ã€‚</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ihEEjwRlghQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯çºªå½•ç‰‡ã€ŠRoadrunnerã€‹ï¼Œè¯¥ç‰‡è®²è¿°äº†å»ä¸–çš„è‘—åå¨å¸ˆ Anthony Bourdain çš„ç”Ÿå¹³ã€‚çºªå½•ç‰‡ä¸­çš„ç”»å¤–éŸ³æ˜¯ç”±æ ¹æ® Anthony çš„å£°éŸ³è®­ç»ƒå‡ºæ¥çš„AI model å®Œæˆçš„ï¼›ç„¶è€Œï¼Œ<a href="https://www.washingtonpost.com/arts-entertainment/2021/07/16/anthony-bourdain-documentary-ai-deepfake/">ä»–çš„é—å­€å’Œå®¶äººå¹¶ä¸æ»¡æ„</a>ã€‚è¿™å°±å¼•å‘äº†ä¸€åœºå…³äºâ€œè°èƒ½æ§åˆ¶é€è€…æ•°æ®â€çš„å¤§è®¨è®ºã€‚<a href="https://www.reuters.com/article/us-britain-dataprotection-privacy-analys-idUSKCN1Q304F">å¤§å¤šæ•°å›½å®¶çš„æ•°å­—å¾€ç”Ÿæ”¿ç­–</a>å…è®¸äº²å±åœ¨æå‡ºç”³è¯·åè®¿é—®è¿™äº›æ•°æ®ã€‚ä½†å¤§æ•°æ®å…¬å¸æ˜¯å¦å¯ä»¥ç»§ç»­ä½¿ç”¨è¿™äº›æ•°æ®æ¥è®­ç»ƒ AI ï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šï¼›å¦‚æœæ— äººè®¤é¢†ï¼Œä¹Ÿæ²¡æœ‰æ³•å¾‹è§„å®šè°æ‹¥æœ‰è¿™äº›æ•°æ®ã€‚</p>
<h2 id="Replacing-Celebrities"><a href="#Replacing-Celebrities" class="headerlink" title="Replacing Celebrities"></a>Replacing Celebrities</h2><p><strong>ä¸å†æœ‰äººç±»æ¼”å‘˜</strong></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8GXIT5qvQH0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p><a href="https://www.wired.com/story/bruce-willis-deepfake-rights-law/">è°æ‹¥æœ‰äº† Bruce Willis </a>ï¼Ÿè¿™ä½æ¼”å‘˜æœ€è¿‘åˆ¶ä½œäº†è‡ªå·±çš„æ•°å­—æ¨¡å‹ï¼Œå¹¶åˆ†äº«ç»™ä¸€å®¶ä¿„ç½—æ–¯å¹¿å‘Šå…¬å¸åˆ¶ä½œäº†ä¸Šé¢çš„å¹¿å‘Šã€‚Bruce Willis è¢«è¯Šæ–­ä¸ºæ‚£æœ‰å¤±è¯­ç—‡ï¼Œè¿™æ˜¯ä¸€ç§è€å¹´ç—´å‘†ç—‡ï¼Œè¿™è®©ä»–ä¸å¾—ä¸åœ¨å»å¹´é€€ä¼‘ï¼›ä¸è¿‡ï¼Œé€šè¿‡ deepfakesï¼Œä»–å¯ä»¥ç»§ç»­æ¼”æˆï¼Œå‡†å¤‡å¥½çœ‹ã€ŠDie Hard 47ã€‹äº†å—ï¼Ÿ</p>
<p>è®½åˆºçš„æ˜¯ï¼Œ<a href="https://restofworld.org/2023/ai-voice-acting/">é…éŸ³æ¼”å‘˜æ­£åœ¨å¸®åŠ©è®­ç»ƒå³å°†å–ä»£ä»–ä»¬çš„AI</a>ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œæœ‰äº†äººå·¥æ™ºèƒ½ï¼Œ<a href="https://www.wired.com/story/simpsons-voice-actors-ai-deepfakes/">ã€Šè¾›æ™®æ£®ä¸€å®¶ã€‹å¯ä»¥æ— é™æœŸåœ°æ’­æ”¾ä¸‹å»</a>ã€‚ä½†è¿™ä¹Ÿå¼•å‡ºäº†ä¸€ä¸ªæ›´å¤§çš„é—®é¢˜ï¼Œä¸€ä¸ªåäººç­¾ç½²äº†åœ¨åª’ä½“ä¸­ä½¿ç”¨å…¶æ¨¡å‹çš„æƒåˆ©ï¼Œè¿™æ˜¯å¦é¢„ç¤ºç€æˆ‘ä»¬çš„æœªæ¥ä¸å†éœ€è¦äººç±»æ¼”å‘˜ï¼Ÿå…¨çƒå„åœ°çš„æ¼”å‘˜å·¥ä¼šéƒ½åœ¨ç«­åŠ›è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯â€<a href="https://losttapesofthe27club.com/">Lost Tapes of the 27 Club</a>â€œï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ©ç”¨AIç”Ÿæˆæ–°æ›²ç›®çš„éŸ³ä¹é¡¹ç›®ï¼Œè¿™äº›æ›²ç›®æ¥è‡ªä¸ç²¾ç¥å¥åº·é—®é¢˜ä½œæ–—äº‰å¹¶åœ¨27å²å»ä¸–çš„éŸ³ä¹å®¶ï¼Œå…¶ä¸­åŒ…æ‹¬Cobainï¼ŒJimi Hendrixï¼ŒJim Morrisonå’ŒAmy Winehouseã€‚</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/muT6x7VXx5I" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<h2 id="Whoâ€™s-fighting-back"><a href="#Whoâ€™s-fighting-back" class="headerlink" title="Whoâ€™s fighting back?"></a>Whoâ€™s fighting back?</h2><p>è¿™æ˜¯å‡ ä¸ªæ”¿ç­–å’Œå®éªŒçš„ä¾‹å­ï¼Œè¯•å›¾å‡è½» deepfakes é€ æˆçš„ä¼¤å®³</p>
<h3 id="Policies-and-frameworks"><a href="#Policies-and-frameworks" class="headerlink" title="Policies and frameworks"></a>Policies and frameworks</h3><ul>
<li><a href="https://www.congress.gov/bill/116th-congress/house-bill/3230">Deepfakes Accountability Act</a>: åœ¨2019å¹´ï¼Œç¾å›½ä¼—è®®å‘˜ Yvette Clarkeæå‡ºäº†è¿™é¡¹æ³•æ¡ˆï¼Œä»¥æ‰“å‡» deepfake è‰²æƒ…å†…å®¹</li>
<li><a href="https://leginfo.legislature.ca.gov/faces/billTextClient.xhtml?bill_id=201920200AB730">AB 730</a>, ç¾å›½å·é•¿ Gavin Newsom ç­¾ç½²äº†åŠ å·ç¬¬ 730 å·æ³•æ¡ˆï¼Œå³â€œ<a href="https://www.wired.com/story/opinion-californias-anti-deepfake-law-is-far-too-feeble/">Anti-Deepfake Bill</a>â€ï¼Œä½¿å…¶æˆä¸ºæ³•å¾‹ç”¨æ¥éåˆ¶2020å¹´å¤§é€‰å‰çš„ deepfakes ä¼ æ’­</li>
<li><a href="https://nvlpubs.nist.gov/nistpubs/ai/NIST.AI.100-1.pdf">The Aritificial Intelligence Risk Management Framework</a>ï¼šNISTçš„è¿™ä¸ªæ¡†æ¶ä¸ºç®¡ç†<a href="https://www.nist.gov/news-events/news/2023/01/nist-risk-management-framework-aims-improve-trustworthiness-artificial">AIçš„è®¸å¤šé£é™©</a>æä¾›äº†æŒ‡å¯¼</li>
</ul>
<h3 id="New-Turing-tests"><a href="#New-Turing-tests" class="headerlink" title="New Turing tests"></a>New Turing tests</h3><p>æ£€æµ‹AIç¼–å†™çš„å†…å®¹çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€å°±æ˜¯è®­ç»ƒå¦ä¸€ä¸ªAIæ¥åšè¿™ä»¶äº‹ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªä¾‹å­ï¼š</p>
<ul>
<li><a href="https://gptzero.me/">GPTZero</a></li>
<li><a href="https://techcrunch.com/2022/12/10/openais-attempts-to-watermark-ai-text-hit-limits/">ç»™AIç”Ÿæˆçš„å†…å®¹åŠ æ°´å°</a>ï¼Œä½œè€… Scott Aaronsonï¼Œ Open AIï¼š</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/fc-cHk9yFpg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><a href="https://openai-openai-detector--mqlck.hf.space/">Jong Wook</a> å’Œ <a href="https://detectgpt.ericmitchell.ai/">Eric Mitchell</a> çš„ GPT2 æ¢æµ‹å™¨</li>
</ul>
<p>å„å›½æ”¿åºœä¹Ÿåœ¨ç«ç›¸èµ„åŠ©èƒ½å¤Ÿè¾¨åˆ«AIç”Ÿæˆå†…å®¹çš„å·¥å…·ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆå¼AIå…¬å¸DeepMediaå°±è·å¾—äº†ä¸€ç¬”ç¾å›½æ‹¨æ¬¾ï¼Œç”¨äºå¼€å‘äººå·¥æ™ºèƒ½è¾…åŠ©æŠ€æœ¯ï¼Œä»¥å‰”é™¤é”™è¯¯ä¿¡æ¯ï¼Œæ»¡è¶³ DoD çš„å›½å®¶å®‰å…¨éœ€æ±‚ã€‚</p>
<hr>
<p>æœ¬æ–‡å¼€å¤´çš„äººå·¥æ™ºèƒ½ç”Ÿæˆå›¾ç‰‡é—®é¢˜çš„ç­”æ¡ˆæ˜¯å·¦è¾¹çš„å©´å„¿ã€‚æ¥æºï¼š<a href="https://loremfaces.com/">Lorem Faces</a> å’Œ <a href="https://thispersonexists.net/">ThisPersonExists</a></p>
<p>åœ¨å°è¯•è¿™ä¸ªç»ƒä¹ çš„äººä¸­ï¼Œæœ‰50%çš„äººç­”æ¡ˆé”™è¯¯ï¼Œè€Œ100%çš„äººæ„Ÿåˆ°å›°æƒ‘ã€‚æˆ‘ä»¬ä¸å†æœ‰èƒ½åŠ›åˆ†è¾¨AIç”Ÿæˆçš„å†…å®¹ï¼Œ<a href="https://www.wsj.com/articles/chatgpt-creator-releases-tool-to-detect-ai-generated-text-calls-it-unreliable-11675204820">ä¸“å®¶ä»¬ä¹Ÿå¯¹æˆ‘ä»¬æ˜¯å¦æœ‰èƒ½åŠ›åˆ†è¾¨AIç”Ÿæˆçš„å†…å®¹æŒæ€€ç–‘æ€åº¦</a>ã€‚ç„¶è€Œï¼Œé€šè¿‡å¯¹AIç”Ÿæˆå·¥å…·è¿›è¡Œé“å¾·è®¾è®¡ï¼Œå†åŠ ä¸Šå¹¿æ³›çš„è®¤çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘å±•å‡ºä¸€ç§æ–°çš„èƒ½åŠ›ï¼šå¯¹æˆ‘ä»¬æ‰€çœ‹åˆ°çš„å†…å®¹æå‡ºè´¨ç–‘çš„èƒ½åŠ›ã€‚</p>
<blockquote>
<p>Something strange is afoot. In the hyper-connected, data-deluged present, schisms emerge in mass perception. Weâ€™re all looking at the same skies, but weâ€™re seeing different things. Where I see covert deportations and secret surveillance planes â€” supported by flight logs and ADS-B data, newspaper reports and Freedom of Information requests â€” others see a global conspiracy to doctor the atmosphere, to control minds, to enslave populations, or to reengineer the climate for naive or nefarious purposes.<br>â€” James Bridle, New Dark Age</p>
</blockquote>
<p>æœ‰å…³æ­¤ä¸»é¢˜åŠå…¶ä»–ä¸»é¢˜çš„æ›´å¤šèµ„æºï¼Œè¯·æŸ¥é˜…æœ¬æ‰‹å†Œ<a href="https://arvindsanjeev.notion.site/arvindsanjeev/The-Handbook-of-AI-s-Unintended-Consequences-720cda3d8cec49dc88807641157a0bba">ã€ŠAIâ€™s unintended consequencesã€‹</a>ã€‚æœ¬æ–‡æ˜¯æ¢è®¨ <a href="https://medium.com/@arvindsanjeev/ai-sociopaths-and-their-unintended-consequences-bf6f19012e4f">unintended consequences of AI å››éƒ¨ç³»åˆ—æ–‡ç« </a>ä¸­çš„ç¬¬ä¸€ç« </p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>AI</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Next.js 13</title>
    <url>/2023/09/24/%E3%80%90%E7%BF%BB%E3%80%91Next-js-13/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://nextjs.org/blog/next-13">Next.js 13</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>æ­£å¦‚æˆ‘ä»¬åœ¨ <a href="">Next.js Conf</a> ä¸Šå®£å¸ƒçš„é‚£æ ·ï¼ŒNext.js13(stable)ä¸ºå®ç°æ— é™åˆ¶çš„åŠ¨æ€åŠŸèƒ½è€Œå¥ å®šäº†åŸºç¡€ï¼š</p>
<ul>
<li>app Directory(beta): æ›´ç®€å•ï¼Œæ›´å¿«é€Ÿï¼Œå®¢æˆ·ç«¯ JS å†…å®¹æ›´å°‘<ul>
<li>Layouts</li>
<li>React Server Components</li>
<li>Streaming</li>
</ul>
</li>
<li>Turbopack(alpha): åŸºäº Rust çš„ Webpack æ›¿ä»£å“å¯æœ€é«˜æå‡700å€çš„é€Ÿåº¦ã€‚</li>
<li>New next&#x2F;image: ä½¿ç”¨æœ¬åœ°æµè§ˆå™¨æ‡’åŠ è½½ï¼Œé€Ÿåº¦æ›´å¿«ã€‚</li>
<li>New @next&#x2F;font(beta): è‡ªåŠ¨æ‰˜ç®¡å­—ä½“ï¼Œå¸ƒå±€é›¶åç§»ã€‚</li>
<li>Improved next&#x2F;link: è‡ªåŠ¨<code>&lt;a&gt;</code>é“¾æ¥ï¼Œç®€åŒ–APIã€‚</li>
</ul>
<p>Next.js å’Œ page directory å·²ç¨³å®šå¹¶å¯ç”¨äºç”Ÿäº§ã€‚è¯·è¿è¡Œ</p>
<pre><code class="highlight bash">npm i next@latest react@latest react-dom@latest eslint-config-next@latest</code></pre>

<h2 id="New-app-Directory-Beta"><a href="#New-app-Directory-Beta" class="headerlink" title="New app Directory(Beta)"></a>New app Directory(Beta)</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ”¹è¿› Next.js ä¸­çš„è·¯ç”±å’Œå¸ƒå±€ä½“éªŒï¼Œå¹¶é€šè¿‡å¼•å…¥ app directory å’Œ React çš„æœªæ¥ä¿æŒä¸€è‡´ã€‚è¿™æ˜¯åœ¨ä¹‹å‰ä¸ºå¾æ±‚ç¤¾åŒºåé¦ˆè€Œå‘å¸ƒçš„ Layouts RFC ä¹‹åçš„åˆä¸€æ¬¡æ”¹è¿›ã€‚</p>
<p>app directory ç›®å‰å¤„äº beta é˜¶æ®µï¼Œæˆ‘ä»¬è¿˜ä¸å»ºè®®åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚ä½ å¯ä»¥åœ¨Nextjs.13ä¸­ä½¿ç”¨ pages directory å’Œæ”¹è¿›çš„ next&#x2F;image å’Œ next&#x2F;link ç»„ä»¶ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„è¿›åº¦é€‰æ‹© app directoryã€‚åœ¨æœªæ¥ï¼Œå°†ç»§ç»­æ”¯æŒ pages directoryã€‚</p>
<p>app directory åŒ…æ‹¬ä»¥ä¸‹æ”¯æŒï¼š</p>
<ul>
<li>Layouts: åœ¨è·¯ç”±ä¹‹é—´è½»æ¾å…±äº«ç”¨æˆ·ç•Œé¢ï¼ŒåŒæ—¶ä¿ç•™çŠ¶æ€å¹¶é¿å…æ˜‚è´µçš„é‡æ–°æ¸²æŸ“ã€‚</li>
<li>Server Components: å°†æœåŠ¡å™¨ä¼˜å…ˆä½œä¸ºåŠ¨æ€åº”ç”¨çš„é»˜è®¤è®¾ç½®ã€‚</li>
<li>Streaming: åœ¨æ¸²æŸ“æ—¶ä»¥ç”¨æˆ·ç•Œé¢ä¸ºå•ä½æ˜¾ç¤ºå³æ—¶åŠ è½½çŠ¶æ€å’Œæ•°æ®æµã€‚</li>
<li>Support for Data Fetching: async æœåŠ¡å™¨ç»„ä»¶å’Œæ‰©å±•çš„ fetch API å¯å®ç°ç»„ä»¶çº§æ•°æ®è·å–ã€‚</li>
</ul>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/layouts-rfc/app-folder.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<h3 id="Layouts"><a href="#Layouts" class="headerlink" title="Layouts"></a>Layouts</h3><p>é€šè¿‡ <code>app/</code> ç›®å½•ï¼Œå¯ä»¥è½»æ¾å®ç°å¸ƒå±€å¤æ‚çš„ç•Œé¢ï¼Œåœ¨å¯¼èˆªè¿‡ç¨‹ä¸­ä¿æŒçŠ¶æ€ï¼Œé¿å…æ˜‚è´µçš„é‡æ–°æ¸²æŸ“ï¼Œå¹¶å¯ç”¨é«˜çº§è·¯ç”±æ¨¡å¼ã€‚æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥åµŒå¥—å¸ƒå±€ï¼Œå¹¶å°† app ä»£ç ä¸è·¯ç”±ï¼ˆå¦‚ç»„ä»¶ã€testså’Œstylesï¼‰æ”¾åœ¨ä¸€èµ·ã€‚</p>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/colocating-assets-in-the-app-directory.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>åœ¨ <code>app/</code> å†…åˆ›å»ºè·¯ç”±åªéœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå³ page.js:</p>
<pre><code class="highlight js"><span class="comment">// This file maps to the index route (/)</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, Next.js!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;
&#125;</code></pre>

<p>ä½ å¯ä»¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿå®šä¹‰å¸ƒå±€ã€‚å¸ƒå±€åœ¨å¤šä¸ªé¡µé¢ä¹‹é—´å…±äº«ç”¨æˆ·ç•Œé¢ã€‚åœ¨å¯¼èˆªæ—¶ï¼Œå¸ƒå±€ä¼šä¿ç•™çŠ¶æ€ï¼Œä¿æŒäº¤äº’æ€§ï¼Œå¹¶ä¸”ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BlogLayout</span>(<span class="params">&#123; children &#125;</span>) &#123;
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>;
&#125;</code></pre>

<h3 id="Server-Components"><a href="#Server-Components" class="headerlink" title="Server Components"></a>Server Components</h3><p><code>app/</code> ç›®å½•å¼•å…¥äº†å¯¹Reactæ–°æœåŠ¡å™¨ç»„ä»¶æ¶æ„çš„æ”¯æŒã€‚æœåŠ¡å™¨ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶åˆ†åˆ«åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å……åˆ†å‘æŒ¥å®ƒä»¬å„è‡ªçš„ä¼˜åŠ¿ï¼Œä½¿ä½ èƒ½å¤Ÿå•ç‹¬ä½¿ç”¨å•ä¸€çš„ç¼–ç¨‹æ¨¡å‹æ„å»ºå¿«é€Ÿã€é«˜åº¦äº¤äº’å¼çš„åº”ç”¨ç¨‹åºï¼Œæä¾›å‡ºè‰²çš„å¼€å‘è€…ä½“éªŒã€‚</p>
<p>åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ„å»ºå¤æ‚çš„ç•Œé¢å¥ å®šäº†åŸºç¡€ï¼ŒåŒæ—¶å‡å°‘äº†å‘é€åˆ°å®¢æˆ·ç«¯çš„JavaScriptæ•°é‡ï¼Œä»è€ŒåŠ å¿«äº†åˆå§‹é¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚</p>
<p>åŠ è½½è·¯ç”±æ—¶ï¼Œå°†ä¼šåŠ è½½ Next.js å’Œ React runtime, è¯¥ runtime å¯ç¼“å­˜ä¸”å¤§å°å¯é¢„æµ‹ã€‚runtimeçš„å¤§å°ä¸ä¼šéšç€åº”ç”¨çš„å¢é•¿è€Œå¢åŠ ã€‚æ­¤å¤–ï¼Œruntime æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œå› æ­¤å¯ä»¥åœ¨å®¢æˆ·ç«¯é€æ­¥å¢å¼ºæœåŠ¡å™¨ä¸Šçš„HTML</p>
<h3 id="Streaming"><a href="#Streaming" class="headerlink" title="Streaming"></a>Streaming</h3><p><code>app/</code> ç›®å½•å¼•å…¥äº†é€æ­¥æ¸²æŸ“å’Œå¢é‡å¼æµå¼ä¼ è¾“ç”¨æˆ·ç•Œé¢å•å…ƒåˆ°å®¢æˆ·ç«¯çš„åŠŸèƒ½ã€‚</p>
<p>åˆ©ç”¨ Next.js ä¸­çš„æœåŠ¡å™¨ç»„ä»¶å’ŒåµŒå¥—å¸ƒå±€ï¼Œä½ å¯ä»¥ç«‹å³å‘ˆç°é¡µé¢ä¸­ä¸éœ€è¦æ•°æ®çš„éƒ¨åˆ†ï¼Œå¹¶ä¸ºæ­£åœ¨è·å–æ•°æ®çš„é¡µé¢æ˜¾ç¤ºåŠ è½½çŠ¶æ€ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…æ•´ä¸ªé¡µé¢åŠ è½½å®Œæ¯•ï¼Œå°±å¯ä»¥å¼€å§‹ä¸é¡µé¢è¿›è¡Œäº¤äº’ã€‚</p>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/streaming.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>éƒ¨ç½²åˆ°Vercelåï¼Œä½¿ç”¨<code>app/</code>ç›®å½•çš„ Next.js åº”ç”¨å°†é»˜è®¤åœ¨Node.jså’ŒEdgeè¿è¡Œæ—¶ä½¿ç”¨æµå¼å“åº”ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</p>
<h3 id="Data-Fetching"><a href="#Data-Fetching" class="headerlink" title="Data Fetching"></a>Data Fetching</h3><p>Reactæœ€è¿‘å‘å¸ƒçš„ <a href="https://github.com/acdlite/rfcs/blob/first-class-promises/text/0000-first-class-support-for-promises.md">Support for Promises RFC</a> ä¸ºåœ¨ç»„ä»¶å†…è·å–æ•°æ®å’Œå¤„ç†Promiseå¼•å…¥äº†ä¸€ç§å¼ºå¤§çš„æ–°æ–¹æ³•ï¼š</p>
<pre><code class="highlight js"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/...&#x27;</span>);
  <span class="comment">// The return value is *not* serialized</span>
  <span class="comment">// You can return Date, Map, Set, etc.</span>
  <span class="keyword">return</span> res.<span class="title function_">json</span>();
&#125;
 
<span class="comment">// This is an async Server Component</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getData</span>();
 
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span>&#123;/* ... */&#125;<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>;
&#125;</code></pre>

<p>React å’Œ Next.js ä¸­ä¹Ÿæ‰©å±•äº†æœ¬åœ° fetch APIã€‚å®ƒèƒ½å¤Ÿè‡ªåŠ¨å¯¹ fetch requests è¿›è¡Œé‡å¤è®¡ç®—ï¼Œå¹¶æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼åœ¨ç»„ä»¶çº§è·å–ã€ç¼“å­˜å’Œé‡æ–°éªŒè¯æ•°æ®ã€‚è¿™æ„å‘³ç€SSGï¼ŒSSRï¼ŒISRçš„æ‰€æœ‰ä¼˜ç‚¹ç°åœ¨éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªAPIè·å¾—ï¼š</p>
<pre><code class="highlight js"><span class="comment">// This request should be cached until manually invalidated.</span>
<span class="comment">// Similar to `getStaticProps`.</span>
<span class="comment">// `force-cache` is the default and can be omitted.</span>
<span class="title function_">fetch</span>(<span class="variable constant_">URL</span>, &#123; <span class="attr">cache</span>: <span class="string">&#x27;force-cache&#x27;</span> &#125;);
 
<span class="comment">// This request should be refetched on every request.</span>
<span class="comment">// Similar to `getServerSideProps`.</span>
<span class="title function_">fetch</span>(<span class="variable constant_">URL</span>, &#123; <span class="attr">cache</span>: <span class="string">&#x27;no-store&#x27;</span> &#125;);
 
<span class="comment">// This request should be cached with a lifetime of 10 seconds.</span>
<span class="comment">// Similar to `getStaticProps` with the `revalidate` option.</span>
<span class="title function_">fetch</span>(<span class="variable constant_">URL</span>, &#123; <span class="attr">next</span>: &#123; <span class="attr">revalidate</span>: <span class="number">10</span> &#125; &#125;);</code></pre>

<p>åœ¨ app ç›®å½•ä¸­ï¼Œä½ å¯ä»¥åœ¨layoutsï¼Œpagesï¼Œcomponentsä¸­è·å–æ•°æ®ï¼ŒåŒ…æ‹¬æ”¯æŒä»æœåŠ¡å™¨è·å–æµå¼å“åº”ã€‚</p>
<p>æˆ‘ä»¬æ­£åœ¨å¯ç”¨ç¬¦åˆäººä½“å·¥å­¦çš„æ–¹å¼æ¥å¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€ï¼Œå¹¶åœ¨æ¸²æŸ“ç”¨æˆ·ç•Œé¢æ—¶å¯¹å…¶è¿›è¡Œæµå¼å¤„ç†ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†æ”¹è¿›å’Œç®€åŒ–æ•°æ®çªå˜ã€‚</p>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/streaming.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>æˆ‘ä»¬å¾ˆé«˜å…´èƒ½ä¸å¼€æºç¤¾åŒºã€åŒ…ç»´æŠ¤è€…ä»¥åŠå…¶ä»–ä¸º React ç”Ÿæ€ç³»ç»Ÿåšå‡ºè´¡çŒ®çš„å…¬å¸åˆä½œï¼Œå…±åŒæ‰“é€  React å’Œ Next.js çš„æ–°æ—¶ä»£ã€‚æˆ‘ä»¬å¾ˆé«˜å…´èƒ½åœ¨ <code>app/</code> ç›®å½•ä¸­åŠ å…¥ä¸¤ä¸ªé‡è¦çš„ç¤¾åŒºåé¦ˆï¼Œä¸€æ˜¯åœ¨ç»„ä»¶å†…éƒ¨é›†ä¸­æ•°æ®è·å–çš„èƒ½åŠ›ï¼ŒäºŒæ˜¯å‘å®¢æˆ·ç«¯å‘é€æ›´å°‘çš„ JavaScript ã€‚</p>
<h2 id="Introducing-Turbopack-Alpha"><a href="#Introducing-Turbopack-Alpha" class="headerlink" title="Introducing Turbopack (Alpha)"></a>Introducing Turbopack (Alpha)</h2><p>Next.js åŒ…å« Turbopack, å®ƒæ˜¯åŸºäºRustçš„Webpackæ›¿ä»£å“</p>
<p>Webpackå·²ç»è¢«ä¸‹è½½è¶…è¿‡30äº¿æ¬¡ï¼Œè™½ç„¶å®ƒä¸€ç›´æ˜¯æ„å»ºWebçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘ä»¬è¾¾åˆ°äº†åŸºäºJavaScriptçš„å·¥å…·æ‰€èƒ½è¾¾åˆ°çš„æœ€é«˜æ€§èƒ½æé™ã€‚</p>
<p>åœ¨Next.js12ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹å‘Rusté©±åŠ¨çš„å·¥å…·è¿‡æ¸¡ã€‚é¦–å…ˆæ˜¯è¿ç§»äº†Babelï¼Œè½¬è¯‘é€Ÿåº¦æé«˜äº†17å€ã€‚ç„¶åï¼Œæ›¿æ¢äº†Terserï¼Œå‹ç¼©é€Ÿåº¦æé«˜äº†6å€ã€‚æ˜¯æ—¶å€™å…¨éƒ¨ä½¿ç”¨åŸç”Ÿå·¥å…·è¿›è¡Œç»‘å®šäº†ã€‚</p>
<p>åœ¨ Next.js13 ä¸­ä½¿ç”¨ Turbopack alpha çš„ç»“æœæ˜¯ï¼š</p>
<ul>
<li>æ›´æ–°é€Ÿåº¦æ¯”Webpackå¿«700å€</li>
<li>æ›´æ–°é€Ÿåº¦æ¯”Viteå¿«10å€</li>
<li>å†·å¯åŠ¨é€Ÿåº¦æ¯”Webpackå¿«4å€</li>
</ul>
<p><img src="https://nextjs.org/_next/image?url=/static/blog/next-13/turbopack.png&w=3840&q=75&dpl=dpl_Cbau7EMekJRyZrPGm1DKP4FVgwP6"></p>
<p>Turbopack åªæ†ç»‘å¼€å‘ä¸­æ‰€éœ€çš„æœ€å°èµ„æºï¼Œæ‰€ä»¥å¯åŠ¨æ—¶é—´æçŸ­ã€‚åœ¨ä¸€ä¸ªåŒ…å«3000ä¸ªmodulesçš„åº”ç”¨ä¸­ï¼ŒTurbopackåªéœ€1.8ç§’å³å¯å¯åŠ¨ã€‚Vite éœ€è¦11.4ç§’ï¼ŒWebpackéœ€è¦16.5ç§’ã€‚</p>
<p>Turbopackå¼€ç®±å³ç”¨ï¼Œæ”¯æŒæœåŠ¡å™¨ç»„ä»¶ã€TypeScriptã€JSXã€CSSç­‰ã€‚åœ¨alphaé˜¶æ®µï¼Œ<a href="https://turbo.build/pack/docs/features">è®¸å¤šåŠŸèƒ½</a>å°šä¸æ”¯æŒã€‚æˆ‘ä»¬å¸Œæœ›å¬åˆ°ä½ å¯¹ä½¿ç”¨ Turbopack å¿«é€Ÿæœ¬åœ°è¿­ä»£è¿‡ç¨‹çš„åé¦ˆ</p>
<blockquote>
<p>Note: Next.jsä¸­çš„ Turbopack ç›®å‰åªæ”¯æŒ <code>next dev</code>ã€‚æŸ¥çœ‹<a href="https://turbo.build/pack/docs/features">æ”¯æŒçš„åŠŸèƒ½</a>ã€‚æˆ‘ä»¬è¿˜åœ¨åŠªåŠ›é€šè¿‡ Turbopack å¢åŠ å¯¹ next build çš„æ”¯æŒ</p>
</blockquote>
<p>ä½¿ç”¨<code>next dev --turbo</code>åœ¨ Next.js13 ä¸­è¯•ç”¨ Turbopack alphaã€‚</p>
<h2 id="next-x2F-image"><a href="#next-x2F-image" class="headerlink" title="next&#x2F;image"></a>next&#x2F;image</h2><p>Next.js13 å¼•å…¥äº†åŠŸèƒ½å¼ºå¤§çš„æ–°Imageç»„ä»¶ï¼Œè®©ä½ å¯ä»¥è½»æ¾æ˜¾ç¤ºå›¾åƒè€Œæ— éœ€æ”¹å˜å¸ƒå±€ï¼Œå¹¶æŒ‰éœ€ä¼˜åŒ–æ–‡ä»¶ä»¥æé«˜æ€§èƒ½ã€‚</p>
<p>åœ¨ Next.js ç¤¾åŒºè°ƒæŸ¥ä¸­ï¼Œ70%çš„å—è®¿è€…å‘Šè¯‰æˆ‘ä»¬ï¼Œä»–ä»¬åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨äº† Next.js çš„ Image ç»„ä»¶ï¼Œå¹¶çœ‹åˆ°äº† Core Web Vitals çš„æ”¹è¿›ã€‚åœ¨ Next.js13 ä¸­ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ”¹è¿› next&#x2F;imageã€‚</p>
<p>æ–°çš„ Image ç»„ä»¶ï¼š</p>
<ul>
<li>å‡å°‘å®¢æˆ·ç«¯ JavaScript</li>
<li>æ›´æ˜“äºè®¾è®¡å’Œé…ç½®</li>
<li>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨<code>alt</code>æ ‡è®°æ›´æ˜“äºè®¿é—®</li>
<li>ä¸Webå¹³å°ä¿æŒä¸€è‡´</li>
<li>å› ä¸ºæœ¬åœ°æ‡’åŠ è½½ä¸éœ€è¦ hydrationï¼Œå› æ­¤é€Ÿåº¦æ›´å¿«</li>
</ul>
<pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">Image</span> <span class="keyword">from</span> <span class="string">&#x27;next/image&#x27;</span>;
<span class="keyword">import</span> avatar <span class="keyword">from</span> <span class="string">&#x27;./lee.png&#x27;</span>;
 
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;
  <span class="comment">// &quot;alt&quot; is now required for improved accessibility</span>
  <span class="comment">// optional: image files can be colocated inside the app/ directory</span>
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">alt</span>=<span class="string">&quot;leeerob&quot;</span> <span class="attr">src</span>=<span class="string">&#123;avatar&#125;</span> <span class="attr">placeholder</span>=<span class="string">&quot;blur&quot;</span> /&gt;</span></span>;
&#125;</code></pre>

<h3 id="Upgrading-next-x2F-image-to-Next-js-13"><a href="#Upgrading-next-x2F-image-to-Next-js-13" class="headerlink" title="Upgrading next&#x2F;image to Next.js 13"></a>Upgrading next&#x2F;image to Next.js 13</h3><p>æ—§çš„ Image ç»„ä»¶å·²æ›´åä¸º <code>next/legacy/image</code>ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªcodemodï¼Œå®ƒå°†è‡ªåŠ¨æŠŠä½ ç°æœ‰çš„ next&#x2F;image æ›´æ–°ä¸º <code>next/legacy/image</code>ã€‚ä¾‹å¦‚ï¼Œå½“ä»æ ¹ç›®å½•è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œå°†åœ¨ <code>./pages</code> ç›®å½•ä¸­è¿è¡Œ codemod:</p>
<pre><code class="highlight bash">npx @next/codemod next-image-to-legacy-image ./pages</code></pre>

<h2 id="next-x2F-font"><a href="#next-x2F-font" class="headerlink" title="@next&#x2F;font"></a>@next&#x2F;font</h2><p>Next.js å¼•å…¥äº†å…¨æ–°çš„å­—ä½“ç³»ç»Ÿï¼š</p>
<ul>
<li>è‡ªåŠ¨ä¼˜åŒ–ä½ çš„å­—ä½“ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰å­—ä½“</li>
<li>ç§»é™¤å¤–éƒ¨ç½‘ç»œè¯·æ±‚ï¼Œæé«˜ç§å¯†æ€§å’Œæ€§èƒ½</li>
<li>å†…ç½®è‡ªåŠ¨æ‰˜ç®¡åŠŸèƒ½ï¼Œå¯æ‰˜ç®¡ä»»ä½•å­—ä½“æ–‡ä»¶</li>
<li>ä½¿ç”¨CSS <code>size-adjust</code> å±æ€§è‡ªåŠ¨å®ç°é›¶å¸ƒå±€åç§»</li>
</ul>
<p>æ–°çš„å­—ä½“ç³»ç»Ÿå¯ä»¥è®©ä½ æ–¹ä¾¿çš„ä½¿ç”¨æ‰€æœ‰ Google å­—ä½“ï¼ŒåŒæ—¶å…¼é¡¾æ€§èƒ½å’Œéšç§ã€‚CSSå’Œå­—ä½“æ–‡ä»¶åœ¨æ„å»ºæ—¶ä¸‹è½½ï¼Œå¹¶äºå…¶ä»–é™æ€èµ„æºä¸€èµ·è‡ªè¡Œæ‰˜ç®¡ã€‚æµè§ˆå™¨ä¸ä¼šå‘ Google å‘é€ä»»ä½•è¯·æ±‚ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">Inter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@next/font/google&#x27;</span>;
 
<span class="keyword">const</span> inter = <span class="title class_">Inter</span>();
 
<span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">className</span>=<span class="string">&#123;inter.className&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span>;</code></pre>

<p>è‡ªå®šä¹‰å­—ä½“ä¹Ÿæ”¯æŒï¼ŒåŒ…æ‹¬æ”¯æŒå­—ä½“æ–‡ä»¶çš„è‡ªåŠ¨æ‰˜ç®¡ã€ç¼“å­˜å’Œé¢„åŠ è½½ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> localFont <span class="keyword">from</span> <span class="string">&#x27;@next/font/local&#x27;</span>;
 
<span class="keyword">const</span> myFont = <span class="title function_">localFont</span>(&#123; <span class="attr">src</span>: <span class="string">&#x27;./my-font.woff2&#x27;</span> &#125;);
 
<span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">className</span>=<span class="string">&#123;myFont.className&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span>;</code></pre>

<p>ä½ å¯ä»¥è‡ªå®šä¹‰å­—ä½“åŠ è½½è¿‡ç¨‹çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œå¹¶ä¸”ç¡®ä¿å‡ºè‰²çš„æ€§èƒ½å’Œå¸ƒå±€ä¸å˜ï¼ŒåŒ…æ‹¬ <code>font-display</code>ï¼Œé¢„åŠ è½½ï¼Œå›é€€ç­‰ã€‚</p>
<h2 id="next-x2F-link"><a href="#next-x2F-link" class="headerlink" title="next&#x2F;link"></a>next&#x2F;link</h2><p><code>next/link</code> ä¸å†éœ€è¦æ‰‹åŠ¨æ·»åŠ <code>&lt;a&gt;</code>ä½œä¸ºå­ä»£ã€‚</p>
<p>è¿™ä¸ªåŠŸèƒ½ä¹‹å‰æ˜¯åœ¨12.2ä¸­ä½œä¸º expreimental option æ·»åŠ çš„ï¼Œç°åœ¨æ˜¯é»˜è®¤é€‰é¡¹ã€‚åœ¨ Next.js13 ä¸­ï¼Œ<code>&lt;Link&gt;</code>æ€»æ˜¯æ¸²æŸ“<code>&lt;a&gt;</code>ï¼Œå¹¶å…è®¸ä½ å°†propså‘é€åˆ°åº•å±‚æ ‡ç­¾ä¸Šã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span>
 
<span class="comment">// Next.js 12: `&lt;a&gt;` has to be nested otherwise it&#x27;s excluded</span>
&lt;<span class="title class_">Link</span> href=<span class="string">&quot;/about&quot;</span>&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>
&lt;/<span class="title class_">Link</span>&gt;
 
<span class="comment">// Next.js 13: `&lt;Link&gt;` always renders `&lt;a&gt;`</span>
<span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span></span>
<span class="language-xml">  About</span>
<span class="language-xml"><span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></code></pre>

<h3 id="Upgrading-next-x2F-link-to-Next-js-13"><a href="#Upgrading-next-x2F-link-to-Next-js-13" class="headerlink" title="Upgrading next&#x2F;link to Next.js 13"></a>Upgrading next&#x2F;link to Next.js 13</h3><p>å°† links å‡çº§åˆ° Next.js13ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªcodemodï¼Œå¯ä»¥è‡ªåŠ¨æ›´æ–° codebaseã€‚æ¯”å¦‚åœ¨æ ¹ç›®å½•è¿è¡Œæ­¤å‘½ä»¤ï¼Œå°†åœ¨<code>./pages</code>ç›®å½•ä¸­è¿è¡Œcodemodï¼š</p>
<pre><code class="highlight bash">npx @next/codemod new-link ./pages</code></pre>

<h2 id="OG-Image-Generation"><a href="#OG-Image-Generation" class="headerlink" title="OG Image Generation"></a>OG Image Generation</h2><p>ç¤¾äº¤å¡ç‰‡ï¼Œä¹Ÿå¯ç§°ä¸ºå¼€æ”¾å›¾å›¾åƒï¼Œå¯ä»¥å¤§å¤§æé«˜å†…å®¹ç‚¹å‡»çš„å‚ä¸ç‡ï¼Œä¸€äº›å®éªŒæ˜¾ç¤ºè½¬åŒ–ç‡æœ€é«˜å¯æé«˜40%ã€‚</p>
<p>é™æ€ç¤¾äº¤å¡è€—æ—¶ã€æ˜“å‡ºé”™ä¸”éš¾ç»´æŠ¤ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œç¤¾äº¤å¡ç»å¸¸è¢«å¿½ç•¥ç”šè‡³è·³è¿‡ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦ä¸ªæ€§åŒ–å’Œå³æ—¶è®¡ç®—çš„åŠ¨æ€ç¤¾äº¤å¡æ—¢å›°éš¾åˆæ˜‚è´µã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°åº“ <code>@vercel/og</code>, å¯ä¸ Next.js æ— ç¼åä½œï¼Œç”ŸæˆåŠ¨æ€çš„ç¤¾äº¤å¡ç‰‡ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">ImageResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@vercel/og&#x27;</span>;
 
<span class="keyword">export</span> <span class="keyword">const</span> config = &#123;
  <span class="attr">runtime</span>: <span class="string">&#x27;experimental-edge&#x27;</span>,
&#125;;
 
<span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ImageResponse</span>(
    (
      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span>
<span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span>
<span class="tag"><span class="language-xml">          <span class="attr">display:</span> &#x27;<span class="attr">flex</span>&#x27;,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">fontSize:</span> <span class="attr">128</span>,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">background:</span> &#x27;<span class="attr">white</span>&#x27;,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span>
<span class="tag"><span class="language-xml">          <span class="attr">height:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span>
<span class="tag"><span class="language-xml">        &#125;&#125;</span></span>
<span class="tag"><span class="language-xml">      &gt;</span></span>
<span class="language-xml">        Hello, World!</span>
<span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
    ),
  );
&#125;</code></pre>

<p>è¿™ä¸ªæ–¹æ³•æ¯”ç°æœ‰è§£å†³æ–¹æ³•å¿«5å€ã€‚é€šè¿‡ä½¿ç”¨ Vercel Edge Functionsã€WebAssembly å’Œç”¨äºå°† HTML å’Œ CSS è½¬æ¢ä¸ºå›¾åƒçš„å…¨æ–°æ ¸å¿ƒåº“ï¼Œå¹¶åˆ©ç”¨ React ç»„ä»¶æŠ½è±¡ã€‚</p>
<h2 id="Middleware-API-Updates"><a href="#Middleware-API-Updates" class="headerlink" title="Middleware API Updates"></a>Middleware API Updates</h2><p>åœ¨ Next.js12 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸­é—´ä»¶ï¼Œä½¿ Next.js è·¯ç”±å…·æœ‰å……åˆ†çš„çµæ´»æ€§ã€‚ç„¶åæˆ‘ä»¬å¬å–äº†å¤§å®¶å¯¹åˆå§‹ API è®¾è®¡çš„åé¦ˆæ„è§ï¼Œå¹¶å¢åŠ äº†ä¸€äº›æ–°å†…å®¹ï¼Œä»¥æ”¹å–„å¼€å‘äººå‘˜çš„ä½“éªŒï¼Œå¹¶æ·»åŠ äº†å¼ºå¤§çš„æ–°åŠŸèƒ½ã€‚</p>
<p>ç°åœ¨ä½ å¯ä»¥æ›´è½»æ¾åœ°åœ¨è¯·æ±‚ä¸­è®¾ç½® headersï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">NextResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next/server&#x27;</span>;
<span class="keyword">import</span> type &#123; <span class="title class_">NextRequest</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next/server&#x27;</span>;
 
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">middleware</span>(<span class="params">request: NextRequest</span>) &#123;
  <span class="comment">// Clone the request headers and set a new header `x-version`</span>
  <span class="keyword">const</span> requestHeaders = <span class="keyword">new</span> <span class="title class_">Headers</span>(request.<span class="property">headers</span>);
  requestHeaders.<span class="title function_">set</span>(<span class="string">&#x27;x-version&#x27;</span>, <span class="string">&#x27;13&#x27;</span>);
 
  <span class="comment">// You can also set request headers in NextResponse.rewrite</span>
  <span class="keyword">const</span> response = <span class="title class_">NextResponse</span>.<span class="title function_">next</span>(&#123;
    <span class="attr">request</span>: &#123;
      <span class="comment">// New request headers</span>
      <span class="attr">headers</span>: requestHeaders,
    &#125;,
  &#125;);
 
  <span class="comment">// Set a new response header `x-version`</span>
  response.<span class="property">headers</span>.<span class="title function_">set</span>(<span class="string">&#x27;x-version&#x27;</span>, <span class="string">&#x27;13&#x27;</span>);
  <span class="keyword">return</span> response;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œä½ è¿˜å¯ä»¥ç›´æ¥åœ¨ä¸­é—´ä»¶ä¸­æä¾›å“åº”ï¼Œæ— éœ€ <code>rewrite</code> å’Œ <code>redirect</code>ã€‚</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">NextRequest</span>, <span class="title class_">NextResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next/server&#x27;</span>;
<span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&#x27;@lib/auth&#x27;</span>;
 
<span class="comment">// Limit the middleware to paths starting with `/api/`</span>
<span class="keyword">export</span> <span class="keyword">const</span> config = &#123;
  <span class="attr">matcher</span>: <span class="string">&#x27;/api/:function*&#x27;</span>,
&#125;;
 
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">middleware</span>(<span class="params">request: NextRequest</span>) &#123;
  <span class="comment">// Call our authentication function to check the request</span>
  <span class="keyword">if</span> (!<span class="title function_">isAuthenticated</span>(request)) &#123;
    <span class="comment">// Respond with JSON indicating an error message</span>
    <span class="keyword">return</span> <span class="title class_">NextResponse</span>.<span class="title function_">json</span>(
      &#123;
        <span class="attr">success</span>: <span class="literal">false</span>,
        <span class="attr">message</span>: <span class="string">&#x27;Auth failed&#x27;</span>,
      &#125;,
      &#123;
        <span class="attr">status</span>: <span class="number">401</span>,
      &#125;,
    );
  &#125;
&#125;</code></pre>

<p>ä»ä¸­é—´ä»¶å‘é€å“åº”ç›®å‰éœ€è¦ä½¿ç”¨ <code>next.config.js</code> ä¸­çš„ <code>experimental.allowMiddlewareResponseBody</code> é…ç½®é¡¹ã€‚</p>
]]></content>
      <tags>
        <tag>Next.js</tag>
        <tag>React</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘On Styling Web Components</title>
    <url>/2023/06/17/%E3%80%90%E7%BF%BB%E3%80%91On%20Styling%20Web%20Components/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://blog.webf.zone/on-styling-web-components-b74b8c70c492">On Styling Web Components</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@mistyHarsh">Harshal Patil</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>ä»¥æ­£ç¡®çš„æ–¹å¼è¿›è¡Œ â€” ä½¿ç”¨CSSOM</p>
<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*nrlNnE1jCyNVqNQllN1Qzw.png"></p>
<p>æ›´å¥½çš„å°è£…æ€§å¯èƒ½æ˜¯ä½ å¼€å§‹ä½¿ç”¨Web Componentsçš„ä¸»è¦åŸå› ã€‚ç‰¹åˆ«æ˜¯ï¼ŒShadowDOMæ˜¯å®ç°çœŸæ­£å°è£…æ€§çš„æœºåˆ¶ã€‚å¤šå¹´æ¥ï¼ŒWebç¤¾åŒºå‘æ˜äº†ä¸€äº›æ–¹æ¡ˆæ¥ä¿®å¤å’Œæ”¹å–„CSSå’ŒJSçš„å…¨å±€ç‰¹æ€§ï¼Œè¿™äº›è§£å†³æ–¹æ¡ˆè™½èµ·ä½œç”¨äº†ä½†å¹¶ä¸å®Œç¾ã€‚ç›´åˆ°æœ‰äº†Shadow DOMï¼Œæˆ‘ä»¬æ‰çœŸæ­£å®ç°äº†CSSçš„å®Œç¾ä½œç”¨åŸŸã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šæ¢ç´¢å¦‚ä½•å°†æ ·å¼åº”ç”¨åˆ°Web Componentsä¸Šï¼Œå¹¶å°è¯•æ‰¾åˆ°æœ€åˆé€‚çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†å°è¯•å°†æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆå’Œå½“å‰çš„æ„å»ºå·¥å…·ç›¸ç»“åˆã€‚</p>
<h2 id="The-naive-way-â€”-Plain-lt-style-gt-tag"><a href="#The-naive-way-â€”-Plain-lt-style-gt-tag" class="headerlink" title="The naive way â€” Plain &lt;style&gt; tag"></a>The naive way â€” Plain <code>&lt;style&gt;</code> tag</h2><p>åœ¨ä½¿ç”¨Shadow DOMæ—¶ï¼Œä¸ºäº†ä½¿ style sheet å‘æŒ¥ä½œç”¨ï¼Œç›®å‰æ˜¯è¦åœ¨æ¯ä¸ªshadow rootä¸­ä½¿ç”¨<code>&lt;style&gt;</code> å…ƒç´ ï¼Œåœ¨å¤§å¤šæ•°æ–‡ç« ä¸­ï¼Œéƒ½ä¼šå¾ˆè¡¨é¢çš„è¯´å‡ºè¿™ä¸ªæ–¹æ¡ˆ</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">FancyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;

  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;
    <span class="variable language_">super</span>();

    <span class="keyword">const</span> shadowRoot = <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span> &#125;);

    shadowRoot.<span class="property">innerHTML</span> = <span class="string">`</span>
<span class="string">      &lt;!-- Styles are scoped --&gt;</span>
<span class="string">      &lt;style&gt;</span>
<span class="string">        p &#123; color: red; &#125;</span>
<span class="string">      &lt;/style&gt;</span>
<span class="string">      &lt;div&gt;</span>
<span class="string">        &lt;p&gt;Hello World&lt;/p&gt;</span>
<span class="string">      &lt;/div&gt;</span>
<span class="string">    `</span>;
  &#125;
&#125;

customElements.<span class="title function_">define</span>(<span class="string">&#x27;fancy-comp&#x27;</span>, <span class="title class_">FacyComponent</span>);</code></pre>

<p>è¿™ä¸ªè§£å†³åŠæ³•ç®€å•ç›´æ¥ï¼Œç„¶è€Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>å¯¹äºé¡µé¢ä¸­æ·»åŠ çš„æ¯ä¸ªç»„ä»¶å®ä¾‹ï¼Œæµè§ˆå™¨éƒ½ä¼šè§£æå®ƒçš„æ ·å¼è¡¨è§„åˆ™ã€‚</p>
</blockquote>
<p>è¿™å¯¹æ€§èƒ½ä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼Œæ¯”å¦‚æ—¶é—´å¢åŠ å’Œå†…å­˜å¢åŠ ã€‚æ—¶é—´ä¼šå¢åŠ æ˜¯å› ä¸ºæµè§ˆå™¨éœ€è¦è§£ææ›´å¤šçš„åŸå§‹å­—ç¬¦ä¸²ï¼Œå†…å­˜æˆæœ¬å¢åŠ æ˜¯å› ä¸ºæ¯ä¸ªç»„ä»¶éƒ½ä¼šå­˜å‚¨æ ·å¼è§„åˆ™ã€‚æµè§ˆå™¨æ²¡æœ‰åŠæ³•çŸ¥é“åŒä¸€ä¸ªç»„ä»¶çš„ä¸¤ä¸ªå®ä¾‹æ˜¯å¦å…±äº«ç›¸åŒçš„æ ·å¼ã€‚</p>
<blockquote>
<p>åŸä½œè€…æ›´æ–°ï¼šEric Bidelmanåœ¨è¯„è®ºä¸­æŒ‡å‡ºï¼Œæ€§èƒ½æ–¹é¢ä¸ä¸€å®šä¼šå½±å“ã€‚æµè§ˆå™¨å¯èƒ½åœ¨å†…éƒ¨è¿›è¡Œä¼˜åŒ–ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœ¨æ¯æ¬¡åˆ›å»ºå®ä¾‹æ—¶è§£ææ ·å¼æ ‡ç­¾ã€‚äº‹å®ä¸Šï¼ŒBlinkï¼ˆChromeã€Operaç­‰ï¼‰å¼•æ“å·²ç»å¯¹æ­¤è¿›è¡Œäº†ä¼˜åŒ–</p>
</blockquote>
<h2 id="Can-we-do-something-better"><a href="#Can-we-do-something-better" class="headerlink" title="Can we do something better?"></a>Can we do something better?</h2><p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ ·å¼èŠ‚ç‚¹ï¼Œç„¶ååœ¨ç»„ä»¶çš„æ¯ä¸ªå®ä¾‹ä¸­è¿›è¡Œæ·±åº¦å…‹éš†ï¼Œæ¥é˜²æ­¢æ ·å¼è§„åˆ™çš„é‡æ–°è§£æï¼š</p>
<pre><code class="highlight js"><span class="comment">// Create style node outside of WebComponent</span>
<span class="keyword">const</span> style = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;style&#x27;</span>);

style.<span class="property">innerHTML</span> = <span class="string">`</span>
<span class="string">  p &#123; color: blue; &#125;</span>
<span class="string">`</span>;

<span class="keyword">class</span> <span class="title class_">FancyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;

  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;
    <span class="variable language_">super</span>();

    <span class="keyword">const</span> shadowRoot = <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span> &#125;);

    shadowRoot.<span class="property">innerHTML</span> = <span class="string">`</span>
<span class="string">      &lt;div&gt;</span>
<span class="string">        &lt;p&gt;Hello World&lt;/p&gt;</span>
<span class="string">      &lt;/div&gt;</span>
<span class="string">    `</span>;

    <span class="comment">// Let us try to optimize</span>
    <span class="comment">// Deep cloning of style node</span>
    <span class="keyword">const</span> clonedStyle = style.<span class="title function_">cloneNode</span>(<span class="literal">true</span>);

    shadowRoot.<span class="title function_">appendChild</span>(clonedStyle);
  &#125;
&#125;</code></pre>

<p>ä¸è¿‡ï¼Œè¿™ç§æ–¹æ³•è™½ç„¶å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯ä»ç„¶æœ‰é—®é¢˜ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œå®ƒä¸èƒ½çœŸæ­£çš„å¸®åŠ©æˆ‘ä»¬åœ¨ç»„ä»¶å®ä¾‹é—´å…±äº«æ ·å¼ã€‚æ–°çš„æ ·å¼èŠ‚ç‚¹ä»ç„¶ä¼šåˆ›å»º</li>
<li>å…¶æ¬¡è¿™ä¸ªæ–¹æ³•ä¸ <strong>lit-html</strong> å’Œ <strong>hyperHTML</strong> ç­‰å£°æ˜å¼è§£å†³æ–¹æ¡ˆä¸€èµ·ä½¿ç”¨æœ‰ç‚¹å°´å°¬ã€‚</li>
</ul>
<h2 id="Enter-the-Constructible-Stylesheets"><a href="#Enter-the-Constructible-Stylesheets" class="headerlink" title="Enter the Constructible Stylesheets"></a>Enter the Constructible Stylesheets</h2><p>é¡¾åæ€ä¹‰ï¼Œå¯æ„å»ºçš„æ ·å¼è¡¨å…è®¸åœ¨ä½¿ç”¨Shadow DOMæ—¶åˆ›å»ºå’Œå…±äº«æ ·å¼ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5R11T84I-Fd0JBzOur2AQ.png"></p>
<pre><code class="highlight js"><span class="keyword">const</span> sheet = <span class="keyword">new</span> <span class="title class_">CSSStyleSheet</span>();

<span class="comment">// Replace all styles synchronously for this style sheet</span>
sheet.<span class="title function_">replaceSync</span>(<span class="string">&#x27;p &#123; color: green; &#125;&#x27;</span>);

<span class="keyword">class</span> <span class="title class_">FancyComponent1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;

  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;
    <span class="variable language_">super</span>();

    <span class="keyword">const</span> shadowRoot = <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span> &#125;);

    <span class="comment">// Attaching the style sheet to the Shadow DOM of this component</span>
    shadowRoot.<span class="property">adoptedStyleSheets</span> = [sheet];

    shadowRoot.<span class="property">innerHTML</span> = <span class="string">`</span>
<span class="string">      &lt;div&gt;</span>
<span class="string">        &lt;p&gt;Hello World&lt;/p&gt;</span>
<span class="string">      &lt;/div&gt;</span>
<span class="string">    `</span>;

  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">FancyComponent2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;

  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;
    <span class="variable language_">super</span>();

    <span class="keyword">const</span> shadowRoot = <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span> &#125;);

    <span class="comment">// Same style sheet can also be used by another web component</span>
    shadowRoot.<span class="property">adoptedStyleSheets</span> = [sheet];

    <span class="comment">// You can even manipulate the style sheet with plain JS manipulations</span>
    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> shadowRoot.<span class="property">adoptedStyleSheets</span> = [], <span class="number">2000</span>);

    shadowRoot.<span class="property">innerHTML</span> = <span class="string">`</span>
<span class="string">      &lt;div&gt;</span>
<span class="string">        &lt;p&gt;Hello World&lt;/p&gt;</span>
<span class="string">      &lt;/div&gt;</span>
<span class="string">    `</span>;

  &#125;
&#125;</code></pre>

<p>é™¤äº†è§£å†³é‡å¤æ‹·è´çš„é—®é¢˜ï¼Œå®ƒè¿˜æœ‰ä¸€äº›ç‰¹ç‚¹ï¼š</p>
<ul>
<li>é¦–å…ˆæ ·å¼ä¸ä»…ä»…è¢«åŒä¸€ç»„ä»¶çš„å®ä¾‹å…±äº«ï¼Œä¹Ÿä¼šè¢«å¤šä¸ªä¸åŒç»„ä»¶æ‰€å…±äº«</li>
<li>å®ƒè¿˜æ”¯æŒå¤„ç†å¼‚æ­¥æ ·å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½ çš„CSSä»£ç ä¸­ä½¿ç”¨ <code>url</code> å’Œ <code>@import</code></li>
<li>æœ€åï¼Œ<code>adoptedStyleSheets</code> æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨æˆ‘ä»¬ä»¥å‰ä¸å¯èƒ½åšåˆ°çš„æ–¹å¼æ¥ç»„æˆå¯å¤ç”¨çš„æ ·å¼è¡¨ã€‚é¦–å…ˆä½ å¯ä»¥æŠŠä½ çš„CSSè§„åˆ™åˆ†æˆå°å—ï¼Œç„¶ååªåº”ç”¨éœ€è¦çš„é‚£éƒ¨åˆ†ã€‚ç”šè‡³ä½ å¯ä»¥åšä¸‹é¢è¿™æ ·çš„äº‹æƒ…ï¼š</li>
</ul>
<pre><code class="highlight js">shadowRoot.<span class="property">adoptedStyleSheets</span> = [sheet];
<span class="comment">// Remove stylesheets after two seconds</span>
<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> shadowRoot.<span class="property">adoptedStyleSheets</span> = [], <span class="number">2000</span>);</code></pre>

<h2 id="Using-with-Webpack-and-SCSS"><a href="#Using-with-Webpack-and-SCSS" class="headerlink" title="Using with Webpack and SCSS"></a>Using with Webpack and SCSS</h2><p>SCSSä½œä¸ºä¸€ä¸ªCSSé¢„å¤„ç†å™¨ï¼ŒWebpackä½œä¸ºä¸€ä¸ªæ¨¡å—æ‰“åŒ…å’Œæ„å»ºå·¥å…·ï¼Œéƒ½æ˜¯éå¸¸å¸¸è§çš„é…ç½®ã€‚å…¶ä¸­<br> <code>CSSStyleSheet.replace()</code> å’Œ <code>CSSStyleSheet.replaceSync()</code> é¢„æœŸæ¥æ”¶ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²å½¢å¼çš„CSSè§„åˆ™ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„loader chainï¼ŒåŒ…æ‹¬sass-loaderå’Œraw-loaderï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="highlight js"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;

  <span class="attr">entry</span>: &#123; <span class="comment">/* config */</span> &#125;,

  <span class="attr">output</span>: &#123; <span class="comment">/* config */</span> &#125;,

  <span class="attr">module</span>: &#123;
    <span class="attr">rules</span>: [
      <span class="comment">// Regular css files</span>
      &#123;
        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,
        <span class="attr">loader</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]
      &#125;,

      <span class="comment">// Transforming SCSS file into CSS string</span>
      &#123;
        <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,
        <span class="attr">use</span>: [
          <span class="string">&#x27;raw-loader&#x27;</span>,
          &#123;
            <span class="attr">loader</span>: <span class="string">&#x27;sass-loader&#x27;</span>,
            <span class="attr">options</span>: &#123;
              <span class="attr">includePaths</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;node_modules&#x27;</span>)]
            &#125;
          &#125;
        ]
      &#125;,
    ]
  &#125;,
  <span class="attr">plugins</span>: [],
&#125;;</code></pre>

<p>åœ¨ä½ çš„ä»£ç ä¸­å¯ä»¥å¯¼å…¥SCSSæ–‡ä»¶ï¼š</p>
<pre><code class="highlight js"><span class="comment">// Read SCSS file as a raw CSS text</span>
<span class="keyword">import</span> styleText <span class="keyword">from</span> <span class="string">&#x27;./my-component.scss&#x27;</span>;

<span class="keyword">const</span> sheet = <span class="keyword">new</span> <span class="title class_">CSSStyleSheet</span>();
sheet.<span class="title function_">replaceSync</span>(styleText);</code></pre>

<p>åœ¨Rollup.jsä¸­ä¹Ÿå¯ä»¥è¿›è¡Œç±»ä¼¼çš„è®¾ç½®ã€‚æ­¤å¤–ï¼Œæ¥è‡ªPolymerå›¢é˜Ÿçš„æ–°åº“<strong>LitElement</strong>å·²ç»åœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¹¶å…·æœ‰å›é€€æœºåˆ¶</p>
<p>*æ³¨æ„ï¼šç›®å‰å¯æ„å»ºçš„æ ·å¼è¡¨æ˜¯åœ¨Chromiumç³»åˆ—çš„æµè§ˆå™¨ä¸­å®ç°ã€‚ç„¶è€Œï¼Œé€šè¿‡åˆç†çš„æ¸è¿›å¼å¢å¼ºï¼Œä¸ºä¸æ”¯æŒçš„æµè§ˆå™¨æä¾›æ”¯æŒåº”è¯¥æ˜¯å®¹æ˜“çš„ã€‚</p>
<h2 id="Under-the-hood-â€”-CSSOM"><a href="#Under-the-hood-â€”-CSSOM" class="headerlink" title="Under the hood â€” CSSOM"></a>Under the hood â€” CSSOM</h2><p>*å¦‚æœä½ å¯¹å…¶ä¸­ç»†èŠ‚ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚</p>
<p>å¦‚æœHTMLè¢«è½¬åŒ–ä¸ºDOMï¼Œé‚£ä¹ˆCSSåˆ™è¢«è½¬åŒ–ä¸ºCSSOMã€‚è¿™äº›éƒ½æ˜¯ç‹¬ç«‹çš„æ•°æ®ç»“æ„ã€‚æœ€ç»ˆçš„æ¸²æŸ“æ ‘æ˜¯ç”±è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„æ„å»ºçš„ã€‚ä½œä¸ºä¸€ä¸ªå‰ç«¯å¼€å‘è€…ï¼Œç†è§£CSSOMçš„æœºåˆ¶å…¶å®å¹¶ä¸é‡è¦ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªä¸å¤ªçŸ¥åçš„æ¦‚å¿µã€‚</p>
<p>ç²—ç•¥åœ°è¯´ï¼Œä¸€ä¸ª<code>&lt;link type=&#39;text/css&#39; href=&#39;&#39;/&gt;</code>æ ‡ç­¾å¯¹åº”ä¸€ä¸ªCSSæ ·å¼è¡¨ã€‚å®ƒåœ¨CSSOMä¸­ç”±CSSStyleSheetæ¥å£è¡¨ç¤ºã€‚ä¸€ä¸ªCSSStyleSheetç”±å¤šä¸ªè§„åˆ™ç»„æˆã€‚æ¯ä¸ªè§„åˆ™ç”±CSSRuleæ¥å£è¡¨ç¤ºã€‚</p>
<p>è¦è®¿é—®documentä¸Šçš„CSSStyleSheetå¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>document.styleSheets</code> å±æ€§ã€‚å®é™…ä¸Šï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªCSSStyleSheetå¯¹è±¡ï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªæ ·å¼æ ‡ç­¾ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°documentä¸­å¹¶ä½¿ç”¨sheetå±æ€§ï¼š</p>
<pre><code class="highlight js"><span class="keyword">const</span> styleNode = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;style&#x27;</span>);
<span class="comment">// It is important to add style node to the document</span>
<span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(styleNode);
<span class="keyword">const</span> sheet = styleNode.<span class="property">sheet</span>;</code></pre>

<p>ç„¶åï¼Œå¯æ„å»ºçš„æ ·å¼è¡¨å¯ç”¨äº†ä¸¤ä¸ªAPI â€” <code>CSSStyleSheet()</code>æ„é€ å‡½æ•°å’Œ<code>document.adoptedStyleSheets</code>ã€‚</p>
<blockquote>
<p>æœ‰äº†å¯æ„é€ çš„æ ·å¼è¡¨ï¼Œä½ å¯ä»¥ä½¿ç”¨CSSStyleSheet()æ„é€ å‡½æ•°æ¥åˆ›å»ºæ ·å¼è¡¨</p>
</blockquote>
<p>åœ¨Shadow Rootså’ŒDocumentsä¸Š <code>adoptedStyleSheets</code> æ˜¯å¯ç”¨çš„ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªCSSStyleSheetå®šä¹‰çš„æ ·å¼åº”ç”¨åˆ°ä¸€ä¸ªç»™å®šçš„DOMå­æ ‘ä¸Šã€‚å¦éœ€è¦æ³¨æ„ï¼ŒadoptedStyleSheetsæ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ•°ç»„ï¼Œå› æ­¤ <code>push</code> æˆ– <code>splice</code> ä¼šä¸èµ·ä½œç”¨ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*xQyzox2_i0wMUZh6wJm_DA.png"></p>
<p>å°±CSSRuleè€Œè¨€ï¼Œæœ‰è®¸å¤šCSSRule typeéƒ½æ‰©å±•äº†CSSRule interfaceã€‚ä»¥ä¸‹æ˜¯MDNæä¾›çš„ä¸€ä¸ªæ‰€æœ‰è§„åˆ™çš„åˆ—è¡¨ï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSRule">CSSRule MDN</a></li>
</ul>
<p>CSS Object MOdelæ˜¯å¾ˆåºå¤§çš„ï¼Œè€Œä¸”ä¸€ç›´éƒ½åœ¨ä¸åœçš„å‘å±•ï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°è¯¦ç»†çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS_Object_Model">CSS Object Model (CSSOM)</a></li>
</ul>
<p>å¦å¤–ï¼Œä¸è¦å¿˜è®°æ–°çš„ CSS Typed Object Modelæ­£åœ¨ç§¯æå¼€å‘ä¸­ï¼Œå®ƒè‚¯å®šä¼šå¯¹å¦‚ä½•ç”¨JSç¼–å†™CSSäº§ç”Ÿå½±å“ï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢çš„æ–‡ç« ä¸­æ‰¾åˆ°æ›´å¤šå…³äºå®ƒçš„å†…å®¹ï¼š</p>
<ul>
<li><a href="https://developer.chrome.com/blog/cssom/">Working with the new CSS Typed Object Model</a></li>
</ul>
<h2 id="Side-notes"><a href="#Side-notes" class="headerlink" title="Side notes"></a>Side notes</h2><p>ä¸ç®¡ä½ æ˜¯åœ¨Shadow DOMä¸­å¦‚ä½•å¤„ç†styleï¼Œä½ éƒ½åº”è¯¥ç‰¢è®°ä»¥ä¸‹å‡ é¡¹ï¼š</p>
<ul>
<li>æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨<code>@import</code>è¯­å¥æ¥åœ¨ Shadow DOM ä¸­ä½¿ç”¨å¤–éƒ¨æ ·å¼</li>
<li>æ’æ§½å¯ä»¥é€šè¿‡å…¨å±€CSSæˆ–å®¹å™¨ç»„ä»¶çš„æ ·å¼è¡¨è¿›è¡Œè®¾ç½®</li>
<li>CSSè‡ªå®šä¹‰å±æ€§å¯ä»¥è·¨è¶ŠShadow DOMè¾¹ç•Œä½¿ç”¨å’Œä¿®æ”¹</li>
</ul>
<p>å› æ­¤ï¼Œè¿™äº›è‡ªå®šä¹‰å±æ€§æ˜¯ä»å¤–éƒ¨å¤„ç† ShadowDOM æ ·å¼çš„é¦–é€‰</p>
<ul>
<li>é™¤äº†è‡ªå®šä¹‰å±æ€§å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ–°çš„CSSé€‰æ‹©å™¨ï¼Œå¦‚ <code>:host</code>ã€<code>:part</code>ã€<code>:theme</code>ï¼Œè¿›ä¸€æ­¥æä¾›æ¥è‡ªå¤–éƒ¨çš„æ ·å¼å®šåˆ¶</li>
<li>åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œä½¿ç”¨Shadow DOMè¿›è¡Œæ ·å¼å°è£…æ˜¯æ›¿ä»£CSS-in-JSæ–¹æ³•çš„å¾ˆå¥½é€‰æ‹©</li>
<li>è™šæ‹Ÿç»„ä»¶(æ²¡æœ‰å…ƒç´ çš„ç»„ä»¶ï¼Œå¦‚Vueçš„<code>&lt;router-view /&gt;</code>æˆ–Reactçš„<code>&lt;Route /&gt;</code>)æ˜¯ä¸å¯èƒ½ä½¿ç”¨Web Components</li>
<li>Web Componentséå¸¸é€‚åˆæ›¿ä»£å­ç»„ä»¶ï¼Œå¦‚è¾“å…¥æ¡†ã€é¢æ¿ã€å¡ç‰‡ã€é€‰æ‹©å™¨ç­‰</li>
</ul>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>Web Component</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Reactivity in Depth</title>
    <url>/2023/08/18/%E3%80%90%E7%BF%BB%E3%80%91Reactivity-in-Depth/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://vuejs.org/guide/extras/reactivity-in-depth.html">Reactivity in Depth</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>Vue æœ€ä¸ä¼—ä¸åŒçš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å…¶éš¾ä»¥å¯Ÿè§‰çš„å“åº”å¼ç³»ç»Ÿã€‚Vueçš„ç»„ä»¶çŠ¶æ€éƒ½æ˜¯ç”±javascriptå¯¹è±¡ç»„æˆã€‚å½“ä½ ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œè§†å›¾å°±ä¼šæ›´æ–°ã€‚è¿™å°±ä½¿çŠ¶æ€ç®¡ç†å˜å¾—ç®€å•ç›´è§‚ï¼Œä½†å¦‚æœèƒ½äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ä¹Ÿå¯ä»¥é¿å…ä¸€äº›å¸¸è§çš„é—®é¢˜ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šæ·±å…¥æ¢è®¨Vueå“åº”å¼ç³»ç»Ÿçš„ä¸€äº›åº•å±‚ç»†èŠ‚ã€‚</p>
<h2 id="What-is-Reactivity"><a href="#What-is-Reactivity" class="headerlink" title="What is Reactivity?"></a>What is Reactivity?</h2><p>è¿‘æ¥ï¼Œè¿™ä¸ªæœ¯è¯­åœ¨ç¼–ç¨‹çš„è®¨è®ºä¸­å‡ºç°é¢‘ç‡å¾ˆé«˜ï¼Œä½†å½“äººä»¬è¯´è¿™ä¸ªè¯æ—¶æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå“åº”å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥å£°æ˜çš„æ–¹å¼å¤„ç†å˜åŒ–ã€‚ä¸€ä¸ªç»å¸¸æ‹¿æ¥å±•ç¤ºçš„ä¾‹å­å°±æ˜¯Excelè¡¨æ ¼</p>
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>è¿™é‡Œçš„å•å…ƒæ ¼A2æ˜¯é€šè¿‡å…¬å¼ A0 + A1 å®šä¹‰çš„(ä½ å¯ä»¥ç‚¹å‡»A2æŸ¥çœ‹æˆ–ç¼–è¾‘å…¬å¼)ï¼Œæ‰€ä»¥å¾—å‡ºç»“æœä¸º3ã€‚æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæ›´æ–°A0æˆ–è€…A1ï¼Œä½ ä¼šå‘ç°A2ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>å½“ç„¶javascripté€šå¸¸ä¸æ˜¯è¿™æ ·å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬ç”¨javascriptå†™ä¸€ä¸ªç›¸ä¼¼çš„é€»è¾‘ï¼š</p>
<pre><code class="highlight js"><span class="keyword">let</span> <span class="variable constant_">A0</span> = <span class="number">1</span>
<span class="keyword">let</span> <span class="variable constant_">A1</span> = <span class="number">2</span>
<span class="keyword">let</span> <span class="variable constant_">A2</span> = <span class="variable constant_">A0</span> + <span class="variable constant_">A1</span>

<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">A2</span>) <span class="comment">// 3</span>

<span class="variable constant_">A0</span> = <span class="number">2</span>
<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">A2</span>) <span class="comment">// Still 3</span></code></pre>

<p>å½“æˆ‘ä»¬æ”¹å˜A0æ—¶ï¼ŒA2ä¸ä¼šè‡ªåŠ¨æ”¹å˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œè¯¥å¦‚ä½•ç”¨javascriptå®ç°è¿™ä¸€åŠŸèƒ½å‘¢ï¼Ÿé¦–å…ˆï¼Œä¸ºäº†é‡æ–°è¿è¡Œæ›´æ–°A2çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°æ¥å°è£…å®ƒï¼š</p>
<pre><code class="highlight js"><span class="keyword">let</span> <span class="variable constant_">A2</span>

<span class="keyword">function</span> <span class="title function_">update</span>(<span class="params"></span>) &#123;
  <span class="variable constant_">A2</span> = <span class="variable constant_">A0</span> + <span class="variable constant_">A1</span>
&#125;</code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å‡ ä¸ªæœ¯è¯­ï¼š</p>
<ul>
<li>é¦–å…ˆ<code>update()</code>å‡½æ•°ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œç®€ç§°â€œeffectâ€ï¼Œå› ä¸ºå®ƒä¼šä¿®æ”¹ç¨‹åºçš„çŠ¶æ€ã€‚</li>
<li><code>A0</code>å’Œ<code>A1</code>æ˜¯ effect çš„ä¾èµ–é¡¹ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼æ˜¯ç”¨äºæ‰§è¡Œeffectã€‚å¯ä»¥è¯´ï¼Œeffectæ˜¯å…¶ä¾èµ–é¡¹çš„è®¢é˜…è€…</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé­”æ³•å‡½æ•°ï¼Œå¯ä»¥åœ¨<code>A0</code>æˆ–<code>A1</code>å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨<code>update()</code></p>
<pre><code class="highlight js"><span class="title function_">whenDepsChange</span>(update)</code></pre>

<p>è¿™ä¸ª<code>whenDepsChange()</code>å‡½æ•°æœ‰ä»¥ä¸‹ä»»åŠ¡ï¼š</p>
<ol>
<li>è¿½è¸ªå˜é‡ä½•æ—¶è¢«è¯»å–ã€‚æ¯”å¦‚ï¼Œåœ¨è®¡ç®—è¡¨è¾¾å¼<code>A0 + A1</code>æ—¶ï¼Œ<code>A0</code>å’Œ<code>A1</code>éƒ½ä¼šè¢«è¯»å–ã€‚</li>
<li>å¦‚æœä¸€ä¸ªå˜é‡åœ¨å½“å‰è¿è¡Œçš„effectä¸­è¢«è¯»å–ï¼Œåˆ™è¯¥effectå°±ä¸ºè¯¥å˜é‡çš„è®¢é˜…è€…ã€‚æ¯”å¦‚ï¼Œç”±äº<code>A0</code>å’Œ<code>A1</code>åœ¨<code>update()</code>æ‰§è¡Œæ—¶è¢«è¯»å–ï¼Œå› æ­¤<code>update()</code>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨åå°±æˆä¸ºäº†<code>A0</code>å’Œ<code>A1</code>çš„è®¢é˜…è€…</li>
<li>å½“å˜é‡å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œæ£€æµ‹ã€‚æ¯”å¦‚ï¼Œå½“<code>A0</code>è¢«ä¿®æ”¹ä¸ºä¸€ä¸ªæ–°å€¼æ—¶ï¼Œé€šçŸ¥å…¶æ‰€æœ‰è®¢é˜…äº†çš„effecté‡æ–°æ‰§è¡Œã€‚</li>
</ol>
<h2 id="How-Reactivity-Works-in-Vue"><a href="#How-Reactivity-Works-in-Vue" class="headerlink" title="How Reactivity Works in Vue"></a>How Reactivity Works in Vue</h2><p>æˆ‘ä»¬æ— æ³•åƒç¤ºä¾‹ä¸­é‚£æ ·è¿½è¸ªå±€éƒ¨å˜é‡çš„è¯»å†™ã€‚åœ¨åŸç”Ÿçš„javascriptä¸­æ²¡æœ‰è¿™æ ·çš„æœºåˆ¶ã€‚ä½†æˆ‘ä»¬å¯ä»¥åšåˆ°è¿½è¸ªå¯¹è±¡å±æ€§çš„è¯»å†™ã€‚</p>
<p>åœ¨javascriptä¸­æœ‰ä¸¤ç§æ‹¦æˆªå±æ€§è®¿é—®çš„æ–¹æ³•ï¼š<code>getter</code>&#x2F;<code>setters</code>å’Œ<code>proxies</code>ã€‚ç”±äºæµè§ˆå™¨æ”¯æŒçš„é™åˆ¶ï¼ŒVue2ä¸­åªèƒ½ä½¿ç”¨<code>getter</code>&#x2F;<code>setters</code>ã€‚åœ¨Vue3ä¸­ï¼Œ<code>proxy</code>ç”¨äºå“åº”å¼å¯¹è±¡ï¼Œ<code>getter</code>&#x2F;<code>setter</code>ç”¨äº<code>refs</code>ã€‚ä¸‹é¢æ˜¯ä¸€äº›è¯´æ˜å®ƒä»¬å¦‚ä½•å·¥ä½œçš„ä¼ªä»£ç ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;
    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;
      <span class="title function_">track</span>(target, key)
      <span class="keyword">return</span> target[key]
    &#125;,
    <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;
      target[key] = value
      <span class="title function_">trigger</span>(target, key)
    &#125;
  &#125;)
&#125;

<span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value</span>) &#123;
  <span class="keyword">const</span> refObject = &#123;
    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;
      <span class="title function_">track</span>(refObject, <span class="string">&#x27;value&#x27;</span>)
      <span class="keyword">return</span> value
    &#125;,
    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>) &#123;
      value = newValue
      <span class="title function_">trigger</span>(refObject, <span class="string">&#x27;value&#x27;</span>)
    &#125;
  &#125;
  <span class="keyword">return</span> refObject
&#125;</code></pre>

<blockquote>
<p>TIP: è¿™é‡Œå’Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¯ä¸ºäº†ä»¥æœ€ç®€å•çš„å½¢å¼è§£é‡Šæ ¸å¿ƒæ¦‚å¿µï¼Œå› æ­¤çœç•¥äº†è®¸å¤šç»†èŠ‚ï¼Œä¹Ÿå¿½ç•¥äº†è¾¹ç•Œæƒ…å†µã€‚</p>
</blockquote>
<p>ä»¥ä¸Šå°±è§£é‡Šäº†æˆ‘åœ¨åŸºç¡€éƒ¨åˆ†è®¨è®ºè¿‡çš„å“åº”å¼å¯¹è±¡çš„ä¸€äº›å±€é™æ€§ï¼š</p>
<ul>
<li>å½“ä½ å°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡çš„å±æ€§èµ‹å€¼æˆ–è§£æ„åˆ°ä¸€ä¸ªæœ¬åœ°å˜é‡æ—¶ï¼Œè¯¥å˜é‡çš„è®¿é—®å’Œèµ‹å€¼å°±ä¸æ˜¯å“åº”å¼çš„äº†ï¼Œå› ä¸ºå®ƒä¸å†è§¦å‘æºå¯¹è±¡ä¸Šçš„<code>get</code>&#x2F;<code>set</code>çš„ä»£ç†ã€‚è¯·æ³¨æ„ï¼Œè¿™ç§æ–­å¼€åªå½±å“å˜é‡ç»‘å®šï¼Œå¦‚æœå˜é‡æŒ‡å‘ä¸€ä¸ªéåŸå§‹å€¼ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡çš„æ›´æ”¹ä»æ˜¯å“åº”å¼çš„ã€‚</li>
<li>ä½¿ç”¨<code>proxy</code>è¿”å›çš„å“åº”å¼å¯¹è±¡ï¼Œè™½ç„¶ä¸åŸå§‹å¯¹è±¡æ— å¼‚ï¼Œä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>===</code> æ“ä½œç¬¦å°†å…¶å¯¹æ¯”å¼ï¼Œè¿˜æ˜¯èƒ½å¤Ÿæ¯”è¾ƒå‡ºä¸åŒ</li>
</ul>
<p>åœ¨<code>track()</code>ä¸­ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥å½“å‰æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„effectã€‚å¦‚æœæœ‰ï¼Œæˆ‘ä»¬ä¼šæŸ¥æ‰¾åˆ°ä¸€ä¸ªå­˜å‚¨æ‰€æœ‰è¿½è¸ªäº†è¯¥å±æ€§çš„è®¢é˜…çš„Setï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Setä¸­ï¼š</p>
<pre><code class="highlight js"><span class="comment">// This will be set right before an effect is about</span>
<span class="comment">// to be run. We&#x27;ll deal with this later.</span>
<span class="keyword">let</span> activeEffect

<span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>) &#123;
  <span class="keyword">if</span> (activeEffect) &#123;
    <span class="keyword">const</span> effects = <span class="title function_">getSubscribersForProperty</span>(target, key)
    effects.<span class="title function_">add</span>(activeEffect)
  &#125;
&#125;</code></pre>

<p>effectè®¢é˜…ä¼šä»¥è¿™ç§æ•°æ®ç»“æ„<code>WeakMap&lt;target, Map&lt;key, Set&lt;effect&gt;&gt;</code>å­˜å‚¨åœ¨å…¨å±€ã€‚å¦‚æœæŸä¸ªå±æ€§æ²¡æœ‰æ‰¾åˆ°effect Setï¼Œè¯´æ˜æ˜¯é¦–æ¬¡è¿½è¸ªï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªeffect Setã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯<code>getSubscribersForProperty()</code>å‡½æ•°çš„ä½œç”¨ã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬è·³è¿‡å…¶ç»†èŠ‚ã€‚</p>
<p>åœ¨<code>trigger()</code>ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥æ‰¾è¯¥å±æ€§çš„effectè®¢é˜…ã€‚ä½†è¿™æ¬¡æˆ‘ä»¬ä¼šæ‰§è¡Œå®ƒä»¬ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;
  <span class="keyword">const</span> effects = <span class="title function_">getSubscribersForProperty</span>(target, key)
  effects.<span class="title function_">forEach</span>(<span class="function">(<span class="params">effect</span>) =&gt;</span> <span class="title function_">effect</span>())
&#125;</code></pre>

<p>ç°åœ¨æˆ‘ä»¬å›åˆ°<code>whenDepsChange()</code>å‡½æ•°ä¸­ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">whenDepsChange</span>(<span class="params">update</span>) &#123;
  <span class="keyword">const</span> <span class="title function_">effect</span> = (<span class="params"></span>) =&gt; &#123;
    activeEffect = effect
    <span class="title function_">update</span>()
    activeEffect = <span class="literal">null</span>
  &#125;
  <span class="title function_">effect</span>()
&#125;</code></pre>

<p>å®ƒæŠŠåŸå§‹çš„<code>update</code>å‡½æ•°å°è£…åœ¨ä¸€ä¸ªeffectä¸­ï¼Œç„¶åè¯¥effectä¼šåœ¨å®é™…æ›´æ–°ä¹‹å‰å°†è‡ªå·±è®¾ç½®ä¸ºactiveEffectã€‚è¿™æ ·å°±èƒ½åœ¨æ›´æ–°è¿‡ç¨‹ä¸­è°ƒç”¨<code>track()</code>æ¥å®šä½å½“å‰çš„active effectã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨è¿½è¸ªå…¶ä¾èµ–å…³ç³»çš„effectï¼Œå¹¶åœ¨ä¾èµ–å…³ç³»å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è¿è¡Œã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºå“åº”å¼å‰¯ä½œç”¨ã€‚</p>
<p>Vueæä¾›ä¸€ä¸ªå¯ä»¥åˆ›å»ºå“åº”å¼å‰¯ä½œç”¨çš„APIï¼š<code>watchEffect()</code>ã€‚äº‹å®ä¸Šï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°å®ƒçš„å·¥ä½œåŸç†ä¸ç¤ºä¾‹ä¸­çš„<code>whenDepsChange()</code>éå¸¸ç›¸ä¼¼ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®é™…çš„Vue APIè¿è¡Œæœ€åˆçš„ç¤ºä¾‹ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> <span class="variable constant_">A0</span> = <span class="title function_">ref</span>(<span class="number">0</span>)
<span class="keyword">const</span> <span class="variable constant_">A1</span> = <span class="title function_">ref</span>(<span class="number">1</span>)
<span class="keyword">const</span> <span class="variable constant_">A2</span> = <span class="title function_">ref</span>()

<span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;
  <span class="comment">// tracks A0 and A1</span>
  <span class="variable constant_">A2</span>.<span class="property">value</span> = <span class="variable constant_">A0</span>.<span class="property">value</span> + <span class="variable constant_">A1</span>.<span class="property">value</span>
&#125;)

<span class="comment">// triggers the effect</span>
<span class="variable constant_">A0</span>.<span class="property">value</span> = <span class="number">2</span></code></pre>

<p>ä½¿ç”¨å“åº”å¼å‰¯ä½œç”¨æ¥æ”¹å˜refå¹¶ä¸æ˜¯æœ€æœ‰è¶£çš„ç”¨ä¾‹ï¼Œäº‹å®ä¸Šï¼Œä½¿ç”¨è®¡ç®—å±æ€§ä¼šä½¿å®ƒæ›´å…·æœ‰å£°æ˜æ€§ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> <span class="variable constant_">A0</span> = <span class="title function_">ref</span>(<span class="number">0</span>)
<span class="keyword">const</span> <span class="variable constant_">A1</span> = <span class="title function_">ref</span>(<span class="number">1</span>)
<span class="keyword">const</span> <span class="variable constant_">A2</span> = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="variable constant_">A0</span>.<span class="property">value</span> + <span class="variable constant_">A1</span>.<span class="property">value</span>)

<span class="variable constant_">A0</span>.<span class="property">value</span> = <span class="number">2</span></code></pre>

<p>åœ¨å†…éƒ¨ï¼Œcomputedä¼šé€šè¿‡å“åº”å¼å‰¯ä½œç”¨æ¥ç®¡ç†å¤±æ•ˆå’Œé‡æ–°è®¡ç®—çš„è¿‡ç¨‹ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ€æœ‰ç”¨ä¸”å¸¸è§çš„å“åº”å¼ç¤ºä¾‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯æ›´æ–°DOMï¼æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ªç®€å•çš„å“åº”å¼æ¸²æŸ“ä¾‹å­ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)

<span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;
  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = <span class="string">`count is: <span class="subst">$&#123;count.value&#125;</span>`</span>
&#125;)

<span class="comment">// updates the DOM</span>
count.<span class="property">value</span>++</code></pre>

<p>äº‹å®ä¸Šï¼Œè¿™ä¸Vueä¿æŒçŠ¶æ€å’ŒDOMåŒæ­¥çš„æ–¹å¼éå¸¸æ¥è¿‘ï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå“åº”å¼å‰¯ä½œç”¨æ¥æ¸²æŸ“å’Œæ›´æ–°DOMã€‚å½“ç„¶Vueç»„ä»¶ä½¿ç”¨äº†æ¯”innerHTMLæ›´é«˜æ•ˆçš„æ–¹å¼æ¥æ›´æ–°DOMã€‚è¿™ä¼šåœ¨æ¸²æŸ“æœºåˆ¶ä¸€èŠ‚ä¸­è®¨è®ºã€‚</p>
<h2 id="Runtime-vs-Compile-time-Reactivity"><a href="#Runtime-vs-Compile-time-Reactivity" class="headerlink" title="Runtime vs. Compile-time Reactivity"></a>Runtime vs. Compile-time Reactivity</h2><p>Vueçš„å“åº”å¼ç³»ç»Ÿä¸»è¦åŸºäºè¿è¡Œæ—¶ï¼šè·Ÿè¸ªå’Œè§¦å‘éƒ½æ˜¯ä»£ç ç›´æ¥åœ¨æµè§ˆå™¨è¿è¡Œæ—¶è¿›è¡Œçš„ã€‚è¿è¡Œæ—¶çš„ä¼˜ç‚¹æ˜¯æ— éœ€æ„å»ºæ­¥éª¤å³å¯è¿è¡Œï¼Œè€Œä¸”è¾¹ç•Œæƒ…å†µè¾ƒå°‘ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¹Ÿä½¿å®ƒå—åˆ°javascriptè¯­æ³•çš„åˆ¶çº¦ï¼Œå¯¼è‡´éœ€è¦ refsè¿™æ ·çš„å€¼å®¹å™¨</p>
<p>åƒä¸€äº›æ¡†æ¶ï¼Œå¦‚Svelteï¼Œé€‰æ‹©åœ¨ç¼–è¯‘é˜¶æ®µå®ç°å“åº”å¼æ¥å…‹æœè¿™äº›é™åˆ¶ï¼Œå®ƒé€šè¿‡åˆ†æå’Œè½¬æ¢ä»£ç æ¥æ¨¡æ‹Ÿå“åº”å¼ã€‚ç¼–è¯‘é˜¶æ®µå…è®¸æ¡†æ¶æ”¹å˜javascriptæœ¬èº«çš„è¯­ä¹‰ï¼Œæ¯”å¦‚ï¼Œéšå¼æ³¨å…¥ä»£ç æ¥æ‰§è¡Œä¾èµ–æ€§åˆ†æï¼Œå¹¶åœ¨è®¿é—®æœ¬åœ°å®šä¹‰çš„å˜é‡æ—¶è§¦å‘ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ï¼Œè¿™ç§è½¬æ¢éœ€è¦ä¸€ä¸ªæ„å»ºæ­¥éª¤ï¼Œè€Œæ”¹å˜javascriptè¯­ä¹‰æœ¬è´¨ä¸Šå°±æ˜¯åˆ›é€ ä¸€ç§çœ‹èµ·æ¥åƒjavascriptä½†ç¼–è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„è¯­è¨€ã€‚</p>
<p>Vueå›¢é˜Ÿæ›¾é€šè¿‡äº†ä¸€é¡¹åä¸º <a href="https://vuejs.org/guide/extras/reactivity-transform.html">Reactivity Transform</a> çš„å®éªŒæ€§åŠŸèƒ½æ¢ç´¢è¿‡è¿™ä¸ªæ–¹å‘ï¼Œä½†æˆ‘ä»¬æœ€åè¿˜æ˜¯å› ä¸º<a href="https://github.com/vuejs/rfcs/discussions/369#discussioncomment-5059028">è¿™ä¸ªåŸå› </a>ï¼Œè®¤ä¸ºä»–ä¸é€‚åˆè¿™ä¸ªé¡¹ç›®ã€‚</p>
]]></content>
      <tags>
        <tag>Vue</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Render Functions &amp; JSX</title>
    <url>/2023/08/31/%E3%80%90%E7%BF%BB%E3%80%91Render-Functions-JSX/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://vuejs.org/guide/extras/render-function.html">Render Functions &amp; JSX</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>Vue æ¨èå¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨æ¨¡æ¿æ¥æ„å»ºåº”ç”¨ã€‚ä¸è¿‡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨JavaScriptçš„å…¨éƒ¨ç¼–ç¨‹èƒ½åŠ›ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ¸²æŸ“å‡½æ•°ã€‚</p>
<h2 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h2><h3 id="Creating-Vnodes"><a href="#Creating-Vnodes" class="headerlink" title="Creating Vnodes"></a>Creating Vnodes</h3><p>Vueæä¾›äº†<code>h()</code>å‡½æ•°ç”¨äºåˆ›å»ºvnode</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">const</span> vnode = <span class="title function_">h</span>(
  <span class="string">&#x27;div&#x27;</span>, <span class="comment">// type</span>
  &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">class</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, <span class="comment">// props</span>
  [
    <span class="comment">/* children */</span>
  ]
)</code></pre>

<p><code>h()</code>æ˜¯ <strong>hyperscript</strong> çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€ç”ŸæˆHTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰çš„JavaScriptâ€ã€‚è¿™ä¸ªåå­—æ¥è‡ªäºè®¸å¤šè™šæ‹ŸDOMå®ç°æ—¶çš„å…±åŒçº¦å®šã€‚ä¸€ä¸ªæè¿°æ€§æ›´å¼ºçš„åç§°å¯ä»¥ä¸º<code>createVnode()</code>ï¼Œä½†å½“ä½ éœ€è¦åœ¨æ¸²æŸ“å‡½æ•°ä¸­å¤šæ¬¡è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªæ›´ç®€çŸ­çš„åç§°ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p>
<p>è¿™ä¸ª<code>h()</code>å‡½æ•°è®¾è®¡çš„éå¸¸çµæ´»</p>
<pre><code class="highlight js"><span class="comment">// all arguments except the type are optional</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>)
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span> &#125;)

<span class="comment">// both attributes and properties can be used in props</span>
<span class="comment">// Vue automatically picks the right way to assign it</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">innerHTML</span>: <span class="string">&#x27;hello&#x27;</span> &#125;)

<span class="comment">// props modifiers such as `.prop` and `.attr` can be added</span>
<span class="comment">// with `.` and `^` prefixes respectively</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="string">&#x27;.name&#x27;</span>: <span class="string">&#x27;some-name&#x27;</span>, <span class="string">&#x27;^width&#x27;</span>: <span class="string">&#x27;100&#x27;</span> &#125;)

<span class="comment">// class and style have the same object / array</span>
<span class="comment">// value support that they have in templates</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: [foo, &#123; bar &#125;], <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span> &#125; &#125;)

<span class="comment">// event listeners should be passed as onXxx</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;&#125; &#125;)

<span class="comment">// children can be a string</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span> &#125;, <span class="string">&#x27;hello&#x27;</span>)

<span class="comment">// props can be omitted when there are no props</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>)
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [<span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>)])

<span class="comment">// children array can contain mixed vnodes and strings</span>
<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [<span class="string">&#x27;hello&#x27;</span>, <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>)])</code></pre>

<p>ç”Ÿæˆçš„vnodeç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="highlight js"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span> &#125;, [])

vnode.<span class="property">type</span> <span class="comment">// &#x27;div&#x27;</span>
vnode.<span class="property">props</span> <span class="comment">// &#123; id: &#x27;foo&#x27; &#125;</span>
vnode.<span class="property">children</span> <span class="comment">// []</span>
vnode.<span class="property">key</span> <span class="comment">// null</span></code></pre>

<blockquote>
<p>Note<br>å®Œæ•´çš„VNodeç»“æ„è¿˜åŒ…å«è®¸å¤šå…¶ä»–å†…éƒ¨å±æ€§ï¼Œå½“å¼ºçƒˆå»ºè®®é¿å…ä¾èµ–ä»¥ä¸Šæ‰€åˆ—çš„ä»¥å¤–å…¶ä»–å±æ€§ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å†…éƒ¨å±æ€§å‘ç”Ÿå˜åŒ–æ—¶å‡ºç°æ„å¤–ä¸­æ–­ã€‚</p>
</blockquote>
<h3 id="Declaring-Render-Functions"><a href="#Declaring-Render-Functions" class="headerlink" title="Declaring Render Functions"></a>Declaring Render Functions</h3><p>åœ¨é€šè¿‡ Composition API ä½¿ç”¨æ¨¡ç‰ˆæ—¶ï¼Œ<code>setup()</code>çš„è¿”å›å€¼æ˜¯ç”¨äºå‘æ¨¡ç‰ˆæš´éœ²æ•°æ®ã€‚ä½†åœ¨ä½¿ç”¨æ¸²æŸ“å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›æ¸²æŸ“å‡½æ•°ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; ref, h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">export</span> <span class="keyword">default</span> &#123;
  <span class="attr">props</span>: &#123;
    <span class="comment">/* ... */</span>
  &#125;,
  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;
    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">1</span>)

    <span class="comment">// return the render function</span>
    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, props.<span class="property">msg</span> + count.<span class="property">value</span>)
  &#125;
&#125;</code></pre>

<p>å› ä¸ºæ¸²æŸ“å‡½æ•°æ˜¯åœ¨<code>setup()</code>å†…éƒ¨å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒè‡ªç„¶å¯ä»¥è®¿é—®å…¶åŒä¸€ä½œç”¨åŸŸä¸‹å£°æ˜çš„propså’Œä»»æ„çš„å“åº”æ•°æ®ã€‚</p>
<p>é™¤äº†è¿”å›å•ä¸ªvnodeå¤–ï¼Œè¿˜å¯ä»¥è¿”å›å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼š</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">default</span> &#123;
  <span class="title function_">setup</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="string">&#x27;hello world!&#x27;</span>
  &#125;
&#125;</code></pre>

<pre><code class="highlight js"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">export</span> <span class="keyword">default</span> &#123;
  <span class="title function_">setup</span>(<span class="params"></span>) &#123;
    <span class="comment">// use an array to return multiple root nodes</span>
    <span class="keyword">return</span> <span class="function">() =&gt;</span> [
      <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>),
      <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>),
      <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>)
    ]
  &#125;
&#125;</code></pre>

<blockquote>
<p>TIP<br>ç¡®ä¿è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›å€¼ï¼å› ä¸ºæ¯ä¸ªç»„ä»¶çš„<code>setup()</code>åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œè€Œè¿”å›çš„æ¸²æŸ“å‡½æ•°ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚</p>
</blockquote>
<p>å¦‚æœæ¸²æŸ“å‡½æ•°ä¸éœ€è¦ä»»ä½•å®ä¾‹çŠ¶æ€ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">Hello</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="string">&#x27;hello world!&#x27;</span>
&#125;</code></pre>

<p>æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„Vueç»„ä»¶ï¼æœ‰å…³æ­¤è¯­æ³•çš„æ›´å¤šè¯¦æƒ…ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://vuejs.org/guide/extras/render-function.html#functional-components">Functional Components</a></p>
<h3 id="Vnodes-Must-Be-Unique"><a href="#Vnodes-Must-Be-Unique" class="headerlink" title="Vnodes Must Be Unique"></a>Vnodes Must Be Unique</h3><p>ç»„ä»¶æ ‘ä¸­çš„æ‰€æœ‰vnodeå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ä¸‹é¢çš„æ¸²æŸ“å‡½æ•°å°±æ„å‘³ç€æ˜¯æ— æ•ˆçš„ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> p = <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)
  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [
    <span class="comment">// Yikes - duplicate vnodes!</span>
    p,
    p
  ])
&#125;</code></pre>

<p>å¦‚æœä½ çœŸçš„æƒ³å¤šæ¬¡å¤åˆ¶ç›¸åŒçš„å…ƒç´ &#x2F;ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å·¥å‚å‡½æ•°æ¥å®ç°ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„æ¸²æŸ“å‡½æ•°å°±æ˜¯æ¸²æŸ“äº†20ä¸ªç›¸åŒå†…å®¹çš„æœ‰æ•ˆæ–¹æ³•ï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="title function_">h</span>(
    <span class="string">&#x27;div&#x27;</span>,
    <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">20</span> &#125;).<span class="title function_">map</span>(<span class="function">() =&gt;</span> &#123;
      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)
    &#125;)
  )
&#125;</code></pre>

<h2 id="JSX-x2F-TSXâ€‹"><a href="#JSX-x2F-TSXâ€‹" class="headerlink" title="JSX &#x2F; TSXâ€‹"></a>JSX &#x2F; TSXâ€‹</h2><p><a href="https://facebook.github.io/jsx/">JSX</a>æ˜¯JavaScriptçš„XMLæ‰©å±•ï¼Œå¯ä»¥è®©æˆ‘ä»¬å†™å‡ºä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="highlight jsx"><span class="keyword">const</span> vnode = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></code></pre>

<p>åœ¨JSXè¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨èŠ±æ‹¬å·åµŒå…¥åŠ¨æ€å€¼ï¼š</p>
<pre><code class="highlight jsx"><span class="keyword">const</span> vnode = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#123;dynamicId&#125;</span>&gt;</span>hello, &#123;userName&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></code></pre>

<p><strong>create-vue</strong>å’ŒVue CLIéƒ½æœ‰åœ¨è„šæ‰‹æ¶é…ç½®é¡¹ä¸­è¿›è¡Œäº†JSXæ”¯æŒã€‚å¦‚æœä½ è¦æ‰‹åŠ¨é…ç½®JSXï¼Œè¯·å‚é˜…<a href="https://github.com/vuejs/babel-plugin-jsx">@vue&#x2F;babel-plugin-jsx</a>æ–‡æ¡£äº†è§£è¯¦æƒ…ã€‚</p>
<p>è™½ç„¶JSXæœ€åˆæ˜¯ç”±Reactå¼•å…¥çš„ï¼Œä½†å®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰å®šä¹‰è¿è¡Œæ—¶è¯­ä¹‰ï¼Œå¯ä»¥ç¼–è¯‘æˆå„ç§ä¸åŒçš„è¾“å‡ºã€‚å¦‚æœä½ ä»¥å‰ä½¿ç”¨è¿‡JSXï¼Œéœ€æ³¨æ„Vueçš„JSXè½¬æ¢å’ŒReactçš„JSXè½¬æ¢æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥ä½ ä¸èƒ½åœ¨Vueåº”ç”¨ä¸­ä½¿ç”¨Reactçš„JSXè½¬æ¢ï¼Œå…·ä½“ä¸React JSXçš„ä¸€äº›æ˜æ˜¾åŒºåˆ«åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä½ å¯ä»¥ä½¿ç”¨<code>class</code>å’Œ<code>for</code>ç­‰HTMLå±æ€§ä½œä¸ºpropsï¼Œæ— éœ€ä½¿ç”¨<code>className</code>æˆ–è€…<code>htmlFor</code>ã€‚</li>
<li>å°†å­å…ƒç´ ä¼ é€’ç»™ç»„ä»¶(å³æ’æ§½)çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒã€‚</li>
</ul>
<p>Vueçš„ç±»å‹å®šä¹‰è¿˜ä¸ºTSXçš„ä½¿ç”¨æä¾›äº†ç±»å‹æ¨æ–­ã€‚ä½¿ç”¨TSXæ—¶ï¼Œç¡®ä¿åœ¨tsconfig.jsonä¸­æŒ‡å®š<code>&quot;jsx&quot;: &quot;preserve&quot;</code>ï¼Œä»¥ä¾¿åœ¨TypeScriptä¿ç•™JSXè¯­æ³•ï¼Œä¾›Vue JSXè½¬æ¢å¤„ç†ã€‚</p>
<h3 id="JSX-Type-Inference"><a href="#JSX-Type-Inference" class="headerlink" title="JSX Type Inference"></a>JSX Type Inference</h3><p>ä¸transformä¸€æ ·ï¼ŒVueçš„JSXä¹Ÿéœ€è¦ä¸åŒçš„ç±»å‹å®šä¹‰ã€‚ç›®å‰ï¼ŒVueä¼šè‡ªåŠ¨å…¨å±€æ³¨å†ŒVueçš„JSXç±»å‹ã€‚è¿™æ„å‘³ç€ï¼Œå½“Vueçš„ç±»å‹å¯ç”¨æ—¶ï¼ŒTSXå°±èƒ½å¼€ç®±å³ç”¨ã€‚</p>
<p>Vueçš„å…¨å±€JSXç±»å‹å¯èƒ½ä¼šä¸å…¶ä»–åŒæ ·éœ€è¦JSXç±»å‹æ¨å¯¼çš„åº“å‘ç”Ÿå†²çªï¼Œç‰¹åˆ«æ˜¯Reactã€‚ä»3.3ç‰ˆæœ¬å¼€å§‹ï¼ŒVueæ”¯æŒé€šè¿‡TypeScriptçš„jsxImportSourceé€‰é¡¹æŒ‡å®šJSXå‘½åç©ºé—´ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨3.4ç‰ˆæœ¬ä¸­ç§»é™¤é»˜è®¤çš„å…¨å±€JSXå‘½åç©ºé—´æ³¨å†Œã€‚</p>
<p>å¯¹äºTSXç”¨æˆ·ï¼Œå»ºè®®åœ¨å‡çº§åˆ°3.3ä¹‹ååœ¨ tsconfig.json ä¸­å°† jsxImportSource é€‰é¡¹è®¾ç½®ä¸º â€œvueâ€ï¼Œæˆ–è€…åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ <code>/* @jsxImportSource vue */</code>ã€‚è¿™æ ·ï¼Œä½ ç°åœ¨å°±å¯ä»¥é€‰æ‹©åŠ å…¥æ–°è¡Œä¸ºï¼Œå¹¶åœ¨ 3.4 å‘å¸ƒæ—¶æ— ç¼å‡çº§ã€‚</p>
<p>å¦‚æœæœ‰ä»£ç ä¾èµ–äºå…¨å±€JSXå‘½åç©ºé—´ï¼Œä½ å¯ä»¥é€šè¿‡æ˜¾å¼å¼•ç”¨ vue&#x2F;jsxï¼ˆå®ƒä¼šæ³¨å†Œå…¨å±€ JSX å‘½åç©ºé—´ï¼‰æ¥ä¿ç•™å®Œå…¨ç›¸åŒçš„ 3.4 ä¹‹å‰çš„å…¨å±€è¡Œä¸º</p>
<h2 id="Render-Function-Recipes"><a href="#Render-Function-Recipes" class="headerlink" title="Render Function Recipes"></a>Render Function Recipes</h2><p>ä¸‹é¢æˆ‘ä»¬ä¼šæä¾›ä¸€äº›ç”¨ç­‰ä»·çš„æ¸²æŸ“å‡½æ•°&#x2F;JSXå®ç°æ¨¡ç‰ˆåŠŸèƒ½çš„å¸¸ç”¨æ–¹æ³•ã€‚</p>
<h3 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h3><p>template:</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">div</span>&gt;</span>
  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;ok&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span>no<span class="tag">&lt;/<span class="name">span</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre>

<p>ç­‰ä»· æ¸²æŸ“å‡½æ•°&#x2F;JSX:</p>
<pre><code class="highlight js"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [ok.<span class="property">value</span> ? <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;yes&#x27;</span>) : <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;no&#x27;</span>)])</code></pre>

<pre><code class="highlight jsx">&lt;div&gt;&#123;ok.<span class="property">value</span> ? <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>no<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;&lt;/div&gt;</code></pre>

<h3 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h3><p>template:</p>
<pre><code class="highlight html"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>
  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;&#123; id, text &#125; in items&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span>
    &#123;&#123; text &#125;&#125;
  <span class="tag">&lt;/<span class="name">li</span>&gt;</span>
<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></code></pre>

<p>ç­‰ä»· æ¸²æŸ“å‡½æ•°&#x2F;JSX:</p>
<pre><code class="highlight js"><span class="title function_">h</span>(
  <span class="string">&#x27;ul&#x27;</span>,
  <span class="comment">// assuming `items` is a ref with array value</span>
  items.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; id, text &#125;</span>) =&gt;</span> &#123;
    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: id &#125;, text)
  &#125;)
)</code></pre>

<pre><code class="highlight jsx">&lt;ul&gt;
  &#123;items.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; id, text &#125;</span>) =&gt;</span> &#123;
    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;id&#125;</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>
  &#125;)&#125;
&lt;/ul&gt;</code></pre>

<h3 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h3><p>propsåç§°ä»¥<code>on</code>å¼€å¤´ä¸”åé¢è·Ÿå¤§å†™å­—æ¯çš„è¢«è§†ä¸ºäº‹ä»¶ç›‘å¬å™¨ã€‚æ¯”å¦‚ï¼Œ<code>onClick</code>ç›¸å½“äºæ¨¡ç‰ˆçš„<code>@click</code>ã€‚</p>
<pre><code class="highlight js"><span class="title function_">h</span>(
  <span class="string">&#x27;button&#x27;</span>,
  &#123;
    <span class="title function_">onClick</span>(<span class="params">event</span>) &#123;
      <span class="comment">/* ... */</span>
    &#125;
  &#125;,
  <span class="string">&#x27;click me&#x27;</span>
)</code></pre>

<pre><code class="highlight jsx">&lt;button
  onClick=&#123;<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;
    <span class="comment">/* ... */</span>
  &#125;&#125;
&gt;
  click me
&lt;/button&gt;</code></pre>

<h3 id="Event-Modifiers"><a href="#Event-Modifiers" class="headerlink" title="Event Modifiers"></a>Event Modifiers</h3><p>å¯¹äº<code>.passive</code>ï¼Œ<code>.capture</code>å’Œ<code>.once</code>äº‹ä»¶ä¿®é¥°ç¬¦ï¼Œå¯ä»¥é©¼å³°å†™æ³•åœ¨äº‹ä»¶åç§°åé¢è¿›è¡Œè¿æ¥ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight js"><span class="title function_">h</span>(<span class="string">&#x27;input&#x27;</span>, &#123;
  <span class="title function_">onClickCapture</span>(<span class="params"></span>) &#123;
    <span class="comment">/* listener in capture mode */</span>
  &#125;,
  <span class="title function_">onKeyupOnce</span>(<span class="params"></span>) &#123;
    <span class="comment">/* triggers only once */</span>
  &#125;,
  <span class="title function_">onMouseoverOnceCapture</span>(<span class="params"></span>) &#123;
    <span class="comment">/* once + capture */</span>
  &#125;
&#125;)</code></pre>

<pre><code class="highlight jsx">&lt;input
  onClickCapture=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;
  onKeyupOnce=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;
  onMouseoverOnceCapture=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;
/&gt;</code></pre>

<p>ç„¶åå…¶ä½™çš„äº‹ä»¶å’ŒæŒ‰é”®ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨<code>withModifiers</code>ååŠ©ä½¿ç”¨ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; withModifiers &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123;
  <span class="attr">onClick</span>: <span class="title function_">withModifiers</span>(<span class="function">() =&gt;</span> &#123;&#125;, [<span class="string">&#x27;self&#x27;</span>])
&#125;)</code></pre>

<pre><code class="highlight jsx">&lt;div onClick=&#123;<span class="title function_">withModifiers</span>(<span class="function">() =&gt;</span> &#123;&#125;, [<span class="string">&#x27;self&#x27;</span>])&#125; /&gt;</code></pre>

<h3 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h3><p>è¦ä¸ºç»„ä»¶åˆ›å»ºvnodeï¼Œä¼ é€’ç»™<code>h()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯ç»„ä»¶å®šä¹‰ã€‚è¿™å°±æ„å‘³ç€ä½¿ç”¨æ¸²æŸ“å‡½æ•°æ—¶ï¼Œæ— éœ€æ³¨å†Œç»„ä»¶ï¼Œåªæ˜¯ç›´æ¥ä½¿ç”¨å¯¼å…¥çš„ç»„ä»¶å³å¯ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;./Foo.vue&#x27;</span>
<span class="keyword">import</span> <span class="title class_">Bar</span> <span class="keyword">from</span> <span class="string">&#x27;./Bar.jsx&#x27;</span>

<span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [<span class="title function_">h</span>(<span class="title class_">Foo</span>), <span class="title function_">h</span>(<span class="title class_">Bar</span>)])
&#125;</code></pre>

<pre><code class="highlight jsx"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> (
    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">      <span class="tag">&lt;<span class="name">Foo</span> /&gt;</span></span>
<span class="language-xml">      <span class="tag">&lt;<span class="name">Bar</span> /&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
  )
&#125;</code></pre>

<p>æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œåªè¦æ˜¯æœ‰æ•ˆçš„Vueç»„ä»¶ï¼Œhå‡½æ•°å°±èƒ½å¤„ç†ä»»ä½•æ–‡ä»¶æ ¼å¼å¯¼å…¥çš„ç»„ä»¶ã€‚</p>
<p>åŠ¨æ€ç»„ä»¶åœ¨æ¸²æŸ“ç»„ä»¶ä¸­å¯ç›´æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;./Foo.vue&#x27;</span>
<span class="keyword">import</span> <span class="title class_">Bar</span> <span class="keyword">from</span> <span class="string">&#x27;./Bar.jsx&#x27;</span>

<span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> ok.<span class="property">value</span> ? <span class="title function_">h</span>(<span class="title class_">Foo</span>) : <span class="title function_">h</span>(<span class="title class_">Bar</span>)
&#125;</code></pre>

<pre><code class="highlight jsx"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> ok.<span class="property">value</span> ? <span class="language-xml"><span class="tag">&lt;<span class="name">Foo</span> /&gt;</span></span> : <span class="language-xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span></span>
&#125;</code></pre>

<p>å¦‚æœç»„ä»¶æ˜¯ç”¨åç§°æ³¨å†Œçš„ï¼Œæ— æ³•ç›´æ¥å¯¼å…¥(ä¾‹å¦‚ï¼Œæœ‰åº“è¿›è¡Œçš„å…¨å±€æ³¨å†Œ)ï¼Œè¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨<code>resolveComponent</code>æ¥è§£æè¯¥ç»„ä»¶ã€‚</p>
<h3 id="Rendering-Slots"><a href="#Rendering-Slots" class="headerlink" title="Rendering Slots"></a>Rendering Slots</h3><p>åœ¨æ¸²æŸ“å‡½æ•°ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>setup()</code>çš„ä¸Šä¸‹æ–‡è®¿é—®slotã€‚ç„¶åslotså¯¹è±¡ä¸Šçš„æ¯ä¸€ä¸ªslotéƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªvnodesæ•°ç»„ï¼š</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">default</span> &#123;
  <span class="attr">props</span>: [<span class="string">&#x27;message&#x27;</span>],
  <span class="title function_">setup</span>(<span class="params">props, &#123; slots &#125;</span>) &#123;
    <span class="keyword">return</span> <span class="function">() =&gt;</span> [
      <span class="comment">// default slot:</span>
      <span class="comment">// &lt;div&gt;&lt;slot /&gt;&lt;/div&gt;</span>
      <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, slots.<span class="title function_">default</span>()),

      <span class="comment">// named slot:</span>
      <span class="comment">// &lt;div&gt;&lt;slot name=&quot;footer&quot; :text=&quot;message&quot; /&gt;&lt;/div&gt;</span>
      <span class="title function_">h</span>(
        <span class="string">&#x27;div&#x27;</span>,
        slots.<span class="title function_">footer</span>(&#123;
          <span class="attr">text</span>: props.<span class="property">message</span>
        &#125;)
      )
    ]
  &#125;
&#125;</code></pre>

<p>JSXï¼š</p>
<pre><code class="highlight js"><span class="comment">// default</span>
&lt;div&gt;&#123;slots.<span class="title function_">default</span>()&#125;&lt;/div&gt;

<span class="comment">// named</span>
<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;slots.footer(&#123; text: props.message &#125;)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></code></pre>

<h3 id="Passing-Slots"><a href="#Passing-Slots" class="headerlink" title="Passing Slots"></a>Passing Slots</h3><p>å°†å­å…ƒç´ ä¼ é€’ç»™ç»„ä»¶å’Œå­å…ƒç´ ä¼ é€’ç»™å…ƒç´ çš„æ–¹å¼æœ‰äº›ä¸åŒã€‚æˆ‘ä»¬ä¸éœ€è¦ä¼ é€’æ•°ç»„ï¼Œè€Œæ˜¯ä¼ é€’slotå‡½æ•°æˆ–è€…slotå‡½æ•°å¯¹è±¡ã€‚slotå‡½æ•°å¯ä»¥è¿”å›ä¸æ™®é€šæ¸²æŸ“å‡½æ•°çš„è¿”å›å€¼ä¸€æ ·çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨å­ç»„ä»¶è®¿é—®æ—¶ï¼Œè¿™äº›å†…å®¹å°†å§‹ç»ˆä¼šè½¬æ¢ä¸ºä¸€ä¸ªvnodesæ•°ç»„ã€‚</p>
<pre><code class="highlight js"><span class="comment">// å•ä¸ªé»˜è®¤æ’æ§½</span>
<span class="title function_">h</span>(<span class="title class_">MyComponent</span>, <span class="function">() =&gt;</span> <span class="string">&#x27;hello&#x27;</span>)

<span class="comment">// å…·åæ’æ§½</span>
<span class="comment">// æ³¨æ„ `null` æ˜¯å¿…éœ€çš„</span>
<span class="comment">// ä»¥é¿å… slot å¯¹è±¡è¢«å½“æˆ prop å¤„ç†</span>
<span class="title function_">h</span>(<span class="title class_">MyComponent</span>, <span class="literal">null</span>, &#123;
    <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;default slot&#x27;</span>,
    <span class="attr">foo</span>: <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>),
    <span class="attr">bar</span>: <span class="function">() =&gt;</span> [<span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;one&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;two&#x27;</span>)]
&#125;)</code></pre>

<p>ç­‰ä»·çš„JSXï¼š</p>
<pre><code class="highlight jsx"><span class="comment">// default</span>
&lt;<span class="title class_">MyComponent</span>&gt;&#123;<span class="function">() =&gt;</span> <span class="string">&#x27;hello&#x27;</span>&#125;&lt;/<span class="title class_">MyComponent</span>&gt;

<span class="comment">// named</span>
<span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span>&gt;</span>&#123;&#123;</span>
<span class="language-xml">  default: () =&gt; &#x27;default slot&#x27;,</span>
<span class="language-xml">  foo: () =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>foo<span class="tag">&lt;/<span class="name">div</span>&gt;</span>,</span>
<span class="language-xml">  bar: () =&gt; [<span class="tag">&lt;<span class="name">span</span>&gt;</span>one<span class="tag">&lt;/<span class="name">span</span>&gt;</span>, <span class="tag">&lt;<span class="name">span</span>&gt;</span>two<span class="tag">&lt;/<span class="name">span</span>&gt;</span>]</span>
<span class="language-xml">&#125;&#125;<span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span></code></pre>

<p>å°†slotä½œä¸ºå‡½æ•°ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå¯ä»¥è®©å­ç»„ä»¶æ‡’æ•£åœ°è°ƒç”¨slotã€‚è¿™æ ·ï¼Œå­ç»„ä»¶è€Œä¸æ˜¯çˆ¶ç»„ä»¶å°±èƒ½è·Ÿè¸ªslotçš„ä¾èµ–å…³ç³»ï¼Œä»è€Œå®ç°æ›´å‡†ç¡®ã€æ›´æœ‰æ•ˆçš„æ›´æ–°ã€‚</p>
<h3 id="Built-in-Components"><a href="#Built-in-Components" class="headerlink" title="Built-in Components"></a>Built-in Components</h3><p>å†…ç½®ç»„ä»¶å¦‚<code>&lt;KeepAlive&gt;</code>, <code>&lt;Transition&gt;</code>, <code>&lt;TransitionGroup&gt;</code>, <code>&lt;Teleport&gt;</code> å’Œ <code>&lt;Suspense&gt;</code>å¿…é¡»å¯¼å…¥æ‰èƒ½åœ¨æ¸²æŸ“å‡½æ•°ä¸­ä½¿ç”¨</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; h, <span class="title class_">KeepAlive</span>, <span class="title class_">Teleport</span>, <span class="title class_">Transition</span>, <span class="title class_">TransitionGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">export</span> <span class="keyword">default</span> &#123;
  setup () &#123;
    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="title class_">Transition</span>, &#123; <span class="attr">mode</span>: <span class="string">&#x27;out-in&#x27;</span> &#125;, <span class="comment">/* ... */</span>)
  &#125;
&#125;</code></pre>

<h3 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h3><p>åœ¨æ¨¡ç‰ˆç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œ<code>v-model</code>æŒ‡ä»¤ä¼šæ‰©å±•ä¸º<code>modelValue</code>å’Œ<code>onUpdate:modelValue</code>ä¸¤ä¸ªpropsï¼Œåœ¨æ¸²æŸ“å‡½æ•°ä¸­å°±å¿…é¡»è‡ªå·±æä¾›è¿™äº›propsï¼š</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">default</span> &#123;
  <span class="attr">props</span>: [<span class="string">&#x27;modelValue&#x27;</span>],
  <span class="attr">emits</span>: [<span class="string">&#x27;update:modelValue&#x27;</span>],
  <span class="title function_">setup</span>(<span class="params">props, &#123; emit &#125;</span>) &#123;
    <span class="keyword">return</span> <span class="function">() =&gt;</span>
      <span class="title function_">h</span>(<span class="title class_">SomeComponent</span>, &#123;
        <span class="attr">modelValue</span>: props.<span class="property">modelValue</span>,
        <span class="string">&#x27;onUpdate:modelValue&#x27;</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, value)
      &#125;)
  &#125;
&#125;</code></pre>

<h3 id="Custom-Directives"><a href="#Custom-Directives" class="headerlink" title="Custom Directives"></a>Custom Directives</h3><p>è‡ªå®šä¹‰æŒ‡ä»¤å¯ä»¥é€šè¿‡<code>withDirectives</code>åº”ç”¨åˆ°vnodeï¼š</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; h, withDirectives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="comment">// a custom directive</span>
<span class="keyword">const</span> pin = &#123;
  <span class="title function_">mounted</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;,
  <span class="title function_">updated</span>(<span class="params"></span>) &#123; <span class="comment">/* ... */</span> &#125;
&#125;

<span class="comment">// &lt;div v-pin:top.animate=&quot;200&quot;&gt;&lt;/div&gt;</span>
<span class="keyword">const</span> vnode = <span class="title function_">withDirectives</span>(<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>), [
  [pin, <span class="number">200</span>, <span class="string">&#x27;top&#x27;</span>, &#123; <span class="attr">animate</span>: <span class="literal">true</span> &#125;]
])</code></pre>

<p>å¦‚æœæŒ‡ä»¤æ˜¯é€šè¿‡åå­—æ³¨å†Œçš„ï¼Œæ˜¯æ— æ³•ç›´æ¥å¯¼å…¥çš„ï¼Œéœ€è¦ä½¿ç”¨<code>resolveDirective</code>å¯¹å…¶è¿›è¡Œè§£æã€‚</p>
<h3 id="Template-Refs"><a href="#Template-Refs" class="headerlink" title="Template Refs"></a>Template Refs</h3><p>åœ¨ä½¿ç”¨ç»„åˆå¼APIæ—¶ï¼Œæ¨¡ç‰ˆrefæ˜¯é€šè¿‡<code>ref()</code>æœ¬èº«ä½œä¸ºpropsä¼ é€’ç»™vnodeåˆ›å»ºçš„</p>
<pre><code class="highlight js"><span class="keyword">import</span> &#123; h, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">export</span> <span class="keyword">default</span> &#123;
  <span class="title function_">setup</span>(<span class="params"></span>) &#123;
    <span class="keyword">const</span> divEl = <span class="title function_">ref</span>()

    <span class="comment">// &lt;div ref=&quot;divEl&quot;&gt;</span>
    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">ref</span>: divEl &#125;)
  &#125;
&#125;</code></pre>

<h2 id="Functional-Components"><a href="#Functional-Components" class="headerlink" title="Functional Components"></a>Functional Components</h2><p>å‡½æ•°ç»„ä»¶æ˜¯ç»„ä»¶çš„å¦ä¸€ç§å½¢å¼ï¼Œè‡ªèº«æ²¡æœ‰ä»»ä½•çŠ¶æ€ã€‚æ‰§è¡Œçš„å†…å®¹å°±åƒçº¯å‡½æ•°ï¼Œpropsè¾“å…¥ï¼Œvnodeè¾“å‡ºã€‚åœ¨æ¸²æŸ“æ—¶ä¸åˆ›å»ºç»„ä»¶å®ä¾‹(å³æ²¡æœ‰<code>this</code>)ï¼Œä¹Ÿæ²¡æœ‰ä¸€äº›ç»„ä»¶å£°æ˜å‘¨æœŸé’©å­ã€‚</p>
<p>æˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªæ™®é€šå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ã€‚è¯¥å‡½æ•°å®é™…ä¸Šå°±æ˜¯ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ã€‚</p>
<p>å‡½æ•°ç»„ä»¶çš„ç­¾åä¸<code>setup()</code>hookç›¸åŒï¼š</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">props, &#123; slots, emit, attrs &#125;</span>) &#123;
  <span class="comment">// ...</span>
&#125;</code></pre>

<p>ç»„ä»¶çš„å¤§å¤šæ•°å¸¸è§„é…ç½®é€‰é¡¹éƒ½ä¸é€‚ç”¨äºå‡½æ•°ç»„ä»¶ã€‚ä¸è¿‡ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å±æ€§æ¥å®šä¹‰<code>props</code>å’Œ<code>emits</code>ï¼š</p>
<pre><code class="highlight js"><span class="title class_">MyComponent</span>.<span class="property">props</span> = [<span class="string">&#x27;value&#x27;</span>]
<span class="title class_">MyComponent</span>.<span class="property">emits</span> = [<span class="string">&#x27;click&#x27;</span>]</code></pre>

<p>å¦‚æœæœªæŒ‡å®špropsé€‰é¡¹ï¼Œé‚£ä¹ˆä¼ é€’ç»™å‡½æ•°çš„propså¯¹è±¡å°†åŒ…å«æ‰€æœ‰å±æ€§ï¼Œä¸attrsç›¸åŒã€‚é™¤éæŒ‡å®šæ¥propsé€‰é¡¹ï¼Œå¦åˆ™propsåç§°ä¸ä¼šè§„èŒƒä¸ºé©¼å³°ã€‚</p>
<p>å¯¹äºæ²¡æœ‰æ˜ç¡®propsçš„å‡½æ•°ç»„ä»¶ï¼Œå±æ€§ç©¿é€çš„å·¥ä½œåŸç†ä¸æ™®é€šç»„ä»¶å¤§è‡´ç›¸åŒã€‚ä½†æ˜¯ï¼Œå¯¹äºæ²¡æœ‰æ˜ç¡®æŒ‡å®špropsçš„å‡½æ•°ç»„ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä¼šä»<code>attrs</code>ç»§æ‰¿<code>class</code>ã€<code>style</code>å’Œ<code>onXxx</code>äº‹ä»¶ä¾¦å¬å™¨ã€‚æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œéƒ½å¯ä»¥å°†<code>inheritAttrs</code>è®¾ä¸º<code>false</code>ä»¥ç¦ç”¨å±æ€§ç»§æ‰¿ï¼š</p>
<pre><code class="highlight js"><span class="title class_">MyComponent</span>.<span class="property">inheritAttrs</span> = <span class="literal">false</span></code></pre>

<p>å‡½æ•°ç»„ä»¶å¯ä»¥åƒæ™®é€šç»„ä»¶ä¸€æ ·æ³¨å†Œå’Œä½¿ç”¨ã€‚å¦‚æœå°†å‡½æ•°ä½œä¸º<code>h()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå®ƒä¼šè¢«è§†ä¸ºå‡½æ•°ç»„ä»¶ã€‚</p>
<h3 id="Typing-Functional-Components"><a href="#Typing-Functional-Components" class="headerlink" title="Typing Functional Components"></a>Typing Functional Components</h3><p>å‡½æ•°ç»„ä»¶å¯æ ¹æ®å…¶å‘½åæˆ–åŒ¿åç±»å‹æ¥è¿›è¡Œæ ‡æ³¨ç±»å‹ã€‚åœ¨SFCæ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ï¼ŒVolarè¿˜æ”¯æŒå¯¹å…¶è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚</p>
<p>å…·åå‡½æ•°ç»„ä»¶</p>
<pre><code class="highlight tsx"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">SetupContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>
<span class="keyword">type</span> <span class="title class_">FComponentProps</span> = &#123;
  <span class="attr">message</span>: <span class="built_in">string</span>
&#125;

<span class="keyword">type</span> <span class="title class_">Events</span> = &#123;
  <span class="title function_">sendMessage</span>(<span class="attr">message</span>: <span class="built_in">string</span>): <span class="built_in">void</span>
&#125;

<span class="keyword">function</span> <span class="title function_">FComponent</span>(<span class="params"></span>
<span class="params">  props: FComponentProps,</span>
<span class="params">  context: SetupContext&lt;Events&gt;</span>
<span class="params"></span>) &#123;
  <span class="keyword">return</span> (
    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> context.emit(&#x27;sendMessage&#x27;, props.message)&#125;&gt;</span>
<span class="language-xml">        &#123;props.message&#125; &#123;&#x27; &#x27;&#125;</span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>
  )
&#125;

<span class="title class_">FComponent</span>.<span class="property">props</span> = &#123;
  <span class="attr">message</span>: &#123;
    <span class="attr">type</span>: <span class="title class_">String</span>,
    <span class="attr">required</span>: <span class="literal">true</span>
  &#125;
&#125;

<span class="title class_">FComponent</span>.<span class="property">emits</span> = &#123;
  <span class="attr">sendMessage</span>: <span class="function">(<span class="params">value: <span class="built_in">unknown</span></span>) =&gt;</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>
&#125;</code></pre>

<p>åŒ¿åå‡½æ•°ç»„ä»¶</p>
<pre><code class="highlight tsx"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">FunctionalComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>

<span class="keyword">type</span> <span class="title class_">FComponentProps</span> = &#123;
  <span class="attr">message</span>: <span class="built_in">string</span>
&#125;

<span class="keyword">type</span> <span class="title class_">Events</span> = &#123;
  <span class="title function_">sendMessage</span>(<span class="attr">message</span>: <span class="built_in">string</span>): <span class="built_in">void</span>
&#125;

<span class="keyword">const</span> <span class="title class_">FComponent</span>: <span class="title class_">FunctionalComponent</span>&lt;<span class="title class_">FComponentProps</span>, <span class="title class_">Events</span>&gt; = <span class="function">(<span class="params"></span></span>
<span class="params"><span class="function">  props,</span></span>
<span class="params"><span class="function">  context</span></span>
<span class="params"><span class="function"></span>) =&gt;</span> &#123;
  <span class="keyword">return</span> (
    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> context.emit(&#x27;sendMessage&#x27;, props.message)&#125;&gt;</span>
<span class="language-xml">      Â  &#123;props.message&#125;Â &#123;&#x27; &#x27;&#125;</span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>
  )
&#125;

<span class="title class_">FComponent</span>.<span class="property">props</span> = &#123;
  <span class="attr">message</span>: &#123;
    <span class="attr">type</span>: <span class="title class_">String</span>,
    <span class="attr">required</span>: <span class="literal">true</span>
  &#125;
&#125;

<span class="title class_">FComponent</span>.<span class="property">emits</span> = &#123;
  <span class="attr">sendMessage</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>
&#125;</code></pre>
]]></content>
      <tags>
        <tag>Vue</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Resource optimization in Node.js</title>
    <url>/2023/07/15/%E3%80%90%E7%BF%BB%E3%80%91Resource-optimization-in-Node-js/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://medium.com/pipedrive-engineering/resource-optimization-in-node-js-c90c731f9df4">Resource optimization in Node.js</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@nelson.gomes_64705">Nelson Gomes</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢Node.jsæœ€å¤§ä¼˜åŒ–çš„å¯èƒ½æ€§ï¼Œå¹¶äº†è§£èµ„æºå…±äº«çš„å¥½å¤„ï¼Œåè¯æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»éš”ç¦»çš„å‡è®¾ã€‚åŠ å…¥æˆ‘ä»¬ï¼Œå‘æ˜Node.jsçš„å…¨éƒ¨æ½œåŠ›ï¼Œäº†è§£èµ„æºä¼˜åŒ–å¦‚ä½•æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“Node.jsé€Ÿåº¦å¿«ï¼Œå•çº¿ç¨‹ï¼Œæ— é˜»å¡ï¼Œä½†æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ˜¯å¦å……åˆ†åˆ©ç”¨äº†å‘¢ï¼Ÿå¤§å¤šæ•°æƒ…å†µä¸‹çš„ç­”æ¡ˆæ˜¯â€æ²¡æœ‰â€</p>
<p>å› ä¸ºå®ƒæ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šå¿˜è®°æˆ‘ä»¬ä»ç„¶æœ‰å‡ ä¸ªç±»ä¼¼çº¿ç¨‹çš„æ‰§è¡Œæ–¹å¼ï¼æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¹è¿›ä»£ç çš„æ‰§è¡Œæ–¹å¼ï¼Œå°†çº¿ç¨‹è·å¾—çš„èµ„æºæä¾›ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œä»è€Œå‡å°‘è¿™äº›å®è´µèµ„æºçš„è´Ÿè½½ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Y7nbW1YwR2kEX-2hq16vA.png"></p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç«¯ç‚¹è°ƒç”¨ä¸€ä¸ªAPIï¼Œå¹¶ä¸”è¯¥ç«¯ç‚¹åŒæ—¶è¢«è®¸å¤šå®¢æˆ·ç«¯è°ƒç”¨ã€‚å› æ­¤ï¼Œå½“ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾å¹¶éœ€è¦è°ƒç”¨è¯¥APIæ—¶ï¼Œç¬¬äºŒä¸ªè¯·æ±‚ä¹Ÿåˆ°è¾¾å¹¶è°ƒç”¨ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚å®Œå…¨ç›¸åŒçš„APIï¼Œä¸ºä»€ä¹ˆä¸å…±äº«å®ƒå‘¢ï¼Ÿ</p>
<p>å¼€å‘äººå‘˜ç»å¸¸æœ‰ä¸ªé”™è¯¯çš„å‡è®¾ï¼Œè®¤ä¸ºåœ¨Node.jsæœåŠ¡å™¨ä¸Šå·¥ä½œæ—¶ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»ä¸å…¶ä»–è¯·æ±‚å®Œå…¨éš”ç¦»ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨ä¸å…¶ä»–è¯·æ±‚éš”ç¦»çš„æƒ…å†µä¸‹è¿›è¡Œè°ƒç”¨å’Œæ•°æ®åº“è¯·æ±‚ã€‚</p>
<p>äº‹å®å¹¶éå¦‚æ­¤ã€‚</p>
<p>å¦‚æœæ»¡è¶³æŸäº›æƒ…å†µï¼Œè¯·æ±‚å¯ä»¥å…±äº«åŒä¸€ä¸ªèµ„æºï¼š</p>
<ul>
<li>é¦–å…ˆè¿™ä¸ªè¯·æ±‚ä¸æ˜¯å®¢æˆ·ç‰¹å®šæ•°æ®ï¼Œæˆ–è€…æ²¡æœ‰ä½¿ç”¨ authentication token ï¼ˆæˆ‘ä»¬ç»ä¸èƒ½æ··åˆè¿™äº›è¯·æ±‚ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦çŸ¥é“è°æå‡ºäº†è¯·æ±‚ï¼‰ã€‚</li>
<li>è¯·æ±‚æ•°æ®ç¡®ä¿æ˜¯å®Œå…¨ç›¸åŒã€‚</li>
<li>æˆ‘ä»¬è¦ç¡®ä¿å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œä¸ä¼šå°†ä¿¡æ¯æ³„éœ²ç»™å…¶ä»–å®¢æˆ·ç«¯(å¯¼è‡´GDPRé—®é¢˜)ï¼Œå¯ä»¥é€šè¿‡è®°å½•åŸå§‹é”™è¯¯å¹¶å‘æ‰€æœ‰å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé€šç”¨é”™è¯¯æ¥é¿å…ã€‚</li>
<li>æœ€åï¼Œå®ƒéœ€è¦æ˜¯ä¸€ä¸ªé¢‘ç¹è°ƒç”¨çš„è¯·æ±‚ï¼Œæœ€å¥½æ˜¯éœ€è¦ä¸€äº›æ—¶é—´æ¥æ‰§è¡Œï¼Œè¿™æ ·èµ„æºå…±äº«å¯¹å¤šä¸ªæ‰§è¡Œè¯·æ±‚æ¥è¯´æ‰æœ‰å¥½å¤„ï¼Œå¦åˆ™å¥½å¤„å‡ ä¹ä¸ä¼šå¯Ÿè§‰</li>
</ul>
<p>å…³äºè¯·æ±‚æµç¨‹ï¼Œè¯·æŸ¥çœ‹ä¸‹å›¾ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªé¢œè‰²æ¡ä»£è¡¨ä½¿ç”¨èµ„æºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚å› ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å…±äº«èµ„æºï¼Œè€Œå½“åº”ç”¨ç¨‹åºè¿›è¡Œæ•°åƒä¸ªå¹¶å‘è¯·æ±‚æ—¶è¿™é€šå¸¸å¾ˆé‡è¦ï¼Œå¹¶ä¸”ä¸å®¹æ˜“è§£å†³ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyXUNpB0IYVS9pT780KbIw.png"></p>
<p>å½“æˆ‘ä»¬æ‹¥æœ‰éå¸¸ä¸“é—¨åŒ–çš„æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰å¤šä¸ªè¯·æ±‚è¯·æ±‚å®Œå…¨ç›¸åŒçš„èµ„æºï¼Œè¿™æ˜¯æ”¹è¿›æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æœºä¼šã€‚</p>
<p>è¯·çœ‹ï¼Œä¸€äº›è°ƒç”¨è¢«Promiseæ›¿ä»£äº†ã€‚è¿™æ˜¯å› ä¸ºåŒæ ·çš„èµ„æºå·²ç»è¢«è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šå…±äº«å®ƒè€Œä¸æ˜¯å†æ¬¡è°ƒç”¨ï¼Œä»è€Œå‡è½»èµ„æºçš„è´Ÿè½½ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vCkIw3uTwjUSTsoAj6V5iA.png"></p>
<p>åœ¨Javaç­‰è¯­è¨€ä¸­ï¼Œå¼€å‘è€…ä½¿ç”¨åŒæ­¥æ–¹æ³•æ¥æ§åˆ¶èµ„æºè®¿é—®ã€‚è€Œå¯¹äºNode.jsæœ‰ä¸ªå¥½å¤„ï¼Œç”±äºNode.jsçš„æ¶æ„ï¼Œä¸éœ€è¦å¯¹ mutexes æˆ– semaphores è¿›è¡Œæ˜‚è´µçš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™ä½¿å¾—Node.jsçš„é€Ÿåº¦æ›´å¿«ã€‚</p>
<p>å½“ç„¶ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘è¯´çš„æ˜¯æœåŠ¡çš„å•ä¸ªå®ä¾‹ã€‚åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Šè¿›è¡Œæ­¤æ“ä½œç¨å¾®å¤æ‚ä¸€ä¸‹ã€‚å°½ç®¡æ¦‚å¿µæ˜¯ç›¸ä¼¼çš„ï¼ˆæˆ‘æ­£åœ¨ç ”ç©¶æ›´é«˜çº§çš„åˆ†å¸ƒå¼æ¨¡å¼ï¼‰</p>
<p>è¿™ä¸ªä¼˜åŒ–ç‚¹çš„æœ‰è¶£ä¹‹å¤„ä¸ä»…åœ¨äºèŠ‚çœèµ„æºï¼Œå®é™…ä¸Šï¼Œå®ƒè¿˜èƒ½è®©ä½ çš„åº”ç”¨ç¨‹åºå˜å¾—æ›´å¿«ã€‚ä½ å¯èƒ½ä¼šé—®ã€‚æ€ä¹ˆå¯èƒ½ï¼Ÿè®©æˆ‘ä»¬å‡è®¾ä¸€ä¸ªæ“ä½œè€—æ—¶200msï¼Œå¹¶ä¸”åŒä¸€æ“ä½œçš„ä»»ä½•åç»­è¯·æ±‚éƒ½ä¼šé‡å¤ä½¿ç”¨è¯¥æ“ä½œã€‚è¿™æ„å‘³ç€ï¼Œåœ¨è¿™200mså†…ä»»ä½•ä¼ å…¥çš„è¯·æ±‚éƒ½å°†é‡ç”¨è¯¥ç»“æœï¼Œå³ä½¿å®ƒæ˜¯åœ¨åˆå§‹æ“ä½œå¼€å§‹1msåæˆ–200msåå¼€å§‹çš„ï¼Œå› æ­¤é‡ç”¨æ“ä½œå¹³å‡è€—æ—¶200ms&#x2F;2&#x3D;100msã€‚</p>
<p>é€šè¿‡é‡å¤è¿™äº›æ“ä½œï¼Œä½ å°†å¹³å‡èŠ‚çœä¸€åŠçš„æ—¶é—´ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§çš„ä¼˜åŒ–ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uA-88yStVJNi_bhp9SKX0A.png"></p>
<p>é™¤éä½ åœ¨ç±»ä¼¼ transaction çš„æ“ä½œèŒƒå›´å†…è¿è¡Œï¼Œæˆ–è€…åœ¨APIè°ƒç”¨æ—¶ä½¿ç”¨äº†ç‰¹å®šçš„ ç”¨æˆ·tokenï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸åº”è¯¥å…±äº«ç”±æ­¤äº§ç”Ÿçš„æ•°æ®ï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–ä½ å¯ä»¥æ¯«æ— é¡¾è™‘åœ°å…±äº«å¤§éƒ¨åˆ†å¸¸è§æ“ä½œæ•°æ®ã€‚</p>
<p>é‚£æˆ‘ä»¬å¦‚ä½•å®ç°è¿™ä¸ªç›®æ ‡ï¼ŒPromise å°±æ˜¯ç­”æ¡ˆ</p>
<p>å½“æˆ‘ä»¬æ£€æµ‹åˆ°å¯¹èµ„æºçš„è°ƒç”¨å·²ç»å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬ä¸å¯åŠ¨å¯¹å®ƒçš„å¦ä¸€ä¸ªè°ƒç”¨ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªPromiseæ¥è¡¨ç¤ºå…¶ç»“æœ(or failure)ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥é¿å…å¯¹APIã€æ•°æ®åº“æŸ¥è¯¢æˆ–ä»»ä½•éœ€è¦è°ƒç”¨çš„å¹¶å‘è¯·æ±‚ï¼Œä»è€Œé™ä½èµ„æºè´Ÿè½½ã€‚</p>
<p>æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•çš„è°ƒç”¨ï¼Œå®ƒéœ€è¦ä¸€äº›æ—¶é—´å¹¶è¿”å›ä¸€ä¸ªç»“æœã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦å°†å‡ ä¸ªå€¼ä¹˜ä»¥200msçš„å»¶è¿Ÿï¼Œè¿™å°†ä»£è¡¨æˆ‘ä»¬çš„APIè°ƒç”¨æˆ–æ•°æ®åº“æŸ¥è¯¢ï¼š</p>
<pre><code class="highlight ts"><span class="keyword">import</span> &#123; delay &#125; <span class="keyword">from</span> <span class="string">&#x27;ts-timeframe&#x27;</span>;

<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">simulatedCall</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) &#123;
  <span class="comment">// these 3 lines represent our call</span>
  <span class="keyword">await</span> <span class="title function_">delay</span>(<span class="number">200</span>);
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`calculated <span class="subst">$&#123;a&#125;</span> * <span class="subst">$&#123;b&#125;</span>`</span>);
  <span class="keyword">return</span> a * b;
&#125;

<span class="comment">// our data fetching function, could be an API call, db query, whatever slow promise is needed</span>
<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">costlyFunction</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">number</span>&gt; &#123;
  <span class="keyword">return</span> <span class="title function_">simulatedCall</span>(a, b);
&#125;

<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> values = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([
    <span class="title function_">costlyFunction</span>(<span class="number">4</span>, <span class="number">5</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">4</span>, <span class="number">5</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">4</span>, <span class="number">5</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">50</span>, <span class="number">2</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">50</span>, <span class="number">2</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">50</span>, <span class="number">2</span>),
  ]);

  <span class="variable language_">console</span>.<span class="title function_">log</span>(values);
&#125;

<span class="title function_">main</span>();</code></pre>

<p>å½“æˆ‘ä»¬æ‰§è¡Œè¿™æ®µä»£ç æ—¶ï¼Œå¾—åˆ°äº†é¢„æœŸçš„ç»“æœï¼Œæ²¡æœ‰ä»»ä½•æ„å¤–ã€‚æˆ‘ä»¬è°ƒç”¨è¯¥å‡½æ•°6æ¬¡ï¼Œæ¯æ¬¡ç­‰å¾…200ms</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0X2mg3xU-XhG-W6YmR26YQ.png"></p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ”¹å˜è¿™äº›ä»£ç ï¼Œåˆ©ç”¨ä¹‹å‰çš„æ¨¡å¼æ¥æ”¹è¿›æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚è¿™æ¬¡æˆ‘ä»¬å°†ä½¿ç”¨ <code>OperationRegistry</code> æ¥ç®¡ç†æˆ‘ä»¬çš„è°ƒç”¨ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„keyæ¥æ ‡è¯†æˆ‘ä»¬åœ¨æ³¨å†Œè¡¨ä¸­çš„æ“ä½œã€‚</p>
<p>å®Œæˆåï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ <code>isExecuting</code> å‡½æ•°æŸ¥çœ‹å®ƒæ˜¯å¦è¿”å›ä¸€ä¸ªPromiseã€‚å¦‚æœæ˜¯ï¼Œè¿™æ„å‘³ç€å¦ä¸€ä¸ªæ‰§è¡Œæ­£åœ¨è¿›è¡Œä¸­ï¼Œæˆ‘ä»¬åªéœ€è¿”å›ç­‰å¾…ç»“æœçš„Promiseã€‚å¦åˆ™ï¼Œæˆ‘ä»¬æ‰§è¡Œè°ƒç”¨ï¼Œå°†ç»“æœä¼ æ’­ç»™æ‰€æœ‰å¾…æ‰§è¡Œçš„Promiseï¼Œå¹¶è¿”å›æˆ‘ä»¬çš„å€¼ï¼Œæ ¹æ®æ“ä½œæ˜¯å¦æˆåŠŸï¼Œå¯ä»¥é€šè¿‡ <code>triggerAwaitingResolves</code> æˆ– <code>triggerAwaitingRejects</code> å°†ç»“æœä¼ é€’ç»™ç‰¹å®š Promise</p>
<pre><code class="highlight ts"><span class="keyword">import</span> &#123; delay &#125; <span class="keyword">from</span> <span class="string">&#x27;ts-timeframe&#x27;</span>;
<span class="keyword">import</span> &#123; <span class="title class_">OperationRegistry</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;reliable-caching&#x27;</span>;

<span class="keyword">const</span> operationRegistry = <span class="keyword">new</span> <span class="title class_">OperationRegistry</span>(<span class="string">&#x27;costlyFunction&#x27;</span>);

<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">simulatedCall</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) &#123;
  <span class="comment">// these 3 lines represent our call</span>
  <span class="keyword">await</span> <span class="title function_">delay</span>(<span class="number">200</span>);
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`calculated <span class="subst">$&#123;a&#125;</span> * <span class="subst">$&#123;b&#125;</span>`</span>);
  <span class="keyword">return</span> a * b;
&#125;

<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">costlyFunction</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">number</span>&gt; &#123;
  <span class="keyword">const</span> uniqueOperationKey = <span class="string">`<span class="subst">$&#123;a&#125;</span>:<span class="subst">$&#123;b&#125;</span>`</span>;
  <span class="keyword">const</span> promiseForResult = operationRegistry.<span class="property">isExecuting</span>&lt;<span class="built_in">number</span>&gt;(uniqueOperationKey);

  <span class="comment">// a promise means execution for the same key is ongoing, we just need to await for it</span>
  <span class="keyword">if</span> (promiseForResult) &#123;
    <span class="keyword">return</span> promiseForResult;
  &#125;

  <span class="keyword">try</span> &#123;
    <span class="comment">// otherwise we call it</span>
    <span class="keyword">const</span> value = <span class="keyword">await</span> <span class="title function_">simulatedCall</span>(a, b);

    <span class="comment">// pass value to awaiting promises (in next event loop, to avoid delaying current execution)</span>
    operationRegistry.<span class="title function_">triggerAwaitingResolves</span>(uniqueOperationKey, value);

    <span class="comment">// return value to current execution</span>
    <span class="keyword">return</span> value;
  &#125; <span class="keyword">catch</span> (e) &#123;
    <span class="comment">// pass error to awaiting rejects (in next event loop, to avoid delaying current execution)</span>
    operationRegistry.<span class="title function_">triggerAwaitingRejects</span>(uniqueOperationKey, e);

    <span class="comment">// throw exception to current execution</span>
    <span class="keyword">throw</span> e;
  &#125;
&#125;

<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> values = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([
    <span class="title function_">costlyFunction</span>(<span class="number">4</span>, <span class="number">5</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">4</span>, <span class="number">5</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">4</span>, <span class="number">5</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">50</span>, <span class="number">2</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">50</span>, <span class="number">2</span>),
    <span class="title function_">costlyFunction</span>(<span class="number">50</span>, <span class="number">2</span>),
  ]);

  <span class="variable language_">console</span>.<span class="title function_">log</span>(values);
&#125;

<span class="title function_">main</span>();</code></pre>

<p>è®©æˆ‘ä»¬çœ‹çœ‹å½“ç¬¬äºŒæ¬¡æ‰§è¡Œè¿™æ®µä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YRX9-tGj6Gwaciiudtj13Q.png"></p>
<p>ç»“æœå®Œå…¨ç›¸åŒï¼Œä½†æˆ‘ä»¬çš„å‡½æ•°åªè°ƒç”¨äº†2æ¬¡ï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„6æ¬¡ï¼Œæ¯ä¸ªkeyè¢«è°ƒç”¨ä¸€æ¬¡ã€‚å½“ç„¶ï¼Œåªæœ‰å½“ä½ å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œæˆ–è€…å› ä¸ºæ“ä½œè€—æ—¶è¿‡é•¿ï¼Œæˆ–è€…å› ä¸ºæ“ä½œé¢‘ç¹å‘ç”Ÿæ—¶ï¼Œè¿™ç§æ¨¡å¼æ‰æ˜¯æœ‰ç›Šçš„ã€‚</p>
<p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼šé”™è¯¯å’Œç»“æœæ˜¯æ‰€æœ‰æ‰§è¡Œå…±äº«çš„ï¼Œæ‰€ä»¥è¦éå¸¸æ³¨æ„ä¸è¦æ±¡æŸ“å…±äº«çš„ç»“æœï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é”™è¯¯ã€‚å¦‚æœéœ€è¦æ›´æ”¹å¯¹è±¡ï¼Œä¸è¦å¿˜è®°å…‹éš†å®ƒã€‚</p>
<p>Conclusions:</p>
<ul>
<li>è™½ç„¶è¿™å¹¶éæ˜“äº‹ï¼Œä½†å¯¹äºå¹¶å‘åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå®ƒèƒ½å¸¦æ¥å¾ˆå¤§çš„å¥½å¤„ï¼Œå› ä¸ºèµ„æºéå¸¸ç¨€ç¼ºã€‚æ­¤å¤–ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­æ‰€è§£é‡Šçš„ï¼Œè¿™ä¸ä»…å¯ä»¥é‡Šæ”¾è¿™äº›èµ„æºï¼Œè¿˜å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚</li>
<li>è¿™ä¸ªæ”¹å˜ä¼šå¯¹é¢‘ç¹è°ƒç”¨çš„æ“ä½œäº§ç”Ÿå·¨å¤§å½±å“ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¯ä»¥èŠ‚çœèµ„æºå¹¶æé«˜ç³»ç»Ÿç¨³å®šæ€§ã€‚å³ä½¿æ˜¯å¾®ä¸è¶³é“çš„æ”¶ç›Šï¼Œä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬ç¼©çŸ­P99çš„å“åº”æ—¶é—´ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</li>
<li>å¦‚æœåœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ç¼“å†²ï¼Œæ•ˆæœæ›´å¥½ï¼æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸åªæ˜¯åœ¨å•ä¸ªå®ä¾‹ä¸ŠèŠ‚çœèµ„æºï¼Œè€Œæ˜¯åœ¨æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ä¹‹é—´èŠ‚çœè¿™äº›èµ„æºï¼Œä¼šæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œå› ä¸ºè¿™æ ·å°±æ›´æœ‰å¯èƒ½åœ¨å¤šä¸ªå®ä¾‹ä¸­å…±äº«å¸¸ç”¨èµ„æºã€‚</li>
<li>è¿™äº›å°ç»†èŠ‚æ˜¯åŒºåˆ†ä¼˜ç§€çš„å¾®æœåŠ¡æ¶æ„å’Œä¸€èˆ¬çš„å¾®æœåŠ¡æ¶æ„çš„å…³é”®æ‰€åœ¨ï¼Œå› ä¸ºCPUåŠŸç‡å’Œå†…å­˜å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œè€Œæ‹¥æœ‰ä¼˜åŒ–çš„æœåŠ¡æ‰æ˜¯åŒºåˆ†èƒœè€…å’Œè´¥è€…çš„å…³é”®æ‰€åœ¨ã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>JavaScript</tag>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘SOLID Principles in JavaScript</title>
    <url>/2023/06/02/%E3%80%90%E7%BF%BB%E3%80%91SOLID-Principles-in-JavaScript/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://medium.com/@akashjha9041/solid-principles-in-javascript-ab69197e4cf7">SOLID Principles in JavaScript</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@akashjha9041">roniee</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>SOLIDåŸåˆ™æ˜¯ç”±Robert C. Martinæå‡ºçš„ä¸€å¥—è½¯ä»¶è®¾è®¡åŸåˆ™ã€‚è¿™äº›åŸåˆ™æŒ‡å¯¼å¼€å‘äººå‘˜æ„å»ºå‡ºå¥å£®çš„ã€å¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å°†ç»´æŠ¤çš„æˆæœ¬é™åˆ°æœ€ä½ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨JavaScriptä¸­ä½¿ç”¨è¿™äº›åŸåˆ™ï¼Œå¹¶ä¼šå±•ç¤ºä¸€äº›ä»£ç ç¤ºä¾‹</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/0*b8uhCfoR8YgDFc58"></p>
<p>SOLIDåŸåˆ™æ˜¯ç”±Robert C. Martin. â€œBobå”å”â€ æå‡ºçš„ä¸€å¥—è½¯ä»¶è®¾è®¡åŸåˆ™ã€‚è¿™äº›åŸåˆ™æŒ‡å¯¼å¼€å‘äººå‘˜æ„å»ºå‡ºå¥å£®çš„ã€å¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å°†ç»´æŠ¤çš„æˆæœ¬é™åˆ°æœ€ä½ã€‚</p>
<p>å°½ç®¡SOLIDåŸåˆ™ç»å¸¸è¢«ç”¨äºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°†å…¶ç”¨äºå…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚JavaScriptã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨JavaScriptä¸­ä½¿ç”¨è¿™äº›åŸåˆ™ï¼Œå¹¶ä¼šå±•ç¤ºä¸€äº›ä»£ç ç¤ºä¾‹</p>
<h2 id="What-are-the-SOLID-principles"><a href="#What-are-the-SOLID-principles" class="headerlink" title="What are the SOLID principles?"></a>What are the SOLID principles?</h2><ul>
<li>Single responsibility principleï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰</li>
<li>Open-closed principleï¼ˆå¼€é—­åŸåˆ™ï¼‰</li>
<li>Liskov substitution principleï¼ˆé‡Œå¼æ›¿æ¢åŸåˆ™ï¼‰</li>
<li>Interface segregation principleï¼ˆæ¥å£åˆ†ç¦»åŸåˆ™ï¼‰</li>
<li>Dependency inversion principleï¼ˆä¾èµ–å€’ç½®åŸåˆ™ï¼‰</li>
</ul>
<h2 id="Single-responsibility-principle"><a href="#Single-responsibility-principle" class="headerlink" title="Single responsibility principle"></a>Single responsibility principle</h2><p>ä¸€ä¸ªclassï¼Œä¸€ä¸ªmoduleæˆ–è€…ä¸€ä¸ªfunctionåº”è¯¥åªè´Ÿè´£ä¸€ä¸ªè§’è‰²ã€‚æ‰€ä»¥å®ƒåº”è¯¥åªæœ‰ä¸€ä¸ªæ”¹å˜åŸå› ã€‚</p>
<p>å•ä¸€èŒè´£åŸåˆ™æ˜¯SOLIDæœ€ç®€å•çš„åŸåˆ™ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œå¼€å‘è€…ç»å¸¸è¯¯è§£å®ƒã€‚è®¤ä¸ºä¸€ä¸ªæ¨¡å—åº”è¯¥åªåšä¸€ä»¶äº‹ã€‚</p>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£è¿™ä¸ªåŸåˆ™ã€‚ä¸‹é¢çš„JavaScriptä»£ç ç‰‡æ®µæœ‰ä¸€ä¸ªåä¸º ManageEmployee çš„ class å’Œå‡ ä¸ªç®¡ç†é›‡å‘˜çš„ function</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">ManageEmployee</span> &#123;

  <span class="title function_">constructor</span>(<span class="params">private http: HttpClient</span>)
  <span class="variable constant_">SERVER_URL</span> = <span class="string">&#x27;http://localhost:5000/employee&#x27;</span>;

  getEmployee (empId)&#123;
     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;empId&#125;</span>`</span>);
  &#125;

  updateEmployee (employee)&#123;
     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">put</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;employee.id&#125;</span>`</span>,employee);
  &#125;

  deleteEmployee (empId)&#123;
     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">delete</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;empId&#125;</span>`</span>);
  &#125;

  calculateEmployeeSalary (empId, workingHours)&#123;
    <span class="keyword">var</span> employee = <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;empId&#125;</span>`</span>);
    <span class="keyword">return</span> employee.<span class="property">rate</span> * workingHours;
  &#125;

&#125;</code></pre>

<p>å‰é¢çš„ä»£ç çœ‹ä¸Šå»å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œå¹¶ä¸”å¾ˆå¤šå¼€å‘è€…éƒ½ä¼šæŒ‰ç…§ç›¸åŒçš„æ–¹æ³•æ¥åšå¹¶ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚ç„¶è€Œï¼Œç”±äºå®ƒæ˜¯å¯¹ä¸¤ä¸ªè§’è‰²è´Ÿè´£ï¼Œè¿™æ ·ä»–å°±æœ‰è¿å•ä¸€èŒè´£åŸåˆ™ã€‚<code>getEmployee()</code>ã€<code>updateEmployee()</code>å’Œ<code>deleteEmployee()</code>å‡½æ•°ç›´æ¥ä¸ HR ç®¡ç†æœ‰å…³ï¼Œè€Œ<code>calculateEmployeeSalary()</code>åˆ™ä¸è´¢åŠ¡ç®¡ç†æœ‰å…³ã€‚</p>
<p>å°†æ¥ï¼Œå¦‚æœä½ éœ€è¦ä¸ºHRæˆ–è´¢åŠ¡æ›´æ–°ä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œä½ å°±å¿…é¡»æ”¹å˜ <code>ManageEmployee class</code> æ¥å½±å“ä¸¤ä¸ªè§’è‰²ï¼Œå› æ­¤ï¼Œ <code>ManageEmployee class</code> è¿åäº†å•ä¸€èŒè´£åŸåˆ™ã€‚ä½ éœ€è¦æŠŠHRå’Œè´¢åŠ¡æœ‰å…³çš„åŠŸèƒ½åˆ†å¼€ï¼Œä½¿ä»£ç ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹è¯æ˜äº†è¿™ä¸€ç‚¹ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">ManageEmployee</span> &#123;

  <span class="title function_">constructor</span>(<span class="params">private http: HttpClient</span>)
  <span class="variable constant_">SERVER_URL</span> = <span class="string">&#x27;http://localhost:5000/employee&#x27;</span>;

  getEmployee (empId)&#123;
     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;empId&#125;</span>`</span>);
  &#125;

  updateEmployee (employee)&#123;
     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">put</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;employee.id&#125;</span>`</span>,employee);
  &#125;

  deleteEmployee (empId)&#123;
     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">delete</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;empId&#125;</span>`</span>);
  &#125;

&#125;

<span class="keyword">class</span> <span class="title class_">ManageSalaries</span> &#123;

  <span class="title function_">constructor</span>(<span class="params">private http: HttpClient</span>)
  <span class="variable constant_">SERVER_URL</span> = <span class="string">&#x27;http://localhost:5000/employee&#x27;</span>;

  calculateEmployeeSalary (empId, workingHours)&#123;
    <span class="keyword">var</span> employee = <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">SERVER_URL</span> + <span class="string">`/<span class="subst">$&#123;empId&#125;</span>`</span>);
    <span class="keyword">return</span> employee.<span class="property">rate</span> * workingHours;
  &#125;

&#125;</code></pre>

<h2 id="Open-closed-principle"><a href="#Open-closed-principle" class="headerlink" title="Open-closed principle"></a>Open-closed principle</h2><p>Functions, modules, å’Œ classes åº”è¯¥æ˜¯å¯æ‰©å±•çš„ï¼Œä½†ä¸æ˜¯å¯ä¿®æ”¹çš„ã€‚</p>
<p>è¿™æ˜¯å®ç°å¤§å‹åº”ç”¨æ—¶éœ€è¦éµå¾ªçš„ä¸€ä¸ªé‡è¦åŸåˆ™ã€‚æ ¹æ®è¿™ä¸€åŸåˆ™ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°ä¸ºåº”ç”¨æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä½†åŒæ—¶æˆ‘ä»¬ä¸åº”è¯¥å¯¹ç°æœ‰çš„ä»£ç å¼•å…¥ç ´åå¼ä¿®æ”¹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬å®ç°ä¸€ä¸ª <code>calculateSalaries()</code> çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰å·¥ä½œè§’è‰²å’Œæ—¶è–ªçš„æ•°ç»„æ¥è®¡ç®—å·¥èµ„ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">ManageSalaries</span> &#123;
  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;
    <span class="variable language_">this</span>.<span class="property">salaryRates</span> = [
      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">role</span>: <span class="string">&#x27;developer&#x27;</span>, <span class="attr">rate</span>: <span class="number">100</span> &#125;,
      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">role</span>: <span class="string">&#x27;architect&#x27;</span>, <span class="attr">rate</span>: <span class="number">200</span> &#125;,
      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">role</span>: <span class="string">&#x27;manager&#x27;</span>, <span class="attr">rate</span>: <span class="number">300</span> &#125;,
    ];
  &#125;

  <span class="title function_">calculateSalaries</span>(<span class="params">empId, hoursWorked</span>) &#123;
    <span class="keyword">let</span> salaryObject = <span class="variable language_">this</span>.<span class="property">salaryRates</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">o</span>) =&gt;</span> o.<span class="property">id</span> === empId);
    <span class="keyword">return</span> hoursWorked * salaryObject.<span class="property">rate</span>;
  &#125;
&#125;

<span class="keyword">const</span> mgtSalary = <span class="keyword">new</span> <span class="title class_">ManageSalaries</span>();
<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Salary : &quot;</span>, mgtSalary.<span class="title function_">calculateSalaries</span>(<span class="number">1</span>, <span class="number">100</span>));</code></pre>

<p>ç›´æ¥ä¿®æ”¹ salaryRates æ•°ç»„ä¼šè¿åå¼€é—­åŸåˆ™ã€‚ä¾‹å¦‚ï¼Œä½ éœ€è¦ä¸ºä¸€ä¸ªæ–°è§’è‰²è¿›è¡Œå·¥èµ„è®¡ç®—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ï¼Œå°†å·¥èµ„æ·»åŠ åˆ° salaryRates æ•°ç»„ä¸­ï¼Œè€Œä¸æ˜¯å¯¹åŸä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">ManageSalaries</span> &#123;
  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;
    <span class="variable language_">this</span>.<span class="property">salaryRates</span> = [
      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">role</span>: <span class="string">&#x27;developer&#x27;</span>, <span class="attr">rate</span>: <span class="number">100</span> &#125;,
      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">role</span>: <span class="string">&#x27;architect&#x27;</span>, <span class="attr">rate</span>: <span class="number">200</span> &#125;,
      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">role</span>: <span class="string">&#x27;manager&#x27;</span>, <span class="attr">rate</span>: <span class="number">300</span> &#125;,
    ];
  &#125;

  <span class="title function_">calculateSalaries</span>(<span class="params">empId, hoursWorked</span>) &#123;
    <span class="keyword">let</span> salaryObject = <span class="variable language_">this</span>.<span class="property">salaryRates</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">o</span>) =&gt;</span> o.<span class="property">id</span> === empId);
    <span class="keyword">return</span> hoursWorked * salaryObject.<span class="property">rate</span>;
  &#125;

  <span class="title function_">addSalaryRate</span>(<span class="params">id, role, rate</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">salaryRates</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>: id, <span class="attr">role</span>: role, <span class="attr">rate</span>: rate &#125;);
  &#125;
&#125;

<span class="keyword">const</span> mgtSalary = <span class="keyword">new</span> <span class="title class_">ManageSalaries</span>();
mgtSalary.<span class="title function_">addSalaryRate</span>(<span class="number">4</span>, <span class="string">&#x27;developer&#x27;</span>, <span class="number">250</span>);
<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Salary : &#x27;</span>, mgtSalary.<span class="title function_">calculateSalaries</span>(<span class="number">4</span>, <span class="number">100</span>));</code></pre>

<h2 id="Liskov-substitution-principle"><a href="#Liskov-substitution-principle" class="headerlink" title="Liskov substitution principle"></a>Liskov substitution principle</h2><p>å‡è®¾P(y)æ˜¯ç±»å‹Açš„å¯¹è±¡yçš„ä¸€ä¸ªå¯è¯æ˜å±æ€§ï¼Œé‚£ä¹ˆå¯¹äºç±»å‹Bçš„å¯¹è±¡xï¼Œå…¶ä¸­Bæ˜¯Açš„å­ç±»å‹ï¼ŒP(x)åº”è¯¥ä¸ºçœŸ</p>
<p>ä½ èƒ½åœ¨ç½‘ä¸Šæ‰¾åˆ°å…³äºé‡Œå¼æ›¿æ¢åŸåˆ™çš„ä¸åŒå®šä¹‰ï¼Œä½†å®ƒä»¬éƒ½æœ‰ç›¸åŒçš„å«ä¹‰ã€‚ç®€å•çš„è¯´ï¼Œé‡Œå¼æ›¿æ¢åŸåˆ™æŒ‡å‡ºï¼Œå¦‚æœçˆ¶ç±»çš„å­ç±»åœ¨åº”ç”¨ä¸­äº§ç”Ÿæ„å¤–è¡Œä¸ºï¼Œæˆ‘ä»¬å°±ä¸åº”è¯¥ç”¨å­ç±»æ›¿æ¢çˆ¶ç±»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªåä¸º Animal çš„ç±»ï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªåä¸º <code>eat()</code> çš„å‡½æ•°ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;
  <span class="title function_">eat</span>(<span class="params"></span>) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Animal Eats&quot;</span>)
  &#125;
&#125;</code></pre>

<p>ç°åœ¨ï¼Œæˆ‘å°†æŠŠ Animal ç±»æ‰©å±•æˆä¸€ä¸ªåä¸ºBirdçš„æ–°ç±»ï¼Œå…¶å‡½æ•°åä¸º <code>fly()</code> ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">Bird</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span>&#123;
  <span class="title function_">fly</span>(<span class="params"></span>) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bird Flies&quot;</span>)
  &#125;
&#125;

<span class="keyword">var</span> parrot = <span class="keyword">new</span> <span class="title class_">Bird</span>();
parrot.<span class="title function_">eat</span>();
parrot.<span class="title function_">fly</span>();</code></pre>

<p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ ¹æ® Bird ç±»åˆ›å»ºäº†ä¸€ä¸ªåä¸º parrot çš„å¯¹è±¡ï¼Œå¹¶åŒæ—¶æ‹¥æœ‰ eat å’Œ fly æ–¹æ³•ã€‚ç”±äºé¹¦é¹‰èƒ½å¤Ÿå®Œæˆè¿™ä¸¤ä¸ªåŠ¨ä½œï¼Œå› æ­¤å°† Animal ç±»æ‰©å±•åˆ° Bird ç±»å¹¶ä¸è¿åé‡Œå¼æ›¿æ¢åŸåˆ™</p>
<p>ç°åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥æ‰©å±• Bird ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º Ostrich çš„æ–°ç±»</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">Ostrich</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Bird</span>&#123;
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Ostriches Do Not Fly&quot;</span>)
&#125;

<span class="keyword">var</span> ostrich = <span class="keyword">new</span> <span class="title class_">Ostrich</span>();
ostrich.<span class="title function_">eat</span>();
ostrich.<span class="title function_">fly</span>();</code></pre>

<p>è¿™ä¸ªå¯¹ Bird ç±»çš„æ‰©å±•å°±è¿åäº†é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå› ä¸ºé¸µé¸Ÿä¸ä¼šé£è¡Œï¼Œè¿™å¯èƒ½ä¼šåœ¨åº”ç”¨ä¸­å¼•å‘æ„å¤–è¡Œä¸ºã€‚è§£å†³è¿™ä¸ªæƒ…å†µçš„æœ€ä½³æ–¹æ³•æ˜¯ä» Animal ç±»æ‰©å±• Ostrich ç±»ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">Ostrich</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span>&#123;

  <span class="title function_">walk</span>(<span class="params"></span>) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Ostrich Walks&quot;</span>)
  &#125;

&#125;</code></pre>

<h2 id="Interface-segregation-principle"><a href="#Interface-segregation-principle" class="headerlink" title="Interface segregation principle"></a>Interface segregation principle</h2><p>å®¢æˆ·ç«¯ä¸åº”è¯¥æ·»åŠ ä»–ä»¬æ°¸è¿œä¸ä¼šä½¿ç”¨çš„ä¾èµ–æ¥å£ã€‚</p>
<p>è¿™ä¸ªåŸåˆ™å’Œæ¥å£æœ‰å…³ï¼Œä¸»è¦æ˜¯å°†å¤§æ¥å£åˆ†ä¸ºå°æ¥å£ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ä½ è¦å»é©¾æ ¡å­¦ä¹ å¦‚ä½•é©¾é©¶æ±½è½¦ï¼Œä»–ä»¬ç»™ä½ ä¸€å¤§å¥—å…³äºé©¾é©¶æ±½è½¦ã€å¡è½¦ã€ç«è½¦çš„è¯´æ˜ã€‚ç”±äºä½ åªéœ€è¦å­¦ä¹ é©¾é©¶æ±½è½¦ï¼Œä½ ä¸éœ€è¦å…¶ä»–çš„ä¿¡æ¯ã€‚é©¾æ ¡å°±åº”è¯¥æŠŠè¯´æ˜åˆ†å¼€ï¼Œåªç»™ä½ ä¸“é—¨é’ˆå¯¹æ±½è½¦çš„è¯´æ˜ã€‚</p>
<p>ç”±äº JavaScript ä¸æ”¯æŒ interface ï¼Œæ‰€ä»¥åœ¨åŸºäº JavaScript çš„åº”ç”¨ä¸­å¾ˆéš¾é‡‡ç”¨è¿™ä¸€åŸåˆ™ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript ç»„åˆæ¥å®ç°è¿™ä¸€ç‚¹ã€‚ç»„åˆå…è®¸å¼€å‘äººå‘˜åœ¨ä¸ç»§æ‰¿æ•´ä¸ªç±»çš„æƒ…å†µä¸‹æ·»åŠ åŠŸèƒ½ã€‚å‡è®¾æœ‰ä¸€ä¸ªåä¸º DrivingTest çš„ç±»ï¼Œç„¶åæœ‰ä¸¤ä¸ªåä¸º startCarTest å’Œ startTruckTest çš„å‡½æ•°ã€‚ç„¶åæˆ‘ä»¬æœ‰ CarDrivingTest å’Œ TruckDrivingTest æ‰©å±• DrivingTest ç±»ï¼Œç„¶åæˆ‘ä»¬å¿…é¡»å¼ºåˆ¶è¿™ä¸¤ä¸ªç±»å®ç° startCarTest å’Œ startTruckTest så‡½æ•°ã€‚</p>
<pre><code class="highlight js"><span class="title class_">Class</span> <span class="title class_">DrivingTest</span> &#123;
  <span class="title function_">constructor</span>(<span class="params">userType</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">userType</span> = userType;
  &#125;

  <span class="title function_">startCarTest</span>(<span class="params"></span>) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(â€œ<span class="title class_">This</span> is <span class="keyword">for</span> <span class="title class_">Car</span> <span class="title class_">Drivers</span>â€â€™);
  &#125;

  <span class="title function_">startTruckTest</span>(<span class="params"></span>) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(â€œ<span class="title class_">This</span> is <span class="keyword">for</span> <span class="title class_">Truck</span> <span class="title class_">Drivers</span>â€);
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">CarDrivingTest</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DrivingTest</span> &#123;
  <span class="title function_">constructor</span>(<span class="params">userType</span>) &#123;
    <span class="variable language_">super</span>(userType);
  &#125;

  <span class="title function_">startCarTest</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> â€œ<span class="title class_">Car</span> <span class="title class_">Test</span> <span class="title class_">Started</span>â€;
  &#125;

  <span class="title function_">startTruckTest</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> <span class="literal">null</span>;
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">TruckDrivingTest</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DrivingTest</span> &#123;
  <span class="title function_">constructor</span>(<span class="params">userType</span>) &#123;
    <span class="variable language_">super</span>(userType);
  &#125;

  <span class="title function_">startCarTest</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> <span class="literal">null</span>;
  &#125;

  <span class="title function_">startTruckTest</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> â€œ<span class="title class_">Truck</span> <span class="title class_">Test</span> <span class="title class_">Started</span>â€;
  &#125;
&#125;

<span class="keyword">const</span> carTest = <span class="keyword">new</span> <span class="title class_">CarDrivingTest</span>(carDriver );
<span class="variable language_">console</span>.<span class="title function_">log</span>(carTest.<span class="title function_">startCarTest</span>());
<span class="variable language_">console</span>.<span class="title function_">log</span>(carTest.<span class="title function_">startTruckTest</span>());

<span class="keyword">const</span> truckTest = <span class="keyword">new</span> <span class="title class_">TruckDrivingTest</span>( ruckdriver );
<span class="variable language_">console</span>.<span class="title function_">log</span>(truckTest.<span class="title function_">startCarTest</span>());
<span class="variable language_">console</span>.<span class="title function_">log</span>(truckTest.<span class="title function_">startTruckTest</span>());</code></pre>

<p>ç„¶è€Œï¼Œè¿™ç§å®ç°æ–¹æ³•è¿åäº†æ¥å£åˆ†ç¦»åŸåˆ™ï¼Œå› ä¸ºæˆ‘ä»¬å¼ºè¿«é‚£ä¸¤ä¸ªæ‰©å±•ç±»å®ç°è¿™ä¸¤ç§åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆæ¥ä¸ºæ‰€éœ€çš„ç±»æ·»åŠ åŠŸèƒ½æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰€ç¤ºã€‚</p>
<pre><code class="highlight js"><span class="title class_">Class</span> <span class="title class_">DrivingTest</span> &#123;
  <span class="title function_">constructor</span>(<span class="params">userType</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">userType</span> = userType;
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">CarDrivingTest</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DrivingTest</span> &#123;
  <span class="title function_">constructor</span>(<span class="params">userType</span>) &#123;
    <span class="variable language_">super</span>(userType);
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">TruckDrivingTest</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DrivingTest</span> &#123;
  <span class="title function_">constructor</span>(<span class="params">userType</span>) &#123;
    <span class="variable language_">super</span>(userType);
  &#125;
&#125;

<span class="keyword">const</span> carUserTests = &#123;
  <span class="title function_">startCarTest</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> â€˜<span class="title class_">Car</span> <span class="title class_">Test</span> <span class="title class_">Started</span>â€™;
  &#125;,
&#125;;

<span class="keyword">const</span> truckUserTests = &#123;
  <span class="title function_">startTruckTest</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> â€˜<span class="title class_">Truck</span> <span class="title class_">Test</span> <span class="title class_">Started</span>â€™;
  &#125;,
&#125;;

<span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">CarDrivingTest</span>.<span class="property"><span class="keyword">prototype</span></span>, carUserTests);
<span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">TruckDrivingTest</span>.<span class="property"><span class="keyword">prototype</span></span>, truckUserTests);

<span class="keyword">const</span> carTest = <span class="keyword">new</span> <span class="title class_">CarDrivingTest</span>(carDriver );
<span class="variable language_">console</span>.<span class="title function_">log</span>(carTest.<span class="title function_">startCarTest</span>());
<span class="variable language_">console</span>.<span class="title function_">log</span>(carTest.<span class="title function_">startTruckTest</span>()); <span class="comment">// Will throw an exception</span>

<span class="keyword">const</span> truckTest = <span class="keyword">new</span> <span class="title class_">TruckDrivingTest</span>( ruckdriver );
<span class="variable language_">console</span>.<span class="title function_">log</span>(truckTest.<span class="title function_">startTruckTest</span>());
<span class="variable language_">console</span>.<span class="title function_">log</span>(truckTest.<span class="title function_">startCarTest</span>()); <span class="comment">// Will throw an exception</span></code></pre>

<p>ç°åœ¨ï¼Œ <code>carTest.startTruckTest()</code> å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå› ä¸º <code>startTruckTest()</code> å‡½æ•°æ²¡æœ‰åˆ†é…ç»™ CarDrivingTest ç±»ã€‚</p>
<h2 id="Dependency-inversion-principle"><a href="#Dependency-inversion-principle" class="headerlink" title="Dependency inversion principle"></a>Dependency inversion principle</h2><p>é«˜å±‚æ¨¡å—åº”è¯¥ä½¿ç”¨æŠ½è±¡åŒ–ã€‚å¹¶ä¸”ï¼Œä»–ä»¬ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ã€‚</p>
<p>ä¾èµ–å€’ç½®æ˜¯å…³äºè§£è€¦ä»£ç çš„ã€‚éµå¾ªè¿™ä¸ªåŸåˆ™å°†ä½¿ä½ èƒ½å¤Ÿçµæ´»åœ°åœ¨æœ€é«˜çº§åˆ«ä¸Šæ‰©å±•å’Œæ”¹å˜ä½ çš„åº”ç”¨è€Œä¸å‡ºç°ä»»ä½•é—®é¢˜ã€‚</p>
<p>å…³äºJavaScriptï¼Œæˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘æŠ½è±¡çš„é—®é¢˜ï¼Œå› ä¸ºJavaScriptæ˜¯ä¸€ç§åŠ¨æ€è¯­è¨€ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿é«˜å±‚æ¨¡å—ä¸ä¾èµ–äºä½å±‚æ¨¡å—ã€‚</p>
<p>æˆ‘ä»¬æ¥ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è§£é‡Šä¾èµ–å€’ç½®æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å‡è®¾ä½ åœ¨ä½ çš„åº”ç”¨ä¸­éœ€è¦ä½¿ç”¨ Yahoo çš„ email API ï¼Œç°åœ¨ä½ éœ€è¦æŠŠå®ƒæ”¹ä¸º Gmail çš„ API ã€‚å¦‚æœä½ åƒä¸‹é¢çš„ä¾‹å­ä¸€æ ·å®ç°äº†æ²¡æœ‰ä¾èµ–å€’ç½®çš„æ§åˆ¶å™¨ï¼Œä½ éœ€è¦å¯¹æ¯ä¸ªæ§åˆ¶å™¨éƒ½è¿›è¡Œä¿®æ”¹ã€‚è¿™æ˜¯å› ä¸ºå¤šä¸ªæ§åˆ¶å™¨ä½¿ç”¨äº† Yahoo API ï¼Œä½ éœ€è¦æ‰¾åˆ°æ¯ä¸ªå®ä¾‹å¹¶æ›´æ–°å®ƒã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">EmailController</span> &#123; 
  <span class="title function_">sendEmail</span>(<span class="params">emailDetails</span>) &#123; 
    <span class="comment">// Need to change this line in every controller that uses YahooAPI.const response = YahooAPI.sendEmail(emailDetails); </span>
    <span class="keyword">if</span> (response.<span class="property">status</span> == <span class="number">200</span>) &#123; 
       <span class="keyword">return</span> <span class="literal">true</span>;
    &#125; <span class="keyword">else</span> &#123;
       <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;
  &#125;
&#125;</code></pre>

<p>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥å¸®åŠ©å¼€å‘è€…é¿å…è¿™ç§é«˜æ˜‚çš„é”™è¯¯ï¼Œåœ¨è¿™ä¸ªåŸåˆ™ä¸‹ï¼Œå°† email API å¤„ç†éƒ¨åˆ†è½¬ç§»åˆ°ä¸€ä¸ªå•ç‹¬çš„æ§åˆ¶å™¨ã€‚ç„¶åä½ åªéœ€è¦åœ¨ email API å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜è¯¥æ§åˆ¶å™¨å³å¯ã€‚</p>
<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">EmailController</span> &#123; 
  <span class="title function_">sendEmail</span>(<span class="params">emailDetails</span>) &#123; 
    <span class="keyword">const</span> response = <span class="title class_">EmailApiController</span>.<span class="title function_">sendEmail</span>(emailDetails);   
    <span class="keyword">if</span> (response.<span class="property">status</span> == <span class="number">200</span>) &#123; 
       <span class="keyword">return</span> <span class="literal">true</span>;
    &#125; <span class="keyword">else</span> &#123;
       <span class="keyword">return</span> <span class="literal">false</span>;
    &#125;
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">EmailApiController</span> &#123;
  <span class="title function_">sendEmail</span>(<span class="params">emailDetails</span>) &#123;
    <span class="comment">// Only need to change this controller. return YahooAPI.sendEmail(emailDetails);</span>
  &#125;
&#125;</code></pre>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†åœ¨è½¯ä»¶è®¾è®¡ä¸­SOLIDåŸåˆ™çš„é‡è¦æ€§ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•åœ¨JavaScriptåº”ç”¨ä¸­é‡‡ç”¨è¿™äº›æ¦‚å¿µã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œç†è§£å¹¶åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä½¿ç”¨è¿™äº›æ ¸å¿ƒæ¦‚å¿µæ˜¯å¾ˆé‡è¦çš„ã€‚æœ‰æ—¶ï¼Œåœ¨å¤„ç†ä¸€äº›å°çš„åº”ç”¨æ—¶ï¼Œè¿™äº›åŸåˆ™çš„å¥½å¤„å¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼Œä½†ä¸€æ—¦ä½ å¼€å§‹åœ¨ä¸€ä¸ªå¤§è§„æ¨¡çš„é¡¹ç›®ä¸Šå·¥ä½œæ—¶ï¼Œä½ ä¸€å®šä¼šçŸ¥é“å®ƒä»¬çš„ä¸åŒã€‚</p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Stop using &amp;&amp; in React Conditional Rendering</title>
    <url>/2023/05/20/%E3%80%90%E7%BF%BB%E3%80%91Stop-using-in-React-Conditional-Rendering/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://www.crocoder.dev/blog/react-conditional-rendering/">Stop using &amp;&amp; in React Conditional Rendering</a><br>åŸä½œè€…ï¼š<a href="https://twitter.com/devabram">David Abram</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>æ¡ä»¶æ¸²æŸ“æ˜¯Reactä¸­çš„ä¸€é¡¹æŠ€æœ¯ï¼Œå®ƒå…è®¸ä½ æ ¹æ®æŸäº›æ¡ä»¶æ¥å±•ç¤ºæˆ–éšè—ç”¨æˆ·ç•Œé¢çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ ¹æ®ä½ åº”ç”¨ç¨‹åºåœ¨ä»»ä½•æ—¶é—´å‘ç”Ÿçš„æƒ…å†µæ¥æ˜¾ç¤ºä¸åŒçš„å†…å®¹å’Œç»„ä»¶</p>
<p>æ¯”å¦‚ï¼Œä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥ç™»å½•å¹¶æŸ¥çœ‹ä»–ä»¬çš„ä¸ªäººèµ„æ–™ä¿¡æ¯ã€‚å½“ç”¨æˆ·æ²¡æœ‰ç™»å½•æ—¶ï¼Œä½ å¯èƒ½æƒ³å±•ç¤ºä¸€ä¸ªç™»å½•è¡¨å•ã€‚ä½†å½“ç”¨æˆ·ç™»å½•åï¼Œä½ å¯èƒ½æƒ³å±•ç¤ºä»–ä»¬çš„èµ„æ–™ä¿¡æ¯ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹Reactä¸­æ¡ä»¶æ¸²æŸ“çš„ä¸€ä¸ªä¾‹å­ã€‚</p>
<h3 id="The-CrocDemo-component"><a href="#The-CrocDemo-component" class="headerlink" title="The CrocDemo component"></a>The CrocDemo component</h3><pre><code class="highlight js"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;

<span class="keyword">const</span> <span class="title class_">CrocDemo</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;
  <span class="keyword">const</span> crocodiles = [<span class="string">&#x27;Lyle&#x27;</span>, <span class="string">&#x27;Snappy&#x27;</span>, <span class="string">&#x27;Mr. Vile&#x27;</span>];

  <span class="keyword">const</span> dodos = [];

  <span class="keyword">return</span> (
    <span class="language-xml"><span class="tag">&lt;&gt;</span></span>
<span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;crocodiles.length &amp;&amp; `crocodiles: $&#123;crocodiles.map(() =&gt; &#x27;ğŸŠ&#x27;).join(&#x27; &#x27;)&#125;`&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;dodos.length &amp;&amp; `dodos: $&#123;dodos.map(() =&gt; &#x27;ğŸ¦¤&#x27;).join(&#x27; &#x27;)&#125;`&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span>
<span class="language-xml">    <span class="tag">&lt;/&gt;</span></span>
  );
&#125;;</code></pre>

<p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>CrocDemo</code>çš„Reactç»„ä»¶</p>
<p>åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ•°ç»„ï¼š<code>crocodiles</code>å’Œ<code>dodos</code>ã€‚crocodilesæ•°ç»„åŒ…å«ä¸‰æ¡é³„é±¼çš„åå­—ã€‚è€Œdodosæ•°ç»„æ˜¯ç©ºçš„ã€‚è¿™æ˜¯å½“ç„¶çš„ï¼Œå› ä¸ºæ¸¡æ¸¡é¸Ÿå·²ç»ç­ç»äº†</p>
<p>ç„¶åè¯¥ç»„ä»¶è¿”å›äº†ä¸€äº›JSXä»£ç ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªdivå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªdivå…ƒç´ æ˜¾ç¤ºé³„é±¼çš„åå­—ï¼Œç¬¬äºŒä¸ªdivå…ƒç´ æ˜¾ç¤ºæ¸¡æ¸¡é¸Ÿçš„åå­—ã€‚</p>
<p>è¿™æ®µä»£ç ä¸­æœ‰æ„æ€çš„ä¸€éƒ¨åˆ†æ˜¯å¦‚ä½•å±•ç¤ºè¿™äº›åå­—ã€‚divå…ƒç´ ä½¿ç”¨ä¸€ç§å«åšæ¡ä»¶æ¸²æŸ“çš„æŠ€æœ¯æ¥å†³å®šæ˜¯å¦æ˜¾ç¤ºåå­—ã€‚</p>
<p>ç¬¬ä¸€ä¸ªdivå…ƒç´ æ£€æŸ¥crocodiesæ•°ç»„çš„é•¿åº¦æ˜¯å¦å¤§äº0ã€‚å¦‚æœæ˜¯ï¼Œè¿™ä¸ªdivå…ƒç´ å°±ä¼šæ˜¾ç¤ºcrocodilesæ–‡æœ¬ï¼Œç„¶åæ˜¯ä¸€ç³»åˆ—çš„é³„é±¼è¡¨æƒ…ã€‚è¿™äº›è¡¨æƒ…æ˜¯ç”¨mapå‡½æ•°åˆ›å»ºï¼Œå®ƒæ ¹æ®åŸæ•°ç»„ä¸­çš„é³„é±¼æ•°é‡ç”Ÿæˆä¸€ä¸ªæ–°çš„è¡¨æƒ…æ•°ç»„ï¼Œç„¶åç”¨joinå‡½æ•°å°†è¿™äº›è¡¨æƒ…è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºåœ¨divå…ƒç´ å†…ã€‚</p>
<p>ç¬¬äºŒä¸ªdivå…ƒç´ æŒ‰ç…§ç›¸åŒçš„æ¨¡å¼ï¼Œå½“å®ƒæ£€æŸ¥dodosæ•°ç»„çš„é•¿åº¦æ˜¯å¦å¤§äº0ã€‚ç”±äºdodosæ•°ç»„æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªdivå…ƒç´ ä¸ä¼šæ˜¾ç¤ºä»»ä½•ä¸œè¥¿ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ï¼Œå¦‚æœé³„é±¼æ•°ç»„ä¸­æœ‰ä»»ä½•é³„é±¼ï¼ŒCrocDemoç»„ä»¶å°±ä¼šæ˜¾ç¤ºé³„é±¼çš„åå­—(è¡¨æƒ…ç¬¦å·)ï¼Œè€Œå¯¹dodosæ•°ç»„åˆ™ä¸æ˜¾ç¤ºã€‚</p>
<p>è‡³å°‘æ²¡æœ‰å±•ç¤ºå…³äºdodosæ•°ç»„çš„å†…å®¹ã€‚</p>
<pre><code class="highlight text">crocodiles: ğŸŠ ğŸŠ ğŸŠ
0</code></pre>

<p>å—¯â€¦ çœ‹èµ·æ¥æ˜¯æœ‰ä¸€ä¸ªéšæœºçš„0ï¼Œæˆ‘ä»¬æœŸæœ›çš„æ˜¯ä»€ä¹ˆéƒ½ä¸å±•ç¤ºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬è¯•ç€ç”¨å…·æœ‰ä¸åŒ<code>false value</code>çš„<code>&amp;&amp;</code>è¿ç®—ç¬¦æ¥äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆ</p>
<pre><code class="highlight js"><span class="comment">/* This won&#x27;t render anything âœ… */</span>
&lt;&gt;&#123;<span class="literal">false</span> &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&lt;/&gt;

<span class="comment">/* This will render 0 ğŸ˜¡ */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;0 &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span>

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;&quot;&quot;  &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span>

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;null &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span>

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;undefined &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span>

<span class="comment">/* This will render NaN ğŸ˜¡ */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;NaN &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span></code></pre>

<p>åœ¨JavaScriptä¸­ï¼Œ<code>&amp;&amp;</code>è¿ç®—ç¬¦ä¼šæ£€æŸ¥å·¦å³æ“ä½œå¯¹è±¡æ˜¯å¦éƒ½æ˜¯trueï¼Œå¦‚æœå·¦è¾¹çš„æ“ä½œå¯¹è±¡æ˜¯falseï¼Œé‚£ä¹ˆå³è¾¹çš„æ“ä½œå¯¹è±¡å°±ä¸ä¼šè¢«æ£€æŸ¥ï¼Œå¹¶ä¸”<code>&amp;&amp;</code>è¿ç®—ç¬¦ä¼šè¿”å›å·¦è¾¹çš„æ“ä½œå¯¹è±¡</p>
<p>åœ¨è¡¨è¾¾å¼<code>&#123;0 &amp;&amp; &lt;div&gt;ğŸ‘‹&lt;/div&gt;&#125;</code>ä¸­ï¼Œå·¦è¾¹çš„æ“ä½œå¯¹è±¡æ˜¯0ï¼Œè¿™åœ¨javascriptä¸­æ˜¯ä¸€ä¸ª<code>false value</code>ï¼Œå› ä¸ºå·¦è¾¹çš„æ“ä½œå¯¹è±¡æ˜¯falseï¼Œæ‰€ä»¥å³è¾¹çš„æ“ä½œå¯¹è±¡ä¸ä¼šè¢«æ£€æŸ¥ã€‚å¹¶ä¸”è¿”å›å·¦è¾¹çš„æ“ä½œå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯0</p>
<p>å½“Reactè¯•å›¾æ¸²æŸ“è¯¥ç»„ä»¶æ—¶ï¼Œå®ƒå°†0è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ğŸ˜¡ğŸ˜¡ğŸ˜¡</p>
<p>NaNçš„æƒ…å†µæ˜¯ä¸€æ ·çš„ã€‚</p>
<pre><code class="highlight js"><span class="comment">/* This will render NaN ğŸ˜¡ */</span>
&lt;&gt;&#123;<span class="title class_">NaN</span> &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&lt;/&gt;</code></pre>

<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<h3 id="Use-the-ternary-operator"><a href="#Use-the-ternary-operator" class="headerlink" title="Use the ternary operator"></a>Use the ternary operator</h3><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ª(ä¹Ÿæ˜¯æœ€å¥½çš„)æ–¹æ³•æ˜¯ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ã€‚ä¸‰å…ƒè¿ç®—ç¬¦æ˜¯ä¸€ä¸ªæ¡ä»¶è¿ç®—ç¬¦ï¼Œå®ƒæ£€æŸ¥ä¸€ä¸ªæ¡ä»¶æ˜¯å¦ä¸ºtrueã€‚å¦‚æœæ¡ä»¶ä¸ºtrueï¼Œå®ƒè¿”å›ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œå¦‚æœæ¡ä»¶ä¸ºfalseï¼Œè¿™è¿”å›ç¬¬äºŒä¸ªæ“ä½œå¯¹è±¡ã€‚</p>
<pre><code class="highlight js"><span class="comment">/* This won&#x27;t render anything âœ… */</span>
&lt;&gt;&#123;<span class="number">0</span> ? <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="literal">null</span>&#125;&lt;/&gt;

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;NaN ? <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span> : null&#125;<span class="tag">&lt;/&gt;</span></span></code></pre>

<h3 id="Convert-falsy-values-to-Boolean"><a href="#Convert-falsy-values-to-Boolean" class="headerlink" title="Convert falsy values to Boolean"></a>Convert falsy values to Boolean</h3><p>å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„falseè½¬ä¸ºbooleanï¼Œæˆ–è€…ä½¿ç”¨<code>!!</code>è¿ç®—ç¬¦ï¼Œ<code>!!</code>è¿ç®—ç¬¦æ˜¯å°†ä¸€ä¸ªå€¼è½¬ä¸ºå¸ƒå°”å€¼çš„ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å°†ä¸€ä¸ªtrue valueæˆ–è€…false valueè½¬æ¢ä¸ºtrueæˆ–falseçš„ä¸€ä¸ªé€Ÿè®°æ–¹æ³•ã€‚</p>
<pre><code class="highlight js"><span class="comment">/* This won&#x27;t render anything âœ… */</span>
&lt;&gt;&#123;<span class="title class_">Boolean</span>(<span class="number">0</span>) &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&lt;/&gt;

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;Boolean(NaN) &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span>

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;!!0 &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span>

<span class="comment">/* This won&#x27;t render anything âœ… */</span>
<span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;!!NaN &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/&gt;</span></span></code></pre>

<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>æ¡ä»¶æ¸²æŸ“æ˜¯Reactä¸­çš„ä¸€é¡¹æŠ€æœ¯ï¼Œå®ƒå…è®¸ä½ æ ¹æ®æŸäº›æ¡ä»¶æ¥å±•ç¤ºæˆ–è€…éšè—ç”¨æˆ·ç•Œé¢çš„æŸäº›éƒ¨åˆ†ã€‚å½“ä½ æƒ³æ ¹æ®åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„äº‹æƒ…æ¥æ˜¾ç¤ºä¸åŒçš„å†…å®¹æˆ–ç»„ä»¶æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨ä½¿ç”¨<code>&amp;&amp;</code>è¿ç®—ç¬¦æ—¶ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚0å’ŒNaNè¿™æ ·çš„false valueï¼Œä¼šæ„å¤–åœ°å¯¼è‡´æ„å¤–çš„æ¸²æŸ“ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æˆ–å°†false valueè½¬æ¢ä¸ºbooleanã€‚è¿™äº›æŠ€æœ¯å°†æœ‰åŠ©äºç¡®ä¿ä½ çš„Reactç»„ä»¶å®Œå…¨å‘ˆç°å‡ºä½ æ‰€æœŸæœ›çš„æ•ˆæœã€‚</p>
]]></content>
      <tags>
        <tag>React</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯çš„Dockerå­¦ä¹ è®°å½•</title>
    <url>/2022/10/30/%E5%89%8D%E7%AB%AF%E7%9A%84Docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="Dockerç®€ä»‹"><a href="#Dockerç®€ä»‹" class="headerlink" title="Dockerç®€ä»‹"></a>Dockerç®€ä»‹</h2><ul>
<li>Docker æ˜¯ä¸€ä¸ªåº”ç”¨<strong>æ‰“åŒ…</strong>ã€<strong>åˆ†å‘</strong>ã€<strong>éƒ¨ç½²</strong>çš„å·¥å…·ï¼Œå¯ä»¥ä½¿åº”ç”¨éƒ¨ç½²æ›´åŠ è½»é‡ï¼Œå¯ç§»æ¤ï¼Œå¯æ‰©å±•ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çš„è™šæ‹Ÿæœº<ul>
<li>æ‰“åŒ…ï¼šå°±æ˜¯æŠŠä½ è½¯ä»¶è¿è¡Œæ‰€éœ€çš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹åº“ã€è½¯ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…</li>
<li>åˆ†å‘ï¼šä½ å¯ä»¥æŠŠä½ æ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…</li>
<li>éƒ¨ç½²ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ¨¡ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨Windows&#x2F;Mac&#x2F;Linux</li>
</ul>
</li>
<li>dockeræ¶æ„å›¾<br><img src="https://s1.ax1x.com/2022/10/30/xI2lGR.png"></li>
</ul>
<ul>
<li><strong>docker client</strong>: å³dockerå‘½ä»¤è¡Œå·¥å…·</li>
<li><strong>docker host</strong>: å®¿ä¸»æœºï¼Œdocker daemonçš„è¿è¡Œç¯å¢ƒæœåŠ¡å™¨</li>
<li><strong>docker daemon</strong>: dockerçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œdocker clienté€šè¿‡å‘½ä»¤è¡Œä¸docker daemonäº¤äº’</li>
<li><strong>image</strong>: é•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºå®‰è£…åŒ…ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¼ æ’­å’Œå®‰è£…</li>
<li><strong>container</strong>: å®¹å™¨ï¼Œé•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œæ¯ä¸ªè½¯ä»¶è¿è¡Œç¯å¢ƒéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œéš”ç¦»çš„</li>
<li><strong>registry</strong>: é•œåƒä»“åº“ï¼Œå¯ä»¥ä»é•œåƒä»“åº“æ‹‰å–å’Œæ¨é€é•œåƒ</li>
</ul>
<h3 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><p>dockeråº•å±‚ä½¿ç”¨äº†ä¸€äº›linuxå†…æ ¸çš„ç‰¹æ€§ï¼Œ<code>namespace</code>ï¼Œ<code>cgroups</code>ï¼Œ<code>unionFS</code></p>
<h3 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h3><ul>
<li>namespaceï¼Œä¹Ÿå«å‘½åç©ºé—´ï¼Œåç§°ç©ºé—´ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ ‡è¯†ç¬¦çš„å¯è§èŒƒå›´ã€‚ä¸€ä¸ªæ ‡è¯†ç¬¦å¯åœ¨å¤šä¸ªåå­—ç©ºé—´ä¸­å®šä¹‰ï¼Œå®ƒåœ¨ä¸åŒåå­—ç©ºé—´ä¸­çš„å«ä¹‰æ˜¯äº’ä¸ç›¸å¹²çš„ã€‚è¿™æ ·ï¼Œåœ¨ä¸€ä¸ªæ–°çš„åå­—ç©ºé—´ä¸­å¯å®šä¹‰ä»»ä½•æ ‡è¯†ç¬¦ï¼Œå®ƒä¸ä¼šä¸ä»»ä½•å·²æœ‰çš„æ ‡è¯†ç¬¦å‘ç”Ÿå†²çªï¼Œå› ä¸ºå·²æœ‰çš„å®šä¹‰éƒ½å¤„äºå…¶ä»–å‘½åç©ºé—´ä¸­</li>
<li>dockerä½¿ç”¨linux namespaceæ„å»ºéš”ç¦»çš„ç¯å¢ƒï¼Œå®ƒç”±ä»¥ä¸‹namespaceç»„æˆ<ul>
<li>pidï¼šéš”ç¦»è¿›ç¨‹</li>
<li>netï¼šéš”ç¦»ç½‘ç»œ</li>
<li>ipcï¼šéš”ç¦»IPC</li>
<li>mntï¼šéš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½</li>
<li>utsï¼šéš”ç¦»hostname</li>
<li>userï¼šéš”ç¦»uid&#x2F;gid</li>
</ul>
</li>
</ul>
<h3 id="cgroups"><a href="#cgroups" class="headerlink" title="cgroups"></a>cgroups</h3><ul>
<li>cgroupsï¼Œæ˜¯æ§åˆ¶ç»„ç¾¤(control groups)çš„ç®€å†™ï¼Œæ˜¯ç”¨æ¥é™åˆ¶ã€æ§åˆ¶ä¸åˆ†ç¦»ä¸€ä¸ªè¿›ç¨‹ç»„çš„èµ„æº(å¦‚CPUã€å†…å­˜ã€ç£ç›˜è¾“å…¥è¾“å‡ºç­‰)</li>
<li>cgroupsåŠŸèƒ½ï¼š<ul>
<li>èµ„æºé™åˆ¶ï¼šè®¾ç½®å†…å­˜é™åˆ¶ï¼ŒåŒ…æ‹¬è™šæ‹Ÿå†…å­˜</li>
<li>ä¼˜å…ˆçº§ï¼šä¸€äº›èµ„æºå¯ä»¥å¾—åˆ°å¤§é‡çš„CPUæˆ–ç£ç›˜IOååé‡</li>
<li>ç»“ç®—ï¼šç”¨æ¥åº¦é‡ç³»ç»Ÿå®é™…ç”¨äº†å¤šå°‘èµ„æº</li>
<li>æ§åˆ¶ï¼šå†»ç»“ç»„æˆ–æ£€æŸ¥ç‚¹å’Œé‡å¯åŠ¨</li>
</ul>
</li>
</ul>
<h3 id="unionFS"><a href="#unionFS" class="headerlink" title="unionFS"></a>unionFS</h3><ul>
<li>unionFS(Union file systems)æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶æ€§èƒ½ï¼Œæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ã€‚dockerçš„é•œåƒä¸å®¹å™¨å°±æ˜¯åˆ†å±‚å­˜å‚¨ï¼Œå¯ç”¨çš„å­˜å‚¨å¼•æ“å‘¦aufsï¼Œoverlayç­‰</li>
</ul>
<h3 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h3><ul>
<li>é•œåƒæ˜¯ä¸€ä»½ç”¨æ¥åˆ›é€ å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œè€Œå®¹å™¨å¯ä»¥è§†ä½œæœ€å°å‹çš„ä¸€ä¸ªæ“ä½œç³»ç»Ÿ</li>
<li>dockerçš„é•œåƒå’Œå®¹å™¨éƒ½ä½¿ç”¨äº†unionFSåšåˆ†å±‚å­˜å‚¨ï¼Œé•œåƒä½œä¸ºåªè¯»å±‚æ˜¯å…±äº«çš„ï¼Œè€Œå®¹å™¨åœ¨é•œåƒä¹‹ä¸Šé™„åŠ äº†ä¸€å±‚å¯å†™å±‚ï¼Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†ç©ºé—´çš„æµªè´¹</li>
<li>é•œåƒçš„ç›¸å…³å‘½ä»¤<ul>
<li>é•œåƒæ‹‰å–ï¼š<code>docker pull node:alpine</code></li>
<li>æŸ¥çœ‹é•œåƒä¿¡æ¯ï¼š<code>docker inspect node:alpine</code></li>
<li>åˆ—å‡ºæ‰€æœ‰é•œåƒï¼š<code>docker images</code></li>
<li>é•œåƒæ‰“åŒ…ï¼š<code>docker build -t docker-app:v1.0.0</code><ul>
<li><code>-t</code>ï¼šè®¾ç½®é•œåƒåå­—å’Œç‰ˆæœ¬å·</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><ul>
<li>Dockerfileæ˜¯dockeræ„å»ºé•œåƒçš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ªç®€å•çš„Dockerfileå¦‚ä¸‹<pre><code class="highlight dockerfile"><span class="keyword">FROM</span> node:<span class="number">16</span>
<span class="keyword">MAINTAINER</span> songlh

<span class="keyword">ADD</span><span class="language-bash"> . /app</span>
<span class="keyword">WORKDIR</span><span class="language-bash"> /app</span>

<span class="keyword">RUN</span><span class="language-bash"> npm install pnpm -g</span>
<span class="keyword">RUN</span><span class="language-bash"> pnpm install</span>

<span class="keyword">CMD</span><span class="language-bash"> pnpm run dev</span></code></pre></li>
<li>å¸¸ç”¨æŒ‡ä»¤</li>
<li><code>FROM</code>ï¼šè¡¨ç¤ºåŸºäºä¸€ä¸ªå·²æœ‰çš„åŸºç¡€é•œåƒï¼Œ<code>FROM &lt;image&gt; [AS &lt;name&gt;]</code></li>
<li><code>MAINTAINER</code>ï¼šå£°æ˜dockerfileé•œåƒæ„å»ºçš„ä½œè€…</li>
<li><code>ADD</code>ï¼šè¡¨ç¤ºæŠŠå®¿ä¸»æœºçš„æ–‡ä»¶æˆ–ç›®å½•åŠ å…¥åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œ<code>ADD [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code></li>
<li><code>RUN</code>: åœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ï¼Œç”±äºufsçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä¼šåœ¨å½“å‰é•œåƒçš„é¡¶å±‚æ–°å¢ä¸€å±‚ï¼Œ<code>RUN &lt;command&gt;</code></li>
<li><code>CMD</code>: æŒ‡å®šå®¹å™¨å¦‚ä½•å¯åŠ¨ï¼Œä¸€ä¸ªDockerfileä¸­åªå…è®¸æœ‰ä¸€ä¸ªCMD</li>
<li><code>WORKDIR</code>ï¼šè®¾ç½®å·¥ä½œç›®å½•</li>
<li><code>ENV</code>ï¼šè®¾ç½®ç¯å¢ƒå˜é‡</li>
</ul>
<h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><ul>
<li><code>docker run</code>ï¼šåˆ›å»ºå®¹å™¨<ul>
<li><code>docker run -p 8080:8080 --name docker-hello docker-app:v1.0.0</code>è¡¨ç¤ºåŸºäºdocker-appé•œåƒçš„v1.0.0ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªå®¹å™¨å¹¶åœ¨æœ¬åœ°çš„8080ç«¯å£è¿è¡Œï¼Œå®¹å™¨åå­—å«<code>docker-hellp</code></li>
<li><code>-p host-port:container-port</code>ï¼šå®¿ä¸»æœºä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œæ–¹ä¾¿å®¹å™¨å¯¹å¤–æä¾›æœåŠ¡</li>
<li><code>--name</code>ï¼šä¸ºå®¹å™¨æŒ‡å®šåç§°</li>
<li><code>-d</code>ï¼šåå°è¿è¡Œ</li>
<li><code>--rm</code>ï¼šå½“åœæ­¢å®¹å™¨æ—¶è‡ªåŠ¨æ¸…é™¤å®¹å™¨</li>
</ul>
</li>
<li><code>docker stop</code>ï¼šåœæ­¢å®¹å™¨</li>
<li><code>docker rm</code>ï¼šåˆ é™¤å®¹å™¨</li>
<li><code>docker exec -it container-name</code>ï¼šè¿›å…¥å®¹å™¨ç¯å¢ƒ</li>
<li><code>docker ps</code>ï¼šåˆ—å‡ºæ‰€æœ‰å®¹å™¨</li>
<li><code>docker port</code>ï¼šæŸ¥çœ‹å®¹å™¨ç«¯å£æ˜ å°„</li>
<li><code>docker stats</code>ï¼šæŸ¥çœ‹å®¹å™¨èµ„æºå ç”¨</li>
</ul>
<h2 id="ç›®å½•æŒ‚è½½"><a href="#ç›®å½•æŒ‚è½½" class="headerlink" title="ç›®å½•æŒ‚è½½"></a>ç›®å½•æŒ‚è½½</h2><ul>
<li>æŒ‰ç…§ç›®å‰å·²æœ‰çŸ¥è¯†ï¼Œå¦‚æœæ”¹äº†é¡¹ç›®ä»£ç ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œéœ€è¦é‡æ–°buildå’Œrunï¼Œå¾ˆéº»çƒ¦ï¼Œè€Œä¸”å®¹å™¨äº§ç”Ÿçš„æ•°æ®ï¼Œå¦‚æœå®¹å™¨åˆ é™¤äº†å°±ä¼šæ²¡æœ‰ï¼Œç›®å½•æŒ‚è½½å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜</li>
<li>ç›®å‰çš„æŒ‚è½½æ–¹å¼<ul>
<li><code>bind mount</code>ï¼šç›´æ¥æŠŠå®¿ä¸»æœºç›®å½•æ˜ å°„åˆ°å®¹å™¨å†…ï¼Œé€‚åˆæŒ‚è½½ä»£ç ç›®å½•å’Œé…ç½®æ–‡ä»¶ï¼Œå¯æŒ‚è½½åˆ°å¤šä¸ªå®¹å™¨ä¸Š</li>
<li><code>volume</code>ï¼šç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†ï¼Œåˆ›å»ºåœ¨å®¿ä¸»æœºï¼Œæ‰€ä»¥åˆ é™¤å®¹å™¨ä¸ä¼šä¸¢å¤±ï¼Œå®˜æ–¹æ¨èï¼Œæ›´é«˜æ•ˆï¼ŒLinuxæ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆå­˜å‚¨æ•°æ®åº“æ•°æ®ã€‚å¯æŒ‚è½½åˆ°å¤šä¸ªå®¹å™¨ä¸Š</li>
<li><code>tmpfs mount</code>ï¼šé€‚åˆå­˜å‚¨ä¸´æ—¶æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨å®¿ä¸»æœºå†…å­˜ä¸­ã€‚ä¸å¯å¤šå®¹å™¨å…±äº«</li>
<li><img src="https://s1.ax1x.com/2022/10/30/xI2Qi9.png"></li>
</ul>
</li>
</ul>
<h3 id="bind-mount"><a href="#bind-mount" class="headerlink" title="bind mount"></a>bind mount</h3><ul>
<li><code>bind mount</code>æ˜¯é€šè¿‡<code>-v</code>å‚æ•°æ¥ç»‘å®šå®¿ä¸»æœºç›®å½•ï¼Œæ¯”å¦‚å°†å¤–éƒ¨çš„htmlæ–‡æ¡£æŒ‚è½½åˆ°Nginxå®¹å™¨çš„æ ¹ç›®å½•ä¸‹<ul>
<li><code>docker run -v ~/html:/usr/share/nginx/html -p 81:80 -d --name nginx_bind nginx:latest</code></li>
</ul>
</li>
<li>è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯è¢«æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•(æˆ–æ–‡ä»¶)ä¸å—ä¿æŠ¤ï¼Œä»»ä½•å®¹å™¨éƒ½å¯ä»¥éšæ„ä¿®æ”¹</li>
</ul>
<h3 id="volume"><a href="#volume" class="headerlink" title="volume"></a>volume</h3><ul>
<li>volumeä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨dockerçš„ç®¡æ§èŒƒå›´å†…ï¼Œdockerå¯ä»¥é€šè¿‡æŒ‚è½½çš„è®¾å®šæ¥æ§åˆ¶å®¹å™¨å¯¹volumeçš„è¯»å†™æƒé™</li>
<li>é€šè¿‡<code>docker volume create volume-name</code>åˆ›å»ºä¸€ä¸ªVolumeï¼Œå®é™…ä¸Šæ˜¯åœ¨dockerçš„<code>/var/lib/docker/volumes/</code>æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªç›¸åŒåå­—çš„æ–‡ä»¶å¤¹æ¥ä¿å­˜æ•°æ®</li>
<li>æ¯”å¦‚è®¾ç½®ä¸€ä¸ªåªèƒ½è¯»å–volume<ul>
<li><code>docker run --mount type=volume,source=nginx-volume,destination=/usr/share/nginx/html,readonly -p 82:80 -d --name nginx_volume nginx:latest</code></li>
</ul>
</li>
</ul>
<h3 id="tmpfs-mount"><a href="#tmpfs-mount" class="headerlink" title="tmpfs mount"></a>tmpfs mount</h3><ul>
<li>tmpfsæŒ‚è½½æ˜¯ä¸´æ—¶çš„ï¼Œä»…ä¿ç•™åœ¨ä¸»æœºå†…å­˜ä¸­ã€‚å½“å®¹å™¨åœæ­¢æ—¶ï¼ŒtmpfsæŒ‚è½½è¢«ç§»é™¤ï¼Œå†™å…¥çš„æ–‡ä»¶ä¸ä¼šè¢«æŒä¹…åŒ–</li>
<li><code>docker run --mount type=tmpfs,destination=/usr/share/nginx/html -p 83:80 -d --name nginx-tempfs nginx:latest</code></li>
<li>tmpfså› ä¸ºä¸æ˜¯æŒä¹…åŒ–ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨</li>
</ul>
<h2 id="å®¹å™¨é€šä¿¡"><a href="#å®¹å™¨é€šä¿¡" class="headerlink" title="å®¹å™¨é€šä¿¡"></a>å®¹å™¨é€šä¿¡</h2><ul>
<li>å®¹å™¨é—´çš„é€šä¿¡æ ¹æ®åª’ä»‹å¯ä»¥åˆ†ä¸ºï¼švolumeå…±äº«é€šä¿¡ã€ç½‘ç»œé€šä¿¡</li>
<li>æ ¹æ®é€šä¿¡èŒƒå›´å¯ä»¥åˆ†ä¸ºï¼šåŒä¸»æœºé€šä¿¡ã€è·¨ä¸»æœºé€šä¿¡</li>
</ul>
<h3 id="ç½‘ç»œé€šä¿¡"><a href="#ç½‘ç»œé€šä¿¡" class="headerlink" title="ç½‘ç»œé€šä¿¡"></a>ç½‘ç»œé€šä¿¡</h3><ul>
<li>Dockerçš„ç½‘ç»œé€šä¿¡æ¨¡å‹åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼Œåœ¨å®‰è£…Dockerä»¥åï¼Œä¼šé»˜è®¤åˆ›å»ºä¸‰ç§ç½‘ç»œï¼Œå¯ä»¥é€šè¿‡<code>docker network ls</code>æŸ¥çœ‹<ul>
<li><strong>bridge</strong>ï¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ã€è®¾ç½®IPç­‰ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ª<code>docker0</code>è™šæ‹Ÿç½‘æ¡¥ï¼Œé»˜è®¤ä¸ºè¯¥æ¨¡å¼</li>
<li><strong>host</strong>ï¼šå®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£</li>
<li><strong>none</strong>ï¼šå®¹å™¨æœ‰ç‹¬ç«‹çš„<code>network namespace</code>ï¼Œä½†å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œä»»ä½•ç½‘ç»œè®¾ç½®ï¼Œå¦‚åˆ†é…<code>veth pair</code>å’Œç½‘æ¡¥è¿æ¥ï¼ŒIPç­‰</li>
<li><strong>overlay</strong>ï¼šå¯ä»¥è¿æ¥å¤šä¸ªdockerå®ˆæŠ¤è¿›ç¨‹æˆ–è€…æ»¡è¶³é›†ç¾¤æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œé€‚ç”¨äºä¸åŒå®¿ä¸»æœºä¸Šçš„dockerå®¹å™¨ä¹‹é—´çš„é€šä¿¡</li>
<li><strong>macvlan</strong>: å¯ä»¥ä¸ºdockerå®¹å™¨åˆ†é…MACåœ°å€ï¼Œä½¿å…¶åƒçœŸå®çš„ç‰©ç†åŠä¸€æ ·è¿è¡Œ</li>
</ul>
</li>
<li>Dockerå†…ç½®çš„<code>bridge network</code>ï¼Œä¹Ÿå°±æ˜¯docker0æ¥å£æ‰€å±çš„networkï¼Œæ‰€æœ‰æœªæŒ‡å®šnetworkçš„å®¹å™¨ï¼Œé»˜è®¤è¿æ¥åˆ°æ­¤networkä¸­ï¼Œå…¶ç½‘æ®µæœª<code>172.17.0.1/16</code>ï¼Œæ‰€ä»¥ä¸¤ä¸ªæœªè¿›è¡Œä»»ä½•è¿æ¥æ“ä½œçš„å®¹å™¨æ˜¯å¯ä»¥é€šè¿‡IPåœ°å€äº’ç›¸é€šä¿¡çš„ï¼Œå› ä¸ºä»–ä»¬åŒåœ¨ä¸€ä¸ªnetworkä¸‹ï¼Œä½†é€šä¿¡åªèƒ½é€šè¿‡IPåœ°å€è¿›è¡Œï¼Œä¸å¯ä»¥é€šè¿‡å®¹å™¨åé€šä¿¡<ul>
<li><img src="https://s1.ax1x.com/2022/10/30/xI21R1.png"></li>
</ul>
</li>
<li>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼š<code>docker network create custom_network</code></li>
<li>æŸ¥çœ‹ç½‘ç»œæ¨¡å¼ï¼š<code>docker network ls</code></li>
<li>é€šè¿‡è‡ªå®šä¹‰ç½‘ç»œåˆ›å»ºå®¹å™¨ï¼š<code>docker run -di --name docker-app --net custom_network docker-app:v1.0.0</code></li>
<li>æŸ¥çœ‹å®¹å™¨çš„ç½‘ç»œä¿¡æ¯ï¼š<code>docker inspect å®¹å™¨åç§°|ID</code>ï¼Œç„¶ååœ¨<code>NetworkSettings</code>èŠ‚ç‚¹ä¸­å¯ä»¥çœ‹åˆ°</li>
<li>ä¸ºå®¹å™¨è¿æ¥æ–°çš„ç½‘ç»œï¼š<code>docker network connect ç½‘ç»œåç§° å®¹å™¨åç§°</code></li>
<li>æ–­å¼€ç½‘ç»œï¼š<code>docker network disconnect ç½‘ç»œåç§° å®¹å™¨åç§°</code></li>
</ul>
<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><ul>
<li>docker-composeæ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡composeï¼Œæ‚¨å¯ä»¥ä½¿ç”¨YMLæ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æœåŠ¡ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥ä»YMLæ–‡ä»¶é…ç½®ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡</li>
<li>ä½¿ç”¨åˆ†ä¸‰æ­¥<ul>
<li><ol>
<li>ä½¿ç”¨Dockerfileå®šä¹‰åº”ç”¨ç¨‹åºçš„ç¯å¢ƒ</li>
</ol>
</li>
<li><ol start="2">
<li>ä½¿ç”¨docker-compose.ymlå®šä¹‰æ„æˆåº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œè¿™æ ·å®ƒä»¬å¯ä»¥åœ¨éš”ç¦»ç¯å¢ƒä¸­ä¸€èµ·è¿è¡Œ</li>
</ol>
</li>
<li><ol start="3">
<li>æœ€åï¼Œæ‰§è¡Œdocker-compose upå‘½ä»¤å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åº</li>
</ol>
</li>
</ul>
</li>
<li>æ¯”å¦‚è¿è¡Œä¸€ä¸ªwebé¡¹ç›®å’Œredisï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªå¦‚ä¸‹çš„<code>docker-compose.yml</code>æ–‡ä»¶<pre><code class="highlight yml"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span>

<span class="attr">services:</span>
  <span class="attr">app:</span>
    <span class="attr">build:</span> <span class="string">./</span>
    <span class="attr">ports:</span>
      <span class="bullet">-</span> <span class="number">80</span><span class="string">:8080</span>
    <span class="attr">volumes:</span>
      <span class="bullet">-</span> <span class="string">./:/app</span>
  <span class="attr">redis:</span>
    <span class="attr">image:</span> <span class="string">redis:5.0.13</span>
    <span class="attr">volumes:</span>
      <span class="bullet">-</span> <span class="string">redis:/data</span>
<span class="attr">volumes:</span>
  <span class="attr">redis:</span></code></pre></li>
<li>versionï¼šæŒ‡å®šæœ¬ymlä¾ä»çš„composeå“ªä¸ªç‰ˆæœ¬æŒ‡å®šçš„</li>
<li>build: æŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡è·¯å¾„</li>
<li>imageï¼šæŒ‡å®šå¯åŠ¨å®¹å™¨çš„é•œåƒ</li>
<li>volumesï¼šå·æŒ‚è½½è·¯å¾„è®¾ç½®ï¼Œå¦‚æœè·¨å¤šä¸ªæœåŠ¡å¹¶é‡ç”¨æŒ‚è½½å·ï¼Œå¯ä»¥åœ¨volumeså…³é”®å­—ä¸­å‘½åæŒ‚è½½å·</li>
<li>portsï¼šæš´éœ²ç«¯å£ä¿¡æ¯</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://blog.csdn.net/Mr_YanMingXin/article/details/123016807">æµ…è°ˆDockeråº•å±‚åŸç†</a></li>
<li><a href="https://docker.easydoc.net/">Dockerå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://q.shanyue.tech/deploy/docker.html#%E6%9C%AF%E8%AF%AD">Dockerä½¿ç”¨æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/6993979788020940830">Dockerä¸æ•°æ®ï¼šä¸‰ç§æŒ‚è½½æ–¹å¼</a></li>
<li><a href="https://www.cnblogs.com/mrhelloworld/p/docker11.html">Docker ç½‘ç»œæ¨¡å¼è¯¦è§£åŠå®¹å™¨é—´ç½‘ç»œé€šä¿¡</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Rendering Mechanism</title>
    <url>/2023/08/13/%E3%80%90%E7%BF%BB%E3%80%91Rendering-Mechanism/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://vuejs.org/guide/extras/rendering-mechanism.html">Rendering Mechanism</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>Vue æ˜¯å¦‚ä½•å°† template è½¬æ¢ä¸ºçœŸå®çš„DOMèŠ‚ç‚¹ï¼Ÿåˆæ˜¯å¦‚ä½•é«˜æ•ˆåœ°æ›´æ–°è¿™äº›èŠ‚ç‚¹ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé€šè¿‡ç ”ç©¶Vueå†…éƒ¨çš„æ¸²æŸ“æœºåˆ¶ï¼Œæ¥è§£é‡Šè¿™äº›é—®é¢˜ã€‚</p>
<h2 id="Virtual-DOM"><a href="#Virtual-DOM" class="headerlink" title="Virtual DOM"></a>Virtual DOM</h2><p>ä½ ä¹Ÿè®¸å¬è¿‡â€è™šæ‹ŸDOMâ€è¿™ä¸ªæ¦‚å¿µï¼ŒVueçš„æ¸²æŸ“å°±æ˜¯åŸºäºå®ƒå®ç°çš„</p>
<p>è™šæ‹ŸDOMï¼ˆVDOMï¼‰æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¦‚å¿µï¼Œä»–å°†ç”¨æˆ·æ‰€éœ€çš„ç•Œé¢é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹(å¯¹è±¡ç»“æ„)ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸çœŸå®çš„DOMèŠ‚ç‚¹åŒæ­¥ã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯ç”± React é¦–åˆ›ï¼Œå¹¶è¢«Vueåœ¨å†…çš„è®¸å¤šå…¶ä»–æ¡†æ¶ä»¥ä¸åŒçš„å®ç°æ–¹å¼é‡‡ç”¨</p>
<p>è™šæ‹ŸDOMæ›´åƒæ˜¯ä¸€ç§æ¨¡å¼ï¼Œè€Œä¸æ˜¯ä¸€ç§ç‰¹å®šçš„æŠ€æœ¯ï¼Œå› æ­¤ä¸å­˜åœ¨æŸç§æ ‡å‡†çš„å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p>
<pre><code class="highlight js"><span class="keyword">const</span> vnode = &#123;
  <span class="attr">type</span>: <span class="string">&#x27;div&#x27;</span>,
  <span class="attr">props</span>: &#123;
    <span class="attr">id</span>: <span class="string">&#x27;hello&#x27;</span>
  &#125;,
  <span class="attr">children</span>: [
    <span class="comment">/* more vnodes */</span>
  ]
&#125;</code></pre>

<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œvnode æ˜¯ä¸€ä¸ªçº¯ JavaScript å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ª <code>&lt;div&gt;</code>å…ƒç´ ã€‚å®ƒåŒ…å«äº†æˆ‘ä»¬åˆ›å»ºçœŸå®DOMæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚å®ƒè¿˜åŒ…å«äº†æ›´å¤šçš„å­èŠ‚ç‚¹ï¼Œè¿™å°±ä½¿å®ƒæˆä¸ºäº†è™šæ‹ŸDOMæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p>
<p>ç„¶åä¸€ä¸ªè¿è¡Œæ—¶çš„æ¸²æŸ“å™¨(runtime renderer)éå†è¿™ä¸ªè™šæ‹ŸDOMæ ‘ï¼Œå¹¶ä½¿å…¶æ„å»ºä¸ºä¸€ä¸ªçœŸå®çš„DOMæ ‘ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºæŒ‚è½½(mount)ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªè™šæ‹ŸDOMæ ‘ï¼Œæ¸²æŸ“å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸ªæ ‘è¿›è¡Œéå†å’Œå¯¹æ¯”ï¼Œæ‰¾å‡ºä¸åŒä¹‹å¤„ã€‚ç„¶åå°†è¿™äº›ä¸åŒä¹‹å¤„çš„æ›´æ”¹åº”ç”¨åˆ°çœŸå®DOMä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º patchï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºâ€diffingâ€æˆ–è€…â€reconciliationâ€</p>
<p>è™šæ‹ŸDOMçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜ä»¥å£°æ˜çš„æ–¹å¼ï¼Œåˆ›å»ºã€æ£€æŸ¥å’Œç»„åˆæ‰€éœ€çš„ç”¨æˆ·ç•Œé¢ç»“æ„ï¼Œè€ŒçœŸå®DOMçš„æ“ä½œå°±ç•™ç»™æ¸²æŸ“å™¨å»å®ç°</p>
<h2 id="Render-Pipeline"><a href="#Render-Pipeline" class="headerlink" title="Render Pipeline"></a>Render Pipeline</h2><p>ä»é«˜å±‚æ¬¡æ¥çœ‹ï¼ŒæŒ‚è½½Vueç»„ä»¶æ—¶ä¼šå‘ç”Ÿä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ol>
<li><p><strong>Compile</strong>ï¼šVue æ¨¡ç‰ˆä¼šè¢«ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°ï¼šæ¸²æŸ“å‡½æ•°ä¼šè¿”å›è™šæ‹ŸDOMæ ‘ï¼Œè¿™ä¸€æ­¥å¯ä»¥æ˜¯åœ¨æ„å»ºä¹‹å‰å®Œæˆï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æ¸²æŸ“å™¨å³æ—¶å®Œæˆçš„ã€‚</p>
</li>
<li><p><strong>Mount</strong>ï¼šè¿è¡Œæ—¶æ¸²æŸ“å™¨ä¼šè°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œç„¶åéå†è¿”å›çš„è™šæ‹ŸDOMæ ‘ï¼Œå¹¶ä»¥æ­¤åˆ›å»ºçœŸå®DOMèŠ‚ç‚¹ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨å“åº”å¼å‰¯ä½œç”¨ä¸­æ‰§è¡Œï¼Œå› æ­¤å®ƒä¼šè·Ÿè¸ªæ‰€æœ‰ä½¿ç”¨è¿‡çš„å“åº”å¼ä¾èµ–é¡¹ã€‚</p>
</li>
<li><p><strong>Patch</strong>ï¼šå½“æŒ‚è½½æœŸé—´ä½¿ç”¨è¿‡çš„ä¾èµ–æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‰¯ä½œç”¨ä¼šé‡æ–°è¿è¡Œã€‚è¿™æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¹¶ä¸”ç»è¿‡æ›´æ–°çš„è™šæ‹ŸDOMæ ‘ã€‚ç„¶åè¿è¡Œæ—¶æ¸²æŸ“å™¨ä¼šéå†æ–°çš„DOMæ ‘ï¼Œå¹¶ä¸æ—§çš„DOMæ ‘è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶å°†å¿…è¦çš„æ›´æ–°åº”ç”¨åˆ°çœŸå®DOMä¸Šã€‚</p>
</li>
</ol>
<p><img src="https://cn.vuejs.org/assets/render-pipeline.03805016.png"></p>
<h2 id="Templates-vs-Render-Functions"><a href="#Templates-vs-Render-Functions" class="headerlink" title="Templates vs. Render Functions"></a>Templates vs. Render Functions</h2><p>Vueæ¨¡ç‰ˆä¼šè¢«ç¼–è¯‘æˆè™šæ‹ŸDOMæ¸²æŸ“å‡½æ•°ã€‚å¦å¤–Vueä¹Ÿæä¾›äº†ä¸€äº›APIå¯ä»¥è·³è¿‡æ¨¡ç‰ˆç¼–è¯‘é˜¶æ®µç›´æ¥ç¼–å†™æ¸²æŸ“å‡½æ•°ã€‚å½“ä½ åœ¨å¤„ç†é«˜åº¦åŠ¨æ€çš„é€»è¾‘æ—¶ï¼Œç›´æ¥ç¼–å†™æ¸²æŸ“å‡½æ•°æ¯”æ¨¡ç‰ˆæ›´åŠ çµæ´»ï¼Œå› ä¸ºä½ å¯ä»¥ä½¿ç”¨javascriptçš„å…¨éƒ¨åŠŸèƒ½æ¥å¤„ç† vnodes</p>
<p>é‚£ä¸ºä»€ä¹ˆVueé»˜è®¤æ¨èä½¿ç”¨æ¨¡ç‰ˆå‘¢ï¼Ÿæœ‰å‡ ä¸ªåŸå› ï¼š</p>
<ol>
<li><p>æ¨¡ç‰ˆæ›´æ¥è¿‘çœŸå®çš„HTMLã€‚è¿™æ ·å°±æ›´å®¹æ˜“çš„å¤ç”¨ç°æœ‰çš„HTMLä»£ç æ®µï¼Œå¹¶æœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼Œæ›´èƒ½æ–¹ä¾¿åœ°ä½¿ç”¨CSSæ ·å¼ï¼Œå¹¶ä¸”è®¾è®¡å¸ˆæ›´å®¹æ˜“ç†è§£å’Œä¿®æ”¹ã€‚</p>
</li>
<li><p>æ¨¡ç‰ˆçš„è¯­æ³•æ›´åŠ ç¡®å®šï¼Œå› æ­¤æ›´å®¹æ˜“è¿›è¡Œé™æ€åˆ†æã€‚è¿™å°±å¯ä»¥è®©Vueçš„æ¨¡ç‰ˆç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æœ‰æ›´å¤šçš„ä¼˜åŒ–ï¼Œä»¥æé«˜è™šæ‹ŸDOMçš„æ€§èƒ½(è¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨ä¸‹é¢è®¨è®º)ã€‚</p>
</li>
</ol>
<p>åœ¨å®è·µä¸­ï¼Œæ¨¡ç‰ˆè¶³ä»¥æ»¡è¶³åº”ç”¨ä¸­çš„å¤§å¤šç”¨ä¾‹ã€‚æ¸²æŸ“å‡½æ•°é€šå¸¸åªéœ€è¦å¤„ç†é«˜åº¦åŠ¨æ€æ¸²æŸ“é€»è¾‘çš„å¯é‡ç”¨ç»„ä»¶ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šæ¸²æŸ“å‡½æ•°çš„ä½¿ç”¨ï¼Œå¯ä»¥å» <a href="https://vuejs.org/guide/extras/render-function.html"><strong>Render Functions &amp; JSX</strong></a> ä¸­ç»§ç»­é˜…è¯»</p>
<h2 id="Compiler-Informed-Virtual-DOM"><a href="#Compiler-Informed-Virtual-DOM" class="headerlink" title="Compiler-Informed Virtual DOM"></a>Compiler-Informed Virtual DOM</h2><p>React ä¸­çš„è™šæ‹ŸDOMå’Œå¤§å¤šæ•°è™šæ‹ŸDOMå®ç°éƒ½æ˜¯å•çº¯çš„è¿è¡Œæ—¶å®ç°ï¼šreconciliation ç®—æ³•æ— æ³•é¢„çŸ¥ä¼ å…¥çš„è™šæ‹ŸDOMæ ‘ï¼Œæ‰€ä»¥å®ƒå¿…é¡»å®Œå…¨éå†ï¼Œå¹¶å¯¹æ¯”æ¯ä¸ªvnodeçš„propsï¼Œä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å¦å¤– ï¼Œå³ä½¿DOMæ ‘çš„å…¶ä¸­ä¸€éƒ¨åˆ†ä»æœªæ”¹å˜ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ä¹Ÿä¼šä¸ºå®ƒä»¬åˆ›å»ºæ–°çš„vnodeï¼Œä»è€Œé€ æˆä¸å¿…è¦çš„å†…å­˜å‹åŠ›ã€‚è¿™ä¹Ÿæ˜¯è™šæ‹ŸDOMæœ€ä¸ºäººè¯Ÿç—…çš„åœ°æ–¹ä¹‹ä¸€ï¼šç²—æš´çš„æ›´æ–°è¿‡ç¨‹ç‰ºç‰²äº†æ•ˆç‡ï¼Œå´æ¢æ¥äº†ä»£ç çš„å£°æ˜æ€§å’Œæ­£ç¡®æ€§</p>
<p>ä½†å…¶å®ä¸å¿…å¦‚æ­¤ã€‚åœ¨Vueä¸­ï¼Œæ¡†æ¶åŒæ—¶æ§åˆ¶äº†ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬å®ç°è®¸å¤šç¼–è¯‘æ—¶çš„ä¼˜åŒ–ï¼Œåªæœ‰ç¼–è¯‘æ—¶å’Œæ¸²æŸ“æ—¶ç´§å¯†è€¦åˆæ‰èƒ½åˆ©ç”¨è¿™äº›ä¼˜åŒ–ã€‚ç¼–è¯‘å™¨å¯ä»¥é™æ€åˆ†ææ¨¡ç‰ˆï¼Œå¹¶åœ¨ç”Ÿæˆçš„ä»£ç ä¸­ç•™ä¸‹æç¤ºï¼Œè¿™æ ·è¿è¡Œæ—¶å°±å¯èƒ½é€šè¿‡è¿™äº›æç¤ºèµ°æ·å¾„ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä»ç„¶ä¿ç•™äº†ç”¨æˆ·åœ¨æŸäº›è¾¹ç•Œæƒ…å†µæƒ³è¦ä½¿ç”¨åº•å±‚æ¸²æŸ“å‡½æ•°çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å°†è¿™ç§æ··åˆå®ç°ç§°ä¸ºå¸¦ç¼–è¯‘æ—¶ä¿¡æ¯çš„è™šæ‹Ÿ DOM (Compiler-Informed Virtual DOM)</p>
<p>åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬å°†è®¨è®ºVueç¼–è¯‘å™¨ä¸ºæé«˜è™šæ‹ŸDOMè¿è¡Œæ—¶æ€§èƒ½è€Œè¿›è¡Œçš„å‡ é¡¹ä¸»è¦ä¼˜åŒ–ã€‚</p>
<h3 id="Static-Hoisting"><a href="#Static-Hoisting" class="headerlink" title="Static Hoisting"></a>Static Hoisting</h3><p>åœ¨æ¨¡ç‰ˆä¸­ç»å¸¸ä¼šå‡ºç°ä¸åŒ…å«ä»»ä½•åŠ¨æ€ç»‘å®šçš„éƒ¨åˆ†ï¼š</p>
<pre><code class="highlight js">&lt;div&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>foo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> &lt;!-- hoisted --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> &lt;!-- hoisted --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; dynamic &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
&lt;/div&gt;

<span class="comment">// ==&gt; after compile</span>

<span class="keyword">import</span> &#123; createElementVNode <span class="keyword">as</span> _createElementVNode, createCommentVNode <span class="keyword">as</span> _createCommentVNode, toDisplayString <span class="keyword">as</span> _toDisplayString, openBlock <span class="keyword">as</span> _openBlock, createElementBlock <span class="keyword">as</span> _createElementBlock &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>

<span class="keyword">const</span> _hoisted_1 = <span class="comment">/*#__PURE__*/</span><span class="title function_">_createElementVNode</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;foo&quot;</span>, -<span class="number">1</span> <span class="comment">/* HOISTED */</span>)
<span class="keyword">const</span> _hoisted_2 = <span class="comment">/*#__PURE__*/</span><span class="title function_">_createElementVNode</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;bar&quot;</span>, -<span class="number">1</span> <span class="comment">/* HOISTED */</span>)

<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">_ctx, _cache, $props, $setup, $data, $options</span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, [
    _hoisted_1,
    <span class="title function_">_createCommentVNode</span>(<span class="string">&quot; hoisted &quot;</span>),
    _hoisted_2,
    <span class="title function_">_createCommentVNode</span>(<span class="string">&quot; hoisted &quot;</span>),
    <span class="title function_">_createElementVNode</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="title function_">_toDisplayString</span>(_ctx.<span class="property">dynamic</span>), <span class="number">1</span> <span class="comment">/* TEXT */</span>)
  ]))
&#125;</code></pre>

<p><code>foo</code> å’Œ <code>bar</code>çš„<code>div</code>å…ƒç´ æ˜¯é™æ€çš„ï¼Œå› æ­¤åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶é‡æ–°åˆ›å»ºvnodeå¹¶è¿›è¡Œdiffingå¤„ç†æ˜¯æ²¡å¿…è¦çš„ã€‚Vueç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†é™æ€éƒ¨åˆ†ä»æ¸²æŸ“å‡½æ•°ä¸­ç§»å‡ºåˆ°å¤–é¢ï¼Œå¹¶åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶é‡å¤ä½¿ç”¨ç›¸åŒçš„vnodeã€‚å½“æ¸²æŸ“å™¨å‘ç°æ—§çš„vnodeå’Œæ–°çš„vnodeæ˜¯åŒä¸€ä¸ªæ—¶ï¼Œå®ƒè¿˜å¯ä»¥å®Œå…¨è·³è¿‡å®ƒä»¬çš„diffingå¤„ç†</p>
<p>æ­¤å¤–ï¼Œå¦‚æœæœ‰è¶³å¤Ÿå¤šçš„è¿ç»­é™æ€å…ƒç´ ï¼Œå®ƒä»¬å°†ç»„åˆæˆä¸€ä¸ªâ€é™æ€vnodeâ€ï¼Œå…¶ä¸­åŒ…å«è¿™äº›èŠ‚ç‚¹çš„çº¯HTMLå­—ç¬¦ä¸²ã€‚ç„¶åè¿™äº›vnodeå¯ä»¥ç›´æ¥é€šè¿‡<code>innerHTML</code>æ¥åŠ è½½ã€‚åœ¨åˆå§‹æŒ‚è½½æ—¶ï¼Œå®ƒä»¬ä¹Ÿä¼šç¼“å­˜ç›¸åº”çš„DOMèŠ‚ç‚¹ï¼Œå¦‚æœåŒä¸€å†…å®¹åœ¨åº”ç”¨çš„å…¶ä»–åœ°æ–¹é‡å¤ä½¿ç”¨åï¼Œå°±ä¼šé€šè¿‡æœ¬åœ°çš„<code>cloneNode()</code>åˆ›å»ºæ–°çš„DOMèŠ‚ç‚¹ï¼Œè¿™æ ·åšä¼šéå¸¸é«˜æ•ˆã€‚</p>
<h3 id="Patch-Flags"><a href="#Patch-Flags" class="headerlink" title="Patch Flags"></a>Patch Flags</h3><p>å¯¹äºåŠ¨æ€ç»‘å®šçš„å•ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æ—¶ä»ä¸­æ¨æ–­å‡ºå¾ˆå¤šä¿¡æ¯ï¼š</p>
<pre><code class="highlight js">&lt;!-- <span class="keyword">class</span> <span class="title class_">binding</span> only --&gt;
<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; active &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>

&lt;!-- id and value bindings only --&gt;
<span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;value&quot;</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="comment">&lt;!-- text children only --&gt;</span></span>
<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; dynamic &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">// ==&gt; after compile</span>
<span class="language-xml"></span>
<span class="language-xml">import &#123; normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock &#125; from &quot;vue&quot;</span>
<span class="language-xml"></span>
<span class="language-xml">export function render(_ctx, _cache, $props, $setup, $data, $options) &#123;</span>
<span class="language-xml">  return (_openBlock(), _createElementBlock(_Fragment, null, [</span>
<span class="language-xml">    _createElementVNode(&quot;div&quot;, &#123;</span>
<span class="language-xml">      class: _normalizeClass(&#123; active: _ctx.active &#125;)</span>
<span class="language-xml">    &#125;, null, 2 /* CLASS */),</span>
<span class="language-xml">    _createElementVNode(&quot;input&quot;, &#123;</span>
<span class="language-xml">      id: _ctx.id,</span>
<span class="language-xml">      value: _ctx.value</span>
<span class="language-xml">    &#125;, null, 8 /* PROPS */, [&quot;id&quot;, &quot;value&quot;]),</span>
<span class="language-xml">    _createElementVNode(&quot;div&quot;, null, _toDisplayString(_ctx.dynamic), 1 /* TEXT */)</span>
<span class="language-xml">  ], 64 /* STABLE_FRAGMENT */))</span>
<span class="language-xml">&#125;</span>
<span class="language-xml"></span></code></pre>

<p>åœ¨ä¸ºè¿™äº›å…ƒç´ ç”Ÿæˆæ¸²æŸ“å‡½æ•°ä»£ç æ—¶ï¼ŒVueä¼šåœ¨vnodeåˆ›å»ºè°ƒç”¨ä¸­ç›´æ¥ç¼–ç æ¯ä¸ªå…ƒç´ æ‰€éœ€çš„æ›´æ–°ç±»å‹ï¼š</p>
<pre><code class="highlight js"><span class="title function_">createElementVNode</span>(<span class="string">&quot;div&quot;</span>, &#123;
  <span class="attr">class</span>: <span class="title function_">_normalizeClass</span>(&#123; <span class="attr">active</span>: _ctx.<span class="property">active</span> &#125;)
&#125;, <span class="literal">null</span>, <span class="number">2</span> <span class="comment">/* CLASS */</span>)</code></pre>

<p>æœ€åä¸€ä¸ªå‚æ•°2æ˜¯patch flagã€‚ä¸€ä¸ªå…ƒç´ å¯ä»¥æœ‰å¤šä¸ªflagï¼Œè¿™äº›flagä¼šåˆå¹¶æˆä¸€ä¸ªæ•°å­—ã€‚ç„¶åï¼Œè¿è¡Œæ—¶æ¸²æŸ“å™¨å¯ä»¥é€šè¿‡ä½è¿ç®—æ£€æŸ¥è¿™äº›flagï¼Œç”¨äºç¡®å®šæ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›æ›´æ–°æ“ä½œï¼š</p>
<pre><code class="highlight js"><span class="keyword">if</span> (vnode.<span class="property">patchFlag</span> &amp; <span class="title class_">PatchFlags</span>.<span class="property">CLASS</span> <span class="comment">/* 2 */</span>) &#123;
  <span class="comment">// update the element&#x27;s class</span>
&#125;</code></pre>

<p>ä½è¿ç®—æ£€æŸ¥é€Ÿåº¦æå¿«ã€‚æœ‰äº†patch flagsï¼ŒVueå°±èƒ½é€šè¿‡æœ€å°‘çš„æ›´æ–°æ“ä½œæ¥æ›´æ–°å…·æœ‰åŠ¨æ€ç»‘å®šçš„å…ƒç´ </p>
<p>Vueè¿˜ä¼šç»™vnodeçš„å­èŠ‚ç‚¹ç±»å‹è¿›è¡Œç¼–ç ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹çš„æ¨¡ç‰ˆè¢«è¡¨ç¤ºä¸ºä¸€ä¸ªç‰‡æ®µã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šè¿™äº›æ ¹èŠ‚ç‚¹çš„é¡ºåºæ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ä¸ªä¿¡æ¯é€šè¿‡æ ‡è®°æä¾›ç»™è¿è¡Œæ—¶</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(_Fragment, <span class="literal">null</span>, [
    <span class="comment">/* children */</span>
  ], <span class="number">64</span> <span class="comment">/* STABLE_FRAGMENT */</span>))
&#125;
</code></pre>

<p>æ‰€ä»¥ï¼Œè¿è¡Œæ—¶å¯ä»¥å®Œå…¨è·³è¿‡æ ¹ç‰‡æ®µçš„å­åºåˆ—é¡ºåºçš„åè°ƒè¿‡ç¨‹</p>
<h3 id="Tree-Flattening"><a href="#Tree-Flattening" class="headerlink" title="Tree Flattening"></a>Tree Flattening</h3><p>å†çœ‹ä¸€ä¸‹ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ç”Ÿæˆçš„ä»£ç ï¼Œä½ ä¼šå‘ç°è¿”å›çš„è™šæ‹ŸDOMæ ‘çš„æ ¹æ˜¯é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ <code>createElementBlock()</code>è°ƒç”¨åˆ›å»ºçš„ï¼š</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;
  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(_Fragment, <span class="literal">null</span>, [
    <span class="comment">/* children */</span>
  ], <span class="number">64</span> <span class="comment">/* STABLE_FRAGMENT */</span>))
&#125;</code></pre>

<p>ä»æ¦‚å¿µä¸Šçœ‹ï¼Œâ€œblockâ€æ˜¯æ¨¡ç‰ˆä¸­å…·æœ‰ç¨³å®šå†…éƒ¨ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ•´ä¸ªæ¨¡ç‰ˆåªæœ‰ä¸€ä¸ªblockï¼Œå› ä¸ºå®ƒä¸åŒ…å«ä»»ä½•ç»“æ„æŒ‡ä»¤ï¼Œå¦‚<code>v-if</code>å’Œ<code>v-for</code></p>
<p>æ¯ä¸ªblockéƒ½ä¼šè¿½è¸ªä»»ä½•æœ‰patch flagsçš„åä»£èŠ‚ç‚¹(ä¸åªæ˜¯ç›´æ¥å­èŠ‚ç‚¹)ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="highlight js">&lt;div&gt; &lt;!-- root block --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>         &lt;!-- not tracked --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>   &lt;!-- tracked --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>                  <span class="comment">&lt;!-- not tracked --&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; bar &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- tracked --&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
&lt;/div&gt;</code></pre>

<p>è¿™ä¸ªç»“æœæ˜¯ä¸€ä¸ªåªåŒ…å«åŠ¨æ€å­èŠ‚ç‚¹çš„æ‰å¹³åŒ–æ•°ç»„ï¼š</p>
<pre><code class="highlight js">div (block root)
- div <span class="keyword">with</span> :id binding
- div <span class="keyword">with</span> &#123;&#123; bar &#125;&#125; binding</code></pre>

<p>å½“ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“æ—¶ï¼Œå®ƒåªéœ€è¦éå†è¿™ä¸ªæ‰å¹³åŒ–çš„æ ‘è€Œä¸æ˜¯æ•´æ£µæ ‘ã€‚è¿™å°±æ‰€è°“çš„ Tree Flatteningï¼Œå®ƒå¤§å¤§å‡å°‘äº†è™šæ‹ŸDOMåè°ƒè¿‡ç¨‹ä¸­éœ€è¦éå†çš„èŠ‚ç‚¹æ•°é‡ã€‚æ¨¡ç‰ˆä¸­çš„ä»»ä½•é™æ€éƒ¨åˆ†éƒ½ä¼šé«˜æ•ˆç•¥è¿‡ã€‚</p>
<p><code>v-if</code>å’Œ<code>v-for</code>ä¼šåˆ›å»ºæ–°çš„blockèŠ‚ç‚¹ï¼š</p>
<pre><code class="highlight js">&lt;div&gt; &lt;!-- root block --&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>&gt;</span> <span class="comment">&lt;!-- if block --&gt;</span></span>
<span class="language-xml">      ...</span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></code></pre>

<p>å­blockä¼šåœ¨çˆ¶blockçš„åŠ¨æ€åä»£æ•°ç»„ä¸­è¿›è¡Œè¿½è¸ªã€‚è¿™å°±ä¸ºçˆ¶blockä¿ç•™äº†ä¸€ä¸ªç¨³å®šçš„ç»“æ„ã€‚</p>
<h2 id="Impact-on-SSR-Hydration"><a href="#Impact-on-SSR-Hydration" class="headerlink" title="Impact on SSR Hydration"></a>Impact on SSR Hydration</h2><p>patch flags å’Œ tree flattening ä¹Ÿä¼šæé«˜Vueçš„ <a href="https://vuejs.org/guide/scaling-up/ssr.html#client-hydration">SSR Hydration</a> æ€§èƒ½ï¼š</p>
<ul>
<li>å•ä¸ªå…ƒç´ çš„ hydration å¯ä»¥æ ¹æ® vnode çš„ path flag èµ°æ›´å¿«çš„æ·å¾„ã€‚</li>
<li>åªæœ‰blockèŠ‚ç‚¹å’Œå…¶åŠ¨æ€å­èŠ‚ç‚¹åœ¨è¿›è¡Œ hydration æ—¶éœ€è¦è¿›è¡Œéå†ï¼Œä»è€Œåœ¨æ¨¡æ¿çº§åˆ«å®ç°éƒ¨åˆ† hydrationã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>Vue</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘Why Japanese Websites Look So Different</title>
    <url>/2023/06/10/%E3%80%90%E7%BF%BB%E3%80%91Why-Japanese-Websites-Look-So-Different/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://medium.com/@mirijam.missbichler/why-japanese-websites-look-so-different-2c7273e8be1e">Why Japanese Websites Look So Different</a><br>åŸä½œè€…ï¼š<a href="https://medium.com/@mirijam.missbichler">Mirijam Missbichler</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>å¤šå¹´ä»¥æ¥ï¼Œæˆ‘å¤šæ¬¡æ¥è§¦è¿‡æ—¥æœ¬ç½‘ç«™ï¼Œæ— è®ºæ˜¯ç ”ç©¶ç­¾è¯ã€è®¡åˆ’æ—…è¡Œï¼Œè¿˜æ˜¯ç®€å•çš„åœ¨ç½‘ä¸Šè´­ç‰©ã€‚æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰ä¹ æƒ¯ä¸‹é¢è¿™æ ·çš„æ–‡å­—å¸ƒå±€ï¼Œä½¿ç”¨å¤§é‡é²œè‰³çš„é¢œè‰²å’Œåå¤šç§ä¸åŒçš„å­—ä½“</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lfpAOTRBmUP6k80b2GNGlg.png"></p>
<p>å¯¹äºä¹ æƒ¯ä½¿ç”¨è¥¿æ–¹ç½‘ç«™çš„äººï¼Œæœ‰è®¸å¤šç½‘ç«™è®¾è®¡çš„ç®€çº¦ä¸”æ˜“äºæµè§ˆï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™ç§æ›´åŠ å¤æ‚çš„é£æ ¼åœ¨æ—¥æœ¬å´å¾ˆæµè¡Œã€‚</p>
<p>æ¾„æ¸…ä¸€ä¸‹ï¼Œè¿™äº›ä¸æ˜¯è¿‡å»çš„ç½‘ç«™ï¼Œæ˜¯ç°åœ¨æ­£åœ¨ç»´æŠ¤çš„ç½‘ç«™ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªç½‘ç«™æœ€åä¸€æ¬¡æ›´æ–°æ˜¯åœ¨2023å¹´ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52jHrlyvsqRw2l7hwfMS5A.png"></p>
<p>æˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªä¸åŒè§’åº¦æ¥åˆ†æè¿™ç§è®¾è®¡ï¼š</p>
<ul>
<li>å­—ä½“å’Œç½‘ç«™å¼€å‘çš„é™åˆ¶</li>
<li>æŠ€æœ¯å‘å±•åœæ»</li>
<li>æœºæ„ç¼ºä¹æ•°å­—ç´ å…»</li>
<li>æ–‡åŒ–çš„å½±å“</li>
</ul>
<p>å°±åƒå¤§å¤šæ•°è¯é¢˜ä¸€æ ·ï¼Œå¯èƒ½æ²¡æœ‰ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆã€‚è¿™ç§ç½‘ç«™è®¾è®¡æ˜¯å„ç§å› ç´ é•¿æœŸäº’ç›¸ä½œç”¨çš„ç»“æœ</p>
<h2 id="Fonts-amp-Front-End-Website-Development-Constraints"><a href="#Fonts-amp-Front-End-Website-Development-Constraints" class="headerlink" title="Fonts &amp; Front-End Website Development Constraints"></a>Fonts &amp; Front-End Website Development Constraints</h2><p>ä¸ºç½—é©¬è¯­è¨€åˆ›å»ºæ–°çš„å­—ä½“æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŒ‘æˆ˜ï¼Œæ¯ä¸ªäººåªè¦å¯¹å­—ä½“è®¾è®¡æœ‰åŸºæœ¬çš„äº†è§£ï¼Œå¹¶ä¸”ç”¨é€‚å½“çš„ç¨‹åºå’Œä¸€äº›æ—¶é—´å°±å¯ä»¥æ‰¿å—ï¼Œä½†æ˜¯ä¸ºæ—¥è¯­åˆ›å»ºå­—ä½“æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„äº‹æƒ…</p>
<p>é¦–å…ˆå¦‚æœä»å¤´åˆ›å»ºä¸€ä¸ªè‹±è¯­å­—ä½“ï¼Œä½ ä¼šçœ‹åˆ°å¤§çº¦230ä¸ªå­—å½¢ï¼Œä¸€ä¸ªå­—å½¢æ˜¯ä¸€ä¸ªå­—æ¯çš„å•ç‹¬å±•ç¤º(A a a ç®—3ä¸ªå­—å½¢)ï¼Œå¦‚æœä½ æƒ³è¦†ç›–æ‰€æœ‰åŸºäºæ‹‰ä¸å­—æ¯çš„è¯­è¨€ï¼Œå°±éœ€è¦840ä¸ªå­—å½¢ã€‚ä½†æ˜¯å¯¹äºæ—¥è¯­ï¼Œç”±äºä¸‰ç§ä¸åŒçš„ä¹¦å†™ç³»ç»Ÿå’Œæ— æ•°çš„æ±‰å­—ï¼Œä½ å°±ä¼šçœ‹åˆ°7000 - 16000ä¸ªå­—å½¢ç”šè‡³æ›´å¤šã€‚å› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥è¯­å­—ä½“éœ€è¦ä¸€ä¸ªæœ‰ç»„ç»‡çš„å›¢é˜ŸèŠ±è´¹æ¯”æ‹‰ä¸è¯­å­—ä½“ç›¸å½“å¤šçš„æ—¶é—´æ‰å¯èƒ½</p>
<p>æ¯«ä¸å¥‡æ€ªï¼Œå¯¹äºä¸­æ–‡å’Œ(æ±‰å­—)éŸ©æ–‡å­—ä½“æ¥è¯´ï¼Œç±»ä¼¼çš„å·¥ä½œé‡ä¹Ÿæ˜¯å¿…ç„¶çš„ï¼Œè¿™å¯¼è‡´è¿™äº›è¯­è¨€é€šå¸¸è¢«æ‰€è°“çš„CJKå­—ä½“æ‰€è¦†ç›–</p>
<p>éšç€è¶Šæ¥è¶Šå°‘çš„è®¾è®¡å¸ˆæ¥å—è¿™ä¸€ç‰¹æ®ŠæŒ‘æˆ˜ï¼Œåœ¨å»ºç«‹ä¸€ä¸ªç½‘ç«™æ—¶å¯ä¾›é€‰æ‹©çš„å­—ä½“ä¹Ÿå°±è¶Šæ¥è¶Šå°‘ã€‚å†åŠ ä¸Šç¼ºä¹å¤§å†™å­—ä½“å’Œæ—¥æ–‡å­—ä½“ï¼Œéœ€è¦å¼•å…¥è¾ƒå¤§ä½“ç§¯çš„åº“ï¼Œä¼šå¯¼è‡´åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œæœ€ç»ˆä½ å°±éœ€è¦ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œæ¥åˆ›å»ºè§†è§‰å±‚æ¬¡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ‹¿ç¾å›½å’Œæ—¥æœ¬çš„æ˜Ÿå·´å…‹ä¸»é¡µä¸ºä¾‹ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PfaaGd_Bl2fTN9uqAT-bKA.png"></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-TiKrBADjkMrnHjBAQ4bQ.png"></p>
<p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆå¯¹äºè®¸å¤šæ—¥æœ¬ç½‘ç«™å€¾å‘äºç”¨æ–‡å­—å¯†é›†çš„å›¾åƒæ¥è¡¨ç¤ºå†…å®¹ç±»åˆ«ã€‚æœ‰æ—¶å€™ä½ ç”šè‡³å¯ä»¥çœ‹åˆ°æ¯ä¸ªç“·ç –éƒ½ä½¿ç”¨è‡ªå·±ç‰¹å®šçš„å­—ä½“ï¼Œç‰¹åˆ«æ˜¯é™æ—¶ä¼˜æƒ æ—¶ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Imrz53GsvI3Jmibv4Lltxw.png"></p>
<h2 id="Technological-Development-x2F-Stagnation-amp-Institutional-Digital-Literacy"><a href="#Technological-Development-x2F-Stagnation-amp-Institutional-Digital-Literacy" class="headerlink" title="Technological Development&#x2F;Stagnation &amp; Institutional Digital Literacy"></a>Technological Development&#x2F;Stagnation &amp; Institutional Digital Literacy</h2><p>è™½ç„¶å…³äº â€œå¤±å»çš„åå¹´â€ å’Œæ—¥æœ¬æŠ€æœ¯è¿›æ­¥çš„å…³ç³»æœ‰æ— æ•°çš„è®¨è®ºï¼Œä½†æˆ‘æœ€å–œæ¬¢è¿™ä¸ªæ€»ç»“ï¼š</p>
<blockquote>
<p>Japan, living in the year 2000 since 1985. (<a href="https://www.reddit.com/r/japan/comments/10herkr/comment/j59m31c/?context=3">thanks Reddit</a>)</p>
</blockquote>
<p>å¦‚æœä½ å¯¹æ—¥æœ¬æ„Ÿå…´è¶£ï¼Œä½ å¯èƒ½ä¼šç†Ÿæ‚‰å…ˆè¿›æŠ€æœ¯å’Œè¿‡æ—¶æŠ€æœ¯çš„è¿™ç§å¯¹æ¯”ï¼Œè¿™ç§å¯¹æ¯”åœ¨è®¸å¤šåœ°æ–¹éƒ½å­˜åœ¨ã€‚ä½œä¸ºä¸–ç•Œæœºå™¨äººé¢†åŸŸçš„é¢†å…ˆè€…ä¹‹ä¸€ï¼Œå°†ä¸€åº§<a href="https://www.unicorn-gundam-statue.jp/en/">çœŸäººå¤§å°çš„é«˜è¾¾é›•åƒ</a>æ”¾åœ¨å¾¡å°åœºäººå·¥å²›ä¸Šçš„å›½å®¶ï¼Œå´ä»ç„¶ä¾èµ–è½¯é©±å’Œä¼ çœŸæœºï¼Œå¹¶åœ¨2022å¹´æ—¶é¢å¯¹<a href="https://www.bloomberg.com/news/articles/2022-06-15/end-of-internet-explorer-era-spells-trouble-for-japan-businesses?leadSource=uverify%20wall#xj4y7vzkg">windows ieå…³é—­</a>é™·å…¥ææ…Œ</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDYVc3z22_A-ELz8Q1KHIw.png"></p>
<p>åœ¨å¾·å›½ï¼Œå‰æ€»ç†å®‰æ ¼æ‹‰-é»˜å…‹å°”åœ¨2013å¹´ç§°äº’è”ç½‘ä¸º â€œæœªçŸ¥é¢†åŸŸâ€ï¼ˆå¾·æ–‡åŸè¯ï¼šâ€Das Internet ist fÃ¼r uns alle Neulandâ€ï¼‰åï¼Œè¢«å…¨å›½å–ç¬‘ã€‚ç„¶è€Œï¼Œè¿™ä¸€æƒ…å†µè¢«å‰ç½‘ç»œå®‰å…¨éƒ¨é•¿æ¨±ç”°ä¹‰å­åœ¨2018å¹´è¶…è¶Šã€‚æ®æŠ¥é“ï¼Œä»–å£°ç§°ä»æœªä½¿ç”¨è¿‡è®¡ç®—æœºï¼Œå¹¶ä¸”å½“åœ¨è®®ä¼šè¢«é—®åŠUSBé©±åŠ¨å™¨çš„æ¦‚å¿µæ—¶ï¼Œä»–â€œå›°æƒ‘ä¸è§£â€(<a href="https://www.theguardian.com/world/2018/nov/15/japan-cyber-security-ministernever-used-computer-yoshitaka-sakurada">æ¥æº</a>)ã€‚</p>
<p>å¯¹äºé‚£äº›æ²¡æœ‰æœºä¼šçœ‹åˆ°å¹•åçš„äººæ¥è¯´ï¼Œè¿™æ ·çš„çŠ¶å†µå¯èƒ½å¬èµ·æ¥å¾ˆå¥‡æ€ªã€‚å› ä¸ºæ—¥æœ¬åœ¨æŠ€æœ¯ç´ å…»æ–¹é¢ï¼Œä¸€ç›´ä¸¥é‡æ»åã€‚å› æ­¤ï¼Œæ¨æ–­è¿™äº›é—®é¢˜å¯¹æ—¥æœ¬ç½‘ç«™è®¾è®¡å‘å±•ä¹Ÿèµ·åˆ°äº†ä¸€ç‚¹é˜»ç¢çš„ä½œç”¨ã€‚è€Œä¸”ï¼Œæ—¥æœ¬çš„ç½‘ç«™è®¾è®¡ä¹Ÿé¢ä¸´ç€è¿™ç§å›°å¢ƒã€‚åªéœ€åœ¨è°·æ­Œæˆ–Pinterestä¸Šæœç´¢æ—¥æœ¬æµ·æŠ¥è®¾è®¡ï¼Œå°±èƒ½è§è¯ä¸€ç§æˆªç„¶ä¸åŒä¸”ç°ä»£åŒ–çš„å¹³é¢è®¾è®¡æ°´å¹³ã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4nu6H_pheQBXEiAIZz6jA.png"></p>
<h2 id="Cultural-Influence"><a href="#Cultural-Influence" class="headerlink" title="Cultural Influence"></a>Cultural Influence</h2><p>åœ¨åˆ†æä»»ä½•ç±»å‹çš„è®¾è®¡é€‰æ‹©æ—¶ï¼Œæ–‡åŒ–ä¹ ä¿—ã€å€¾å‘ã€åè§å’Œåå¥½éƒ½ä¸åº”è¢«ä½ä¼°ã€‚ç„¶è€Œï¼Œâ€œè¿™æ˜¯æ–‡åŒ–â€çš„è§‚ç‚¹å­˜åœ¨è¿‡äºç®€åŒ–ä¸»é¢˜çš„é£é™©ï¼Œå¹¶å¯èƒ½è¢«ç”¨ä½œä¸ºå„ç§å·®å¼‚è¾©æŠ¤çš„å€Ÿå£ã€‚è€Œè¦æ‘†è„±ä¸ªäººçš„è§‚ç‚¹åè§æ˜¯å›°éš¾çš„ï¼Œç”šè‡³ä¸å¯èƒ½å®Œå…¨åšåˆ°ã€‚</p>
<p>æ‰€ä»¥ï¼Œä»æˆ‘ä»¬çš„è§’åº¦æ¥çœ‹ï¼Œå¾ˆå®¹æ˜“çœ‹å¾…è¿™ä¸ªç½‘ç«™â€¦</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Tgk9_5Ci-B4DoITuGqQTw.png"></p>
<p>â€¦æ„Ÿè§‰éš¾ä»¥æ¥å—ï¼Œå¹¶ä¸”è®¤ä¸ºå®ƒçš„è®¾è®¡å¾ˆç³Ÿç³•ï¼Œç„¶åå®£å¸ƒç»“æŸã€‚å› ä¸ºè°ä¼šä½¿ç”¨è¿™ä¸ªæ··ä¹±æ— åºçš„ç½‘ç«™å‘¢ï¼Ÿ</p>
<p>æ­£æ˜¯å› ä¸ºè¿™ç§æ— çŸ¥ï¼Œè¿™äº›æœ‰è¶£çš„è§è§£å°±è¢«å¿½è§†äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä¸èƒ½ç¡®åˆ‡çš„å‘Šè¯‰ä½ æ—¥æœ¬æ–‡åŒ–å¦‚ä½•å½±å“äº†è¿™ç§è®¾è®¡ã€‚ç„¶è€Œï¼Œæˆ‘å¾ˆå¹¸è¿åœ°èƒ½å¤Ÿä»ä¸æ—¥æœ¬æœ¬åœŸäººçš„å¯¹è¯ä¸­è·å¾—å¯ç¤ºï¼Œä¹Ÿæœ‰åœ¨æ—¥æœ¬å·¥ä½œå’Œç”Ÿæ´»çš„ç»éªŒå¯ä»¥å€Ÿé‰´ã€‚</p>
<p>æˆ‘æ›¾ç»å‚ä¸è¿‡ä¸€æ¬¡ä¸è¿™ä¸ªåˆ†æç›¸å…³ä½†ä¸ç½‘ç«™æ— å…³çš„å¯¹è¯ï¼Œæ˜¯å…³äºYouTubeçš„ç¼©ç•¥å›¾ï¼Œå› ä¸ºè¿™åŒæ ·è®©äººéš¾ä»¥æ¥å—</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lwaEIIIUc5peoMMo6fM_Q.png"></p>
<p>å¯¹äºä¸€ä¸ªä¹ æƒ¯äº†è®¸å¤šè¥¿æ–¹é¢‘é“ä½¿ç”¨çš„æç®€å’Œå…‰æ»‘è®¾è®¡çš„äººæ¥è¯´ï¼Œä»¥ä¸€ä¸ªæ ‡é¢˜ï¼Œåå¤å‡ºç°çš„è°ƒè‰²æ¿å’Œæœ‰é™çš„å­—ä½“ä¸ºç‰¹è‰²ï¼Œä¸Šé¢çš„ç¼©ç•¥å›¾è®©äººéš¾ä»¥æ¥å—ï¼Œæˆ‘æ›¾é—®ä¸€ä¸ªæ—¥æœ¬äººä¸ºä»€ä¹ˆè®¸å¤šéå¸¸å—æ¬¢è¿çš„é¢‘é“çš„ç¼©ç•¥å›¾éƒ½æ˜¯è¿™æ ·è®¾è®¡çš„ï¼Œç„¶è€Œï¼Œä»–éå¸¸æƒŠè®¶è¿™ç§è§†ä¸ºæ··ä¹±çš„æƒ³æ³•ã€‚ä»–è®¤ä¸ºæ—¥æœ¬äººçš„è§†é¢‘çœ‹èµ·æ¥æ›´æœ‰å¸å¼•åŠ›ï¼Œæä¾›äº†ä¸€äº›èƒ½è®©äººæŠ“ä½çš„ä¿¡æ¯ï¼Œè®©äººä»¬æ›´å®¹æ˜“å†³å®šè§†é¢‘æ˜¯å¦æœ‰è¶£ã€‚æˆ‘ç»™ä»–çœ‹è‹±æ–‡è§†é¢‘ç¼©ç•¥å›¾åšå¯¹æ¯”æ—¶ï¼Œä»–è®¤ä¸ºéå¸¸æ¨¡ç³Šä¸”æ— èŠã€‚</p>
<p>è€Œæ­£æ˜¯è¿™ç§å¯»æ±‚ä¿¡æ¯çš„æ€åº¦ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬çš„è§‚å¿µå‡ºç°å¦‚æ­¤å¤§åˆ†æ­§çš„æ ¹æœ¬åŸå› ã€‚åœ¨æ—¥æœ¬ï¼Œè§„é¿é£é™©ã€åå¤æ£€æŸ¥å’Œå¯¹åšå†³å®šæ—¶çš„çŠ¹è±«ä¸å†³çš„ç¨‹åº¦æ˜æ˜¾é«˜äºè¥¿æ–¹å›½å®¶ã€‚è¿™ä¸æ›´å¤šçš„é›†ä½“ä¸»ä¹‰ç¤¾ä¼šå¿ƒæ€å¯†åˆ‡ç›¸å…³ï¼Œæ¯”å¦‚ï¼Œå°†ä¸€ä»½æ–‡ä»¶å‘é€ç»™å•†ä¸šä¼™ä¼´ä¹‹å‰ï¼Œè¿›è¡ŒåŒé‡ï¼ˆæˆ–ä¸‰é‡ï¼‰æ£€æŸ¥å¯èƒ½ä¼šèŠ±è´¹æ›´å¤šæ—¶é—´ï¼Œä½†å´å¤§å¤§é™ä½é”™è¯¯æºœèµ°çš„é£é™©ï¼Œä»è€Œé˜²æ­¢ç›¸å…³äººå‘˜ä¸¢è„¸ã€‚</p>
<p>å›åˆ°ç½‘ç«™è®¾è®¡ï¼Œè¿™ä¸ªæ–‡åŒ–è§’åº¦æ›´èƒ½åŠ©äºè§£é‡Šä¸ºä»€ä¹ˆç½‘ä¸Šè´­ç‰©ã€æ–°é—»å’Œæ”¿åºœç½‘ç«™ä»å¤–éƒ¨æ¥çœ‹å¾€å¾€æ˜¯â€æœ€ç³Ÿç³•çš„çŠ¯ç½ªè€…â€ã€‚æ¯•ç«Ÿï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¤§é‡çš„ç»†èŠ‚ç›´æ¥å¯¹åº”ç€å¥½çš„çš„è´­ä¹°å†³ç­–ã€é«˜æ•ˆåœ°ä¿æŒæœ€æ–°ä¿¡æ¯æˆ–ç¡®ä¿ä½ æ‹¥æœ‰æŸä¸ªæµç¨‹çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼Œå…³äºç¾å›½äººå’Œä¸­å›½&#x2F;æ—¥æœ¬äººå¯¹ä¿¡æ¯çš„æ„ŸçŸ¥æ–¹å¼ï¼Œæœ‰ç€å¤§é‡ç ”ç©¶ã€‚ä¸€äº›ç ”ç©¶çš„ç»“æœä¼¼ä¹è¡¨æ˜ï¼Œæ—¥æœ¬äººå¯¹ä¿¡æ¯çš„æ„ŸçŸ¥æ›´åŠ å…¨é¢ï¼Œè€Œç¾å›½äººåˆ™å€¾å‘äºé€‰æ‹©ä¸€ä¸ªç„¦ç‚¹æ¥å¼•å¯¼ä»–ä»¬çš„æ³¨æ„åŠ›(<a href="https://www.wired.com/2008/03/japanese-more-s/">æ¥æº</a>)ã€‚è¿™å°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè§£é‡Šï¼Œä¸ºä»€ä¹ˆè¥¿æ–¹äººå³ä½¿åœ¨æ—¥è¯­æ°´å¹³å¾ˆé«˜çš„æƒ…å†µä¸‹ä¹Ÿå¾ˆéš¾ä½¿ç”¨è¿™ç±»ç½‘ç«™</p>
<p>æœ€åï¼Œéœ€è¦æŒ‡å‡ºï¼Œç½‘ç«™ä¸æ˜¯å•ç‹¬å­˜åœ¨çš„ã€‚ä»æ‚å¿—åˆ°åœ°é“é‡Œçš„å¹¿å‘Šç­‰å„ç§åª’ä½“ä¹Ÿå°½å¯èƒ½åœ¨å°çš„ç©ºé—´é‡Œå¡è¿›å°½å¯èƒ½å¤šçš„ä¿¡æ¯ï¼Œäººä»¬å¯èƒ½åªæ˜¯ä¹ æƒ¯äº†è¿™ç§æ— å¤„ä¸åœ¨çš„å±•ç¤ºå¯¼è‡´æ²¡æœ‰äººæƒ³è¦è´¨ç–‘å®ƒã€‚</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6KRgu_BarZlRVPehgytsA.png"></p>
<p>é•¿è¯çŸ­è¯´ï¼Œè¿™æ—¢ä¸æ˜¯ä¸ºäº†æ‰¾åˆ°æ ‡é¢˜çš„ç»å¯¹ç­”æ¡ˆï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†åŠ å¼ºæ—¥æœ¬äººç‹¬ç‰¹æ€§çš„æ¦‚å¿µã€‚ç›¸åï¼Œç‰¹åˆ«æ˜¯çœ‹åˆ°ä¸€äº›ä¸“æ³¨äºå°†æŸç§è§£é‡Šè§†ä¸ºâ€œçœŸæ­£ç­”æ¡ˆâ€çš„è®¨è®ºåï¼Œæˆ‘æƒ³è¦è¯´æ˜ç§‘æŠ€ã€å†å²å’Œæ–‡åŒ–å½±å“çš„èŒƒå›´å¯¼è‡´æœ€ç»ˆå½¢æˆçš„è¿™ç§å·®å¼‚ã€‚</p>
<h2 id="Sources-amp-further-reading"><a href="#Sources-amp-further-reading" class="headerlink" title="Sources &amp; further reading"></a>Sources &amp; further reading</h2><h3 id="Fonts-amp-Typography"><a href="#Fonts-amp-Typography" class="headerlink" title="Fonts &amp; Typography"></a>Fonts &amp; Typography</h3><p>Interview with Font Designer Akira Kobayashi: <a href="https://www.smashingmagazine.com/2015/04/interview-with-akira-kobayashi/">https://www.smashingmagazine.com/2015/04/interview-with-akira-kobayashi/</a></p>
<p>A detailed breakdown of the creation process behind a Chinese font: <a href="https://qz.com/522079/the-long-incredibly-tortuous-and-fascinating-process-of-creating-a-chinese-font">https://qz.com/522079/the-long-incredibly-tortuous-and-fascinating-process-of-creating-a-chinese-font</a></p>
<p>An example of a Japanese font including glyph count from Adobe Fonts: <a href="https://fonts.adobe.com/fonts/source-han-sans-japanese#fonts-section">https://fonts.adobe.com/fonts/source-han-sans-japanese#fonts-section</a></p>
<p>CJK Fonts: <a href="https://en.wikipedia.org/wiki/List_of_CJK_fonts">https://en.wikipedia.org/wiki/List_of_CJK_fonts</a></p>
<h3 id="Japan-amp-Technology"><a href="#Japan-amp-Technology" class="headerlink" title="Japan &amp; Technology"></a>Japan &amp; Technology</h3><p>An article on Japanâ€™s fading hi-tech image and where it came from: <a href="https://thenextweb.com/news/japan-loves-fax-machine-techno-orientalism">https://thenextweb.com/news/japan-loves-fax-machine-techno-orientalism</a></p>
<p>Bloomberg on the effects of the Internet Explorer shutdown in Japan: <a href="https://www.bloomberg.com/news/articles/2022-06-15/end-of-internet-explorer-era-spells-trouble-for-japan-businesses#xj4y7vzkg?leadSource=uverify%20wall">https://www.bloomberg.com/news/articles/2022-06-15/end-of-internet-explorer-era-spells-trouble-for-japan-businesses#xj4y7vzkg?leadSource=uverify%20wall</a></p>
<p>The Guardian on the 2018 statement made by Japanâ€™s former Cybersecurity Minister: <a href="https://www.theguardian.com/world/2018/nov/15/japan-cyber-security-ministernever-used-computer-yoshitaka-sakurada">https://www.theguardian.com/world/2018/nov/15/japan-cyber-security-ministernever-used-computer-yoshitaka-sakurada</a></p>
<p>Reading up on the Lost Decades: <a href="https://en.wikipedia.org/wiki/Lost_Decades">https://en.wikipedia.org/wiki/Lost_Decades</a></p>
<h3 id="Cultural-Influences"><a href="#Cultural-Influences" class="headerlink" title="Cultural Influences"></a>Cultural Influences</h3><p>Wired on several studies about perception differences: <a href="https://www.wired.com/2008/03/japanese-more-s/">https://www.wired.com/2008/03/japanese-more-s/</a></p>
<p>A study on the same topic: <a href="https://www.researchgate.net/publication/11645680_Attending_holistically_vs_analytically_Comparing_the_context_sensitivity_of_Japanese_and_Americans_Journal_of_Personality_and_Social_Psychology_81_922-934">https://www.researchgate.net/publication/11645680_Attending_holistically_vs_analytically_Comparing_the_context_sensitivity_of_Japanese_and_Americans_Journal_of_Personality_and_Social_Psychology_81_922-934</a></p>
]]></content>
      <tags>
        <tag>Translate</tag>
        <tag>Web Design</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¿»ã€‘â€œreturn nullâ€ vs â€œreturn falseâ€ in React</title>
    <url>/2023/05/13/%E3%80%90%E7%BF%BB%E3%80%91%E2%80%9Creturn-null%E2%80%9D-vs-%E2%80%9Creturn-false%E2%80%9D-in-React/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºäº†æé«˜è‹±è¯­æ°´å¹³å’Œä¿æŒæŠ€æœ¯æˆé•¿ï¼Œå¼€å§‹æŒ‰è®¡åˆ’ç¿»è¯‘ä¸€äº›çŸ­ç¯‡å’Œåšå®¢ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»<br>åŸæ–‡ï¼š<a href="https://caglayanyanikoglu.medium.com/return-null-vs-return-false-in-react-826d8abcc429">â€œreturn nullâ€ vs â€œreturn falseâ€ in React</a><br>åŸä½œè€…ï¼š<a href="https://caglayanyanikoglu.medium.com/">Ã‡aÄŸlayan YanÄ±koÄŸlu</a></p>
</blockquote>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>å¤§å®¶å¥½ï¼Œåœ¨æœ¬å‘¨çš„#SundayTechMusingsï¼Œæˆ‘å°†å°è¯•è§£é‡Šåœ¨Reactä¸­â€return nullâ€å’Œâ€return falseâ€ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<p>è¿™å®é™…ä¸Šä¸æ€§èƒ½æœ‰å…³ï¼Œåœ¨å†™ä¹‹å‰ï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘çš„æ–‡ç« <a href="https://tech.jotform.com/react-performance-improvements-356f81b1904f">Performance Optimization Techniques</a></p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/0*yaIvvEwXKIvFQ_8g"></p>
<p>æˆ‘çŸ¥é“å¾ˆå¤šäººè®¤ä¸ºâ€return nullâ€å’Œâ€return falseâ€æ˜¯ä¸€æ ·çš„ï¼Œå®é™…ä¸Šæ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›åŒºåˆ«ï¼Œè¿™å’ŒReactçš„å·¥ä½œæ–¹å¼æœ‰å…³ã€‚</p>
<p>åœ¨ä½¿ç”¨Reactå¼€å‘æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ¡ä»¶æ¸²æŸ“æ ¹æ®ä¸åŒçš„æ¡ä»¶æ˜¾ç¤ºä¸åŒçš„ç»„ä»¶ã€‚åœ¨ä¸€äº›æ¡ä»¶ä¸‹ï¼Œä½ å¯èƒ½æƒ³æ˜ç¡®æŒ‡å‡ºä¸€ä¸ªç»„ä»¶ä¸åº”è¯¥æ¸²æŸ“ä»»ä½•ä¸œè¥¿ã€‚è¿™å°±æ˜¯nullå’Œfalseçš„æ¥å†ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå€¼éƒ½ä¼šé˜»æ­¢ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æœ‰ç€é‡è¦çš„åŒºåˆ«ã€‚</p>
<h3 id="Returning-null"><a href="#Returning-null" class="headerlink" title="Returning null"></a>Returning null</h3><p>å½“ä¸€ä¸ªç»„ä»¶è¿”å›nullï¼Œå®ƒä¼šå‘Šè¯‰Reactä¸è¦åœ¨DOMä¸­ä¸ºè¯¥ç»„ä»¶æ¸²æŸ“ä»»ä½•ä¸œè¥¿ã€‚å½“ä½ æƒ³è¦æ ¹æ®æŸç§çŠ¶æ€æœ‰æ¡ä»¶åœ°æ¸²æŸ“ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œä½†ä¸å¸Œæœ›åœ¨ä¸ç¬¦åˆè¯¥çŠ¶æ€æ—¶æ˜¾ç¤ºä»»ä½•ä¸œè¥¿æ—¶ï¼Œè¿”å›nullå°±å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¯´ï¼š</p>
<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">Greeting</span> = (<span class="params">props</span>) =&gt; &#123;
  <span class="keyword">if</span> (!props.<span class="property">name</span>) &#123;
    <span class="keyword">return</span> <span class="literal">null</span>;
  &#125;

  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;
&#125;;</code></pre>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰æä¾› <code>name</code> propï¼Œç»„ä»¶ä¼šè¿”å›nullï¼Œè¿™æ ·å°±ä¸ä¼šæ¸²æŸ“<code>&lt;h1&gt;</code>å…ƒç´ ã€‚å¦‚æœæä¾›äº† <code>name</code> propï¼Œè¯¥ç»„ä»¶å°±ä¼šæ¸²æŸ“å¸¦æœ‰å®é™…å†…å®¹çš„<code>&lt;h1&gt;</code>å…ƒç´ ï¼Œè¿™å®é™…ä¸Šæ˜¯æ¯ä¸ªäººçš„ç»å…¸åšæ³•ã€‚</p>
<h3 id="Returning-false"><a href="#Returning-false" class="headerlink" title="Returning false"></a>Returning false</h3><p>å½“ä¸€ä¸ªç»„ä»¶è¿”å›falseæ—¶ï¼Œå®ƒå‘Šè¯‰ä¼šReactä¸è¦å†DOMä¸­ä¸ºè¯¥ç»„ä»¶æ¸²æŸ“ä»»ä½•ä¸œè¥¿ï¼Œå°±åƒnullä¸€æ ·ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼šè¿”å›falseä¹Ÿä¼šé˜»æ­¢è¯¥ç»„ä»¶åœ¨æœªæ¥çš„æ›´æ–°ã€‚è¿™æ˜¯å› ä¸ºReactå°†falseè§£é‡Šä¸ºâ€œå¸è½½â€ç»„ä»¶çš„ä¿¡å·ï¼Œè¿™æ„å‘³ç€ä»DOMä¸­å®Œå…¨åˆ é™¤å®ƒã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªè¿”å›falseçš„ç»„ä»¶çš„ä¾‹å­ï¼š</p>
<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params">props</span>) =&gt; &#123;
  <span class="keyword">if</span> (!props.<span class="property">onClick</span>) &#123;
    <span class="keyword">return</span> <span class="literal">false</span>;
  &#125;

  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onClick&#125;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;
&#125;;</code></pre>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰æä¾› <code>onClick</code> propï¼Œç»„ä»¶å°±ä¼šè¿”å›falseï¼Œä»è€Œé˜»æ­¢ <code>&lt;button&gt;</code>å…ƒç´ æ¸²æŸ“ã€‚å¦‚æœæä¾›äº† <code>onClick</code> propï¼Œç»„ä»¶ä¼šç”¨æŒ‡å®šçš„ç‚¹å‡»å¤„ç†æ¥æ¸²æŸ“ <code>&lt;button&gt;</code> å…ƒç´ </p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿”å›falseå¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„åæœï¼Œæ¯”å¦‚åœ¨åº”è¯¥æ›´æ–°çš„æ—¶å€™é˜»æ­¢ç»„ä»¶çš„æ›´æ–°ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œå½“ä½ æƒ³åœ¨ä¸å½±å“æœªæ¥æ›´æ–°çš„æƒ…å†µä¸‹é˜»æ­¢æ¸²æŸ“ï¼Œä½¿ç”¨nullé€šå¸¸æ›´å®‰å…¨</p>
<p>ä»ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“æ–¹æ³•ä¸­è¿”å›falseï¼Œåªæœ‰åœ¨è¯¥ç»„ä»¶æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨æ—¶æ‰æœ‰ç”¨ï¼Œæ¯”å¦‚æ›´æ–°çŠ¶æ€æˆ–è€…è§¦å‘APIè¯·æ±‚ã€‚å¦‚æœä¸€ä¸ªç»„ä»¶æœ‰å‰¯ä½œç”¨å¹¶è¿”å›falseæ—¶ï¼Œè¿™äº›å‰¯ä½œç”¨ä»ç„¶ä¼šå‘ç”Ÿï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„è¡Œä¸ºã€‚</p>
<p><a href="https://github.com/facebook/react/blob/main/packages/react/src/ReactElementValidator.js#L347-L385">react&#x2F;ReactElementValidator.js at main</a></p>
<p>å¦‚æœä½ åœ¨Reactåº“ä¸­æ£€æŸ¥ä¸Šé¢è¿™æ®µä»£ç æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªâ€nullâ€æ£€æŸ¥ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£Reactçš„å·¥ä½œï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™æ®µä»£ç ã€‚</p>
<h3 id="To-sum-up"><a href="#To-sum-up" class="headerlink" title="To sum up"></a>To sum up</h3><p>æ€»è€Œè¨€ä¹‹ï¼Œè¿”å›nullå’Œè¿”å›falseéƒ½ä¼šé˜»æ­¢ä¸€ä¸ªç»„ä»¶åœ¨DOMä¸­æ¸²æŸ“ä»»ä½•ä¸œè¥¿ï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰é‡è¦çš„åŒºåˆ«ã€‚nullæ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥æœ‰æ¡ä»¶çš„æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”ä¸å½±å“æœªæ¥çš„æ›´æ–°ï¼Œè€Œfalseåˆ™æ˜¯å‘Reactå‘å‡ºå¸è½½ç»„ä»¶çš„ä¿¡å·ï¼Œå¹¶å¯èƒ½å¯¼è‡´æ„æƒ³ä¸åˆ°çš„åæœã€‚ä¸ºä½ ç‰¹å®šçš„ç”¨ä¾‹é€‰æ‹©æ­£ç¡®çš„é€‰é¡¹æ˜¯å¾ˆé‡è¦çš„</p>
]]></content>
      <tags>
        <tag>React</tag>
        <tag>Translate</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºcanvaså®ç°çš„å¤šåŠŸèƒ½ç”»æ¿</title>
    <url>/2022/09/21/%E5%9F%BA%E4%BA%8Ecanvas%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%A4%9A%E5%8A%9F%E8%83%BD%E7%94%BB%E6%9D%BF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘ç©ºé—²æ—¶é—´æ¯”è¾ƒå¤šï¼Œå°±æƒ³åšç‚¹å°å·¥å…·ç©ç©ï¼Œæ–¹æ¡ˆé€‰äº†å¥½å‡ ä¸ªï¼Œæœ€ç»ˆå†³å®šåšä¸€ä¸ªåŸºäºcanvasçš„ç”»æ¿ï¼Œç›®å‰å·²ç»å®Œæˆäº†ç¬¬ä¸€ç‰ˆï¼Œæœ‰ä»¥ä¸‹ä¸»è¦åŠŸèƒ½</p>
<ol>
<li>ç”»ç¬”ï¼ˆåŠ¨æ€å®½åº¦è®¾ç½®ï¼Œé¢œè‰²è®¾ç½®ï¼‰</li>
<li>æ©¡çš®æ“¦</li>
<li>æ’¤å›ï¼Œåæ’¤å›ï¼Œæ¸…é™¤ç”»æ¿ï¼Œä¿å­˜</li>
<li>ç”»æ¿æ‹–æ‹½</li>
<li>å¤šå›¾å±‚</li>
</ol>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>ç›®å‰å®ç°æ•ˆæœå¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/img_convert/6ee0b9163552f4c61abfde6af199b3ed.png"><br>é¢„è§ˆåœ°å€ï¼š<a href="https://lhrun.github.io/paint-board/">https://lhrun.github.io/paint-board/</a><br>repoï¼š<a href="https://github.com/LHRUN/paint-board">https://github.com/LHRUN/paint-board</a></p>
<h2 id="ç”»æ¿è®¾è®¡"><a href="#ç”»æ¿è®¾è®¡" class="headerlink" title="ç”»æ¿è®¾è®¡"></a>ç”»æ¿è®¾è®¡</h2><ol>
<li>é¦–å…ˆæ˜¯å»ºç«‹ä¸€ä¸ªcanvasç”»æ¿ç±»ï¼Œæ‰€æœ‰canvasä¸Šçš„æ“ä½œå’Œæ•°æ®å…¨éƒ½åœ¨æ­¤å¤„ç†ï¼Œä¾‹å¦‚åˆå§‹åŒ–ï¼Œæ¸²æŸ“ï¼Œæ‹–æ‹½ç”»æ¿ç­‰ç­‰<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">PaintBoard</span> &#123;
  <span class="attr">canvas</span>: <span class="title class_">HTMLCanvasElement</span>
  <span class="attr">context</span>: <span class="title class_">CanvasRenderingContext2D</span>
  ...
  <span class="title function_">constructor</span>(<span class="params">canvas: HTMLCanvasElement</span>) &#123;&#125;
  <span class="comment">// åˆå§‹åŒ–canvas</span>
  <span class="title function_">initCanvas</span>(<span class="params"></span>) &#123;&#125;
  <span class="comment">// æ¸²æŸ“</span>
  <span class="title function_">render</span>(<span class="params"></span>) &#123;&#125;
  <span class="comment">// æ‹–æ‹½</span>
  <span class="title function_">drag</span>(<span class="params"></span>) &#123;&#125;
  ...
&#125;</code></pre></li>
<li>ç„¶ååŸºäºcanvasç±»ï¼Œæ ¹æ®å½“å‰çš„æ“ä½œï¼Œå»ºç«‹å¯¹åº”çš„canvaså…ƒç´ ï¼Œæ¯”å¦‚ç”»ç¬”ï¼Œæ©¡çš®æ“¦ï¼ŒåŸºæœ¬ç±»å‹å¦‚ä¸‹<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">CanvasElement</span> &#123;
  <span class="attr">type</span>: string <span class="comment">// å…ƒç´ ç±»å‹</span>
  <span class="attr">layer</span>: number <span class="comment">// å›¾å±‚</span>
  <span class="comment">// ...</span>
  <span class="title function_">constructor</span>(<span class="params">type: string, layer: number</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">type</span> = type
    <span class="variable language_">this</span>.<span class="property">layer</span> = layer
    <span class="comment">// ...</span>
  &#125;
  <span class="comment">// ...</span>
&#125;</code></pre></li>
<li>æœ€åæ ¹æ®æ¸²æŸ“é€»è¾‘ï¼Œè¿˜ä¼šå°è£…ä¸€äº›é€šç”¨çš„é€»è¾‘æ¥æ”¹å˜canvasä¸Šæœ€ç»ˆçš„å±•ç¤ºï¼Œæ¯”å¦‚æ’¤å›ï¼Œåæ’¤å›ï¼Œå›¾å±‚æ“ä½œç­‰ç­‰</li>
</ol>
<h2 id="ç”»ç¬”"><a href="#ç”»ç¬”" class="headerlink" title="ç”»ç¬”"></a>ç”»ç¬”</h2><ul>
<li>å®ç°ç”»ç¬”æ•ˆæœé¦–å…ˆè¦åœ¨é¼ æ ‡æŒ‰ä¸‹æ—¶å»ºç«‹ä¸€ä¸ªç”»ç¬”å…ƒç´ ï¼Œç„¶ååœ¨æ„é€ å‡½æ•°ä¸­æ¥å—åŸºç¡€å®½åº¦ï¼Œé¢œè‰²ï¼Œåˆå§‹åŒ–é¼ æ ‡ç§»åŠ¨è®°å½•å’Œçº¿å®½è®°å½•ï¼Œç„¶ååœ¨é¼ æ ‡ç§»åŠ¨æ—¶è®°å½•é¼ æ ‡ç§»åŠ¨çš„åæ ‡</li>
<li>ä¸ºäº†ä½“ç°é¼ æ ‡ç§»åŠ¨å¿«ï¼Œçº¿å®½å°±å˜çª„ï¼Œç§»åŠ¨æ…¢ï¼Œçº¿å®½å°±æ¢å¤æ­£å¸¸è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä¼šè®¡ç®—å½“å‰ç§»åŠ¨çš„é€Ÿåº¦ï¼Œç„¶åæ ¹æ®é€Ÿåº¦è®¡ç®—çº¿å®½<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">FreeLine</span> <span class="keyword">extends</span> <span class="title class_ inherited__">CanvasElement</span> &#123;
  ...
  <span class="title function_">constructor</span>(<span class="params">color: string, width: number, layer: number</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">positions</span> = [] <span class="comment">// é¼ æ ‡ç§»åŠ¨ä½ç½®è®°å½•</span>
    <span class="variable language_">this</span>.<span class="property">lineWidths</span> = [<span class="number">0</span>] <span class="comment">// çº¿å®½è®°å½•</span>
    <span class="variable language_">this</span>.<span class="property">color</span> = color <span class="comment">// å½“å‰ç»˜çº¿é¢œè‰²</span>
    <span class="variable language_">this</span>.<span class="property">maxWidth</span> = width <span class="comment">// æœ€å¤§çº¿å®½</span>
    <span class="variable language_">this</span>.<span class="property">minWidth</span> = width / <span class="number">2</span> <span class="comment">// æœ€å°çº¿å®½</span>
    <span class="variable language_">this</span>.<span class="property">lastLineWidth</span> = width <span class="comment">// æœ€åç»˜çº¿å®½åº¦</span>
  &#125;
&#125;</code></pre></li>
<li>è®°å½•é¼ æ ‡ä½ç½®å’Œå½“å‰çº¿å®½<pre><code class="highlight js">interface <span class="title class_">MousePosition</span> &#123;
  <span class="attr">x</span>: number
  <span class="attr">y</span>: number
&#125;

<span class="title function_">addPosition</span>(<span class="params">position: MousePosition</span>) &#123;
  <span class="variable language_">this</span>.<span class="property">positions</span>.<span class="title function_">push</span>(position)
  <span class="comment">// å¤„ç†å½“å‰çº¿å®½</span>
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">positions</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;
    <span class="keyword">const</span> mouseSpeed = <span class="variable language_">this</span>.<span class="title function_">_computedSpeed</span>(
      <span class="variable language_">this</span>.<span class="property">positions</span>[<span class="variable language_">this</span>.<span class="property">positions</span>.<span class="property">length</span> - <span class="number">2</span>],
      <span class="variable language_">this</span>.<span class="property">positions</span>[<span class="variable language_">this</span>.<span class="property">positions</span>.<span class="property">length</span> - <span class="number">1</span>]
    )
    <span class="keyword">const</span> lineWidth = <span class="variable language_">this</span>.<span class="title function_">_computedLineWidth</span>(mouseSpeed)
    <span class="variable language_">this</span>.<span class="property">lineWidths</span>.<span class="title function_">push</span>(lineWidth)
  &#125;
&#125;

<span class="comment">/**</span>
<span class="comment"> * è®¡ç®—ç§»åŠ¨é€Ÿåº¦</span>
<span class="comment"> * <span class="doctag">@param</span> start èµ·ç‚¹</span>
<span class="comment"> * <span class="doctag">@param</span> end ç»ˆç‚¹</span>
<span class="comment"> */</span>
<span class="title function_">_computedSpeed</span>(<span class="params">start: MousePosition, end: MousePosition</span>) &#123;
  <span class="comment">// è·å–è·ç¦»</span>
  <span class="keyword">const</span> moveDistance = <span class="title function_">getDistance</span>(start, end)

  <span class="keyword">const</span> curTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()
  <span class="comment">// è·å–ç§»åŠ¨é—´éš”æ—¶é—´   lastMoveTimeï¼šæœ€åé¼ æ ‡ç§»åŠ¨æ—¶é—´</span>
  <span class="keyword">const</span> moveTime = curTime - <span class="variable language_">this</span>.<span class="property">lastMoveTime</span>
  <span class="comment">// è®¡ç®—é€Ÿåº¦</span>
  <span class="keyword">const</span> mouseSpeed = moveDistance / moveTime
  <span class="comment">// æ›´æ–°æœ€åç§»åŠ¨æ—¶é—´</span>
  <span class="variable language_">this</span>.<span class="property">lastMoveTime</span> = curTime
  <span class="keyword">return</span> mouseSpeed
&#125;

<span class="comment">/**</span>
<span class="comment"> * è®¡ç®—ç”»ç¬”å®½åº¦</span>
<span class="comment"> * <span class="doctag">@param</span> speed é¼ æ ‡ç§»åŠ¨é€Ÿåº¦</span>
<span class="comment"> */</span>
<span class="title function_">_computedLineWidth</span>(<span class="params">speed: number</span>) &#123;
  <span class="keyword">let</span> lineWidth = <span class="number">0</span>
  <span class="keyword">const</span> minWidth = <span class="variable language_">this</span>.<span class="property">minWidth</span>
  <span class="keyword">const</span> maxWidth = <span class="variable language_">this</span>.<span class="property">maxWidth</span>
  <span class="keyword">if</span> (speed &gt;= <span class="variable language_">this</span>.<span class="property">maxSpeed</span>) &#123;
    lineWidth = minWidth
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (speed &lt;= <span class="variable language_">this</span>.<span class="property">minSpeed</span>) &#123;
    lineWidth = maxWidth
  &#125; <span class="keyword">else</span> &#123;
    lineWidth = maxWidth - (speed / <span class="variable language_">this</span>.<span class="property">maxSpeed</span>) * maxWidth
  &#125;

  lineWidth = lineWidth * (<span class="number">1</span> / <span class="number">3</span>) + <span class="variable language_">this</span>.<span class="property">lastLineWidth</span> * (<span class="number">2</span> / <span class="number">3</span>)
  <span class="variable language_">this</span>.<span class="property">lastLineWidth</span> = lineWidth
  <span class="keyword">return</span> lineWidth
&#125;</code></pre></li>
<li>ä¿å­˜åæ ‡åï¼Œæ¸²æŸ“å°±æ˜¯éå†æ‰€æœ‰åæ ‡<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">freeLineRender</span>(<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  instance: FreeLine</span>
<span class="params"></span>) &#123;
  context.<span class="title function_">save</span>()
  context.<span class="property">lineCap</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">lineJoin</span> = <span class="string">&#x27;round&#x27;</span>
  context.<span class="property">strokeStyle</span> = instance.<span class="property">color</span>
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span>; i++) &#123;
    <span class="title function_">_drawLine</span>(instance, i, context)
  &#125;
  context.<span class="title function_">restore</span>()
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç”»ç¬”è½¨è¿¹æ˜¯å€Ÿé‰´äº†ç½‘ä¸Šçš„ä¸€äº›æ–¹æ¡ˆï¼Œåˆ†ä¸¤ç§æƒ…å†µ</span>
<span class="comment"> * 1. å¦‚æœæ˜¯å‰ä¸¤ä¸ªåæ ‡ï¼Œå°±é€šè¿‡lineToè¿æ¥å³å¯</span>
<span class="comment"> * 2. å¦‚æœæ˜¯å‰ä¸¤ä¸ªåæ ‡ä¹‹åçš„åæ ‡ï¼Œå°±é‡‡ç”¨è´å¡å°”æ›²çº¿è¿›è¡Œè¿æ¥ï¼Œ</span>
<span class="comment"> *    æ¯”å¦‚ç°åœ¨æœ‰a, b, c ä¸‰ä¸ªç‚¹ï¼Œåˆ°cç‚¹æ—¶ï¼ŒæŠŠabåæ ‡çš„ä¸­é—´ç‚¹ä½œä¸ºèµ·ç‚¹</span>
<span class="comment"> *     bcåæ ‡çš„ä¸­é—´ç‚¹ä½œä¸ºç»ˆç‚¹ï¼Œbç‚¹ä½œä¸ºæ§åˆ¶ç‚¹è¿›è¡Œè¿æ¥</span>
<span class="comment"> */</span>
<span class="keyword">function</span> <span class="title function_">_drawLine</span>(<span class="params"></span>
<span class="params">  instance: FreeLine,</span>
<span class="params">  i: number,</span>
<span class="params">  context: CanvasRenderingContext2D</span>
<span class="params"></span>) &#123;
  <span class="keyword">const</span> &#123; positions, lineWidths &#125; = instance
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: centerX, <span class="attr">y</span>: centerY &#125; = positions[i - <span class="number">1</span>]
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: endX, <span class="attr">y</span>: endY &#125; = positions[i]
  context.<span class="title function_">beginPath</span>()
  <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;
    context.<span class="title function_">moveTo</span>(centerX, centerY)
    context.<span class="title function_">lineTo</span>(endX, endY)
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">const</span> &#123; <span class="attr">x</span>: startX, <span class="attr">y</span>: startY &#125; = positions[i - <span class="number">2</span>]
    <span class="keyword">const</span> lastX = (startX + centerX) / <span class="number">2</span>
    <span class="keyword">const</span> lastY = (startY + centerY) / <span class="number">2</span>
    <span class="keyword">const</span> x = (centerX + endX) / <span class="number">2</span>
    <span class="keyword">const</span> y = (centerY + endY) / <span class="number">2</span>
    context.<span class="title function_">moveTo</span>(lastX, lastY)
    context.<span class="title function_">quadraticCurveTo</span>(centerX, centerY, x, y)
  &#125;

  context.<span class="property">lineWidth</span> = lineWidths[i]
  context.<span class="title function_">stroke</span>()
&#125;</code></pre></li>
</ul>
<h2 id="æ©¡çš®æ“¦"><a href="#æ©¡çš®æ“¦" class="headerlink" title="æ©¡çš®æ“¦"></a>æ©¡çš®æ“¦</h2><ul>
<li>æ©¡çš®æ“¦æ˜¯ä¸€ä¸ªçº¿çŠ¶æ“¦é™¤ï¼Œæˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯é€šè¿‡è®¡ç®—æ¯ä¸ªç‚¹çš„åœ†å¼§è½¨è¿¹å’Œä¸¤ä¸ªç‚¹ä¹‹é—´çš„çŸ©å½¢åŒºåŸŸï¼Œç„¶åé€šè¿‡clipå‰ªåˆ‡åæ¸…é™¤<br><img src="https://img-blog.csdnimg.cn/img_convert/8ae8229d79cd8b69d175d5fbb68e3c43.png"><pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * æ©¡çš®æ“¦æ¸²æŸ“</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> * <span class="doctag">@param</span> cleanCanvas æ¸…é™¤ç”»æ¿</span>
<span class="comment"> * <span class="doctag">@param</span> instance CleanLine</span>
<span class="comment"> */</span>
<span class="keyword">function</span> <span class="title function_">cleanLineRender</span>(<span class="params"></span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  cleanCanvas: () =&gt; <span class="keyword">void</span>,</span>
<span class="params">  instance: CleanLine</span>
<span class="params"></span>) &#123;
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; instance.<span class="property">positions</span>.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;
    <span class="title function_">_cleanLine</span>(
      instance.<span class="property">positions</span>[i],
      instance.<span class="property">positions</span>[i + <span class="number">1</span>],
      context,
      cleanCanvas,
      instance.<span class="property">cleanWidth</span>
    )
  &#125;
&#125;

<span class="comment">/**</span>
<span class="comment"> * çº¿çŠ¶æ¸…é™¤</span>
<span class="comment"> * <span class="doctag">@param</span> start èµ·ç‚¹</span>
<span class="comment"> * <span class="doctag">@param</span> end ç»ˆç‚¹</span>
<span class="comment"> * <span class="doctag">@param</span> context canvasäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
<span class="comment"> * <span class="doctag">@param</span> cleanCanvas æ¸…é™¤ç”»æ¿</span>
<span class="comment"> * <span class="doctag">@param</span> cleanWidth æ¸…æ¥šå®½åº¦</span>
<span class="comment"> */</span>
<span class="keyword">function</span> <span class="title function_">_cleanLine</span>(<span class="params"></span>
<span class="params">  start: MousePosition,</span>
<span class="params">  end: MousePosition,</span>
<span class="params">  context: CanvasRenderingContext2D,</span>
<span class="params">  cleanCanvas: () =&gt; <span class="keyword">void</span>,</span>
<span class="params">  cleanWidth: number</span>
<span class="params"></span>)&#123;
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: x1, <span class="attr">y</span>: y1 &#125; = start
  <span class="keyword">const</span> &#123; <span class="attr">x</span>: x2, <span class="attr">y</span>: y2 &#125; = end

  <span class="comment">// è·å–é¼ æ ‡èµ·ç‚¹å’Œç»ˆç‚¹ä¹‹é—´çš„çŸ©å½¢åŒºåŸŸç«¯ç‚¹</span>
  <span class="keyword">const</span> asin = cleanWidth * <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="title class_">Math</span>.<span class="title function_">atan</span>((y2 - y1) / (x2 - x1)))
  <span class="keyword">const</span> acos = cleanWidth * <span class="title class_">Math</span>.<span class="title function_">cos</span>(<span class="title class_">Math</span>.<span class="title function_">atan</span>((y2 - y1) / (x2 - x1)))
  <span class="keyword">const</span> x3 = x1 + asin
  <span class="keyword">const</span> y3 = y1 - acos
  <span class="keyword">const</span> x4 = x1 - asin
  <span class="keyword">const</span> y4 = y1 + acos
  <span class="keyword">const</span> x5 = x2 + asin
  <span class="keyword">const</span> y5 = y2 - acos
  <span class="keyword">const</span> x6 = x2 - asin
  <span class="keyword">const</span> y6 = y2 + acos

  <span class="comment">// æ¸…é™¤æœ«ç«¯åœ†å¼§</span>
  context.<span class="title function_">save</span>()
  context.<span class="title function_">beginPath</span>()
  context.<span class="title function_">arc</span>(x2, y2, cleanWidth, <span class="number">0</span>, <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>)
  context.<span class="title function_">clip</span>()
  <span class="title function_">cleanCanvas</span>()
  context.<span class="title function_">restore</span>()

  <span class="comment">// æ¸…é™¤çŸ©å½¢åŒºåŸŸ</span>
  context.<span class="title function_">save</span>()
  context.<span class="title function_">beginPath</span>()
  context.<span class="title function_">moveTo</span>(x3, y3)
  context.<span class="title function_">lineTo</span>(x5, y5)
  context.<span class="title function_">lineTo</span>(x6, y6)
  context.<span class="title function_">lineTo</span>(x4, y4)
  context.<span class="title function_">closePath</span>()
  context.<span class="title function_">clip</span>()
  <span class="title function_">cleanCanvas</span>()
  context.<span class="title function_">restore</span>()
&#125;</code></pre></li>
</ul>
<h2 id="æ’¤å›ã€åæ’¤å›"><a href="#æ’¤å›ã€åæ’¤å›" class="headerlink" title="æ’¤å›ã€åæ’¤å›"></a>æ’¤å›ã€åæ’¤å›</h2><ul>
<li>å®ç°æ’¤å›ï¼Œåæ’¤å›å°±è¦æŠŠcanvasä¸Šçš„æ¯ä¸ªå…ƒç´ çš„æ¸²æŸ“æ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œé€šè¿‡æ”¹å˜æ§åˆ¶å˜é‡ï¼Œé™åˆ¶æ¸²æŸ“å…ƒç´ çš„éå†ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°æ’¤å›çš„æ•ˆæœ</li>
<li>é¦–å…ˆç”»æ¿åˆå§‹åŒ–æ—¶å»ºç«‹ä¸€ä¸ªhistoryç±»ï¼Œç„¶åå»ºç«‹ç¼“å­˜å’Œstepæ•°æ®ï¼Œæ’¤å›å’Œåæ’¤å›æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹stepå³å¯<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">History</span>&lt;T&gt; &#123;
  <span class="attr">cacheQueue</span>: T[]
  <span class="attr">step</span>: number
  <span class="title function_">constructor</span>(<span class="params">cacheQueue: T[]</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">cacheQueue</span> = cacheQueue
    <span class="variable language_">this</span>.<span class="property">step</span> = cacheQueue.<span class="property">length</span> - <span class="number">1</span>
  &#125;
  <span class="comment">// æ·»åŠ æ•°æ®</span>
  <span class="title function_">add</span>(<span class="params">data: T</span>) &#123;
    <span class="comment">// å¦‚æœåœ¨å›é€€æ—¶æ·»åŠ æ•°æ®å°±åˆ é™¤æš‚å­˜æ•°æ®</span>
    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">step</span> !== <span class="variable language_">this</span>.<span class="property">cacheQueue</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;
      <span class="variable language_">this</span>.<span class="property">cacheQueue</span>.<span class="property">length</span> = <span class="variable language_">this</span>.<span class="property">step</span> + <span class="number">1</span>
    &#125;
    <span class="variable language_">this</span>.<span class="property">cacheQueue</span>.<span class="title function_">push</span>(data)
    <span class="variable language_">this</span>.<span class="property">step</span> = <span class="variable language_">this</span>.<span class="property">cacheQueue</span>.<span class="property">length</span> - <span class="number">1</span>
  &#125;

  <span class="comment">// éå†cacheQueue</span>
  <span class="title function_">each</span>(<span class="params">cb?: (ele: T, i: number) =&gt; <span class="keyword">void</span></span>) &#123;
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="variable language_">this</span>.<span class="property">step</span>; i++) &#123;
      cb?.(<span class="variable language_">this</span>.<span class="property">cacheQueue</span>[i], i)
    &#125;
  &#125;

  <span class="comment">// åé€€</span>
  <span class="title function_">undo</span>(<span class="params"></span>) &#123;
    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">step</span> &gt;= <span class="number">0</span>) &#123;
      <span class="variable language_">this</span>.<span class="property">step</span>--
      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">cacheQueue</span>[<span class="variable language_">this</span>.<span class="property">step</span>]
    &#125;
  &#125;

  <span class="comment">// å‰è¿›</span>
  <span class="title function_">redo</span>(<span class="params"></span>) &#123;
    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">step</span> &lt; <span class="variable language_">this</span>.<span class="property">cacheQueue</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;
      <span class="variable language_">this</span>.<span class="property">step</span>++
      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">cacheQueue</span>[<span class="variable language_">this</span>.<span class="property">step</span>]
    &#125;
  &#125;
&#125;</code></pre></li>
<li>é’ˆå¯¹ç”»æ¿ï¼Œé€šè¿‡ç›‘å¬é¼ æ ‡æŒ‰ä¸‹æ“ä½œï¼Œåœ¨historyä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå¯¹æ¸²æŸ“å‡½æ•°çš„éå†é™åˆ¶åˆ°stepå°±è¾¾åˆ°äº†æ’¤å›çš„æ•ˆæœ<pre><code class="highlight js"><span class="keyword">class</span> <span class="title class_">PaintBoard</span> &#123;
  ...
  <span class="comment">/**</span>
<span class="comment">   * è®°å½•å½“å‰å…ƒç´ ï¼Œå¹¶åŠ å…¥history</span>
<span class="comment">   */</span>
  <span class="title function_">recordCurrent</span>(<span class="params">type: string</span>) &#123;
    <span class="keyword">let</span> <span class="attr">ele</span>: <span class="variable constant_">ELEMENT_INSTANCE</span> | <span class="literal">null</span> = <span class="literal">null</span>
    <span class="keyword">switch</span> (type) &#123;
      <span class="keyword">case</span> <span class="variable constant_">CANVAS_ELE_TYPE</span>.<span class="property">FREE_LINE</span>:
        ele = <span class="keyword">new</span> <span class="title class_">FreeLine</span>(
          <span class="variable language_">this</span>.<span class="property">currentLineColor</span>,
          <span class="variable language_">this</span>.<span class="property">currentLineWidth</span>,
          <span class="variable language_">this</span>.<span class="property">layer</span>.<span class="property">current</span>
        )
        <span class="keyword">break</span>
      <span class="keyword">case</span> <span class="variable constant_">CANVAS_ELE_TYPE</span>.<span class="property">CLEAN_LINE</span>:
        ele = <span class="keyword">new</span> <span class="title class_">CleanLine</span>(<span class="variable language_">this</span>.<span class="property">cleanWidth</span>, <span class="variable language_">this</span>.<span class="property">layer</span>.<span class="property">current</span>)
        <span class="keyword">break</span>
      <span class="attr">default</span>:
        <span class="keyword">break</span>
    &#125;
    <span class="keyword">if</span> (ele) &#123;
      <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">add</span>(ele)
      <span class="variable language_">this</span>.<span class="property">currentEle</span> = ele
    &#125;
  &#125;

  <span class="comment">/**</span>
<span class="comment">   * éå†historyæ¸²æŸ“æ•°æ®</span>
<span class="comment">   */</span>
  <span class="title function_">render</span>(<span class="params"></span>) &#123;
    <span class="comment">// æ¸…é™¤ç”»å¸ƒ</span>
    <span class="variable language_">this</span>.<span class="title function_">cleanCanvas</span>()
    <span class="comment">// éå†history</span>
    <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">each</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;
      <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">save</span>()
      <span class="comment">// render....</span>
      <span class="variable language_">this</span>.<span class="property">context</span>,<span class="title function_">resore</span>()
    &#125;)
    <span class="comment">// ç¼“å­˜æ•°æ®</span>
    <span class="variable language_">this</span>.<span class="title function_">cache</span>()
  &#125;
&#125;</code></pre></li>
</ul>
<h2 id="æ‹–æ‹½ç”»å¸ƒ"><a href="#æ‹–æ‹½ç”»å¸ƒ" class="headerlink" title="æ‹–æ‹½ç”»å¸ƒ"></a>æ‹–æ‹½ç”»å¸ƒ</h2><ul>
<li>æ‹–æ‹½ç”»å¸ƒçš„å®ç°æ˜¯é€šè¿‡è®¡ç®—é¼ æ ‡ç§»åŠ¨è·ç¦»ï¼Œæ ¹æ®è·ç¦»æ”¹å˜ç”»å¸ƒçš„åŸç‚¹ä½ç½®ï¼Œè¾¾åˆ°æ‹–æ‹½çš„æ•ˆæœ</li>
</ul>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">drag</span>(<span class="params">position: MousePosition</span>) &#123;
  <span class="keyword">const</span> mousePosition = &#123;
    <span class="attr">x</span>: position.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">canvasRect</span>.<span class="property">left</span>,
    <span class="attr">y</span>: position.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">canvasRect</span>.<span class="property">top</span>
  &#125;
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">originPosition</span>.<span class="property">x</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">originPosition</span>.<span class="property">y</span>) &#123;
    <span class="keyword">const</span> translteX = mousePosition.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">originPosition</span>.<span class="property">x</span>
    <span class="keyword">const</span> translteY = mousePosition.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">originPosition</span>.<span class="property">y</span>
    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">translate</span>(translteX, translteY)
    <span class="variable language_">this</span>.<span class="property">originTranslate</span> = &#123;
      <span class="attr">x</span>: translteX + <span class="variable language_">this</span>.<span class="property">originTranslate</span>.<span class="property">x</span>,
      <span class="attr">y</span>: translteY + <span class="variable language_">this</span>.<span class="property">originTranslate</span>.<span class="property">y</span>
    &#125;
    <span class="variable language_">this</span>.<span class="title function_">render</span>()
  &#125;
  <span class="variable language_">this</span>.<span class="property">originPosition</span> = mousePosition
&#125;</code></pre>

<h2 id="å¤šå›¾å±‚"><a href="#å¤šå›¾å±‚" class="headerlink" title="å¤šå›¾å±‚"></a>å¤šå›¾å±‚</h2><p>å®ç°å¤šå›¾å±‚éœ€è¦å¯¹ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹è¿›è¡Œå¤„ç†</p>
<ol>
<li>ç”»æ¿åˆå§‹åŒ–æ—¶å»ºç«‹å›¾å±‚ç±»ï¼Œæ‰€æœ‰çš„å›¾å±‚æ•°æ®å’Œå›¾å±‚é€»è¾‘å…¨åœ¨æ­¤å¤„</li>
<li>ç„¶åå¯¹canvasä¸Šçš„å…ƒç´ åŠ layerå±æ€§ï¼Œç”¨äºåˆ¤æ–­å½’å±äºå“ªä¸ªå›¾å±‚</li>
<li>ç”»æ¿çš„æ¸²æŸ“å‡½æ•°æ”¹ä¸ºæŒ‰ç…§å›¾å±‚é¡ºåºè¿›è¡Œæ¸²æŸ“</li>
<li>æ‹–æ‹½æˆ–è€…éšè—å›¾å±‚éƒ½éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œåˆ é™¤å›¾å±‚æŠŠå¯¹åº”çš„ç¼“å­˜å›¾å±‚å…ƒç´ è¿›è¡Œåˆ é™¤</li>
</ol>
<pre><code class="highlight js">interface <span class="title class_">ILayer</span> &#123;
  <span class="attr">id</span>: number <span class="comment">// å›¾å±‚id</span>
  <span class="attr">title</span>: string <span class="comment">// å›¾å±‚åç§°</span>
  <span class="attr">show</span>: boolean <span class="comment">// å›¾å±‚å±•ç¤ºçŠ¶æ€</span>
&#125;

<span class="comment">/**</span>
<span class="comment"> * å›¾å±‚</span>
<span class="comment"> */</span>
<span class="keyword">class</span> <span class="title class_">Layer</span> &#123;
  <span class="attr">stack</span>: <span class="title class_">ILayer</span>[] <span class="comment">// å›¾å±‚æ•°æ®</span>
  <span class="attr">current</span>: number <span class="comment">// å½“å‰å›¾å±‚</span>
  <span class="attr">render</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span> <span class="comment">// ç”»æ¿æ¸²æŸ“äº‹ä»¶</span>

  <span class="title function_">constructor</span>(<span class="params">render: () =&gt; <span class="keyword">void</span>, initData?: Layer</span>) &#123;
    <span class="keyword">const</span> &#123;
      stack = [
        &#123;
          <span class="attr">id</span>: <span class="number">1</span>,
          <span class="attr">title</span>: <span class="string">&#x27;item1&#x27;</span>,
          <span class="attr">show</span>: <span class="literal">true</span>
        &#125;
      ],
      id = <span class="number">1</span>,
      current = <span class="number">1</span>
    &#125; = initData || &#123;&#125;
    <span class="variable language_">this</span>.<span class="property">stack</span> = stack
    <span class="variable language_">this</span>.<span class="property">id</span> = id
    <span class="variable language_">this</span>.<span class="property">current</span> = current
    <span class="variable language_">this</span>.<span class="property">render</span> = render
  &#125;
  ...
&#125;

<span class="keyword">class</span> <span class="title class_">PaintBoard</span> &#123;
  <span class="comment">// é€šè¿‡å›¾å±‚è¿›è¡Œæ’åº</span>
   <span class="title function_">sortOnLayer</span>(<span class="params"></span>) &#123;
     <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;
       <span class="keyword">return</span> (
         <span class="variable language_">this</span>.<span class="property">layer</span>.<span class="property">stack</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> id === b?.<span class="property">layer</span>) -
         <span class="variable language_">this</span>.<span class="property">layer</span>.<span class="property">stack</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> id === a?.<span class="property">layer</span>)
       )
     &#125;)
   &#125;

   <span class="comment">// æ¸²æŸ“å‡½æ•°åªæ¸²æŸ“å›¾å±‚å±•ç¤ºçŠ¶æ€çš„å…ƒç´ </span>
   <span class="title function_">render</span>(<span class="params"></span>) &#123;
     <span class="keyword">const</span> showLayerIds = <span class="keyword">new</span> <span class="title class_">Set</span>(
       <span class="variable language_">this</span>.<span class="property">layer</span>.<span class="property">stack</span>.<span class="property">reduce</span>&lt;number[]&gt;(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> &#123;
         <span class="keyword">return</span> cur.<span class="property">show</span> ? [...acc, cur.<span class="property">id</span>] : acc
       &#125;, [])
     )
     <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">each</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;
       <span class="keyword">if</span> (ele?.<span class="property">layer</span> &amp;&amp; showLayerIds.<span class="title function_">has</span>(ele.<span class="property">layer</span>)) &#123;
         ...
       &#125;
     &#125; 
   &#125;
&#125;</code></pre>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>æˆ‘æœ¬ç¯‡ä¸»è¦æ˜¯åˆ†äº«ä¸€äº›ä¸»è¦é€»è¾‘ï¼Œè¿˜æœ‰ä¸€äº›å…¼å®¹é—®é¢˜å’Œä¸€äº›UIäº¤äº’å°±ä¸å™è¿°äº†</li>
<li>è¿™ä¸ªç”»æ¿å†™ä¸‹æ¥å¤§æ¦‚ç”¨äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œæœ‰å¥½å¤šåŠŸèƒ½è¿˜æ²¡å†™ä¸Šï¼Œå¦‚æœè¿‡æ®µæ—¶é—´æœ‰ç©ºçš„è¯å°±ç»§ç»­å†™ä¸‹å»ï¼Œå¹¶è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œç°åœ¨è¿˜æ˜¯æœ‰ç‚¹ä¼˜åŒ–é—®é¢˜æ²¡æœ‰å†™å¥½ï¼Œæ¯”å¦‚ç”»ç¬”å®½åº¦æ˜¾ç¤ºçš„è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼ŒåŸç‚¹ä½ç½®å’Œä¸€äº›åˆå§‹åŒ–è®¾è®¡çš„ä¸å¤ªå¥½ï¼Œä¸è¿‡å†™å®Œè¿™ä¸ªç”»æ¿è¿˜æ˜¯æŒºæœ‰æˆå°±æ„Ÿçš„</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://www.cnblogs.com/axes/p/3850309.html">HTML5 å®ç°æ©¡çš®æ“¦çš„æ“¦é™¤æ•ˆæœ</a></li>
<li><a href="https://juejin.cn/post/7091276963146530847">æˆ‘åšäº†ä¸€ä¸ªåœ¨çº¿ç™½æ¿ï¼</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºå•æŒ‡æ‹–æ‹½å’ŒåŒæŒ‡ç¼©æ”¾æ—‹è½¬</title>
    <url>/2021/08/21/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%8D%95%E6%8C%87%E6%8B%96%E6%8B%BD%E5%92%8C%E5%8F%8C%E6%8C%87%E7%BC%A9%E6%94%BE%E6%97%8B%E8%BD%AC/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å°ç¨‹åºå•æŒ‡æ‹–æ‹½å’ŒåŒæŒ‡æ“ä½œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åŠŸèƒ½ï¼Œæ•ˆæœå¦‚ä¸‹å›¾<br><img src="https://img-blog.csdnimg.cn/babbbc7162d241e9b0fb01e0b18531eb.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<ul>
<li>å®ç°è¿™ä¸‰ä¸ªåŠŸèƒ½ï¼Œä¸»è¦ç”¨ä¸‰ä¸ªè§¦æ‘¸äº‹ä»¶<code>touchstart</code>ã€<code>touchmove</code>ã€<code>touchend</code><pre><code class="highlight html"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh; width: 100vw&quot;</span>&gt;</span>
  <span class="tag">&lt;<span class="name">image</span></span>
<span class="tag">    <span class="attr">src</span>=<span class="string">&quot;...&quot;</span></span>
<span class="tag">    <span class="attr">style</span>=<span class="string">&quot;transform: translate(&#123;&#123;translateX&#125;&#125;px, &#123;&#123;translateY&#125;&#125;px) scale(&#123;&#123;scale&#125;&#125;) rotate(&#123;&#123;rotate&#125;&#125;deg);&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchstart</span>=<span class="string">&quot;touchStart&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchmove</span>=<span class="string">&quot;touchMove&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchend</span>=<span class="string">&quot;touchEnd&quot;</span></span>
<span class="tag">  /&gt;</span>
<span class="tag">&lt;/<span class="name">view</span>&gt;</span></code></pre></li>
<li>ç”¨äº†ä»¥ä¸‹å˜é‡<pre><code class="highlight ts"><span class="title class_">Page</span>(&#123;
  <span class="attr">data</span>: &#123;
    <span class="attr">translateX</span>: <span class="number">0</span>, <span class="comment">// ä½ç§»xåæ ‡ å•ä½px</span>
    <span class="attr">translateY</span>: <span class="number">0</span>, <span class="comment">// ä½ç§»yåæ ‡ å•ä½px</span>
    <span class="attr">distance</span>: <span class="number">0</span>, <span class="comment">// åŒæŒ‡æ¥è§¦ç‚¹è·ç¦»</span>
    <span class="attr">scale</span>: <span class="number">1</span>, <span class="comment">// ç¼©æ”¾å€æ•°</span>
    <span class="attr">rotate</span>: <span class="number">0</span>, <span class="comment">// æ—‹è½¬è§’åº¦</span>
    <span class="attr">oldRotate</span>: <span class="number">0</span>, <span class="comment">// ä¸Šä¸€æ¬¡æ—‹è½¬åœæ­¢åçš„è§’åº¦</span>
    <span class="attr">startMove</span>: &#123; <span class="comment">// èµ·å§‹ä½ç§»è·ç¦»</span>
      <span class="attr">x</span>: <span class="number">0</span>,
      <span class="attr">y</span>: <span class="number">0</span>,
    &#125;,
    <span class="attr">startTouches</span>: [] <span class="comment">// èµ·å§‹ç‚¹touchæ•°ç»„</span>
  &#125;,
&#125;)</code></pre></li>
</ul>
<h2 id="å•æŒ‡æ‹–æ‹½"><a href="#å•æŒ‡æ‹–æ‹½" class="headerlink" title="å•æŒ‡æ‹–æ‹½"></a>å•æŒ‡æ‹–æ‹½</h2><ul>
<li>å®ç°å•æŒ‡æ‹–æ‹½æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦è®°å½•ç§»åŠ¨çš„ç‚¹åæ ‡ï¼Œç„¶åå‡å»èµ·å§‹ç‚¹åæ ‡ï¼Œå°±å¯ä»¥æ±‚å‡ºç›¸å¯¹é¡µé¢çš„ç§»åŠ¨è·ç¦»</li>
<li><code>touchstart</code><pre><code class="highlight ts"><span class="title function_">touchStart</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> touches = e.<span class="property">touches</span>
  <span class="keyword">const</span> &#123; translateX, translateY &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="keyword">const</span> &#123; pageX, pageY &#125; = touches[<span class="number">0</span>]
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">startMove</span> = &#123;
    <span class="attr">x</span>: pageX - translateX,
    <span class="attr">y</span>: pageY - translateY
  &#125;
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">startTouches</span> = touches
&#125;,</code></pre></li>
<li><code>touchmove</code><pre><code class="highlight ts"><span class="title function_">touchMove</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> touches = e.<span class="property">touches</span>
  <span class="keyword">const</span> &#123; <span class="attr">pageX</span>: onePageX, <span class="attr">pageY</span>: onePageY &#125; = touches[<span class="number">0</span>]
  <span class="keyword">const</span> &#123; startMove &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    <span class="attr">translateX</span>: onePageX - startMove.<span class="property">x</span>,
    <span class="attr">translateY</span>: onePageY - startMove.<span class="property">y</span>
  &#125;)
&#125;</code></pre></li>
</ul>
<h2 id="åŒæŒ‡ç¼©æ”¾"><a href="#åŒæŒ‡ç¼©æ”¾" class="headerlink" title="åŒæŒ‡ç¼©æ”¾"></a>åŒæŒ‡ç¼©æ”¾</h2><ul>
<li>åŒæŒ‡ç¼©æ”¾çš„åŸç†æ˜¯æ ¹æ®ä¸¤ç‚¹åæ ‡æ±‚å‡ºè·ç¦»(å‹¾è‚¡å®šç†)ï¼Œç„¶ååœ¨ç”¨ç§»åŠ¨åæ ‡çš„è·ç¦»æ¯”å°±å¯ä»¥æ±‚å‡ºç¼©æ”¾å€æ•°</li>
<li><code>touchmove</code><pre><code class="highlight js"><span class="title function_">touchMove</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> touches = e.<span class="property">touches</span>
  <span class="keyword">const</span> &#123; <span class="attr">pageX</span>: onePageX, <span class="attr">pageY</span>: onePageY &#125; = touches[<span class="number">0</span>]
  <span class="keyword">const</span> &#123; startMove, scale, <span class="attr">distance</span>: oldDistance, startTouches &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="keyword">if</span> (touches.<span class="property">length</span> === <span class="number">2</span> &amp;&amp; startTouches.<span class="property">length</span> === <span class="number">2</span>) &#123;
    <span class="comment">// åŒæŒ‡ç¼©æ”¾</span>
    <span class="keyword">const</span> &#123; <span class="attr">pageX</span>: twoPageX, <span class="attr">pageY</span>: twoPageY &#125; = touches[<span class="number">1</span>]
    <span class="comment">// æ±‚å‡ºå½“å‰åŒæŒ‡è·ç¦»</span>
    <span class="keyword">const</span> distance = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>((twoPageX - onePageX) ** <span class="number">2</span> + (twoPageY - onePageY) ** <span class="number">2</span>)
    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">distance</span> = distance
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">scale</span>: scale * (distance / (oldDistance || distance))
    &#125;)
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (startTouches.<span class="property">length</span> !== <span class="number">2</span>) &#123;
    <span class="comment">// å•æŒ‡æ‹–æ‹½</span>
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">translateX</span>: onePageX - startMove.<span class="property">x</span>,
      <span class="attr">translateY</span>: onePageY - startMove.<span class="property">y</span>
    &#125;)
  &#125;
&#125;</code></pre></li>
<li><code>startTouches.length !== 2</code>è¿™ä¸ªåˆ¤æ–­çš„åŸå› æ˜¯é˜²æ­¢å›¾ç‰‡è·³åŠ¨ï¼Œå› ä¸ºå¦‚æœä½ ä¸¤ä¸ªæ‰‹æŒ‡è§¦æ‘¸ï¼Œç„¶åç¦»å¼€ä¸€ä¸ªæ‰‹æŒ‡ï¼Œæˆ‘æ˜¯ç¦æ­¢æ‹–æ‹½çš„ï¼Œåªæœ‰åŒæŒ‡éƒ½ç¦»å¼€åå†æ¬¡è§¦æ‘¸æ‰èƒ½å•æŒ‡æ‹–æ‹½</li>
</ul>
<h2 id="åŒæŒ‡æ—‹è½¬"><a href="#åŒæŒ‡æ—‹è½¬" class="headerlink" title="åŒæŒ‡æ—‹è½¬"></a>åŒæŒ‡æ—‹è½¬</h2><ul>
<li>åŒæŒ‡æ—‹è½¬çš„åŸç†æ˜¯æ ¹æ®ä¸‰è§’å‡½æ•°æ±‚å‡ºèµ·å§‹ç‚¹çš„è§’åº¦ï¼Œç„¶åå†æ±‚å‡ºç§»åŠ¨åæ ‡çš„è§’åº¦ï¼Œç›¸å‡ç„¶ååŠ ä¸Šä¸Šä¸€æ¬¡æ—‹è½¬çš„è§’åº¦å°±ç­‰äºä½ å½“å‰æ‰€éœ€çš„é€‰æ‹©è§’åº¦</li>
<li><code>touchmove</code></li>
</ul>
<pre><code class="highlight ts"><span class="title function_">touchMove</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> touches = e.<span class="property">touches</span>
  <span class="keyword">const</span> &#123; <span class="attr">pageX</span>: onePageX, <span class="attr">pageY</span>: onePageY &#125; = touches[<span class="number">0</span>]
  <span class="keyword">const</span> &#123; startMove, scale, <span class="attr">distance</span>: oldDistance, startTouches, oldRotate &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="keyword">if</span> (touches.<span class="property">length</span> === <span class="number">2</span> &amp;&amp; startTouches.<span class="property">length</span> === <span class="number">2</span>) &#123;
    <span class="keyword">const</span> &#123; <span class="attr">pageX</span>: twoPageX, <span class="attr">pageY</span>: twoPageY &#125; = touches[<span class="number">1</span>]
    <span class="keyword">const</span> distance = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>((twoPageX - onePageX) ** <span class="number">2</span> + (twoPageY - onePageY) ** <span class="number">2</span>)
+   <span class="keyword">let</span> rotate = <span class="variable language_">this</span>.<span class="title function_">getAngle</span>(touches[<span class="number">0</span>], touches[<span class="number">1</span>]) - <span class="variable language_">this</span>.<span class="title function_">getAngle</span>(startTouches[<span class="number">0</span>], startTouches[<span class="number">1</span>]) + oldRotate
  <span class="comment">// å¦‚æœå¤§äº360åº¦ï¼Œå°±å‡å»360</span>
+   rotate = rotate &gt; <span class="number">360</span> ? rotate - <span class="number">360</span> : rotate
    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">distance</span> = distance
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">scale</span>: scale * (distance / (oldDistance || distance)),
+     rotate
    &#125;)
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (startTouches.<span class="property">length</span> !== <span class="number">2</span>) &#123;
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">translateX</span>: onePageX - startMove.<span class="property">x</span>,
      <span class="attr">translateY</span>: onePageY - startMove.<span class="property">y</span>
    &#125;)
  &#125;
&#125;,</code></pre>
<ul>
<li><code>getAngle</code><pre><code class="highlight ts"><span class="title function_">getAngle</span>(<span class="params">p1, p2</span>) &#123;
  <span class="keyword">const</span> x = p1.<span class="property">pageX</span> - p2.<span class="property">pageX</span>
  <span class="keyword">const</span> y = p1.<span class="property">pageY</span>- p2.<span class="property">pageY</span>
  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">atan2</span>(y, x) * <span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>
&#125;</code></pre></li>
<li><code>touchend</code><pre><code class="highlight ts"><span class="title function_">touchEnd</span>(<span class="params"></span>) &#123;
  <span class="comment">// ä¿å­˜å½“å‰æ—‹è½¬è§’åº¦</span>
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">oldRotate</span> = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">rotate</span>
&#125;,</code></pre></li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>ä»£ç ç‰‡æ®µ<code>https://developers.weixin.qq.com/s/0nS1tImU7Rs5</code></li>
<li>H5åŸç†ä¸€è‡´ï¼Œåªéœ€æ”¹ä¸€ä¸‹è¯­æ³•å³å¯</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡ä¸Šä¼ &amp;ä¹å®«æ ¼æ‹–æ‹½ç»„ä»¶</title>
    <url>/2021/09/08/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0-%E4%B9%9D%E5%AE%AB%E6%A0%BC%E6%8B%96%E6%8B%BD%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡ä¸Šä¼ -amp-ä¹å®«æ ¼æ‹–æ‹½ç»„ä»¶"><a href="#å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡ä¸Šä¼ -amp-ä¹å®«æ ¼æ‹–æ‹½ç»„ä»¶" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡ä¸Šä¼ &amp;ä¹å®«æ ¼æ‹–æ‹½ç»„ä»¶"></a>å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡ä¸Šä¼ &amp;ä¹å®«æ ¼æ‹–æ‹½ç»„ä»¶</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><ul>
<li><p>å›¾ç‰‡ä¸Šä¼ åŠ ä¹å®«æ ¼æ‹–æ‹½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ç»„ä»¶ï¼Œå¸¸ç”¨äºå‘å¸–æˆ–è€…è¯„è®ºç­‰å†…å®¹ä¸Šä¼ æ¨¡å—ï¼Œæˆ‘è¿™ç¯‡ä¹å®«æ ¼æ‹–æ‹½çš„æ€è·¯æ˜¯å€Ÿé‰´äº†<a href="https://www.cnblogs.com/haha1212/p/11562944.html"><strong>ä¸€æ¬¾ä¼˜é›…çš„å°ç¨‹åºæ‹–æ‹½æ’åºç»„ä»¶å®ç°</strong></a>è¿™ç¯‡æ–‡ç« </p>
</li>
<li><p>å®ç°æ•ˆæœå¦‚ä¸‹å›¾<br><img src="https://img-blog.csdnimg.cn/cc8c84d6bc3049349e94b95f540916c7.gif" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
</li>
<li><p>å®ç°åŸç†ï¼šæ–°å¢å›¾ç‰‡æ—¶ï¼Œä¸ºæ¯ä¸€ä¸ªå›¾ç‰‡å¢åŠ ä¸€ä¸ªkeyå±æ€§ï¼Œå’ŒtranXã€tranYå±æ€§ï¼Œç”¨äºtransformä½ç§»ï¼Œç„¶åè¿™ä¸ªä¹å®«æ ¼çš„æ‹–æ‹½æ–°å¢åˆ é™¤éƒ½æ˜¯ä»¥keyä¸ºæ ‡è®°æ¥ä¿®æ”¹tranXå’ŒtranYï¼Œä»è€Œè¾¾åˆ°æ‹–æ‹½æ•ˆæœ</p>
</li>
<li><p>ä½¿ç”¨äº†ä»¥ä¸‹å˜é‡</p>
<pre><code class="highlight js"><span class="attr">data</span>: &#123;
  <span class="attr">ITEM_SIZE</span>: <span class="number">100</span>, <span class="comment">// å›¾ç‰‡å¤§å° å•ä½px</span>
  <span class="attr">dragImgList</span>: [], <span class="comment">// å›¾ç‰‡åˆ—è¡¨ &#123; src: string, key: number, tranX: number, tranY: number &#125;[]</span>
  <span class="attr">containerRes</span>: &#123;&#125;, <span class="comment">// æ‹–æ‹½å®¹å™¨å±æ€§</span>
  <span class="attr">currentKey</span>: -<span class="number">1</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡çš„key</span>
  <span class="attr">currentIndex</span>: -<span class="number">1</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡çš„index</span>
  <span class="attr">tranX</span>: <span class="number">0</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡ç§»åŠ¨çš„xè·ç¦»</span>
  <span class="attr">tranY</span>: <span class="number">0</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡ç§»åŠ¨çš„yè·ç¦»</span>
  <span class="attr">uploadPosition</span>: &#123; <span class="comment">// uploadä¸Šä¼ å›¾æ ‡ä½ç§»è·ç¦»</span>
    <span class="attr">tranX</span>: <span class="number">0</span>,
    <span class="attr">tranY</span>: <span class="number">0</span>,
  &#125;
&#125;,</code></pre></li>
</ul>
<h3 id="WXML-amp-WXSS"><a href="#WXML-amp-WXSS" class="headerlink" title="WXML &amp; WXSS"></a>WXML &amp; WXSS</h3><pre><code class="highlight html"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;drag-container&quot;</span>&gt;</span>
  <span class="tag">&lt;<span class="name">view</span></span>
<span class="tag">    <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;dragImgList&#125;&#125;&quot;</span> </span>
<span class="tag">    <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span></span>
<span class="tag">    <span class="attr">style</span>=<span class="string">&quot;transform: translate(&#123;&#123;index === currentIndex ? tranX : item.tranX&#125;&#125;px, &#123;&#123;index === currentIndex ? tranY : item.tranY&#125;&#125;px); z-index: &#123;&#123;index === currentIndex ? 10 : 1&#125;&#125;;&quot;</span></span>
<span class="tag">    <span class="attr">class</span>=<span class="string">&quot;darg-item item-transition&quot;</span></span>
<span class="tag">    <span class="attr">mark:index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">mark:key</span>=<span class="string">&quot;&#123;&#123;item.key&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">catch:longpress</span>=<span class="string">&quot;longPress&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchmove</span>=<span class="string">&quot;touchMove&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchend</span>=<span class="string">&quot;touchEnd&quot;</span></span>
<span class="tag">  &gt;</span>
    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;darg-item-img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.src&#125;&#125;&quot;</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">text</span> <span class="attr">catch:tap</span>=<span class="string">&quot;deleteImg&quot;</span> <span class="attr">mark:key</span>=<span class="string">&quot;&#123;&#123;item.key&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;drag-item-delete&quot;</span>&gt;</span>Ã—<span class="tag">&lt;/<span class="name">text</span>&gt;</span>
  <span class="tag">&lt;/<span class="name">view</span>&gt;</span>
  <span class="tag">&lt;<span class="name">view</span></span>
<span class="tag">    <span class="attr">bindtap</span>=<span class="string">&quot;uploadImage&quot;</span></span>
<span class="tag">    <span class="attr">class</span>=<span class="string">&quot;darg-item drag-item-upload&quot;</span></span>
<span class="tag">    <span class="attr">hidden</span>=<span class="string">&quot;&#123;&#123;dragImgList.length &gt;= 9&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">style</span>=<span class="string">&quot;transform: translate(&#123;&#123;uploadPosition.tranX&#125;&#125;px, &#123;&#123;uploadPosition.tranY&#125;&#125;px);&quot;</span></span>
<span class="tag">  &gt;</span>+<span class="tag">&lt;/<span class="name">view</span>&gt;</span>
<span class="tag">&lt;/<span class="name">view</span>&gt;</span></code></pre>
<pre><code class="highlight css"><span class="selector-class">.drag-container</span>&#123;
  <span class="attribute">position</span>: relative;
  <span class="attribute">width</span>: <span class="number">300px</span>;
  <span class="attribute">height</span>: <span class="number">300px</span>;
&#125;
<span class="selector-class">.item-transition</span> &#123;
  <span class="attribute">transition</span>: transform <span class="number">0.1s</span>
&#125;
<span class="selector-class">.darg-item</span>&#123;
  <span class="attribute">position</span>: absolute;
  <span class="attribute">top</span>: <span class="number">0</span>;
  <span class="attribute">left</span>: <span class="number">0</span>;
  <span class="attribute">width</span>: <span class="number">100px</span>;
  <span class="attribute">height</span>: <span class="number">100px</span>;
&#125;
<span class="selector-class">.darg-item-img</span>&#123;
  <span class="attribute">width</span>: <span class="number">100%</span>;
  <span class="attribute">height</span>: <span class="number">100%</span>;
&#125;
<span class="selector-class">.drag-item-delete</span>&#123;
  <span class="attribute">position</span>: absolute;
  <span class="attribute">top</span>: <span class="number">0</span>;
  <span class="attribute">right</span>: <span class="number">0</span>;
  <span class="attribute">width</span>: <span class="number">58</span>rpx;
  <span class="attribute">height</span>: <span class="number">33</span>rpx;
  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.7</span>);
  <span class="attribute">font-size</span>: <span class="number">47</span>rpx;
  <span class="attribute">line-height</span>: <span class="number">25</span>rpx;
  <span class="attribute">text-align</span>: center;
  <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">64</span>rpx;
  <span class="attribute">color</span>: <span class="number">#fff</span>;
&#125;
<span class="selector-class">.drag-item-upload</span>&#123;
  <span class="attribute">background-color</span>: burlywood;
  <span class="attribute">font-size</span>: <span class="number">200</span>rpx;
  <span class="attribute">text-align</span>: center;
  <span class="attribute">color</span>: white;
  <span class="attribute">line-height</span>: <span class="number">200</span>rpx;
&#125;</code></pre>

<h3 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h3><ul>
<li>å›¾ç‰‡ä¸Šä¼ å¾ˆç®€å•ï¼Œå°±æ˜¯åˆå§‹åŒ–ä¸Šä¼ çš„å›¾ç‰‡ï¼Œç„¶åæ‹¼æ¥å›¾ç‰‡åˆ—è¡¨ï¼Œæœ€åä¿®æ”¹ä¸Šä¼ å›¾æ ‡ä½ç½®å³å¯<pre><code class="highlight js"><span class="title function_">uploadImage</span>(<span class="params"></span>) &#123;
  <span class="keyword">let</span> &#123; dragImgList, <span class="variable constant_">ITEM_SIZE</span> &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  wx.<span class="title function_">chooseImage</span>(&#123;
    <span class="attr">count</span>: <span class="number">9</span> - dragImgList.<span class="property">length</span>,
    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;
      <span class="keyword">const</span> imgList = res.<span class="property">tempFilePaths</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (&#123;
        <span class="attr">tranX</span>: <span class="variable constant_">ITEM_SIZE</span> * ((dragImgList.<span class="property">length</span> + index) % <span class="number">3</span>),
        <span class="attr">tranY</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>((dragImgList.<span class="property">length</span> + index) / <span class="number">3</span>) * <span class="variable constant_">ITEM_SIZE</span>,
        <span class="attr">src</span>: item,
        <span class="attr">key</span>: dragImgList.<span class="property">length</span> + index
      &#125;))
      dragImgList = dragImgList.<span class="title function_">concat</span>(imgList)
      <span class="comment">// ä¿®æ”¹ä¸Šä¼ å›¾æ ‡ä½ç½®</span>
      <span class="variable language_">this</span>.<span class="title function_">setUploaPosition</span>(dragImgList.<span class="property">length</span>)
      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
        dragImgList,
      &#125;)
    &#125;
  &#125;)
&#125;,</code></pre>
<pre><code class="highlight js"><span class="title function_">setUploaPosition</span>(<span class="params">listLength</span>) &#123;
  <span class="keyword">const</span> <span class="variable constant_">ITEM_SIZE</span> = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">ITEM_SIZE</span>
  <span class="keyword">const</span> uploadPosition = &#123;
    <span class="attr">tranX</span>: listLength % <span class="number">3</span> * <span class="variable constant_">ITEM_SIZE</span>,
    <span class="attr">tranY</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(listLength / <span class="number">3</span>) * <span class="variable constant_">ITEM_SIZE</span>,
  &#125;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    uploadPosition,
  &#125;)
&#125;,</code></pre></li>
</ul>
<h3 id="å›¾ç‰‡åˆ é™¤"><a href="#å›¾ç‰‡åˆ é™¤" class="headerlink" title="å›¾ç‰‡åˆ é™¤"></a>å›¾ç‰‡åˆ é™¤</h3><ul>
<li>é¦–å…ˆä»å›¾ç‰‡åˆ—è¡¨ä¸­åˆ é™¤æ‰€éœ€å›¾ç‰‡ï¼Œç„¶åä¿®æ”¹åˆ—è¡¨ï¼ŒæŠŠå¤§äºæ‰€é€‰å›¾ç‰‡keyçš„keyå…¨éƒ¨å‡ä¸€ï¼Œæœ€åä¿®æ”¹å‰©ä½™å›¾ç‰‡ä½ç½®å’Œä¸Šä¼ å›¾æ ‡ä½ç½®<pre><code class="highlight js"><span class="title function_">deleteImg</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> key = e.<span class="property">mark</span>.<span class="property">key</span>
  <span class="comment">// åˆ é™¤å›¾ç‰‡</span>
  <span class="keyword">const</span> list = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">dragImgList</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">key</span> !== key)
  <span class="comment">// ä¿®æ”¹keyå€¼</span>
  list.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">key</span> &gt; key &amp;&amp; item.<span class="property">key</span>--)
  <span class="comment">// ä¿®æ”¹å‰©ä½™å›¾ç‰‡ä½ç½®</span>
  <span class="variable language_">this</span>.<span class="title function_">getListPosition</span>(list)
  <span class="comment">// ä¿®æ”¹ä¸Šä¼ å›¾æ ‡ä½ç½®</span>
  <span class="variable language_">this</span>.<span class="title function_">setUploaPosition</span>(list.<span class="property">length</span>)
&#125;</code></pre>
<pre><code class="highlight js"><span class="title function_">getListPosition</span>(<span class="params">list</span>) &#123;
  <span class="keyword">const</span> <span class="variable constant_">ITEM_SIZE</span> = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">ITEM_SIZE</span>
  <span class="keyword">const</span> dragImgList = list.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;
    item.<span class="property">tranX</span> = <span class="variable constant_">ITEM_SIZE</span> * (item.<span class="property">key</span> % <span class="number">3</span>);
    item.<span class="property">tranY</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(item.<span class="property">key</span> / <span class="number">3</span>) * <span class="variable constant_">ITEM_SIZE</span>;
    <span class="keyword">return</span> item
  &#125;)
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    dragImgList,
  &#125;)

  <span class="comment">// å‘é¡µé¢ä¼ é€’æœ€æ–°å›¾ç‰‡åˆ—è¡¨</span>
  <span class="keyword">const</span> urlList = [...dragImgList].<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">key</span> - b.<span class="property">key</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">src</span>)
  <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&#x27;updateImage&#x27;</span>, &#123;
    <span class="attr">list</span>: urlList
  &#125;)
&#125;,</code></pre></li>
</ul>
<h3 id="ä¹å®«æ ¼æ‹–æ‹½"><a href="#ä¹å®«æ ¼æ‹–æ‹½" class="headerlink" title="ä¹å®«æ ¼æ‹–æ‹½"></a>ä¹å®«æ ¼æ‹–æ‹½</h3><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><ul>
<li>åˆå§‹åŒ–åªéœ€è·å–å®¹å™¨çš„ä½ç½®ä¿¡æ¯å³å¯ï¼Œå› ä¸ºæ‹–æ‹½ç»„ä»¶ä¸ä¸€å®šæ˜¯åœ¨é¡µé¢çš„å·¦ä¸Šè§’ï¼Œæ‰€ä»¥éœ€è¦çŸ¥é“å®¹å™¨çš„ä½ç½®ä¿¡æ¯<pre><code class="highlight js"><span class="attr">lifetimes</span>: &#123;
  <span class="title function_">ready</span>(<span class="params"></span>) &#123;
    <span class="variable language_">this</span>.<span class="title function_">createSelectorQuery</span>()
      .<span class="title function_">select</span>(<span class="string">&quot;.drag-container&quot;</span>)
      .<span class="title function_">boundingClientRect</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;
        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">containerRes</span> = res
      &#125;).<span class="title function_">exec</span>();
  &#125;
&#125;,</code></pre></li>
</ul>
<h4 id="longPress"><a href="#longPress" class="headerlink" title="longPress"></a>longPress</h4><ul>
<li>è¿™é‡Œé‡‡ç”¨longPressï¼Œè€Œä¸æ˜¯touchStartçš„åŸå› ï¼Œä¸€æ˜¯ä¸ºäº†ä¼˜åŒ–ä½“éªŒï¼ŒäºŒæ˜¯touchStartä¸åˆ é™¤æŒ‰é’®å†²çª<pre><code class="highlight js"><span class="title function_">longPress</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> index = e.<span class="property">mark</span>.<span class="property">index</span>
  <span class="keyword">const</span> &#123; pageX, pageY &#125; = e.<span class="property">touches</span>[<span class="number">0</span>]
  <span class="keyword">const</span> &#123; top, left &#125; = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">containerRes</span>
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    <span class="attr">currentIndex</span>: index,
    <span class="attr">tranX</span>: pageX - <span class="number">50</span> - left,
    <span class="attr">tranY</span>: pageY - <span class="number">50</span> - top
  &#125;)
&#125;,</code></pre></li>
</ul>
<h4 id="touchMove"><a href="#touchMove" class="headerlink" title="touchMove"></a>touchMove</h4><ul>
<li>touchMoveé¦–å…ˆè®¡ç®—å‡ºä½ç§»è·ç¦»ï¼Œç„¶åæ ¹æ®ä½ç§»è·ç¦»æ±‚å‡ºåœæ”¾ä½ç½®çš„keyï¼Œå¦‚æœä¸ä¸€æ ·å°±ä¿®æ”¹ä½ç½®<pre><code class="highlight js"><span class="title function_">touchMove</span>(<span class="params">e</span>) &#123;
  <span class="comment">// å¦‚æœcurrentIndex &lt; 0ï¼Œè¯´æ˜å¹¶æ²¡æœ‰è§¦å‘longPress</span>
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentIndex</span> &lt; <span class="number">0</span>) <span class="keyword">return</span>
  <span class="keyword">const</span> &#123; pageX, pageY &#125; = e.<span class="property">touches</span>[<span class="number">0</span>]
  <span class="keyword">const</span> &#123; top, left &#125; = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">containerRes</span>
  <span class="keyword">const</span> tranX = pageX - <span class="number">50</span> - left
  <span class="keyword">const</span> tranY = pageY - <span class="number">50</span> - top
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    tranX,
    tranY
  &#125;)
  <span class="comment">// å¯¹æ¯”å½“å‰ç§»åŠ¨çš„keyå’Œåœæ”¾ä½ç½®çš„keyï¼Œå¦‚æœä¸ä¸€æ ·å°±ä¿®æ”¹ä½ç½®</span>
  <span class="keyword">const</span> currentKey = e.<span class="property">mark</span>.<span class="property">key</span>
  <span class="keyword">const</span> moveKey = <span class="variable language_">this</span>.<span class="title function_">getMoveKey</span>(tranX, tranY)
  <span class="keyword">if</span> (currentKey === moveKey || <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentKey</span> === currentKey) <span class="keyword">return</span>
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentKey</span> = currentKey
  <span class="variable language_">this</span>.<span class="title function_">insert</span>(currentKey, moveKey)
&#125;,</code></pre>
<pre><code class="highlight js"><span class="title function_">getMoveKey</span>(<span class="params">tranX, tranY</span>) &#123;
  <span class="keyword">const</span> &#123; <span class="attr">dragImgList</span>: list, <span class="variable constant_">ITEM_SIZE</span> &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="keyword">const</span> <span class="title function_">_getPositionNumber</span> = (<span class="params">position</span>) =&gt; &#123;
    <span class="keyword">const</span> positionNumber = <span class="title class_">Math</span>.<span class="title function_">round</span>(position/ <span class="variable constant_">ITEM_SIZE</span>)
    <span class="keyword">return</span> positionNumber &gt; <span class="number">2</span> ? <span class="number">2</span> : positionNumber &lt; <span class="number">0</span> ? <span class="number">0</span> : positionNumber
  &#125;
  <span class="keyword">const</span> endKey = <span class="number">3</span> * <span class="title function_">_getPositionNumber</span>(tranY) + <span class="title function_">_getPositionNumber</span>(tranX)
  <span class="keyword">return</span> endKey &gt;= list.<span class="property">length</span> ? list.<span class="property">length</span> - <span class="number">1</span> : endKey
&#125;,</code></pre>
<pre><code class="highlight js"><span class="title function_">insert</span>(<span class="params">origin, end</span>) &#123;
  <span class="keyword">const</span> dragImgList = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">dragImgList</span>
  dragImgList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;
    <span class="keyword">if</span> (origin &lt; end) &#123;
      <span class="comment">// å¦‚æœèµ·å§‹keyå°äºç»“æŸkeyï¼Œå°±æŠŠåŒºé—´å†…çš„keyå…¨éƒ¨å‡ä¸€</span>
      <span class="keyword">if</span> (item.<span class="property">key</span> &gt; origin &amp;&amp; item.<span class="property">key</span> &lt;= end) item.<span class="property">key</span>--
      <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">key</span> === origin) item.<span class="property">key</span> = end
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (origin &gt; end) &#123;
      <span class="comment">// å¦‚æœèµ·å§‹keyå¤§äºç»“æŸkeyï¼Œå°±æŠŠåŒºé—´å†…çš„keyå…¨éƒ¨åŠ ä¸€</span>
      <span class="keyword">if</span> (item.<span class="property">key</span> &gt;= end &amp;&amp; item.<span class="property">key</span> &lt; origin) item.<span class="property">key</span>++
      <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">key</span> === origin) item.<span class="property">key</span> = end
    &#125;
  &#125;)
  <span class="variable language_">this</span>.<span class="title function_">getListPosition</span>(dragImgList)
&#125;,</code></pre></li>
</ul>
<h4 id="touchEnd"><a href="#touchEnd" class="headerlink" title="touchEnd"></a>touchEnd</h4><ul>
<li>touchEndç”¨äºé‡ç½®æ•°æ®<pre><code class="highlight js"><span class="title function_">touchEnd</span>(<span class="params"></span>) &#123;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    <span class="attr">tranX</span>: <span class="number">0</span>,
    <span class="attr">tranY</span>: <span class="number">0</span>,
    <span class="attr">currentIndex</span>: -<span class="number">1</span>,
  &#125;)
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentKey</span> = -<span class="number">1</span>
&#125;,</code></pre></li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>ä»£ç ç‰‡æ®µ<code>https://developers.weixin.qq.com/s/2rFIJamX7xty</code></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºmarkdown-itæ‰“é€ çš„markdownç¼–è¾‘å™¨</title>
    <url>/2022/10/12/%E5%9F%BA%E4%BA%8Emarkdown-it%E6%89%93%E9%80%A0%E7%9A%84markdown%E7%BC%96%E8%BE%91%E5%99%A8/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>markdown-itæ˜¯ä¸€ä¸ªç”¨æ¥è§£æmarkdownçš„åº“ï¼Œå®ƒå¯ä»¥å°†markdownç¼–è¯‘ä¸ºhtmlï¼Œç„¶åè§£ææ—¶markdown-itä¼šæ ¹æ®è§„åˆ™ç”Ÿæˆtokensï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰ï¼Œå°±é€šè¿‡ruleså‡½æ•°å¯¹tokenè¿›è¡Œå¤„ç†<br>æˆ‘ç°åœ¨åŸºäºmarkdown-itå·²å®Œæˆç¬¬ä¸€ç‰ˆç¼–è¾‘å™¨ï¼Œç°æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>å¿«æ·ç¼–è¾‘æŒ‰é’®</li>
<li>ä»£ç å—ä¸»é¢˜åˆ‡æ¢</li>
<li>åŒæ­¥æ»šåŠ¨</li>
<li>ç›®å½•åˆ—è¡¨ç”Ÿæˆ</li>
<li>å†…å®¹çŠ¶æ€ç¼“å­˜</li>
</ol>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>ç›®å‰å®ç°æ•ˆæœå¦‚ä¸‹<br><img src="https://s1.ax1x.com/2022/10/12/xaMejs.jpg"></p>
<p>é¢„è§ˆåœ°å€ï¼š<a href="https://lhrun.github.io/md-editor/">https://lhrun.github.io/md-editor/</a><br>repoï¼š<a href="https://github.com/LHRUN/md-editor">https://github.com/LHRUN/md-editor</a> æ¬¢è¿starâ­ï¸</p>
<h2 id="ç¼–è¾‘å™¨è®¾è®¡"><a href="#ç¼–è¾‘å™¨è®¾è®¡" class="headerlink" title="ç¼–è¾‘å™¨è®¾è®¡"></a>ç¼–è¾‘å™¨è®¾è®¡</h2><ol>
<li>é¡µé¢å¸ƒå±€åˆ†å››éƒ¨åˆ†ï¼Œé¡¶éƒ¨æ˜¯å¿«æ·å·¥å…·æ ï¼Œç„¶åä¸»ä½“å†…å®¹åˆ†ä¸‰éƒ¨åˆ†ï¼Œç¼–è¾‘åŒºåŸŸ(textarea)ã€htmlå±•ç¤ºåŒºåŸŸã€ç›®å½•åˆ—è¡¨(å¯å±•ç¤ºéšè—)ï¼Œå› ä¸ºæˆ‘æ˜¯ç”¨reactå¼€å‘çš„ï¼Œæ‰€ä»¥htmlå­—ç¬¦ä¸²æˆ‘æ˜¯é€šè¿‡<a href="https://zh-hans.reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml">dangerouslySetInnerHTML</a>è®¾ç½®</li>
<li>markdown-itåˆå§‹åŒ–<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">MD</span> = <span class="keyword">new</span> <span class="title class_">MarkdownIt</span>(&#123;
  <span class="attr">html</span>: <span class="literal">true</span>, <span class="comment">// åœ¨æºç ä¸­å¯ç”¨HTMLæ ‡ç­¾</span>
  <span class="attr">linkify</span>: <span class="literal">true</span>, <span class="comment">// å°†ç±»ä¼¼URLçš„æ–‡æœ¬è‡ªåŠ¨è½¬æ¢ä¸ºé“¾æ¥</span>
  <span class="attr">breaks</span>: <span class="literal">true</span>, <span class="comment">// è½¬æ¢æ®µè½é‡Œçš„ &#x27;\n&#x27; åˆ° &lt;br&gt;</span>
  <span class="attr">highlight</span>: <span class="keyword">function</span> (<span class="params">str, lang</span>) &#123;
    <span class="keyword">return</span> <span class="title function_">highlightFormatCode</span>(str, lang)
  &#125;
&#125;)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItSub</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItSup</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItMark</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItDeflist</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItTaskLists</span>)
  .<span class="title function_">use</span>(markdownItAbbr)
  .<span class="title function_">use</span>(markdownItFootnote)
  <span class="comment">// å…¶ä½™çš„markdownItæ’ä»¶...</span>

<span class="keyword">const</span> highlightFormatCode = (<span class="attr">str</span>: string, <span class="attr">lang</span>: string): <span class="function"><span class="params">string</span> =&gt;</span> &#123;
  <span class="keyword">if</span> (lang &amp;&amp; hljs.<span class="title function_">getLanguage</span>(lang)) &#123;
    <span class="keyword">try</span> &#123;
      <span class="keyword">return</span> <span class="title function_">codeBlockStyle</span>(hljs.<span class="title function_">highlight</span>(lang, str, <span class="literal">true</span>).<span class="property">value</span>)
    &#125; <span class="keyword">catch</span> (e) &#123;
      <span class="variable language_">console</span>.<span class="title function_">error</span>(e)
    &#125;
  &#125;

  <span class="keyword">return</span> <span class="title function_">codeBlockStyle</span>(<span class="variable constant_">MD</span>.<span class="property">utils</span>.escapeHtml(str))
&#125;

<span class="keyword">const</span> codeBlockStyle = (<span class="attr">val</span>: string): <span class="function"><span class="params">string</span> =&gt;</span> &#123;
  <span class="keyword">return</span> <span class="string">`&lt;pre class=&quot;hljs&quot; style=&quot;padding: 10px;border-radius: 10px;&quot;&gt;&lt;code&gt;<span class="subst">$&#123;val&#125;</span>&lt;/code&gt;&lt;/pre&gt;`</span>
&#125;</code></pre></li>
</ol>
<h2 id="å¿«æ·ç¼–è¾‘æŒ‰é’®"><a href="#å¿«æ·ç¼–è¾‘æŒ‰é’®" class="headerlink" title="å¿«æ·ç¼–è¾‘æŒ‰é’®"></a>å¿«æ·ç¼–è¾‘æŒ‰é’®</h2><p>å¿«æ·ä¾¿æ·æŒ‰é’®ä¸»è¦æ˜¯é€šè¿‡åˆ¤æ–­textareaçš„å…‰æ ‡ä½ç½®ï¼Œç„¶åé€šè¿‡å…‰æ ‡ä½ç½®æ”¹å˜ç¼–è¾‘å™¨æ–‡æœ¬å†…å®¹ï¼Œæ¯”å¦‚æ·»åŠ å›¾ç‰‡</p>
<pre><code class="highlight js"><span class="comment">// è·å–å…‰æ ‡ä½ç½®</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getCursorPosition</span> = (<span class="params">editor: HTMLTextAreaElement</span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; selectionStart, selectionEnd &#125; = editor
  <span class="keyword">return</span> [selectionStart, selectionEnd]
&#125;

<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">addImage</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  source: string,</span>
<span class="params">  setSource: (v: string) =&gt; <span class="keyword">void</span></span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> [start, end] = <span class="title function_">getCursorPosition</span>(editor)
  <span class="keyword">let</span> val = source
  <span class="keyword">if</span> (start === end) &#123;
    val = <span class="string">`<span class="subst">$&#123;source.slice(<span class="number">0</span>, start)&#125;</span>\n![å›¾ç‰‡æè¿°](url)\n<span class="subst">$&#123;source.slice(end)&#125;</span>`</span>
  &#125; <span class="keyword">else</span> &#123;
    val = <span class="string">`<span class="subst">$&#123;source.slice(<span class="number">0</span>, start)&#125;</span>\n![<span class="subst">$&#123;source.slice(</span></span>
<span class="subst"><span class="string">      start,</span></span>
<span class="subst"><span class="string">      end</span></span>
<span class="subst"><span class="string">    )&#125;</span>](url)\n<span class="subst">$&#123;source.slice(end)&#125;</span>`</span>
  &#125;
  <span class="title function_">setSource</span>(val)
&#125;</code></pre>

<h2 id="ä»£ç å—ä¸»é¢˜åˆ‡æ¢"><a href="#ä»£ç å—ä¸»é¢˜åˆ‡æ¢" class="headerlink" title="ä»£ç å—ä¸»é¢˜åˆ‡æ¢"></a>ä»£ç å—ä¸»é¢˜åˆ‡æ¢</h2><ul>
<li>ä»£ç å—é«˜äº®æˆ‘æ˜¯é‡‡ç”¨äº†<strong>highlight.js</strong>ï¼Œå› ä¸ºè¿™ä¸ªåº“æä¾›äº†å¾ˆå¤šä¸»é¢˜æ ·å¼ï¼Œæ‰€ä»¥ä¸»é¢˜åˆ‡æ¢ï¼Œæˆ‘åªéœ€è¦æ”¹å˜css linkå³å¯<pre><code class="highlight js"><span class="comment">// codeThemeå°±æ˜¯å·²é€‰çš„ä¸»é¢˜åå­—</span>
<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;
  <span class="keyword">if</span> (codeTheme) &#123;
    <span class="title function_">switchLink</span>(
      <span class="string">&#x27;code-style&#x27;</span>,
      <span class="string">`https://cdn.bootcdn.net/ajax/libs/highlight.js/11.6.0/styles/<span class="subst">$&#123;codeTheme&#125;</span>.min.css`</span>
    )
  &#125;
&#125;, [codeTheme])

<span class="comment">/**</span>
<span class="comment"> * åˆ‡æ¢html css link</span>
<span class="comment"> * <span class="doctag">@param</span> key link key æŒ‡å®šå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåˆ‡æ¢link</span>
<span class="comment"> * <span class="doctag">@param</span> href link href</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">switchLink</span> = (<span class="params">key: string, href: string</span>) =&gt; &#123;
  <span class="keyword">const</span> head = <span class="variable language_">document</span>.<span class="property">head</span>
  <span class="keyword">const</span> oldLink = head.<span class="title function_">getElementsByClassName</span>(key)
  <span class="keyword">if</span> (oldLink.<span class="property">length</span>) head.<span class="title function_">removeChild</span>(oldLink[<span class="number">0</span>])

  <span class="keyword">const</span> newLink = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;link&#x27;</span>)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;rel&#x27;</span>, <span class="string">&#x27;stylesheet&#x27;</span>)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/css&#x27;</span>)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;class&#x27;</span>, key)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;href&#x27;</span>, href)
  newLink.<span class="property">onerror</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;
    <span class="variable language_">console</span>.<span class="title function_">error</span>(e)
    message.<span class="title function_">error</span>(<span class="string">&#x27;è·å–css linkå¤±è´¥&#x27;</span>)
  &#125;
  head.<span class="title function_">appendChild</span>(newLink)
&#125;</code></pre></li>
</ul>
<h2 id="åŒæ­¥æ»šåŠ¨"><a href="#åŒæ­¥æ»šåŠ¨" class="headerlink" title="åŒæ­¥æ»šåŠ¨"></a>åŒæ­¥æ»šåŠ¨</h2><p>åŒæ­¥æ»šåŠ¨æ˜¯æˆ‘è®¤ä¸ºæœ€éš¾æçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºæˆ‘ä¸æƒ³ä»…ä»…é€šè¿‡ç™¾åˆ†æ¯”æ¥è®¡ç®—æ»šåŠ¨è·ç¦»ï¼Œå› ä¸ºè¿™æ ·çš„è¯å¦‚æœç¼–è¾‘åŒºåŸŸæ·»åŠ äº†ä¸€å †å›¾ç‰‡ï¼Œé¢„è§ˆå°±ä¼šæœ‰éå¸¸å¤§çš„é«˜åº¦å·®ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†è®¸å¤šæ–¹æ¡ˆï¼Œæœ€åå‘ç°markdown-itçš„å®˜æ–¹å®ç°æ˜¯æˆ‘èƒ½æ‰¾åˆ°å¹¶èƒ½å®ç°çš„æœ€ä½³æ–¹æ¡ˆï¼Œå¤§è‡´å®ç°æ€è·¯æ˜¯å¦‚ä¸‹</p>
<ol>
<li><p>é¦–å…ˆåœ¨ç¼–è¯‘æ—¶å¯¹æ ‡é¢˜å…ƒç´ å’Œæ®µè½å…ƒç´ æ·»åŠ è¡Œå·</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * æ³¨å…¥è¡Œå·</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="attr">injectLineNumbers</span>: <span class="title class_">Renderer</span>.<span class="property">RenderRule</span> = <span class="function">(<span class="params"></span></span>
<span class="params"><span class="function">  tokens,</span></span>
<span class="params"><span class="function">  idx,</span></span>
<span class="params"><span class="function">  options,</span></span>
<span class="params"><span class="function">  _env,</span></span>
<span class="params"><span class="function">  slf</span></span>
<span class="params"><span class="function"></span>) =&gt;</span> &#123;
  <span class="keyword">let</span> line
  <span class="keyword">if</span> (tokens[idx].<span class="property">map</span> &amp;&amp; tokens[idx].<span class="property">level</span> === <span class="number">0</span>) &#123;
    line = (tokens[idx].<span class="property">map</span> <span class="keyword">as</span> [number, number])[<span class="number">0</span>]
    tokens[idx].<span class="title function_">attrJoin</span>(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;line&#x27;</span>)
    tokens[idx].<span class="title function_">attrSet</span>(<span class="string">&#x27;data-line&#x27;</span>, <span class="title class_">String</span>(line))
  &#125;
  <span class="keyword">return</span> slf.<span class="title function_">renderToken</span>(tokens, idx, options)
&#125;

<span class="variable constant_">MD</span>.<span class="property">renderer</span>.<span class="property">rules</span>.<span class="property">heading_open</span> = <span class="variable constant_">MD</span>.<span class="property">renderer</span>.<span class="property">rules</span>.<span class="property">paragraph_open</span> = injectLineNumbers</code></pre>
</li>
<li><p>æ»šåŠ¨å‰è®¡ç®—å‡ºå½“å‰ç¼–è¾‘åŒºåŸŸæ¯è¡Œå¯¹åº”çš„é¢„è§ˆåç§»è·ç¦»ï¼Œæœ‰æ ‡è®°è¡Œå·çš„å…ƒç´ ç›´æ¥è®¡ç®—offsetï¼Œæœªæ ‡è®°è¡Œå·çš„å…ƒç´ å°±ç­‰æ¯”è®¡ç®—</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è·å–ç¼–è¾‘åŒºåŸŸæ¯è¡Œå¯¹åº”çš„é¢„è§ˆåç§»è·ç¦»</span>
<span class="comment"> * <span class="doctag">@param</span> editor ç¼–è¾‘å…ƒç´ </span>
<span class="comment"> * <span class="doctag">@param</span> review é¢„è§ˆå…ƒç´ </span>
<span class="comment"> * <span class="doctag">@returns</span> number[]</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="title function_">buildScrollMap</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  review: HTMLDivElement</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> <span class="attr">lineHeightMap</span>: number[] = []
  <span class="keyword">let</span> linesCount = <span class="number">0</span> <span class="comment">// ç¼–è¾‘åŒºæ€»è¡Œæ•°</span>

  <span class="comment">/**</span>
<span class="comment">   * ä¸´æ—¶åˆ›å»ºå…ƒç´ è·å–æ¯æ¬¡æ¢è¡Œä¹‹é—´çš„æ€»è¡Œæ•°</span>
<span class="comment">   */</span>
  <span class="keyword">const</span> sourceLine = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)
  sourceLine.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">&#x27;hidden&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;auto&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;editor.clientWidth&#125;</span>px`</span>
  sourceLine.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&#x27;15px&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">lineHeight</span> = <span class="string">`<span class="subst">$&#123;LINE_HEIGHT&#125;</span>px`</span>
  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(sourceLine)
  <span class="keyword">let</span> acc = <span class="number">0</span>
  editor.<span class="property">value</span>.<span class="title function_">split</span>(<span class="string">&#x27;\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">str</span>) =&gt;</span> &#123;
    lineHeightMap.<span class="title function_">push</span>(acc)
    <span class="keyword">if</span> (str.<span class="property">length</span> === <span class="number">0</span>) &#123;
      acc++
      <span class="keyword">return</span>
    &#125;
    sourceLine.<span class="property">textContent</span> = str
    <span class="keyword">const</span> h = sourceLine.<span class="property">offsetHeight</span>
    acc += <span class="title class_">Math</span>.<span class="title function_">round</span>(h / <span class="variable constant_">LINE_HEIGHT</span>)
  &#125;)
  sourceLine.<span class="title function_">remove</span>()
  lineHeightMap.<span class="title function_">push</span>(acc)
  linesCount = acc

  <span class="comment">// æœ€ç»ˆè¾“å‡ºçš„åç§»map</span>
  <span class="keyword">const</span> <span class="attr">_scrollMap</span>: number[] = <span class="keyword">new</span> <span class="title class_">Array</span>(linesCount).<span class="title function_">fill</span>(-<span class="number">1</span>)

  <span class="comment">/**</span>
<span class="comment">   * è·å–æ ‡è®°è¡Œå·çš„offsetè·ç¦»</span>
<span class="comment">   */</span>
  <span class="keyword">const</span> nonEmptyList = []
  nonEmptyList.<span class="title function_">push</span>(<span class="number">0</span>)
  _scrollMap[<span class="number">0</span>] = <span class="number">0</span>
  <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.line&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;
    <span class="keyword">let</span> <span class="attr">t</span>: string | number = el.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-line&#x27;</span>) <span class="keyword">as</span> string
    <span class="keyword">if</span> (t === <span class="string">&#x27;&#x27;</span>) &#123;
      <span class="keyword">return</span>
    &#125;
    t = lineHeightMap[<span class="title class_">Number</span>(t)]
    <span class="keyword">if</span> (t !== <span class="number">0</span>) &#123;
      nonEmptyList.<span class="title function_">push</span>(t)
    &#125;
    _scrollMap[t] = <span class="title class_">Math</span>.<span class="title function_">round</span>((el <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="property">offsetTop</span> - review.<span class="property">offsetTop</span>)
  &#125;)

  nonEmptyList.<span class="title function_">push</span>(linesCount)
  _scrollMap[linesCount] = review.<span class="property">scrollHeight</span>

  <span class="comment">/**</span>
<span class="comment">   * æœªæ ‡è®°è¡Œå·çš„å…ƒç´ ç­‰æ¯”è®¡ç®—</span>
<span class="comment">   */</span>
  <span class="keyword">let</span> pos = <span class="number">0</span>
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; linesCount; i++) &#123;
    <span class="keyword">if</span> (_scrollMap[i] !== -<span class="number">1</span>) &#123;
      pos++
      <span class="keyword">continue</span>
    &#125;
    <span class="keyword">const</span> a = nonEmptyList[pos]
    <span class="keyword">const</span> b = nonEmptyList[pos + <span class="number">1</span>]
    _scrollMap[i] = <span class="title class_">Math</span>.<span class="title function_">round</span>(
      (_scrollMap[b] * (i - a) + _scrollMap[a] * (b - i)) / (b - a)
    )
  &#125;

  <span class="keyword">return</span> _scrollMap
&#125;</code></pre>
</li>
<li><p>ç¼–è¾‘åŒºåŸŸæ»šåŠ¨æ ¹æ®å…·ä½“è¡Œè·å–éœ€æ»šåŠ¨é«˜åº¦</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">editorScroll</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  preview: HTMLDivElement</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">if</span> (!scrollMap) &#123;
    scrollMap = <span class="title function_">buildScrollMap</span>(editor, preview)
  &#125;

  <span class="keyword">const</span> lineNo = <span class="title class_">Math</span>.<span class="title function_">floor</span>(editor.<span class="property">scrollTop</span> / <span class="variable constant_">LINE_HEIGHT</span>)
  <span class="keyword">const</span> posTo = scrollMap[lineNo]
  preview.<span class="title function_">scrollTo</span>(&#123; <span class="attr">top</span>: posTo &#125;)
&#125;</code></pre></li>
<li><p>é¢„è§ˆåŒºåŸŸæ»šåŠ¨æ ¹æ®å½“å‰çš„æ»šåŠ¨é«˜åº¦æŸ¥å¯¹åº”ç¼–è¾‘åŒºåŸŸçš„è¡Œï¼Œç„¶åæ ¹æ®è®¡ç®—æ»šåŠ¨é«˜åº¦</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">previewScroll</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  preview: HTMLDivElement</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">if</span> (!scrollMap) &#123;
    scrollMap = <span class="title function_">buildScrollMap</span>(editor, preview)
  &#125;

  <span class="keyword">const</span> lines = <span class="title class_">Object</span>.<span class="title function_">keys</span>(scrollMap)
  <span class="keyword">if</span> (lines.<span class="property">length</span> &lt; <span class="number">1</span>) &#123;
    <span class="keyword">return</span>
  &#125;
  <span class="keyword">let</span> line = lines[<span class="number">0</span>]
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; lines.<span class="property">length</span>; i++) &#123;
    <span class="keyword">if</span> (scrollMap[<span class="title class_">Number</span>(lines[i])] &lt; preview.<span class="property">scrollTop</span>) &#123;
      line = lines[i]
      <span class="keyword">continue</span>
    &#125;
    <span class="keyword">break</span>
  &#125;
  editor.<span class="title function_">scrollTo</span>(&#123; <span class="attr">top</span>: <span class="variable constant_">LINE_HEIGHT</span> * <span class="title class_">Number</span>(line) &#125;)
&#125;</code></pre></li>
</ol>
<h3 id="åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹"><a href="#åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹" class="headerlink" title="åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹"></a>åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹</h3><ol>
<li>åœ¨æ”¹å˜ç¼–è¾‘å†…å®¹å’Œçª—å£å¤§å°æ—¶éœ€æ¸…ç©ºè®¡ç®—ç»“æœï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä¸€æ”¹å˜ï¼Œæ¯è¡Œçš„åç§»è·ç¦»å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨æ»šåŠ¨æ—¶éœ€è¦é‡æ–°è®¡ç®—</li>
<li>åŒæ­¥æ»šåŠ¨æ—¶ä¼šæœ‰ä¸€ä¸ªæ— é™è§¦å‘çš„é—®é¢˜ï¼Œå› ä¸ºç¼–è¾‘åŒºåŸŸæ»šåŠ¨ï¼Œä¼šè§¦å‘é¢„è§ˆåŒºåŸŸçš„<code>scrollTo()</code>ï¼Œç„¶åé¢„è§ˆåŒºåŸŸçš„æ»šåŠ¨ç›‘å¬æ–¹æ³•å°±ä¼šè¢«è§¦å‘ï¼Œç„¶åè¿™æ ·å°±ä¼šæ— é™è§¦å‘ä¸‹å»ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå˜é‡è®°ä½å½“å‰çš„æ‰‹åŠ¨æ»šåŠ¨çš„åŒºåŸŸï¼Œè¿›è¡Œé™åˆ¶</li>
</ol>
<h2 id="ç›®å½•åˆ—è¡¨ç”Ÿæˆ"><a href="#ç›®å½•åˆ—è¡¨ç”Ÿæˆ" class="headerlink" title="ç›®å½•åˆ—è¡¨ç”Ÿæˆ"></a>ç›®å½•åˆ—è¡¨ç”Ÿæˆ</h2><p>ç›®å½•åˆ—è¡¨é€šè¿‡rulesçš„<code>heading_open</code>æ–¹æ³•ï¼Œè·å–å½“å‰æ ‡é¢˜çš„tokenï¼Œç„¶åé€šè¿‡tokenå¾—å‡ºæ ‡é¢˜çš„å…·ä½“å†…å®¹è¿›è¡Œæ‹¼æ¥ï¼Œæœ€åæ ¹æ®levelè®¡ç®—å­—ä½“å¤§å°</p>
<ul>
<li>è·å–æ ‡é¢˜å†…å®¹<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">getTitle</span> = (<span class="params">tokens: Token[], idx: number</span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; children &#125; = tokens[idx + <span class="number">1</span>]
  <span class="keyword">const</span> &#123; markup &#125; = tokens[idx]
  <span class="keyword">const</span> val = children?.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span><span class="subst">$&#123;cur.content&#125;</span>`</span>, <span class="string">&#x27;&#x27;</span>) || <span class="string">&#x27;&#x27;</span>
  toc.<span class="title function_">push</span>(&#123;
    val,
    <span class="attr">level</span>: markup.<span class="property">length</span>
  &#125;)
&#125;</code></pre></li>
<li>htmlå±•ç¤º<pre><code class="highlight js">&#123;showToc &amp;&amp; (
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.toc&#125;</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.tocTitle&#125;</span>&gt;</span>ç›®å½•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">      &#123;tocList.map((&#123; val, level &#125;, index) =&gt; &#123;</span>
<span class="language-xml">        const fontSize = ((7 - level) / 10) * 40</span>
<span class="language-xml"></span>
<span class="language-xml">        return (</span>
<span class="language-xml">          <span class="tag">&lt;<span class="name">div</span></span></span>
<span class="tag"><span class="language-xml">            <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span>
<span class="tag"><span class="language-xml">              <span class="attr">marginLeft:</span> `$&#123;<span class="attr">level</span> * <span class="attr">10</span>&#125;<span class="attr">px</span>`,</span></span>
<span class="tag"><span class="language-xml">              <span class="attr">fontSize:</span> `$&#123;<span class="attr">fontSize</span> &gt;</span> 12 ? fontSize : 12&#125;px`</span>
<span class="language-xml">            &#125;&#125;</span>
<span class="language-xml">            key=&#123;index&#125;</span>
<span class="language-xml">          &gt;</span>
<span class="language-xml">            &#123;val&#125;</span>
<span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">        )</span>
<span class="language-xml">      &#125;)&#125;</span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
)&#125;</code></pre></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯èƒ½å®Œæˆçš„æœ‰ç‚¹ç²—ç³™ï¼Œä»¥åæœ‰æ—¶é—´ç»§ç»­å®Œå–„ç»†èŠ‚ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://blog.csdn.net/m0_67393295/article/details/123220722">æ‰‹æŠŠæ‰‹å¸¦ä½ 10åˆ†é’Ÿæ‰‹æ’¸ä¸€ä¸ªç®€æ˜“çš„Markdownç¼–è¾‘å™¨</a></li>
<li><a href="https://github.com/markdown-it/markdown-it/blob/master/support/demo_template/index.js">markdown-it.github.io</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>markdown</tag>
        <tag>markdown-it</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºç€‘å¸ƒæµå’Œè™šæ‹Ÿåˆ—è¡¨</title>
    <url>/2022/08/21/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%80%91%E5%B8%83%E6%B5%81%E5%92%8C%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="å¾®ä¿¡å°ç¨‹åºç€‘å¸ƒæµå’Œè™šæ‹Ÿåˆ—è¡¨"><a href="#å¾®ä¿¡å°ç¨‹åºç€‘å¸ƒæµå’Œè™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºç€‘å¸ƒæµå’Œè™šæ‹Ÿåˆ—è¡¨"></a>å¾®ä¿¡å°ç¨‹åºç€‘å¸ƒæµå’Œè™šæ‹Ÿåˆ—è¡¨</h2><p>é¦–å…ˆå£°æ˜è™½ç„¶æœ¬ç¯‡æ˜¯å†™çš„å¾®ä¿¡å°ç¨‹åºçš„æ¡ˆä¾‹ï¼Œä½†æ˜¯ä¹Ÿå¯ç”¨äºH5ï¼Œæ€è·¯æ˜¯æƒ³é€šçš„ï¼Œåªæ˜¯æœ‰äº›apiçš„å·®å¼‚ï¼Œæœ€åä¼šè´´ä»£ç ç‰‡æ®µ<br><img src="https://img-blog.csdnimg.cn/40f9275783f14ed4a2a020ec733b3043.gif#pic_center" alt="example"></p>
<h3 id="è™šæ‹Ÿåˆ—è¡¨"><a href="#è™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="è™šæ‹Ÿåˆ—è¡¨"></a>è™šæ‹Ÿåˆ—è¡¨</h3><ul>
<li>ä¸€èˆ¬åœ¨åšé•¿åˆ—è¡¨ä¼˜åŒ–æ—¶ï¼Œç‰¹åˆ«æ˜¯é¢è¯•æ—¶ï¼Œè™šæ‹Ÿåˆ—è¡¨å°±æ˜¯ä¸ªé«˜é¢‘è¯ã€‚è¿™ä¸ªåè¯å¬èµ·æ¥å¾ˆé«˜çº§ï¼Œå…¶å®åŸç†å¾ˆç®€å•</li>
<li>è™šæ‹Ÿåˆ—è¡¨å°±æ˜¯å°†éœ€è¦æ¸²æŸ“çš„æ•°ç»„æ•°æ®æ”¹é€ æˆäºŒç»´æ•°ç»„ï¼Œç„¶åé€šè¿‡ç›‘å¬DOMåœ¨åˆé€‚çš„åœ°æ–¹åˆ‡æ¢ä¸ºå ä½å…ƒç´ ï¼Œè¾¾åˆ°é•¿åˆ—è¡¨æ— é™æ»šåŠ¨æ—¶å‡å°‘DOMçš„ä¼˜åŒ–</li>
<li>JS <pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * å¤„ç†å ä½å…ƒç´ ï¼Œå°±æ˜¯åœ¨è·å–æ–°çš„æ•°æ®å</span>
<span class="comment"> * é€šè¿‡SelectQueryè·å–å½“å‰æ•°æ®çš„å®é™…é«˜åº¦ï¼Œç„¶åæŠŠè¿™ä¸ªé«˜åº¦è®¾ç½®åˆ°å ä½å…ƒç´ ä¸Š</span>
<span class="comment"> */</span>
<span class="title function_">getCurrentItemHeight</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> query = <span class="variable language_">this</span>.<span class="title function_">createSelectorQuery</span>();
  <span class="keyword">const</span> &#123; virtualId &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  query.<span class="title function_">select</span>(<span class="string">`#<span class="subst">$&#123;virtualId&#125;</span>`</span>).<span class="title function_">boundingClientRect</span>()
  query.<span class="title function_">exec</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">height</span>: res[<span class="number">0</span>].<span class="property">height</span>
    &#125;, <span class="variable language_">this</span>.<span class="title function_">observePage</span>())
  &#125;)
&#125;

<span class="comment">/**</span>
<span class="comment"> * ç›‘å¬å…ƒç´ ä¸é¡µé¢çš„ç›¸äº¤</span>
<span class="comment"> * å¯ä»¥é€‰æ‹©æŒ‡å®šå…ƒç´ ä¸ºå‚ç…§åŒºåŸŸï¼Œä¹Ÿå¯ä»¥é€‰æ‹©é¡µé¢ä¸ºå‚ç…§å…ƒç´ ï¼Œåªæ˜¯APIä¸åŒ</span>
<span class="comment"> * <span class="doctag">@doc</span> https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.html</span>
<span class="comment"> */</span>
<span class="title function_">observePage</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> &#123; virtualId, observeDistance, wrapId &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="keyword">let</span> <span class="title class_">IntersectionObserver</span> = wx.<span class="title function_">createIntersectionObserver</span>(<span class="variable language_">this</span>);
  (wrapId ? <span class="title class_">IntersectionObserver</span>.<span class="title function_">relativeTo</span>(<span class="string">`#<span class="subst">$&#123;wrapId&#125;</span>`</span>) : <span class="title class_">IntersectionObserver</span>.<span class="title function_">relativeToViewport</span>(&#123; <span class="attr">top</span>: observeDistance, <span class="attr">bottom</span>: observeDistance &#125;))
  .<span class="title function_">observe</span>(<span class="string">`#<span class="subst">$&#123;virtualId&#125;</span>`</span>, <span class="function">(<span class="params">&#123; intersectionRatio &#125;</span>) =&gt;</span> &#123;
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">isShow</span>: intersectionRatio &gt; <span class="number">0</span>,
    &#125;)
  &#125;)
&#125;</code></pre></li>
<li>html<pre><code class="highlight js">&lt;view id=<span class="string">&quot;&#123;&#123;virtualId&#125;&#125;&quot;</span>&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;isShow&#125;&#125;&quot;</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span>
  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">style</span>=<span class="string">&quot;height: &#123;&#123; height &#125;&#125;px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span>
&lt;/view&gt;</code></pre></li>
</ul>
<h3 id="ç€‘å¸ƒæµ"><a href="#ç€‘å¸ƒæµ" class="headerlink" title="ç€‘å¸ƒæµ"></a>ç€‘å¸ƒæµ</h3><ul>
<li>ç€‘å¸ƒæµï¼Œåˆç§°ç€‘å¸ƒæµå¼å¸ƒå±€ã€‚è§†è§‰è¡¨ç°ä¸ºå‚å·®ä¸é½çš„å¤šæ å¸ƒå±€ï¼Œéšç€é¡µé¢æ»šåŠ¨æ¡å‘ä¸‹æ»šåŠ¨ï¼Œè¿™ç§å¸ƒå±€è¿˜ä¼šä¸æ–­åŠ è½½æ•°æ®å—å¹¶é™„åŠ è‡³å½“å‰å°¾éƒ¨</li>
<li>ç€‘å¸ƒæµæœ‰å¤šç§å†™æ³•ï¼Œæœ‰é€šè¿‡çº¯CSSå®Œæˆçš„ï¼Œä¹Ÿæœ‰å€ŸåŠ©JSå®Œæˆçš„ï¼Œæ–¹æ³•å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘ä¸ºäº†æ¥ä¸‹æ¥èƒ½ä¸è™šæ‹Ÿåˆ—è¡¨ç›¸ç»“åˆï¼Œå°±é‡‡ç”¨JSçš„å†™æ³•ï¼Œå°±æ˜¯é€šè¿‡åˆ—æ•°æŠŠæ¯ä¸€åˆ—åˆ†ä¸ºä¸€ä¸ªå•ç‹¬çš„å­å…ƒç´ ï¼Œç„¶åä¼šè®°å½•æ¯ä¸€åˆ—çš„é«˜åº¦ï¼Œé€šè¿‡åˆ¤æ–­å“ªä¸€åˆ—é«˜åº¦æœ€å°ï¼Œç„¶åå°†æ•°æ®pushåˆ°é«˜åº¦æœ€å°çš„é‚£ä¸€åˆ—<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è·å–åˆ—è¡¨æ•°æ®</span>
<span class="comment"> * <span class="doctag">@describe</span> ç€‘å¸ƒæµå¤„ç†ï¼Œå“ªåˆ—é«˜åº¦å°ï¼Œå°±å¾€å“ªåˆ—pushæ–°æ•°æ®</span>
<span class="comment"> */</span>
<span class="title function_">getList</span>(<span class="params"></span>) &#123;
  <span class="keyword">let</span> &#123; <span class="attr">listQuery</span>: &#123; pageIndex, pageSize &#125;, columns, columnsHeight &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pageSize; i++) &#123;
    <span class="keyword">const</span> height = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>)
    <span class="keyword">const</span> item = height &lt; <span class="number">50</span> ? height + <span class="number">50</span> : height
    <span class="keyword">const</span> position = <span class="variable language_">this</span>.<span class="title function_">computePosition</span>(columnsHeight)
    columns[position].<span class="title function_">push</span>(item)
    columnsHeight += item
  &#125;
  <span class="comment">// åœ¨htmlä¸­åŒé‡éå†columnsï¼Œç„¶åé€šè¿‡flexï¼š1å‡åŒ€åˆ†å¸ƒ</span>
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    columns,
  &#125;)
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">columnsHeight</span> = columnsHeight
&#125;

<span class="comment">/**</span>
<span class="comment"> * è·å–é«˜åº¦æœ€å°åˆ—ä¸‹æ ‡</span>
<span class="comment"> */</span>
<span class="title function_">computePosition</span>(<span class="params">heights</span>) &#123;
  <span class="keyword">const</span> min = <span class="title class_">Math</span>.<span class="title function_">min</span>(...heights);
  <span class="keyword">return</span> heights.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item === min)
&#125;</code></pre></li>
</ul>
<h3 id="ç€‘å¸ƒæµç»“åˆè™šæ‹Ÿåˆ—è¡¨"><a href="#ç€‘å¸ƒæµç»“åˆè™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="ç€‘å¸ƒæµç»“åˆè™šæ‹Ÿåˆ—è¡¨"></a>ç€‘å¸ƒæµç»“åˆè™šæ‹Ÿåˆ—è¡¨</h3><ul>
<li>è®©ç€‘å¸ƒæµæœ‰è™šæ‹Ÿæ»šåŠ¨çš„èƒ½åŠ›ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯è®¡ç®—æ¯åˆ—çš„åç§»é‡ï¼Œå› ä¸ºç€‘å¸ƒæµè¢«æˆ‘ä»¬åˆ†æˆäº†äºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥æ¯å—å­å…ƒç´ ä¹‹é—´å°±ä¼šå› ä¸ºåˆ—é«˜åº¦çš„ä¸ä¸€è‡´äº§ç”Ÿç©ºç™½åŒºåŸŸï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—è¿™ä¸ªç©ºç™½åŒºåŸŸçš„å¤§å°ï¼Œç„¶åé€šè¿‡<code>margin-top</code>ç§»åŠ¨åˆ—å…ƒç´ è¾¾åˆ°è§†è§‰ä¸Šçš„ç€‘å¸ƒæµè¡”æ¥æ•ˆæœ<br><img src="https://img-blog.csdnimg.cn/070e8c72d982470ca8808ad8121e6110.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
<pre><code class="highlight js"><span class="title function_">getList</span>(<span class="params"></span>) &#123;
  <span class="keyword">let</span> &#123; <span class="attr">listQuery</span>: &#123; pageIndex &#125;, column, columnsHeights &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">const</span> columns = [];
  <span class="comment">// ä¸Šä¸€ç»„çš„é«˜åº¦æ•°æ®ï¼Œç”¨äºè®¡ç®—åç§»å€¼</span>
  <span class="keyword">const</span> lastHeights = [...columnsHeights];
  <span class="comment">// è·å–æ•°æ®</span>
  <span class="keyword">const</span> list = <span class="variable language_">this</span>.<span class="title function_">getListData</span>();
  <span class="comment">// åˆå§‹åŒ–å½“å‰å±æ•°æ®</span>
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; column; i++ ) &#123;
    columns.<span class="title function_">push</span>([]);
  &#125;
  <span class="comment">// éå†æ–°æ•°æ®ï¼Œåˆ†é…è‡³å„åˆ—</span>
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;
    <span class="keyword">const</span> position = <span class="variable language_">this</span>.<span class="title function_">computePosition</span>(columnsHeights);
    columns[position].<span class="title function_">push</span>(list[i]);
    columnsHeights[position] += <span class="title class_">Number</span>(list[i].<span class="property">height</span>);
  &#125;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    [<span class="string">`listData[<span class="subst">$&#123;pageIndex&#125;</span>]`</span>]: &#123;
      columns,
      <span class="attr">columnOffset</span>: <span class="variable language_">this</span>.<span class="title function_">computeOffset</span>(lastHeights),
    &#125;
  &#125;);
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">listQuery</span>.<span class="property">pageIndex</span> = pageIndex + <span class="number">1</span>;
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">columnsHeights</span> = columnsHeights;
&#125;,

<span class="comment">/**</span>
<span class="comment"> * è·å–åˆ—è¡¨æ•°æ®</span>
<span class="comment"> */</span>
<span class="title function_">getListData</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> result = []
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">listQuery</span>.<span class="property">pageSize</span>; i++) &#123;
    <span class="keyword">const</span> height = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">300</span>);
    <span class="keyword">const</span> item = &#123;
      <span class="attr">height</span>: height &lt; <span class="number">150</span> ? height + <span class="number">150</span> : height,
      <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="title function_">randomRgbColor</span>(),
    &#125;;
    result.<span class="title function_">push</span>(item);
  &#125;
  <span class="keyword">return</span> result;
&#125;,

<span class="comment">/**</span>
<span class="comment"> * éšæœºç”ŸæˆRGBé¢œè‰²</span>
<span class="comment"> */</span>
<span class="title function_">randomRgbColor</span>(<span class="params"></span>) &#123;
  <span class="keyword">var</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>); <span class="comment">//éšæœºç”Ÿæˆ256ä»¥å†…rå€¼</span>
  <span class="keyword">var</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>); <span class="comment">//éšæœºç”Ÿæˆ256ä»¥å†…gå€¼</span>
  <span class="keyword">var</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">256</span>); <span class="comment">//éšæœºç”Ÿæˆ256ä»¥å†…bå€¼</span>
  <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span>; <span class="comment">//è¿”å›rgb(r,g,b)æ ¼å¼é¢œè‰²</span>
&#125;,

<span class="comment">/**</span>
<span class="comment"> * è·å–æœ€å°é«˜åº¦åˆ—ä¸‹æ ‡</span>
<span class="comment"> */</span>
<span class="title function_">computePosition</span>(<span class="params">heights</span>) &#123;
  <span class="keyword">const</span> min = <span class="title class_">Math</span>.<span class="title function_">min</span>(...heights);
  <span class="keyword">return</span> heights.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item === min);
&#125;,

<span class="comment">/**</span>
<span class="comment"> * è®¡ç®—åç§»é‡</span>
<span class="comment"> */</span>
<span class="title function_">computeOffset</span>(<span class="params">heights</span>) &#123;
  <span class="keyword">const</span> max = <span class="title class_">Math</span>.<span class="title function_">max</span>(...heights);
  <span class="keyword">return</span> heights.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> max - item);
&#125;,

<span class="title function_">onScrollLower</span>(<span class="params"></span>) &#123;
  <span class="variable language_">this</span>.<span class="title function_">getList</span>();
&#125;</code></pre>
<ul>
<li>WXML<pre><code class="highlight js">&lt;view&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;virtualScrollView&quot;</span> <span class="attr">eventhandle</span> <span class="attr">scroll-y</span> <span class="attr">bindscrolltolower</span>=<span class="string">&quot;onScrollLower&quot;</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123; listData &#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;screenIndex&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;screenIndex&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;screenItem&quot;</span>&gt;</span></span>
<span class="language-xml">      <span class="tag">&lt;<span class="name">VirtualItem</span> <span class="attr">virtualId</span>=<span class="string">&quot;virtual_&#123;&#123;pageIndex&#125;&#125;&quot;</span>&gt;</span></span>
<span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fall&quot;</span>&gt;</span></span>
<span class="language-xml">          <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123; screenItem.columns &#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;columnIndex&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;columnIndex&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;column&quot;</span> &gt;</span></span>
<span class="language-xml">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: -&#123;&#123;screenItem.columnOffset[columnIndex]&#125;&#125;px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fallCol&quot;</span>&gt;</span></span>
<span class="language-xml">              <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;column&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: &#123;&#123; item.height &#125;&#125;px; background-color: &#123;&#123; item.color &#125;&#125;;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span>
<span class="language-xml">                screen: &#123;&#123; screenIndex &#125;&#125;, column: &#123;&#123; columnIndex &#125;&#125;</span>
<span class="language-xml">              <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span>
<span class="language-xml">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span>
<span class="language-xml">          <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span>
<span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span>
<span class="language-xml">      <span class="tag">&lt;/<span class="name">VirtualItem</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span>
&lt;/view&gt;</code></pre></li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>ä»£ç ç‰‡æ®µï¼š<a href="https://developers.weixin.qq.com/s/5P3DpGmI7PBc">https://developers.weixin.qq.com/s/5P3DpGmI7PBc</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
        <tag>ç€‘å¸ƒæµ</tag>
        <tag>è™šæ‹Ÿåˆ—è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡æ‹–æ‹½æ’åºç»„ä»¶</title>
    <url>/2022/09/03/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%9B%BE%E7%89%87%E6%8B%96%E6%8B%BD%E6%8E%92%E5%BA%8F%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul>
<li>å›¾ç‰‡æ‹–æ‹½æ’åºæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ç»„ä»¶ï¼Œå¸¸ç”¨äºå‘å¸–æˆ–è€…è¯„è®ºç­‰å†…å®¹ä¸Šä¼ æ¨¡å—ï¼Œæˆ‘å€Ÿé‰´äº†<a href="https://www.cnblogs.com/haha1212/p/11562944.html">ã€Šä¸€æ¬¾ä¼˜é›…çš„å°ç¨‹åºæ‹–æ‹½æ’åºç»„ä»¶å®ç°ã€‹</a>è¿™ç¯‡æ–‡ç« çš„æ‹–æ‹½æ€è·¯ï¼Œå¹¶å°è£…æˆ<a href="https://github.com/LHRUN/wx-drag-img">wx-drag-img</a>å‘å¸ƒåˆ°npm</li>
<li>å®ç°åŸç†ï¼šæ¯ä¸ªå›¾ç‰‡åˆå§‹åŒ–æˆ‘éƒ½ä¼šå°è£…æˆä¸€ä¸ªæ‹–æ‹½çš„æ•°æ®ç»“æ„ï¼Œç„¶åè§¦å‘touchäº‹ä»¶æ—¶ï¼Œé€šè¿‡æ”¹å˜å›¾ç‰‡çš„keyæ¥è®¡ç®—transformä½ç½®ï¼Œä»è€Œè¾¾åˆ°æ‹–æ‹½æ•ˆæœ</li>
<li>åŠŸèƒ½åŒ…æ‹¬å›¾ç‰‡ä¸Šä¼ æ‹–æ‹½åˆ é™¤ï¼Œæºç å’Œnpmåœ°å€æˆ‘ä¼šè´´åœ¨ç»“å°¾ï¼Œå¦‚æœæ„Ÿè§‰å¥½çš„è¯ï¼Œæ¬¢è¿star</li>
<li>æˆ‘ä¼šåœ¨ä¸‹é¢é€æ­¥åˆ†æè¿™ä¸ªç»„ä»¶çš„å®ç°æ€è·¯</li>
<li>ä½¿ç”¨äº†ä»¥ä¸‹å˜é‡<pre><code class="highlight ts"><span class="comment">// æ‹–æ‹½æ•°æ®ç»“æ„</span>
<span class="keyword">interface</span> <span class="title class_">IDragImg</span> &#123;
  <span class="attr">src</span>: <span class="built_in">string</span>; <span class="comment">// å›¾ç‰‡è·¯å¾„</span>
  <span class="attr">key</span>: <span class="built_in">number</span>; <span class="comment">// </span>
  <span class="attr">id</span>: <span class="built_in">number</span>; <span class="comment">// forå¾ªç¯éå†ä½¿ç”¨, ä¸ä¼šæ”¹å˜, åˆ›å»ºæ—¶è‡ªå¢id</span>
  <span class="attr">tranX</span>: <span class="built_in">number</span>; <span class="comment">// xè½´ä½ç§»è·ç¦»</span>
  <span class="attr">tranY</span>: <span class="built_in">number</span>; <span class="comment">// yè½´ä½ç§»è·ç¦»</span>
&#125;

<span class="comment">// props</span>
&#123;
  previewSize <span class="comment">// å›¾ç‰‡å¤§å°</span>
  defaultImgList <span class="comment">// åˆå§‹åŒ–å›¾ç‰‡æ•°ç»„</span>
  maxCount <span class="comment">// å›¾ç‰‡ä¸Šä¼ æ•°é‡é™åˆ¶</span>
  columns <span class="comment">// åˆ—æ•°</span>
  gap <span class="comment">// å›¾ç‰‡é—´éš”</span>
  deleteStyle <span class="comment">// åˆ é™¤æ ·å¼</span>
&#125;

<span class="attr">data</span>: &#123;
  <span class="attr">dragImgList</span>: <span class="title class_">IDragImg</span>[],
  <span class="attr">containerRes</span>: &#123;
    <span class="attr">top</span>: <span class="number">0</span>, <span class="comment">// å®¹å™¨è·ç¦»é¡µé¢é¡¶éƒ¨è·ç¦» px</span>
    <span class="attr">left</span>: <span class="number">0</span>, <span class="comment">// å®¹å™¨è·ç¦»é¡µé¢å·¦è¾¹è·ç¦» px</span>
    <span class="attr">width</span>: <span class="number">0</span>, <span class="comment">// å®¹å™¨å®½åº¦ px</span>
    <span class="attr">height</span>: <span class="number">0</span>, <span class="comment">// å®¹å™¨é«˜åº¦ px</span>
  &#125;, <span class="comment">// æ‹–æ‹½å®¹å™¨å±æ€§</span>
  <span class="attr">currentKey</span>: -<span class="number">1</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡çš„key</span>
  <span class="attr">currentIndex</span>: -<span class="number">1</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡çš„index</span>
  <span class="attr">tranX</span>: <span class="number">0</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡ç§»åŠ¨çš„xè·ç¦»</span>
  <span class="attr">tranY</span>: <span class="number">0</span>, <span class="comment">// æ­£åœ¨æ‹–æ‹½å›¾ç‰‡ç§»åŠ¨çš„yè·ç¦»</span>
  <span class="attr">uploadPosition</span>: &#123; <span class="comment">// uploadä¸Šä¼ å›¾æ ‡ä½ç§»è·ç¦»</span>
    <span class="attr">tranX</span>: <span class="number">0</span>,
    <span class="attr">tranY</span>: <span class="number">0</span>,
  &#125;
&#125;,</code></pre></li>
</ul>
<h2 id="WXML"><a href="#WXML" class="headerlink" title="WXML"></a>WXML</h2><pre><code class="highlight html"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: &#123;&#123;containerRes.width&#125;&#125;px; height: &#123;&#123;containerRes.height&#125;&#125;px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;drag-container&quot;</span>&gt;</span>
  <span class="tag">&lt;<span class="name">view</span></span>
<span class="tag">    <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;dragImgList&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span></span>
<span class="tag">    <span class="attr">style</span>=<span class="string">&quot;transform: translate(&#123;&#123;index === currentIndex ? tranX : item.tranX&#125;&#125;px, &#123;&#123;index === currentIndex ? tranY : item.tranY&#125;&#125;px); z-index: &#123;&#123;index === currentIndex ? 10 : 1&#125;&#125;; width: &#123;&#123;previewSize&#125;&#125;px; height: &#123;&#123;previewSize&#125;&#125;px;&quot;</span></span>
<span class="tag">    <span class="attr">class</span>=<span class="string">&quot;drag-item drag-item-transition&quot;</span></span>
<span class="tag">    <span class="attr">mark:index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">mark:key</span>=<span class="string">&quot;&#123;&#123;item.key&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">catch:longpress</span>=<span class="string">&quot;longPress&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchmove</span>=<span class="string">&quot;touchMove&quot;</span></span>
<span class="tag">    <span class="attr">catch:touchend</span>=<span class="string">&quot;touchEnd&quot;</span></span>
<span class="tag">  &gt;</span>
    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;drag-item-img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.src&#125;&#125;&quot;</span>/&gt;</span>
    <span class="comment">&lt;!-- åˆ é™¤å›¾æ ‡ --&gt;</span>
    <span class="tag">&lt;<span class="name">view</span> <span class="attr">catch:tap</span>=<span class="string">&quot;deleteImg&quot;</span> <span class="attr">mark:key</span>=<span class="string">&quot;&#123;&#123;item.key&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;drag-item-delete&quot;</span>&gt;</span>
      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;drag-item-delete_default&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&#123;&#123;deleteStyle&#125;&#125;&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">view</span>&gt;</span>
  <span class="tag">&lt;/<span class="name">view</span>&gt;</span>

  <span class="comment">&lt;!-- ä¸Šä¼ å›¾ç‰‡ --&gt;</span>
  <span class="tag">&lt;<span class="name">view</span></span>
<span class="tag">    <span class="attr">bindtap</span>=<span class="string">&quot;uploadImage&quot;</span></span>
<span class="tag">    <span class="attr">class</span>=<span class="string">&quot;drag-item drag-upload&quot;</span></span>
<span class="tag">    <span class="attr">hidden</span>=<span class="string">&quot;&#123;&#123;dragImgList.length &gt;= maxCount&#125;&#125;&quot;</span></span>
<span class="tag">    <span class="attr">style</span>=<span class="string">&quot;transform: translate(&#123;&#123;uploadPosition.tranX&#125;&#125;px, &#123;&#123;uploadPosition.tranY&#125;&#125;px); width: &#123;&#123;previewSize&#125;&#125;px; height: &#123;&#123;previewSize&#125;&#125;px;&quot;</span></span>
<span class="tag">  &gt;</span>
    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;drag-upload_solt&quot;</span>&gt;</span>
      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;upload&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">view</span>&gt;</span>
    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;drag-upload_default&quot;</span>&gt;</span>
      <span class="tag">&lt;<span class="name">text</span>&gt;</span>+<span class="tag">&lt;/<span class="name">text</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">view</span>&gt;</span>
  <span class="tag">&lt;/<span class="name">view</span>&gt;</span>
<span class="tag">&lt;/<span class="name">view</span>&gt;</span></code></pre>

<h2 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h2><ul>
<li>å›¾ç‰‡ä¸Šä¼ å¾ˆç®€å•ï¼Œå°±æ˜¯åˆå§‹åŒ–ä¸Šä¼ çš„å›¾ç‰‡ï¼Œç„¶åæ‹¼æ¥åˆ°ç°æœ‰å›¾ç‰‡ï¼Œæœ€åä¿®æ”¹ä¸Šä¼ å›¾æ ‡ä½ç½®å³å¯</li>
<li>ç‚¹å‡»ä¸Šä¼ åŒºåŸŸå›è°ƒå‡½æ•°<code>uploadImage</code><pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * ä¸Šä¼ å›¾ç‰‡</span>
<span class="comment"> */</span>
<span class="keyword">async</span> <span class="title function_">uploadImage</span>(<span class="params"></span>) &#123;
  <span class="keyword">let</span> &#123; dragImgList, maxCount &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">try</span> &#123;
    <span class="keyword">const</span> res = <span class="keyword">await</span> wx.<span class="title function_">chooseMedia</span>(&#123;
      <span class="attr">count</span>: maxCount - dragImgList.<span class="property">length</span>,
      <span class="attr">mediaType</span>: [<span class="string">&#x27;image&#x27;</span>],
    &#125;);
    <span class="comment">// è·å–ä¸Šä¼ å›¾ç‰‡æ•°æ®åéœ€è¦åˆå§‹åŒ–å›¾ç‰‡æ‹½ç»“æ„</span>
    <span class="keyword">const</span> imgList = <span class="variable language_">this</span>.<span class="title function_">getDragImgList</span>(res?.<span class="property">tempFiles</span>?.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; tempFilePath &#125;</span>) =&gt;</span> tempFilePath) || [], <span class="literal">false</span>);
    dragImgList = dragImgList.<span class="title function_">concat</span>(imgList);
    <span class="comment">// ä¿®æ”¹ä¸Šä¼ åŒºåŸŸä½ç½®</span>
    <span class="variable language_">this</span>.<span class="title function_">setUploaPosition</span>(dragImgList.<span class="property">length</span>);
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      dragImgList,
    &#125;);
    <span class="variable language_">this</span>.<span class="title function_">updateEvent</span>(dragImgList);
  &#125; <span class="keyword">catch</span> (error) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);
  &#125;
&#125;,</code></pre></li>
<li>ä¸Šä¼ åéœ€è¦åˆå§‹åŒ–æ‹–æ‹½çš„æ•°æ®ç»“æ„<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * æ ¹æ®å›¾ç‰‡åˆ—è¡¨ç”Ÿæˆæ‹–æ‹½åˆ—è¡¨æ•°æ®ç»“æ„</span>
<span class="comment"> * <span class="doctag">@param</span> list å›¾ç‰‡srcåˆ—è¡¨</span>
<span class="comment"> * <span class="doctag">@param</span> init æ˜¯å¦æ˜¯åˆå§‹åŒ–</span>
<span class="comment"> */</span>
 <span class="title function_">getDragImgList</span>(<span class="params">list, init = <span class="literal">true</span></span>) &#123;
  <span class="keyword">let</span> &#123; dragImgList, previewSize, columns, gap &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">return</span> list.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;
    <span class="keyword">const</span> i = (init ? <span class="number">0</span> : dragImgList.<span class="property">length</span>) + index;
    <span class="keyword">return</span> &#123;
      <span class="attr">tranX</span>: (previewSize + gap) * (i % columns),
      <span class="attr">tranY</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(i / columns) * (previewSize + gap),
      <span class="attr">src</span>: item,
      <span class="attr">id</span>: i,
      <span class="attr">key</span>: i,
    &#125;;
  &#125;);
&#125;,</code></pre></li>
<li>ä¿®æ”¹ä¸Šä¼ åŒºåŸŸä½ç½®<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * ä¿®æ”¹ä¸Šä¼ åŒºåŸŸä½ç½®</span>
<span class="comment"> * <span class="doctag">@param</span> listLength æ•°ç»„é•¿åº¦</span>
<span class="comment"> */</span>
<span class="title function_">setUploaPosition</span>(<span class="params">listLength</span>) &#123;
  <span class="keyword">const</span> &#123; previewSize, columns, gap &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">const</span> uploadPosition = &#123;
    <span class="attr">tranX</span>: listLength % columns * (previewSize + gap),
    <span class="attr">tranY</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(listLength / columns) * (previewSize + gap),
  &#125;;
  <span class="keyword">const</span> &#123; width, height &#125; = <span class="variable language_">this</span>.<span class="title function_">getContainerRect</span>(listLength);
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    uploadPosition,
    [<span class="string">&#x27;containerRes.width&#x27;</span>]: width,
    [<span class="string">&#x27;containerRes.height&#x27;</span>]: height,
  &#125;);
&#125;,</code></pre></li>
<li>å›¾ç‰‡æ•°é‡æ”¹å˜åå°±è¦é‡æ–°è·å–å®¹å™¨å®½é«˜äº†<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * æ”¹å˜å›¾ç‰‡æ•°é‡åè·å–å®¹å™¨å®½é«˜</span>
<span class="comment"> * <span class="doctag">@parma</span> listLength æ•°ç»„é•¿åº¦</span>
<span class="comment"> */</span>
<span class="title function_">getContainerRect</span>(<span class="params">listLength</span>) &#123;
  <span class="keyword">const</span> &#123; columns, previewSize, maxCount, gap &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">const</span> number = listLength === maxCount ? listLength : listLength + <span class="number">1</span>;
  <span class="keyword">const</span> row = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(number / columns)
  <span class="keyword">return</span> &#123;
    <span class="attr">width</span>: columns * previewSize + (columns - <span class="number">1</span>) * gap,
    <span class="attr">height</span>: row * previewSize + gap * (row - <span class="number">1</span>),
  &#125;;
&#125;,</code></pre></li>
<li>updateEvent<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * updateEvent</span>
<span class="comment"> * <span class="doctag">@describe</span> ä¸Šä¼ åˆ é™¤æ‹–æ‹½åè§¦å‘äº‹ä»¶æŠŠåˆ—è¡¨æ•°æ®å‘ç»™é¡µé¢</span>
<span class="comment"> */</span>
<span class="title function_">updateEvent</span>(<span class="params">dragImgList</span>) &#123;
  <span class="keyword">const</span> list = [...dragImgList].<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">key</span> - b.<span class="property">key</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">src</span>);
    <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&#x27;updateImageList&#x27;</span>, &#123;
      list,
  &#125;);
&#125;,</code></pre></li>
</ul>
<h3 id="å›¾ç‰‡åˆ é™¤"><a href="#å›¾ç‰‡åˆ é™¤" class="headerlink" title="å›¾ç‰‡åˆ é™¤"></a>å›¾ç‰‡åˆ é™¤</h3><ul>
<li>é¦–å…ˆä»å›¾ç‰‡åˆ—è¡¨ä¸­åˆ é™¤æ‰€éœ€å›¾ç‰‡ï¼Œç„¶åä¿®æ”¹åˆ—è¡¨ï¼ŒæŠŠå¤§äºæ‰€é€‰å›¾ç‰‡keyçš„keyå…¨éƒ¨å‡ä¸€ï¼Œæœ€åè®¡ç®—å‰©ä½™å›¾ç‰‡ä½ç½®å’Œä¸Šä¼ å›¾æ ‡ä½ç½®<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * åˆ é™¤å›¾ç‰‡</span>
<span class="comment"> */</span>
<span class="title function_">deleteImg</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> key = e.<span class="property">mark</span>.<span class="property">key</span>;
  <span class="keyword">const</span> list = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">dragImgList</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">key</span> !== key);
  <span class="comment">// å¤§äºåˆ é™¤å›¾ç‰‡keyçš„keyå…¨éƒ¨å‡1</span>
  list.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;
    item.<span class="property">key</span> &gt; key &amp;&amp; item.<span class="property">key</span>--;
  &#125;);
  <span class="comment">// è·å–</span>
  <span class="variable language_">this</span>.<span class="title function_">getListPosition</span>(list);
  <span class="variable language_">this</span>.<span class="title function_">setUploaPosition</span>(list.<span class="property">length</span>);
&#125;,</code></pre>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è®¡ç®—æ•°ç»„çš„ä½ç§»ä½ç½®</span>
<span class="comment"> * <span class="doctag">@param</span> list æ‹–æ‹½å›¾ç‰‡æ•°ç»„</span>
<span class="comment"> */</span>
<span class="title function_">getListPosition</span>(<span class="params">list</span>) &#123;
  <span class="keyword">const</span> &#123; previewSize, columns, gap &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">const</span> dragImgList = list.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;
    item.<span class="property">tranX</span> = (previewSize + gap) * (item.<span class="property">key</span> % columns);
    item.<span class="property">tranY</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(item.<span class="property">key</span> / columns) * (previewSize + gap);
    <span class="keyword">return</span> item;
  &#125;)
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    dragImgList,
  &#125;);
  <span class="variable language_">this</span>.<span class="title function_">updateEvent</span>(dragImgList);
&#125;,</code></pre></li>
</ul>
<h2 id="å›¾ç‰‡æ‹–æ‹½"><a href="#å›¾ç‰‡æ‹–æ‹½" class="headerlink" title="å›¾ç‰‡æ‹–æ‹½"></a>å›¾ç‰‡æ‹–æ‹½</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><ul>
<li>åˆå§‹åŒ–åªéœ€è·å–å®¹å™¨çš„ä½ç½®ä¿¡æ¯å³å¯ï¼Œå› ä¸ºæ‹–æ‹½ç»„ä»¶ä¸ä¸€å®šæ˜¯åœ¨é¡µé¢çš„å·¦ä¸Šè§’ï¼Œæ‰€ä»¥éœ€è¦çŸ¥é“å®¹å™¨çš„ä½ç½®ä¿¡æ¯<pre><code class="highlight js"><span class="attr">lifetimes</span>: &#123;
  <span class="title function_">ready</span>(<span class="params"></span>) &#123;
    <span class="variable language_">this</span>.<span class="title function_">createSelectorQuery</span>()
      .<span class="title function_">select</span>(<span class="string">&quot;.drag-container&quot;</span>)
      .<span class="title function_">boundingClientRect</span>(<span class="function">(<span class="params">&#123; top, left &#125;</span>) =&gt;</span> &#123;
        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
          [<span class="string">&#x27;containerRes.top&#x27;</span>]: top,
          [<span class="string">&#x27;containerRes.left&#x27;</span>]: left,
        &#125;);
      &#125;).<span class="title function_">exec</span>();
  &#125;
&#125;,</code></pre></li>
</ul>
<h3 id="longPress"><a href="#longPress" class="headerlink" title="longPress"></a>longPress</h3><ul>
<li>è¿™é‡Œé‡‡ç”¨longPressï¼Œè€Œä¸æ˜¯touchStartçš„åŸå› ï¼Œä¸€æ˜¯ä¸ºäº†ä¼˜åŒ–ä½“éªŒï¼ŒäºŒæ˜¯touchStartä¸åˆ é™¤æŒ‰é’®å†²çª<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * é•¿æŒ‰å›¾ç‰‡</span>
<span class="comment"> */</span>
<span class="title function_">longPress</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> index = e.<span class="property">mark</span>.<span class="property">index</span>;
  <span class="keyword">const</span> &#123; pageX, pageY &#125; = e.<span class="property">touches</span>[<span class="number">0</span>];
  <span class="keyword">const</span> &#123; previewSize, <span class="attr">containerRes</span>: &#123; top, left &#125; &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    <span class="attr">currentIndex</span>: index,
    <span class="attr">tranX</span>: pageX - previewSize / <span class="number">2</span> - left,
    <span class="attr">tranY</span>: pageY - previewSize / <span class="number">2</span> - top,
  &#125;);
&#125;,</code></pre></li>
</ul>
<h3 id="touchMove"><a href="#touchMove" class="headerlink" title="touchMove"></a>touchMove</h3><ul>
<li>touchMoveé¦–å…ˆè®¡ç®—å‡ºä½ç§»è·ç¦»ï¼Œç„¶åæ ¹æ®ä½ç§»è·ç¦»æ±‚å‡ºåœæ”¾ä½ç½®çš„keyï¼Œå¦‚æœä¸ä¸€æ ·å°±ä¿®æ”¹ä½ç½®</li>
<li>touchMove<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * touchMove</span>
<span class="comment"> */</span>
<span class="title function_">touchMove</span>(<span class="params">e</span>) &#123;
  <span class="comment">// å¦‚æœcurrentIndex &lt; 0ï¼Œè¯´æ˜å¹¶æ²¡æœ‰è§¦å‘longPress</span>
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentIndex</span> &lt; <span class="number">0</span>) &#123;
    <span class="keyword">return</span>;
  &#125;
  <span class="keyword">const</span> &#123; pageX, pageY &#125; = e.<span class="property">touches</span>[<span class="number">0</span>];
  <span class="keyword">const</span> &#123; previewSize, <span class="attr">containerRes</span>: &#123; top, left &#125; &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">const</span> tranX = pageX - previewSize / <span class="number">2</span> - left;
  <span class="keyword">const</span> tranY = pageY - previewSize / <span class="number">2</span> - top;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    tranX,
    tranY
  &#125;);
  <span class="comment">// å¯¹æ¯”å½“å‰ç§»åŠ¨çš„keyå’Œåœæ”¾ä½ç½®çš„keyï¼Œå¦‚æœä¸ä¸€æ ·å°±ä¿®æ”¹ä½ç½®</span>
  <span class="keyword">const</span> currentKey = e.<span class="property">mark</span>.<span class="property">key</span>;
  <span class="keyword">const</span> moveKey = <span class="variable language_">this</span>.<span class="title function_">getMoveKey</span>(tranX, tranY);

  <span class="comment">// å½“ç§»åŠ¨çš„keyå’Œæ­£åœ¨åœæ”¾ä½ç½®çš„keyç›¸ç­‰ï¼Œå°±æ— é¡»å¤„ç†</span>
  <span class="keyword">if</span> (currentKey === moveKey || <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentKey</span> === currentKey) &#123;
    <span class="keyword">return</span>;
  &#125;
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentKey</span> = currentKey;
  <span class="variable language_">this</span>.<span class="title function_">replace</span>(currentKey, moveKey);
&#125;,</code></pre></li>
<li>getMoveKey<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è®¡ç®—ç§»åŠ¨ä¸­çš„key</span>
<span class="comment"> * <span class="doctag">@param</span> tranX æ­£åœ¨æ‹–æ‹½å›¾ç‰‡çš„tranX</span>
<span class="comment"> * <span class="doctag">@param</span> tranY æ­£åœ¨æ‹–æ‹½å›¾ç‰‡çš„tranY</span>
<span class="comment"> */</span>
<span class="title function_">getMoveKey</span>(<span class="params">tranX, tranY</span>) &#123;
  <span class="keyword">const</span> &#123; <span class="attr">dragImgList</span>: list, previewSize, columns &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;
  <span class="keyword">const</span> <span class="title function_">_getPositionNumber</span> = (<span class="params">drag, limit</span>) =&gt; &#123;
    <span class="keyword">const</span> positionNumber = <span class="title class_">Math</span>.<span class="title function_">round</span>(drag / previewSize);
    <span class="keyword">return</span> positionNumber &gt;= limit ? limit - <span class="number">1</span> : positionNumber &lt; <span class="number">0</span> ? <span class="number">0</span> : positionNumber;
  &#125;
  <span class="keyword">const</span> endKey = columns * <span class="title function_">_getPositionNumber</span>(tranY, <span class="title class_">Math</span>.<span class="title function_">ceil</span>(list.<span class="property">length</span> / columns)) + <span class="title function_">_getPositionNumber</span>(tranX, columns);
  <span class="keyword">return</span> endKey &gt;= list.<span class="property">length</span> ? list.<span class="property">length</span> - <span class="number">1</span> : endKey;
&#125;,</code></pre></li>
<li>replace<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * ç”Ÿæˆæ‹–æ‹½åçš„æ–°æ•°ç»„</span>
<span class="comment"> * <span class="doctag">@param</span> start æ‹–æ‹½èµ·å§‹çš„key</span>
<span class="comment"> * <span class="doctag">@param</span> end æ‹–æ‹½ç»“æŸçš„key</span>
<span class="comment"> */</span>
<span class="title function_">replace</span>(<span class="params">start, end</span>) &#123;
  <span class="keyword">const</span> dragImgList = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">dragImgList</span>;
  dragImgList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;
    <span class="keyword">if</span> (start &lt; end) &#123;
      <span class="keyword">if</span> (item.<span class="property">key</span> &gt; start &amp;&amp; item.<span class="property">key</span> &lt;= end) item.<span class="property">key</span>--;
      <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">key</span> === start) item.<span class="property">key</span> = end;
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (start &gt; end) &#123;
      <span class="keyword">if</span> (item.<span class="property">key</span> &gt;= end &amp;&amp; item.<span class="property">key</span> &lt; start) item.<span class="property">key</span>++;
      <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">key</span> === start) item.<span class="property">key</span> = end;
    &#125;
  &#125;);
  <span class="variable language_">this</span>.<span class="title function_">getListPosition</span>(dragImgList);
&#125;,</code></pre></li>
</ul>
<h3 id="touchEnd"><a href="#touchEnd" class="headerlink" title="touchEnd"></a>touchEnd</h3><ul>
<li>touchEndç”¨äºé‡ç½®æ•°æ®<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * touchEnd</span>
<span class="comment"> */</span>
<span class="title function_">touchEnd</span>(<span class="params"></span>) &#123;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    <span class="attr">tranX</span>: <span class="number">0</span>,
    <span class="attr">tranY</span>: <span class="number">0</span>,
    <span class="attr">currentIndex</span>: -<span class="number">1</span>,
  &#125;);
  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">currentKey</span> = -<span class="number">1</span>;
&#125;,</code></pre></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><a href="https://github.com/LHRUN/wx-drag-img">repo</a></li>
<li><a href="https://www.npmjs.com/package/wx-drag-img">npm</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://www.cnblogs.com/haha1212/p/11562944.html">ä¸€æ¬¾ä¼˜é›…çš„å°ç¨‹åºæ‹–æ‹½æ’åºç»„ä»¶å®ç°</a></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å°ç¨‹åºæ»šåŠ¨æ—¥å†ç»„ä»¶</title>
    <url>/2021/04/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%BB%9A%E5%8A%A8%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="å°ç¨‹åºæ»šåŠ¨æ—¥å†ç»„ä»¶"><a href="#å°ç¨‹åºæ»šåŠ¨æ—¥å†ç»„ä»¶" class="headerlink" title="å°ç¨‹åºæ»šåŠ¨æ—¥å†ç»„ä»¶"></a>å°ç¨‹åºæ»šåŠ¨æ—¥å†ç»„ä»¶</h2><p>å‰æ®µæ—¶é—´äº§å“æå‡ºè¿™ä¸ªéœ€æ±‚ï¼Œè¦æ±‚åšä¸€ä¸ªæ—¥å†å®¹å™¨ï¼Œå¹¶è¦æ±‚æ˜¯æ»šåŠ¨ï¼Œä¸èƒ½æ˜¯é‚£ç§æ¯ä¸ªæœˆåˆ‡æ¢çš„å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘å°±åœ¨ç½‘ä¸Šå¤§æ¦‚æŸ¥æ‰¾äº†ä¸€ä¸‹ç±»ä¼¼ç»„ä»¶ï¼Œæ»šåŠ¨çš„å®¹å™¨è¾ƒå°‘ï¼Œäºæ˜¯æˆ‘å°±è‡ªå·±å†™äº†è¿™ä¸ªç»„ä»¶ï¼Œä»¥ä¸‹æ˜¯å¤§æ¦‚çš„jsæ€è·¯ï¼Œwxmlå’Œcsså°±ä¸é™„ä¸Šäº†ï¼Œæ¯ä¸ªUIéƒ½æœ‰ä¸åŒçš„æƒ³æ³•</p>
<ol>
<li><p>åœ¨readyä¸­åˆå§‹åŒ–ç»„ä»¶æ•°æ®</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@description</span>: åˆå§‹åŒ–</span>
<span class="comment"> */</span>
<span class="title function_">ready</span>(<span class="params"></span>) &#123;
  <span class="comment">// è¿™ä¸¤ä¸ªæ•°æ®æ˜¯ä»é¡µé¢ä¸­ä¼ è¿‡æ¥çš„ï¼Œèµ·å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</span>
  <span class="comment">// æ•°ç»„ç±»å‹ [year, month, day]</span>
  <span class="keyword">const</span> &#123; endDate, startDate &#125; = <span class="variable language_">this</span>.<span class="property">data</span>
  <span class="keyword">let</span> monthList = [] <span class="comment">// è¿™ä¸ªç”¨äºwxmlä¸­éå†ï¼Œä»¥æ¯æœˆä¸ºitem</span>

  <span class="comment">// æœªè·¨å¹´</span>
  <span class="keyword">if</span> ( endDate[<span class="number">0</span>] === startDate[<span class="number">0</span>]) &#123;
    <span class="keyword">let</span> rangeMonth = endDate[<span class="number">1</span>] - startDate[<span class="number">1</span>]
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= rangeMonth; i++) &#123;
      <span class="keyword">let</span> date = [startDate[<span class="number">0</span>], startDate[<span class="number">1</span>] + i + <span class="number">1</span>]
      <span class="comment">// monthInitData()åˆå§‹åŒ–æ¯æœˆæ•°æ®</span>
      <span class="keyword">let</span> days = <span class="variable language_">this</span>.<span class="title function_">monthInitData</span>(startDate[<span class="number">0</span>], startDate[<span class="number">1</span>] + i)
      monthList.<span class="title function_">push</span>(&#123;
        date,
        days,
      &#125;)
    &#125;
  &#125; <span class="keyword">else</span> &#123;
    <span class="comment">// è·¨å¹´å‰æœˆä»½</span>
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, lng = <span class="number">12</span> - startDate[<span class="number">1</span>]; i &lt; lng; i++) &#123;
      <span class="keyword">let</span> date = [startDate[<span class="number">0</span>], startDate[<span class="number">1</span>] + i + <span class="number">1</span>]
      <span class="keyword">let</span> days = <span class="variable language_">this</span>.<span class="title function_">monthInitData</span>(startDate[<span class="number">0</span>], startDate[<span class="number">1</span>] + i)
      monthList.<span class="title function_">push</span>(&#123;
        date,
        days,
      &#125;)
    &#125;

    <span class="comment">// è·¨å¹´åæœˆä»½</span>
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= endDate[<span class="number">1</span>]; i++) &#123;
      <span class="keyword">let</span> date = [endDate[<span class="number">0</span>], i + <span class="number">1</span>]
      <span class="keyword">let</span> days = <span class="variable language_">this</span>.<span class="title function_">monthInitData</span>(endDate[<span class="number">0</span>], i)
      monthList.<span class="title function_">push</span>(&#123;
        date,
        days,
      &#125;)
    &#125;
  &#125;
  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
    monthList,
  &#125;)
&#125;</code></pre>
</li>
<li><p>åˆå§‹åŒ–æ¯æœˆæ•°æ®: </p>
<blockquote>
<p>é€»è¾‘æ˜¯è·å–æ¯ä¸ªæœˆç¬¬ä¸€å¤©çš„æ˜ŸæœŸæ•°å’Œæ¯ä¸ªæœˆçš„æœ€å¤§å¤©æ•°ï¼Œç„¶ååœ¨ä¹‹å‰å’Œä¹‹åçš„ç©ºæ•°æ®å¡«å……itemå ä½<br>ç„¶åéå†ï¼Œæ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼Œåœ¨éå†ä¸­å¤„ç†ï¼Œæœ€ååœ¨htmlä¸­flexå¸ƒå±€å³å¯</p>
</blockquote>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@description</span>: åˆå§‹åŒ–æ¯æœˆæ•°æ®</span>
<span class="comment"> * <span class="doctag">@param</span>: &#123; number &#125; year å¹´</span>
<span class="comment"> * <span class="doctag">@param</span>: &#123; number &#125; month æœˆ</span>
<span class="comment"> */</span>
<span class="title function_">monthInitData</span>(<span class="params">year, month</span>) &#123;
  <span class="keyword">let</span> &#123; calendarValue, startDate, endDate &#125;= <span class="variable language_">this</span>.<span class="property">data</span>, <span class="comment">// å½“å‰ç‚¹å‡»æ—¶é—´ï¼Œèµ·å§‹æ—¶é—´ï¼Œç»“æŸæ—¶é—´</span>
    firstWeek = <span class="keyword">new</span> <span class="title class_">Date</span>(year, month, <span class="number">1</span>).<span class="title function_">getDay</span>(), <span class="comment">// æœ¬æœˆçš„ç¬¬ä¸€å¤©çš„æ˜ŸæœŸæ•°</span>
    days = [], <span class="comment">// æ—¥æœŸæ•°ç»„</span>
    max = <span class="variable language_">this</span>.<span class="title function_">getMonthMax</span>(year, month + <span class="number">1</span>), <span class="comment">// æ¯æœˆæœ€å¤§å¤©æ•°</span>
    lastWeek = <span class="keyword">new</span> <span class="title class_">Date</span>(year, (month + <span class="number">1</span>), <span class="number">0</span>).<span class="title function_">getDay</span>() <span class="comment">// æœ¬æœˆçš„æœ€åä¸€å¤©çš„æ˜ŸæœŸæ•°</span>

  <span class="comment">// å¡«å……æ¯æœˆä¸€å·ä¹‹å‰çš„ç©ºæ•°æ®</span>
  <span class="keyword">if</span> (firstWeek &gt; <span class="number">0</span>) &#123;
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; firstWeek; i++) &#123;
      days.<span class="title function_">push</span>(&#123;
        <span class="attr">day</span>: <span class="number">0</span>
      &#125;)
    &#125;
  &#125;

  <span class="keyword">let</span> currentTime = <span class="number">0</span>, 
      startTime = <span class="number">0</span>,
      endTime = <span class="number">0</span>

  <span class="keyword">if</span> (calendarValue[<span class="number">0</span>]) &#123;
    currentTime = <span class="keyword">new</span> <span class="title class_">Date</span>(calendarValue[<span class="number">0</span>], calendarValue[<span class="number">1</span>], calendarValue[<span class="number">2</span>]).<span class="title function_">getTime</span>()
  &#125;
  <span class="keyword">if</span> (startDate[<span class="number">0</span>]) &#123;
    startTime = <span class="keyword">new</span> <span class="title class_">Date</span>(startDate[<span class="number">0</span>], startDate[<span class="number">1</span>], startDate[<span class="number">2</span>]).<span class="title function_">getTime</span>()
  &#125;
  <span class="keyword">if</span> (endDate[<span class="number">0</span>]) &#123;
    endTime = <span class="keyword">new</span> <span class="title class_">Date</span>(endDate[<span class="number">0</span>], endDate[<span class="number">1</span>], endDate[<span class="number">2</span>]).<span class="title function_">getTime</span>()
  &#125;

  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= max; i++) &#123;
    <span class="comment">// ä»¥ä¸‹çŠ¶æ€æ˜¯éœ€è¦åœ¨htmlä¸­åˆ¤æ–­å¤„ç†ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ”¹å˜</span>
    <span class="keyword">let</span> current = <span class="literal">false</span>, <span class="comment">// å½“å‰ç‚¹å‡»çŠ¶æ€</span>
      disabled = <span class="literal">false</span>, <span class="comment">// ç¦æ­¢çŠ¶æ€</span>
      now = <span class="literal">false</span>, <span class="comment">// ä»Šå¤©æ˜¾ç¤ºæ–‡æ¡ˆ</span>
      time = <span class="keyword">new</span> <span class="title class_">Date</span>(year, month, i).<span class="title function_">getTime</span>(),
      nowTime = [<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMonth</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getDate</span>()]
    <span class="keyword">if</span> (currentTime &amp;&amp; currentTime == time) current = <span class="literal">true</span>
    <span class="keyword">if</span> (startTime &amp;&amp; startTime &gt; time) disabled = <span class="literal">true</span>
    <span class="keyword">if</span> (endTime &amp;&amp; endTime &lt; time) disabled = <span class="literal">true</span>
    <span class="keyword">if</span> (year === nowTime[<span class="number">0</span>] &amp;&amp; month === nowTime[<span class="number">1</span>] &amp;&amp; i === nowTime[<span class="number">2</span>]) now = <span class="literal">true</span>

    days.<span class="title function_">push</span>(&#123;
      <span class="attr">day</span>: i,
      current,
      disabled,
      now,
    &#125;)
  &#125;

  <span class="comment">// å¡«å……æ¯æœˆæœ€åä¸€å¤©ä¹‹åçš„ç©ºæ•°æ®</span>
  <span class="keyword">if</span> (lastWeek != <span class="number">6</span>) &#123;
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = (<span class="number">6</span> - lastWeek); i &lt; l; i++) &#123;
      days.<span class="title function_">push</span>(&#123;
        <span class="attr">day</span>: <span class="number">0</span>
      &#125;)
    &#125;
  &#125;
  <span class="keyword">return</span> days
&#125;,

<span class="comment">/**</span>
<span class="comment"> * è·å–ä¸€ä¸ªæœˆæœ€å¤§å¤©æ•°</span>
<span class="comment"> * <span class="doctag">@method</span> <span class="variable">getMonthMax</span></span>
<span class="comment"> * <span class="doctag">@param</span>: &#123; number &#125; year å¹´ä»½</span>
<span class="comment"> * <span class="doctag">@param</span>: &#123; number &#125; month æœˆä»½</span>
<span class="comment"> */</span>
<span class="title function_">getMonthMax</span>(<span class="params">year, month</span>) &#123;
  <span class="keyword">let</span> max = <span class="number">31</span>
  <span class="keyword">if</span> (month == <span class="number">4</span> || month == <span class="number">6</span> || month == <span class="number">9</span> || month == <span class="number">11</span>) &#123;
    max = <span class="number">30</span>
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (month == <span class="number">2</span>) &#123;
    <span class="keyword">if</span> (((year % <span class="number">4</span>) == <span class="number">0</span> &amp;&amp; (year % <span class="number">100</span>) &gt; <span class="number">0</span>) || (year % <span class="number">400</span>) == <span class="number">0</span>) &#123;
      max = <span class="number">29</span>
    &#125; <span class="keyword">else</span> &#123;
      max = <span class="number">28</span>
    &#125; 
  &#125;

  <span class="keyword">return</span> max
&#125;,
</code></pre></li>
</ol>
<ul>
<li>ä»¥ä¸Šå°±æ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œåƒä¸€äº›å¼¹çª—äº‹ä»¶å’Œä¸€äº›ç‚¹å‡»äº‹ä»¶å°±ä¸é™„ä¸Šæ¥äº†</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºè“ç‰™æ§åˆ¶å¼€é—¨</title>
    <url>/2020/01/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%93%9D%E7%89%99%E6%8E%A7%E5%88%B6%E5%BC%80%E9%97%A8/</url>
    <content><![CDATA[<h2 id="å°ç¨‹åºä½åŠŸè€—è“ç‰™æ§åˆ¶å¼€é—¨"><a href="#å°ç¨‹åºä½åŠŸè€—è“ç‰™æ§åˆ¶å¼€é—¨" class="headerlink" title="å°ç¨‹åºä½åŠŸè€—è“ç‰™æ§åˆ¶å¼€é—¨"></a>å°ç¨‹åºä½åŠŸè€—è“ç‰™æ§åˆ¶å¼€é—¨</h2><h3 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h3><blockquote>
<ol>
<li>åˆå§‹åŒ–è“ç‰™æ¨¡å—<code>openBluetoothAdapter</code></li>
<li>è·å–æœ¬æœºè“ç‰™é€‚é…å™¨çŠ¶æ€<code>getBluetoothAdapterState</code></li>
<li>æœç´¢å¤–å›´è“ç‰™è®¾å¤‡<code>startBluetoothDevicesDiscovery</code></li>
<li>ç›‘å¬å¯»æ‰¾åˆ°æ–°è®¾å¤‡<code>onBluetoothDeviceFound</code></li>
<li>è¿æ¥è“ç‰™<code>createBLEConnection</code></li>
<li>è·å–è“ç‰™è®¾å¤‡çš„æœåŠ¡<code>getBLEDeviceServices</code></li>
<li>è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼<code>getBLEDeviceCharacteristics</code></li>
<li>å¯ç”¨ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½<code>notifyBLECharacteristicValueChange</code></li>
<li>å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®<code>writeBLECharacteristicValue</code></li>
<li>å…³é—­è“ç‰™æ¨¡å—<code>closeBluetoothAdapter</code></li>
</ol>
</blockquote>
<h3 id="1-åˆå§‹åŒ–è“ç‰™æ¨¡å—"><a href="#1-åˆå§‹åŒ–è“ç‰™æ¨¡å—" class="headerlink" title="1. åˆå§‹åŒ–è“ç‰™æ¨¡å—"></a>1. åˆå§‹åŒ–è“ç‰™æ¨¡å—</h3><ul>
<li>åˆå§‹åŒ–è“ç‰™æ¨¡å—ä½¿ç”¨çš„æ˜¯ï¼š<code>wx.openBluetoothAdapter</code>ï¼Œåˆå§‹åŒ–ä¹‹å‰å¯¹è“ç‰™åŠŸèƒ½åšä¸€ä¸ªåˆ¤æ–­ï¼Œçœ‹æ‰‹æœºå¾®ä¿¡ç‰ˆæœ¬æ˜¯å¦æ”¯æŒæ­¤åŠŸèƒ½</li>
<li>åˆå§‹åŒ–ä¹‹å‰éœ€è¦å…³é—­è“ç‰™æ¨¡å—ï¼š<code>wx.closeBluetoothAdapter</code>ï¼Œå¦åˆ™å®¹æ˜“æœç´¢å¤±è´¥<pre><code class="highlight js"><span class="keyword">var</span> _this = <span class="variable language_">this</span>
<span class="keyword">if</span> (!wx.<span class="property">openBluetoothAdapter</span>) &#123;
  wx.<span class="title function_">showModal</span>(&#123;
    <span class="attr">title</span>: <span class="string">&#x27;æç¤º&#x27;</span>,
    <span class="attr">showCancel</span>: <span class="literal">false</span>,
    <span class="attr">content</span>: <span class="string">&#x27;å½“å‰å¾®ä¿¡ç‰ˆæœ¬è¿‡ä½ï¼Œæ— æ³•ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œè¯·å‡çº§åˆ°æœ€æ–°å¾®ä¿¡ç‰ˆæœ¬åé‡è¯•&#x27;</span>,
  &#125;)
&#125; <span class="keyword">else</span> &#123;
  wx.<span class="title function_">closeBluetoothAdapter</span>(&#123;
    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
      wx.<span class="title function_">openBluetoothAdapter</span>(&#123; <span class="comment">// åˆå§‹åŒ–è“ç‰™æ¨¡å—</span>
        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆå§‹åŒ–è“ç‰™æˆåŠŸ&#x27;</span>)
          _this.<span class="title function_">getBluetoothAdapterState</span>()
        &#125;,
        <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
          <span class="variable language_">console</span>.<span class="title function_">log</span>(err)
        &#125;
      &#125;)
    &#125;,
  &#125;)
&#125;</code></pre></li>
</ul>
<h3 id="2-è·å–æœ¬æœºè“ç‰™é€‚é…å™¨çŠ¶æ€"><a href="#2-è·å–æœ¬æœºè“ç‰™é€‚é…å™¨çŠ¶æ€" class="headerlink" title="2. è·å–æœ¬æœºè“ç‰™é€‚é…å™¨çŠ¶æ€"></a>2. è·å–æœ¬æœºè“ç‰™é€‚é…å™¨çŠ¶æ€</h3><ul>
<li>è·å–æœ¬æœºè“ç‰™é€‚é…å™¨çŠ¶æ€ä½¿ç”¨çš„æ˜¯<code>wx.getBluetoothAdapterState</code>ï¼Œè°ƒç”¨æˆåŠŸåï¼Œä¼šè¿”å›ä¸¤ä¸ªå‚æ•°<ul>
<li><code>discovering</code>åˆ¤æ–­æ˜¯å¦æ­£åœ¨æœç´¢è®¾å¤‡</li>
<li><code>available</code>åˆ¤æ–­è“ç‰™é€‚é…å™¨æ˜¯å¦å¯ç”¨<pre><code class="highlight js"><span class="attr">getBluetoothAdapterState</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;
  <span class="keyword">var</span> _this = <span class="variable language_">this</span>
  wx.<span class="title function_">getBluetoothAdapterState</span>(&#123;
    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
      <span class="keyword">if</span> (res.<span class="property">available</span> == <span class="literal">false</span>) &#123;
        wx.<span class="title function_">showToast</span>(&#123;
          <span class="attr">title</span>: <span class="string">&#x27;è®¾å¤‡æ— æ³•å¼€å¯è“ç‰™è¿æ¥&#x27;</span>,
          <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,
          <span class="attr">duration</span>: <span class="number">2000</span>
        &#125;)
        wx.<span class="title function_">closeBluetoothAdapter</span>()
      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">discovering</span> == <span class="literal">false</span>) &#123;
        _this.<span class="title function_">startBluetoothDevicesDiscovery</span>() <span class="comment">// å¼€å¯æœç´¢å¤–å›´è®¾å¤‡</span>
      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">available</span>)&#123;
        _this.<span class="title function_">startBluetoothDevicesDiscovery</span>() <span class="comment">// è“ç‰™é€‚é…å™¨æ­£å¸¸ï¼Œå»æ‰§è¡Œæœç´¢å¤–å›´è®¾å¤‡</span>
      &#125;
    &#125;
  &#125;)
&#125;</code></pre></li>
</ul>
</li>
</ul>
<h3 id="3-æœç´¢å¤–å›´è“ç‰™è®¾å¤‡"><a href="#3-æœç´¢å¤–å›´è“ç‰™è®¾å¤‡" class="headerlink" title="3. æœç´¢å¤–å›´è“ç‰™è®¾å¤‡"></a>3. æœç´¢å¤–å›´è“ç‰™è®¾å¤‡</h3><ul>
<li>æœç´¢å¤–å›´è“ç‰™è®¾å¤‡ä½¿ç”¨çš„æ˜¯<code>wx.startBluetoothDevicesDiscovery</code>ï¼Œè¿æ¥è®¾å¤‡åä¸€å®šè¦ä½¿ç”¨<code>wx.stopBluetoothDevicesDiscovery</code>åœæ­¢æœç´¢<pre><code class="highlight js"><span class="attr">startBluetoothDevicesDiscovery</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;
    <span class="keyword">var</span> _this = <span class="variable language_">this</span>
    wx.<span class="title function_">startBluetoothDevicesDiscovery</span>(&#123;
      <span class="attr">allowDuplicatesKey</span>: <span class="literal">false</span>,
      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
        <span class="keyword">if</span>(!res.<span class="property">isDiscovering</span>)&#123; <span class="comment">// æ˜¯å¦åœ¨æœç´¢è®¾å¤‡</span>
          _this.<span class="title function_">getBluetoothAdapterState</span>()
        &#125;<span class="keyword">else</span>&#123;
          _this.<span class="title function_">onBluetoothDeviceFound</span>() <span class="comment">// æœç´¢æˆåŠŸåï¼Œæ‰§è¡Œç›‘å¬è®¾å¤‡çš„api</span>
        &#125;
      &#125;,
      <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è“ç‰™æœå¯»å¤±è´¥&quot;</span>)
        wx.<span class="title function_">stopBluetoothDevicesDiscovery</span>() <span class="comment">// æ²¡æœ‰æœç´¢åˆ°è®¾å¤‡</span>
        wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// å…³é—­è“ç‰™æ¨¡å—</span>
      &#125;
    &#125;)
&#125;</code></pre></li>
</ul>
<h3 id="4-ç›‘å¬å¯»æ‰¾åˆ°æ–°è®¾å¤‡"><a href="#4-ç›‘å¬å¯»æ‰¾åˆ°æ–°è®¾å¤‡" class="headerlink" title="4. ç›‘å¬å¯»æ‰¾åˆ°æ–°è®¾å¤‡"></a>4. ç›‘å¬å¯»æ‰¾åˆ°æ–°è®¾å¤‡</h3><ul>
<li>ç›‘å¬å¯»æ‰¾åˆ°æ–°è®¾å¤‡ä½¿ç”¨çš„æ˜¯<code>wx.onBluetoothDeviceFound</code>ï¼Œæ¯æœåˆ°ä¸€ä¸ªæ–°è®¾å¤‡å°±ä¼šè§¦å‘ä¸€æ¬¡ï¼Œç„¶åè¿”å›ä¸€ä¸ªæœç´¢åˆ°çš„è®¾å¤‡åˆ—è¡¨ï¼ŒåŒ…å«äº†è®¾å¤‡åç§°å’Œmacåœ°å€ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨è®¾å¤‡åç§°å’Œmacåœ°å€æ¥åŒ¹é…è®¾å¤‡çš„<ul>
<li>å®‰å“å’ŒIOSè¿”å›çš„deviceIdä¸ä¸€æ ·ï¼Œå®‰å“è¿”å›çš„æ˜¯macåœ°å€ï¼ŒIOSè¿”å›çš„æ˜¯UUIDï¼Œå¦‚æœæƒ³é€šè¿‡macåœ°å€æ¥åŒ¹é…è®¾å¤‡ï¼Œå¯ä»¥è®©macåœ°å€å­˜å‚¨åœ¨<code>advertisData</code>æ•°æ®æ®µä¸­ï¼Œç„¶åè§£æè¿™ä¸ªæ•°æ®æ®µå¾—åˆ°macåœ°å€</li>
<li>æˆ‘ä½¿ç”¨çš„æ˜¯é€šè¿‡è®¾å¤‡åç§°æ¥è¿›è¡ŒåŒ¹é…<pre><code class="highlight js"><span class="attr">onBluetoothDeviceFound</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;
  <span class="keyword">var</span> _this = <span class="variable language_">this</span>
  wx.<span class="title function_">onBluetoothDeviceFound</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;
    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;res.<span class="property">devices</span>.<span class="property">length</span>; i++)&#123;
      <span class="keyword">if</span>(res.<span class="property">devices</span>[i].<span class="property">name</span> == <span class="string">&quot;è®¾å¤‡åç§°&quot;</span> || res.<span class="property">devices</span>[i].<span class="property">localName</span> == <span class="string">&quot;è®¾å¤‡åç§°&quot;</span>)&#123;
        _this.<span class="title function_">setData</span>(&#123;
          <span class="attr">deviceId</span>: res.<span class="property">devices</span>[i].<span class="property">deviceId</span> <span class="comment">// æŠŠåŒ¹é…è®¾å¤‡çš„deviceIdå­˜åˆ°dataä¸­</span>
        &#125;)
        wx.<span class="title function_">stopBluetoothDevicesDiscovery</span>() <span class="comment">// åŒ¹é…åˆ°è®¾å¤‡åå…³é—­æœç´¢</span>
        _this.<span class="title function_">createBLEConnection</span>() <span class="comment">// è¿æ¥è“ç‰™</span>
      &#125;
    &#125;
  &#125;)
&#125;</code></pre></li>
</ul>
</li>
</ul>
<h3 id="5-è¿æ¥è“ç‰™"><a href="#5-è¿æ¥è“ç‰™" class="headerlink" title="5. è¿æ¥è“ç‰™"></a>5. è¿æ¥è“ç‰™</h3><ul>
<li>è¿æ¥è“ç‰™ä½¿ç”¨çš„æ˜¯<code>wx.createBLEConnection</code>ï¼Œè¿æ¥è“ç‰™æ˜¯é€šè¿‡<code>deviceId</code>è¿æ¥ï¼Œ<code>deviceId</code>æ˜¯é€šè¿‡<code>wx.onBluetoothDeviceFound</code>è·å–çš„</li>
<li>è¿æ¥è“ç‰™å®¹æ˜“å¤±è´¥ï¼Œæ‰€ä»¥å¯ä»¥å®šä¸€ä¸ªå˜é‡<code>count</code>ç”¨æ¥è®¡ç®—è¿æ¥çš„æ¬¡æ•°ï¼Œå¦‚æœè¶…å‡ºç‰¹å®šçš„æ¬¡æ•°å°±åˆ¤æ–­ä¸ºè¿æ¥å¤±è´¥ï¼Œå…³é—­è“ç‰™æ¨¡å—<pre><code class="highlight js"><span class="attr">createBLEConnection</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// è¿æ¥ä½åŠŸè€—è“ç‰™</span>
  <span class="keyword">var</span> _this = <span class="variable language_">this</span>
  wx.<span class="title function_">createBLEConnection</span>(&#123;
    <span class="attr">deviceId</span>: _this.<span class="property">data</span>.<span class="property">deviceId</span>,
    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
      _this.<span class="title function_">getBLEDeviceServices</span>()
    &#125;,
    <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>)
      <span class="keyword">if</span>( count &lt; <span class="number">6</span> )&#123;
        count++
        _this.<span class="title function_">createBLEConnection</span>()
      &#125;<span class="keyword">else</span>&#123;
        wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// è¿æ¥å¤±è´¥å…³é—­è“ç‰™æ¨¡å—</span>
      &#125;
    &#125;
  &#125;)
&#125;</code></pre></li>
</ul>
<h3 id="6-è·å–è“ç‰™è®¾å¤‡çš„æœåŠ¡"><a href="#6-è·å–è“ç‰™è®¾å¤‡çš„æœåŠ¡" class="headerlink" title="6. è·å–è“ç‰™è®¾å¤‡çš„æœåŠ¡"></a>6. è·å–è“ç‰™è®¾å¤‡çš„æœåŠ¡</h3><ul>
<li>è·å–è“ç‰™è®¾å¤‡çš„æœåŠ¡åˆ—è¡¨ä½¿ç”¨çš„æ˜¯<code>wx.getBLEDeviceServices</code><pre><code class="highlight js"><span class="attr">getBLEDeviceServices</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;
  <span class="keyword">var</span> _this = <span class="variable language_">this</span>
  wx.<span class="title function_">getBLEDeviceServices</span>(&#123;
    <span class="attr">deviceId</span>: _this.<span class="property">data</span>.<span class="property">deviceId</span>,
    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
      <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;res.<span class="property">services</span>.<span class="property">length</span>; i++)&#123;
        <span class="comment">// å¦‚æœæå‰å¾—çŸ¥å¯ä»¥ç›´æ¥åˆ¤æ–­ï¼Œå¦‚æœä¸çŸ¥é“å¯ä»¥ç”¨è“ç‰™å·¥å…·çœ‹ä¸€ä¸‹æœåŠ¡æ‰€éœ€çš„åŠŸèƒ½</span>
        <span class="keyword">if</span>(res.<span class="property">services</span>[i].<span class="property">uuid</span> == _this.<span class="property">data</span>.<span class="property">service</span>)&#123;
          _this.<span class="title function_">setData</span>(&#123;
            <span class="attr">serviceId</span>: res.<span class="property">services</span>[i].<span class="property">uuid</span>
          &#125;)
          _this.<span class="title function_">getBLEDeviceCharacteristics</span>()
        &#125;   
      &#125;
    &#125;,
    <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·å–æœåŠ¡å¤±è´¥&quot;</span>)
      wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// å…³é—­è“ç‰™æ¨¡å—</span>
    &#125;
  &#125;)
&#125;,</code></pre></li>
</ul>
<h3 id="7-è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼"><a href="#7-è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼" class="headerlink" title="7. è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼"></a>7. è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼</h3><ul>
<li>è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼ä½¿ç”¨çš„æ˜¯<code>wx.getBLEDeviceCharacteristics</code><pre><code class="highlight js"><span class="attr">getBLEDeviceCharacteristics</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼</span>
  <span class="keyword">var</span> _this = <span class="variable language_">this</span>
  wx.<span class="title function_">getBLEDeviceCharacteristics</span>(&#123;
    <span class="attr">deviceId</span>: _this.<span class="property">data</span>.<span class="property">deviceId</span>,
    <span class="attr">serviceId</span>: _this.<span class="property">data</span>.<span class="property">serviceId</span>,
    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
      <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;res.<span class="property">characteristics</span>.<span class="property">length</span>; i++)&#123;
        <span class="keyword">let</span> model = res.<span class="property">characteristics</span>[i]
        <span class="keyword">if</span> ((model.<span class="property">properties</span>.<span class="property">notify</span> || model.<span class="property">properties</span>.<span class="property">indicate</span>) &amp;&amp; (model.<span class="property">properties</span>.<span class="property">read</span> &amp;&amp; model.<span class="property">properties</span>.<span class="property">write</span>))&#123;
          _this.<span class="title function_">setData</span>(&#123;
            <span class="attr">characteristicId</span>: model.<span class="property">uuid</span>
          &#125;)
          _this.<span class="title function_">notifyBLECharacteristicValueChange</span>()
        &#125;
      &#125;
    &#125;,
    <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·å–æœåŠ¡ä¸­çš„ç‰¹å¾å€¼å¤±è´¥&quot;</span>)
      wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// å…³é—­è“ç‰™æ¨¡å—</span>
    &#125;
  &#125;)
&#125;,</code></pre></li>
</ul>
<h3 id="8-å¯ç”¨ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½"><a href="#8-å¯ç”¨ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½" class="headerlink" title="8. å¯ç”¨ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½"></a>8. å¯ç”¨ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½</h3><ul>
<li>å¯ç”¨ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½ä½¿ç”¨çš„æ˜¯<code>wx.notifyBLECharacteristicValueChange</code><pre><code class="highlight js"><span class="attr">notifyBLECharacteristicValueChange</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// å¯ç”¨è“ç‰™ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½</span>
    <span class="keyword">var</span> _this = <span class="variable language_">this</span>
    wx.<span class="title function_">notifyBLECharacteristicValueChange</span>(&#123;
      <span class="attr">deviceId</span>: _this.<span class="property">data</span>.<span class="property">deviceId</span>,
      <span class="attr">serviceId</span>: _this.<span class="property">data</span>.<span class="property">serviceId</span>,
      <span class="attr">characteristicId</span>: _thisa.<span class="property">characteristicId</span>,
      <span class="attr">state</span>: <span class="literal">true</span>,
      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
        wx.<span class="title function_">onBLECharacteristicValueChange</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;
            <span class="variable language_">console</span>.<span class="title function_">log</span>(å¦‚æœè¦æ‰“å°éœ€è¦ä»arraybufferæ ¼å¼è½¬ä¸ºå­—ç¬¦ä¸²æˆ–<span class="number">16</span>è¿›åˆ¶)
        &#125;)
        _this.<span class="title function_">writeBLECharacteristicValue</span>() <span class="comment">// å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®</span>
      &#125;,
      <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¯ç”¨BLEè“ç‰™ç‰¹å¾å€¼å˜åŒ–æ—¶çš„notifyåŠŸèƒ½é”™è¯¯&quot;</span>)
        wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// å…³é—­è“ç‰™æ¨¡å—</span>
      &#125;
    &#125;)</code></pre></li>
</ul>
<h3 id="9-å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®"><a href="#9-å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®" class="headerlink" title="9. å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®"></a>9. å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®</h3><ul>
<li>å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®<code>wx.writeBLECharacteristicValue</code>ï¼Œè¿™æ—¶å€™å°±æ˜¯è¾“å…¥æå‰è®¾å®šå¥½çš„æŒ‡ä»¤<pre><code class="highlight js"><span class="attr">writeBLECharacteristicValue</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// å‘è“ç‰™è®¾å¤‡å†™å…¥æ•°æ®</span>
  <span class="keyword">var</span> _this = <span class="variable language_">this</span>
  wx.<span class="title function_">writeBLECharacteristicValue</span>(&#123;
    <span class="attr">deviceId</span>: _this.<span class="property">data</span>.<span class="property">deviceId</span>,
    <span class="attr">serviceId</span>: _this.<span class="property">data</span>.<span class="property">serviceId</span>,
    <span class="attr">characteristicId</span>: _this.<span class="property">data</span>.<span class="property">characteristicId</span>,
    <span class="attr">value</span>: buffer, <span class="comment">// è¿™ä¸ªè¾“å…¥çš„æŒ‡ä»¤ï¼Œéœ€è¦è½¬æ¢æˆArrayBuffer</span>
    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æˆåŠŸ&quot;</span>)
      wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// å…³é—­è“ç‰™æ¨¡å—</span>
    &#125;,
    <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¾“å…¥æŒ‡ä»¤å¤±è´¥&quot;</span>)
      wx.<span class="title function_">closeBluetoothAdapter</span>() <span class="comment">// å…³é—­è“ç‰™æ¨¡å—</span>
    &#125;
  &#125;)
&#125;</code></pre></li>
</ul>
<h3 id="è½¬æ¢æ ¼å¼"><a href="#è½¬æ¢æ ¼å¼" class="headerlink" title="è½¬æ¢æ ¼å¼"></a>è½¬æ¢æ ¼å¼</h3><ul>
<li><p>å­—ç¬¦ä¸²è½¬ä¸ºarraybuffer</p>
<pre><code class="highlight js"><span class="attr">string2buffer</span>: <span class="keyword">function</span> (<span class="params">str</span>) &#123;
    <span class="comment">// é¦–å…ˆå°†å­—ç¬¦ä¸²è½¬ä¸º16è¿›åˆ¶</span>
    <span class="keyword">let</span> val = <span class="string">&quot;&quot;</span>
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.<span class="property">length</span>; i++) &#123;
      <span class="keyword">if</span> (val === <span class="string">&#x27;&#x27;</span>) &#123;
        val = str.<span class="title function_">charCodeAt</span>(i).<span class="title function_">toString</span>(<span class="number">16</span>)
      &#125; <span class="keyword">else</span> &#123;
        val += <span class="string">&#x27;,&#x27;</span> + str.<span class="title function_">charCodeAt</span>(i).<span class="title function_">toString</span>(<span class="number">16</span>)
      &#125;
    &#125;
    <span class="comment">// å°†16è¿›åˆ¶è½¬åŒ–ä¸ºArrayBuffer</span>
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(val.<span class="title function_">match</span>(<span class="regexp">/[\da-f]&#123;2&#125;/gi</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">h</span>) &#123;
      <span class="keyword">return</span> <span class="built_in">parseInt</span>(h, <span class="number">16</span>)
    &#125;)).<span class="property">buffer</span>
&#125;</code></pre>
</li>
<li><p>arraybufferè½¬ä¸ºå­—ç¬¦ä¸²</p>
<pre><code class="highlight js"><span class="keyword">function</span> <span class="title function_">ab2str</span>(<span class="params">u,f</span>) &#123;
   <span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Blob</span>([u]);
   <span class="keyword">var</span> r = <span class="keyword">new</span> <span class="title class_">FileReader</span>();
    r.<span class="title function_">readAsText</span>(b, <span class="string">&#x27;utf-8&#x27;</span>);
    r.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;<span class="keyword">if</span>(f)f.<span class="title function_">call</span>(<span class="literal">null</span>,r.<span class="property">result</span>)&#125;
&#125;</code></pre></li>
</ul>
<h3 id="è“ç‰™é‡è§çš„å‘"><a href="#è“ç‰™é‡è§çš„å‘" class="headerlink" title="è“ç‰™é‡è§çš„å‘"></a>è“ç‰™é‡è§çš„å‘</h3><ul>
<li>1.è‹¹æœæ‰‹æœºæœ‰æ—¶å€™è¾“å…¥æŒ‡ä»¤ä¼šæ˜¾ç¤ºå‘é€æˆåŠŸï¼Œä½†æ˜¯è®¾å¤‡å¹¶æ²¡æœ‰ååº”<ul>
<li><pre><code>è§£å†³æ–¹æ³•ï¼šæŠŠéœ€è¦è¾“å…¥çš„æŒ‡ä»¤æ”¹æˆæ¯10æ¯«ç§’è¾“å…¥ä¸€ä¸ªå­—èŠ‚
</code></pre>
</li>
<li>å¦‚æœæ”¹æˆæ¯10æ¯«ç§’è¾“å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œå®‰å“æ‰‹æœºå°±ä¼šé¢‘ç¹å‡ºç°10008é”™è¯¯</li>
<li>é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ç”¨äº†ä¸€ä¸ªä¸å¤ªå¥½çš„æ–¹æ³•ï¼Œæˆ‘åˆ¤æ–­äº†ä¸€ä¸‹æ‰‹æœºçš„ç±»å‹ï¼Œå¦‚æœæ˜¯iosçš„å°±åˆ†10æ¯«ç§’è¾“å…¥ï¼Œå¦‚æœæ˜¯å®‰å“çš„å°±ä¸€æ¬¡æ€§è¾“å…¥</li>
</ul>
</li>
<li>2.åœ¨è°ƒç”¨<code>wx.onBluetoothDeviceFound</code>è¿™ä¸ªapiæ—¶iosä¼šç›‘å¬ä¸¤æ¬¡ï¼Œç„¶åå°±ä¼šå¯¼è‡´æœ€åè®¾å¤‡ä¼šæœ‰ä¸¤æ¬¡æŒ‡ä»¤è¾“å…¥<ul>
<li>è§£å†³æ–¹æ³•ï¼šæˆ‘åœ¨æœç´¢è“ç‰™è®¾å¤‡ä¹‹å‰åšäº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç„¶åç”¨<code>getBluetoothDevices</code>æ¥æŸ¥çœ‹æ‰€æœ‰å·²æœç´¢åˆ°çš„è“ç‰™ï¼Œåœ¨è¿™ä¸ªé‡Œé¢åšåˆ¤æ–­æ¥è¿æ¥è“ç‰™è®¾å¤‡</li>
</ul>
</li>
<li>æˆ‘ä¸Šé¢çš„æ­¥éª¤æ²¡æœ‰æŠŠè¿™äº›å‘çš„è§£å†³æ­¥éª¤åŠ ä¸Šï¼Œå¦‚æœç¢°è§æ­¤ç±»é—®é¢˜ï¼Œå¯ä»¥è‡ªå·±åœ¨åˆé€‚çš„ä½ç½®ä¿®æ”¹ä¸€ä¸‹</li>
</ul>
<h3 id="äºŒç»´ç "><a href="#äºŒç»´ç " class="headerlink" title="äºŒç»´ç "></a>äºŒç»´ç </h3><p>æˆ‘è‡ªå·±åšäº†ä¸€ä¸ªå°ç¨‹åºçš„è“ç‰™è°ƒè¯•å™¨ï¼Œä¸‹é¢æ˜¯å°ç¨‹åºç ï¼Œæ¬¢è¿å¤§å®¶ä½“éªŒ<br><img src="https://img-blog.csdnimg.cn/20200123154720532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDcxOTI1OA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
        <tag>è“ç‰™</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³reactçŠ¶æ€ç®¡ç†---React Query</title>
    <url>/2021/06/12/%E8%A7%A3%E5%86%B3react%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86-ReactQuery/</url>
    <content><![CDATA[<p><img src="https://img-blog.csdnimg.cn/20210612171112847.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDcxOTI1OA==,size_16,color_FFFFFF,t_70#pic_center" alt="React Query"></p>
<h3 id="ä»€ä¹ˆæ˜¯React-Query"><a href="#ä»€ä¹ˆæ˜¯React-Query" class="headerlink" title="ä»€ä¹ˆæ˜¯React Query"></a>ä»€ä¹ˆæ˜¯React Query</h3><ul>
<li><code>react-query</code>æ˜¯ä¸€ä¸ªé€‚ç”¨äºreact hooksçš„è¯·æ±‚åº“ï¼Œå®ƒå¯ä»¥ä¸ºä»»ä½•ç±»å‹çš„å¼‚æ­¥æ•°æ®æä¾›ReactçŠ¶æ€ç®¡ç†åŠŸèƒ½ï¼Œä½¿Reactä¸­çš„è·å–ã€ç¼“å­˜ã€åŒæ­¥å’Œæ›´æ–°æœåŠ¡å™¨æ•°æ®å˜å¾—è½»è€Œæ˜“ä¸¾</li>
<li><code>react-query</code>ä¸ä¸€äº›ä¼ ç»Ÿçš„çŠ¶æ€ç®¡ç†åº“å¦‚redux,mobxä¸åŒï¼Œå®ƒæ˜¯è´Ÿè´£ç®¡ç†æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„çŠ¶æ€ï¼Œä¸€äº›ç”¨æˆ·äº¤äº’çš„ä¸­é—´çŠ¶æ€ï¼Œå¦‚loadingçŠ¶æ€ï¼Œé”™è¯¯ä¿¡æ¯ç­‰éƒ½æ˜¯é€šè¿‡hooksç›´æ¥è¿”å›</li>
<li><a href="https://react-query-v2.tanstack.com/">React Queryå®˜ç½‘</a></li>
</ul>
<h3 id="åˆæ­¥ä½¿ç”¨"><a href="#åˆæ­¥ä½¿ç”¨" class="headerlink" title="åˆæ­¥ä½¿ç”¨"></a>åˆæ­¥ä½¿ç”¨</h3><ol>
<li><code>yarn add react-query</code> or <code>npm i react-query</code>å®‰è£…react-query</li>
<li>ä½¿ç”¨<code>QueryClientProvider</code>ç»„ä»¶è¿æ¥å¹¶æä¾›ä¸€ä¸ª<code>QueryClient</code>åˆ°ä½ çš„åº”ç”¨ç¨‹åº<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">QueryClient</span>, <span class="title class_">QueryClientProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-query&#x27;</span>

&lt;<span class="title class_">QueryClientProvider</span> client=&#123;<span class="keyword">new</span> <span class="title class_">QueryClient</span>()&#125;&gt;
  &#123; ... &#125;
&lt;/<span class="title class_">QueryClientProvider</span>&gt;</code></pre></li>
</ol>
<h4 id="Devtools"><a href="#Devtools" class="headerlink" title="Devtools"></a>Devtools</h4><ul>
<li><code>yarn add react-query-devtools</code> or <code>npm i --save react-query-devtools</code>å®‰è£…Devtools</li>
<li><code>react-query-devtools</code>æ˜¯ä¸<code>react-query</code>ç›¸åŒ¹é…çš„å¼€å‘å·¥å…·</li>
<li>å¯åœ¨å¼€å‘ä¸­å®æ—¶æŸ¥çœ‹ç¼“å­˜ï¼Œæ‰‹åŠ¨è·å–å’Œåˆ é™¤æŸ¥è¯¢ç­‰ç­‰<pre><code class="highlight js"><span class="keyword">import</span> &#123; <span class="title class_">ReactQueryDevtools</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-query-devtools&#x27;</span>

<span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">return</span> (
    <span class="language-xml"><span class="tag">&lt;&gt;</span>    </span>
<span class="language-xml">      &#123; ... &#125;</span>
<span class="language-xml">      <span class="tag">&lt;<span class="name">ReactQueryDevtools</span> <span class="attr">initialIsOpen</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;/&gt;</span></span>
  );
&#125;;</code></pre></li>
</ul>
<h3 id="å¢åˆ æ”¹æŸ¥"><a href="#å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¢åˆ æ”¹æŸ¥"></a>å¢åˆ æ”¹æŸ¥</h3><ul>
<li>react-queryæœ€å¸¸ç”¨çš„ä¸¤ä¸ªhookï¼ŒæŸ¥è¯¢(<code>useQuery</code>)ã€å¢åˆ æ”¹(<code>useMutation</code>)</li>
</ul>
<h4 id="useQuery"><a href="#useQuery" class="headerlink" title="useQuery"></a>useQuery</h4><ul>
<li><code>useQuery</code>ï¼šåœ¨<code>React Query</code>ä¸­ï¼ŒæŸ¥è¯¢æ˜¯å¯¹æŸäº›å¼‚æ­¥æ•°æ®æºçš„å£°æ˜æ€§ä¾èµ–ã€‚æŸ¥è¯¢å¯ä»¥ä¸ä»»ä½•åŸºäºPromiseçš„æ–¹æ³•(GET)ä¸€èµ·ä½¿ç”¨ï¼Œä»æœåŠ¡å™¨è·å–æ•°æ®<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">useTodos</span> = (<span class="params">param</span>) =&gt; &#123;
  <span class="keyword">const</span> request = <span class="title function_">useHttp</span>()

  <span class="comment">/**</span>
<span class="comment">   * ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯QueryKeyï¼Œæ˜¯æŸ¥è¯¢çš„å…³é”®ï¼Œæ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„keyï¼Œå¹¶åœ¨ä¹‹åçš„å¢åˆ æ”¹ä¸­éœ€è¦ï¼Œ</span>
<span class="comment">   *   å¦‚æœéœ€è¦åŠ¨æ€çš„QueryKeyï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„çš„æ–¹å¼ï¼Œå¦‚[&#x27;todos&#x27;, params]</span>
<span class="comment">   * ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨äºè·å–æ•°æ®çš„å¼‚æ­¥å‡½æ•°</span>
<span class="comment">   * useQueryçš„å“åº”è¿”å›å°±æ˜¯è·å–åˆ°çš„æ•°æ®å’Œä¸€äº›ä¸­é—´çŠ¶æ€ï¼Œå¦‚isLoadingï¼Œerrorï¼ŒisIdle...</span>
<span class="comment">   */</span>
  <span class="keyword">return</span> <span class="title function_">useQuery</span>(<span class="string">&#x27;todos&#x27;</span>, <span class="function">() =&gt;</span>
    <span class="title function_">request</span>(<span class="string">&#x27;todos&#x27;</span>, &#123; <span class="attr">data</span>: param &#125;)
  )
&#125;

<span class="comment">// åœ¨UIç»„ä»¶è°ƒç”¨</span>
<span class="keyword">const</span> &#123; isLoading, error, <span class="attr">data</span>: todos &#125; = <span class="title function_">useTodos</span>()</code></pre></li>
</ul>
<h4 id="useMutation"><a href="#useMutation" class="headerlink" title="useMutation"></a>useMutation</h4><ul>
<li><code>useMutation</code>ï¼šå¸¸ç”¨äºåˆ›å»º&#x2F;æ›´æ–°&#x2F;åˆ é™¤æ•°æ®æˆ–æ‰§è¡ŒæœåŠ¡å™¨å‰¯ä½œç”¨<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">useAddTodo</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> request = <span class="title function_">useHttp</span>()

  <span class="comment">/**</span>
<span class="comment">   * ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰§è¡Œæ“ä½œçš„å¼‚æ­¥å‡½æ•°ï¼Œåœ¨è¿”å›çš„mutateä¸­è§¦å‘</span>
<span class="comment">   * ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰§è¡ŒæˆåŠŸæˆ–è€…å¤±è´¥çš„ä¸€äº›é…ç½®å‡½æ•°ï¼Œå¯ç”¨äºä¸€äº›å¤„ç†ç¼“å­˜çš„æ“ä½œï¼Œä¾‹å¦‚ä¹è§‚æ›´æ–°</span>
<span class="comment">   */</span>
  <span class="keyword">return</span> <span class="title function_">useMutation</span>(
    <span class="function">(<span class="params">data</span>) =&gt;</span>
      <span class="title function_">request</span>(<span class="string">`todos`</span>, &#123;
        data,
        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,
      &#125;),
    &#123;
      <span class="title function_">onSuccess</span>(<span class="params"></span>)&#123;&#125;
      <span class="title function_">onError</span>(<span class="params"></span>)&#123;&#125;
      <span class="title function_">onSettled</span>(<span class="params"></span>)&#123;&#125;
      ...
    &#125;
  )
&#125;

<span class="comment">// æ“ä½œç»„ä»¶è°ƒç”¨</span>
<span class="keyword">const</span> <span class="title function_">TodosAddBtn</span> = (<span class="params"></span>) =&gt; &#123;
  ...
  <span class="keyword">const</span> &#123; mutateAsync, isLoading, error &#125; = <span class="title function_">useAddTodo</span>()
  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> mutateAsync(todoData)&#125;&gt;add<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span>
&#125;</code></pre></li>
</ul>
<h5 id="ä¾‹ï¼šç”¨ç¬¬äºŒä¸ªå‚æ•°é…ç½®ä¹è§‚æ›´æ–°"><a href="#ä¾‹ï¼šç”¨ç¬¬äºŒä¸ªå‚æ•°é…ç½®ä¹è§‚æ›´æ–°" class="headerlink" title="ä¾‹ï¼šç”¨ç¬¬äºŒä¸ªå‚æ•°é…ç½®ä¹è§‚æ›´æ–°"></a>ä¾‹ï¼šç”¨ç¬¬äºŒä¸ªå‚æ•°é…ç½®ä¹è§‚æ›´æ–°</h5><ul>
<li>ä¹è§‚æ›´æ–°å°±æ˜¯åœ¨ä¸€äº›è¯·æ±‚æˆ–è€…æ•°æ®å¤„ç†æ²¡æœ‰ç»“æŸçš„æ—¶å€™ï¼Œæå‰ç»™ç”¨æˆ·æ˜¾ç¤ºç†æƒ³çš„ç»“æœï¼Œå¦‚æœå¤±è´¥å°±å›æ»šæ›´æ–°<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">useAddConfig</span> = (<span class="params">queryKey</span>) =&gt; &#123;
  <span class="comment">// è·å–å½“å‰QueryClientçš„å®ä¾‹</span>
  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>()
  
  <span class="keyword">return</span> &#123;
    <span class="comment">// å½“mutateè¢«è°ƒç”¨æ—¶è§¦å‘</span>
    <span class="keyword">async</span> <span class="title function_">onMutate</span>(<span class="params">target</span>) &#123;
      <span class="comment">// è·å–å½“å‰æ•°æ®å¿«ç…§ï¼Œç”¨äºé”™è¯¯æ—¶å›æ»šæ›´æ–°</span>
      <span class="keyword">const</span> previousItems = queryClient.<span class="title function_">getQueryData</span>(queryKey)
      <span class="comment">// ä¹è§‚æ›´æ–°ä¸ºæ–°å€¼</span>
      queryClient.<span class="title function_">setQueryData</span>(queryKey, <span class="function">(<span class="params">old</span>) =&gt;</span> &#123;
        <span class="keyword">return</span> <span class="function">(<span class="params">target, old</span>) =&gt;</span> (old ? [...old, target] : [])
      &#125;)

      <span class="comment">// è¿™ä¸ªè¿”å›å€¼ä¼šä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ç»™onErrorå’ŒonSettled</span>
      <span class="keyword">return</span> &#123; previousItems &#125;
    &#125;,
    <span class="comment">// æˆåŠŸå›è°ƒ æ¸…é™¤ç¼“å­˜</span>
    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> queryClient.<span class="title function_">invalidateQueries</span>(queryKey),
    <span class="comment">// å¤±è´¥å›è°ƒ</span>
    <span class="title function_">onError</span>(<span class="params">error, newItem, context</span>) &#123;
      <span class="comment">// å½“å‰queryKeyçš„æ•°æ®å›æ»š</span>
      queryClient.<span class="title function_">setQueryData</span>(
        queryKey,
        context.<span class="property">previousItems</span>
      )
    &#125;,
    <span class="comment">// æ— è®ºé”™è¯¯æˆ–è€…æˆåŠŸéƒ½ä¼šè§¦å‘ï¼Œæ­¤ä¾‹å­æ²¡æœ‰ä½¿ç”¨</span>
    <span class="title function_">onSettled</span>(<span class="params"></span>) &#123;&#125;
  &#125;
&#125;</code></pre></li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>æœ¬åœ°&#x2F;å®¢æˆ·ç«¯ä¸­é—´çŠ¶æ€<ul>
<li>reduxä¸react-queryéƒ½å¯ï¼Œæ²¡æœ‰è¾ƒå¤§çš„ä¼˜ç¼ºç‚¹</li>
</ul>
</li>
<li>æœåŠ¡ç«¯ä¸­é—´çŠ¶æ€<ul>
<li>æ¨èreact-queryï¼Œå°†æœåŠ¡å™¨çŠ¶æ€ä»å…¨å±€çŠ¶æ€ä¸­è§£æ”¾å‡ºæ¥ï¼Œç”¨æ›´å°‘çš„ä»£ç å®ç°å¤æ‚çš„éœ€æ±‚ï¼Œè®©ä½ çš„çŠ¶æ€ç®¡ç†æ›´ä¼˜é›…</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>ReactQuery</tag>
      </tags>
  </entry>
  <entry>
    <title>vue3å“åº”å¼åˆ†æ</title>
    <url>/2021/08/01/%E8%A7%A3%E6%9E%90reactive-vue3%E5%93%8D%E5%BA%94%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="vue3å“åº”å¼åˆ†æ"><a href="#vue3å“åº”å¼åˆ†æ" class="headerlink" title="vue3å“åº”å¼åˆ†æ"></a>vue3å“åº”å¼åˆ†æ</h2><ol>
<li>é¦–å…ˆå¯¹vue3å“åº”å¼åˆ†æä¹‹å‰ï¼Œéœ€è¦å¯¹å‰ç½®çŸ¥è¯†<code>Proxy</code>å’Œ<code>Reflect</code>æœ‰æ‰€äº†è§£ï¼Œï¼Œå…³äºè¿™ä¸¤ä¸ªçŸ¥è¯†æˆ‘æ¨èçœ‹é˜®ä¸€å³°è€å¸ˆçš„<a href="https://es6.ruanyifeng.com/#README">ES6å…¥é—¨æ•™ç¨‹</a></li>
<li>vue3çš„å“åº”å¼æˆ‘æ˜¯ä»¥reactiveä¸ºå…¥å£è¿›è¡Œæ¢³ç†ï¼Œæµç¨‹å¦‚ä¸‹å›¾<br><img src="https://img-blog.csdnimg.cn/83a41b1d8a3044d6b8135850ea972ed1.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDcxOTI1OA==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>æºç ä½ç½®ï¼š<code>reactivity/src/...</code>ï¼Œåˆ†å››éƒ¨åˆ†è§£æ</li>
</ol>
<ul>
<li>reactiveæ–‡ä»¶ï¼šç›®æ ‡å¯¹è±¡è½¬åŒ–ä¸ºproxyå®ä¾‹</li>
<li>baseHandleræ–‡ä»¶ï¼šåŸºæœ¬ç±»å‹å¤„ç†å™¨</li>
<li>collectionHandlersæ–‡ä»¶ï¼šMapã€Setå¤„ç†å™¨</li>
<li>effectæ–‡ä»¶ï¼šæ”¶é›†è§¦å‘ä¾èµ–</li>
</ul>
<ol start="4">
<li>å¦‚æœä¸æƒ³çœ‹æºç è§£æï¼Œå¯ä»¥ç›´æ¥çœ‹æ€»ç»“ğŸ¶</li>
</ol>
<h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h3><ul>
<li><code>reactive</code>ï¼šå°†ä¸€ä¸ªJSå¯¹è±¡è½¬ä¸ºå…·æœ‰å“åº”å¼çš„proxyå®ä¾‹<pre><code class="highlight ts"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">target: <span class="built_in">object</span></span>) &#123;
    <span class="comment">// å¦‚æœæ˜¯åªè¯»æ•°æ®ï¼Œå°±ç›´æ¥è¿”å›</span>
    <span class="keyword">if</span> (target &amp;&amp; (target <span class="keyword">as</span> <span class="title class_">Target</span>)[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>]) &#123;
      <span class="keyword">return</span> target
    &#125;
    <span class="keyword">return</span> <span class="title function_">createReactiveObject</span>(
      target,
      <span class="literal">false</span>,
      mutableHandlers,
      mutableCollectionHandlers,
      reactiveMap
    )
&#125;</code></pre></li>
<li><code>createReactiveObject</code><pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">createReactiveObject</span>(<span class="params"></span>
<span class="params">    target: Target, <span class="comment">// æºå¯¹è±¡</span></span>
<span class="params">    isReadonly: <span class="built_in">boolean</span>, <span class="comment">// æ˜¯å¦åªè¯»</span></span>
<span class="params">    baseHandlers: ProxyHandler&lt;<span class="built_in">any</span>&gt;, <span class="comment">// åŸºæœ¬ç±»å‹çš„handlers</span></span>
<span class="params">    collectionHandlers: ProxyHandler&lt;<span class="built_in">any</span>&gt;, <span class="comment">// ä¸»è¦é’ˆå¯¹(setã€mapã€weakSetã€weakMap)çš„handlers</span></span>
<span class="params">    proxyMap: <span class="built_in">WeakMap</span>&lt;Target, <span class="built_in">any</span>&gt;</span>
<span class="params"></span>) &#123;
  <span class="comment">// å¦‚æœä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼Œå¹¶ä¸”åœ¨å¼€å‘ç¯å¢ƒå‘å‡ºè­¦å‘Š</span>
    <span class="keyword">if</span> (!<span class="title function_">isObject</span>(target)) &#123;
      <span class="keyword">if</span> (__DEV__) &#123;
        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`value cannot be made reactive: <span class="subst">$&#123;<span class="built_in">String</span>(target)&#125;</span>`</span>)
      &#125;
      <span class="keyword">return</span> target
    &#125;
    <span class="comment">// å¦‚æœå·²ç»æ˜¯å“åº”å¼ï¼Œç›´æ¥è¿”å›</span>
    <span class="keyword">if</span> (
      target[<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>] &amp;&amp;
      !(isReadonly &amp;&amp; target[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>])
    ) &#123;
      <span class="keyword">return</span> target
    &#125;

    <span class="comment">// å¦‚æœç›®æ ‡å¯¹è±¡å·²ç»å­˜åœ¨ä»£ç†ï¼Œç›´æ¥è¿”å›</span>
    <span class="keyword">const</span> existingProxy = proxyMap.<span class="title function_">get</span>(target)
    <span class="keyword">if</span> (existingProxy) &#123;
      <span class="keyword">return</span> existingProxy
    &#125;

    <span class="comment">// å¦‚æœç±»å‹å€¼ä¸æ˜¯Objectã€Arrayã€Mapã€Setã€WeakMapã€WeakSetçš„ï¼Œç›´æ¥è¿”å›</span>
    <span class="keyword">const</span> targetType = <span class="title function_">getTargetType</span>(target)
    <span class="keyword">if</span> (targetType === <span class="title class_">TargetType</span>.<span class="property">INVALID</span>) &#123;
      <span class="keyword">return</span> target
    &#125;

    <span class="comment">// æ ¹æ®ä¸åŒçš„ç±»å‹å€¼èµ‹äºˆä¸åŒçš„handlersï¼Œå°±æ˜¯æˆ‘ä¹‹å‰å›¾ä¸Šç”»çš„åˆ†å¼€å¤„ç†</span>
    <span class="comment">/* </span>
<span class="comment">      æŠŠsetã€Mapè¿™ç§æ•°æ®ä¸åŸºç¡€æ•°æ®åˆ†å¼€å¤„ç†ï¼Œæ˜¯å› ä¸ºMapã€Setä¸­å­˜å‚¨çš„æ•°æ®å¿…é¡»é€šè¿‡thisè¿›è¡Œè®¿é—®</span>
<span class="comment">      ä½†æ˜¯è¢«proxyåŠ«æŒåï¼Œthiså°±å˜æˆäº†proxyï¼Œ</span>
<span class="comment">      æ‰€ä»¥éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ŒæŠŠåŠ«æŒæ–¹æ³•è¿›è¡Œé‡å†™</span>
<span class="comment">     */</span>
    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(
      target,
      targetType === <span class="title class_">TargetType</span>.<span class="property">COLLECTION</span> ? collectionHandlers : baseHandlers
    )
    proxyMap.<span class="title function_">set</span>(target, proxy)
    <span class="keyword">return</span> proxy
  &#125;</code></pre></li>
</ul>
<h3 id="baseHandler"><a href="#baseHandler" class="headerlink" title="baseHandler"></a>baseHandler</h3><p><code>baseHandler</code>ä¸»è¦åˆ†æreactiveçš„å¤„ç†å™¨å¯¹è±¡<code>mutableHandlers</code></p>
<pre><code class="highlight ts"><span class="comment">// å¯¹get set delete has onwKeysåšäº†æ‹¦æˆªå¤„ç†</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">mutableHandlers</span>: <span class="title class_">ProxyHandler</span>&lt;<span class="built_in">object</span>&gt; = &#123;
  get,
  set,
  deleteProperty,
  has,
  ownKeys
&#125;</code></pre>
<h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">createGetter</span>(<span class="params">isReadonly = <span class="literal">false</span>, shallow = <span class="literal">false</span></span>) &#123;
  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">target: Target, key: <span class="built_in">string</span> | <span class="built_in">symbol</span>, receiver: <span class="built_in">object</span></span>) &#123;
    <span class="comment">// è®¿é—®æ ‡å¿—ä½æ—¶çš„é€»è¾‘å¤„ç†</span>
    <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>) &#123;
      <span class="keyword">return</span> !isReadonly
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>) &#123;
      <span class="keyword">return</span> isReadonly
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (
      key === <span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span> &amp;&amp;
      receiver ===
        (isReadonly
          ? shallow
            ? shallowReadonlyMap
            : readonlyMap
          : shallow
            ? shallowReactiveMap
            : reactiveMap
        ).<span class="title function_">get</span>(target)
    ) &#123;
      <span class="keyword">return</span> target
    &#125;

    <span class="keyword">const</span> targetIsArray = <span class="title function_">isArray</span>(target)

    <span class="comment">// å¦‚æœtargetæ˜¯æ•°ç»„å¹¶ä¸”keyå±äºä¸€äº›æ•°ç»„çš„åŸå§‹æ–¹æ³•ï¼Œå³è§¦å‘æ‹¦æˆª</span>
    <span class="keyword">if</span> (!isReadonly &amp;&amp; targetIsArray &amp;&amp; <span class="title function_">hasOwn</span>(arrayInstrumentations, key)) &#123;
      <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(arrayInstrumentations, key, receiver)
    &#125;

    <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)

    <span class="comment">// å¦‚æœkeyæ˜¯symbolçš„å†…ç½®æ–¹æ³•ï¼Œæˆ–è€…æ˜¯åŸå‹å¯¹è±¡ï¼Œç›´æ¥è¿”å›</span>
    <span class="keyword">if</span> (<span class="title function_">isSymbol</span>(key) ? builtInSymbols.<span class="title function_">has</span>(key) : <span class="title function_">isNonTrackableKeys</span>(key)) &#123;
      <span class="keyword">return</span> res
    &#125;

    <span class="comment">// åªè¯»å¯¹è±¡ä¸æ”¶é›†ä¾èµ–ï¼Œå› ä¸ºä¸ä¼šè§¦å‘ä¾èµ–æ›´æ–°</span>
    <span class="keyword">if</span> (!isReadonly) &#123;
      <span class="title function_">track</span>(target, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, key)
    &#125;

    <span class="comment">// æµ…å±‚å“åº”ç«‹å³è¿”å›ï¼Œä¸é€’å½’è½¬åŒ–</span>
    <span class="keyword">if</span> (shallow) &#123;
      <span class="keyword">return</span> res
    &#125;

    <span class="comment">// å¦‚æœæ˜¯refå¯¹è±¡(æ•°ç»„é™¤å¤–)ï¼Œè¿”å›çœŸæ­£çš„å€¼ï¼Œ</span>
    <span class="keyword">if</span> (<span class="title function_">isRef</span>(res)) &#123;
      <span class="keyword">const</span> shouldUnwrap = !targetIsArray || !<span class="title function_">isIntegerKey</span>(key)
      <span class="keyword">return</span> shouldUnwrap ? res.<span class="property">value</span> : res
    &#125;

    <span class="keyword">if</span> (<span class="title function_">isObject</span>(res)) &#123;
      <span class="comment">// ç”±äºproxyåªèƒ½ä»£ç†ä¸€å±‚ï¼Œæ‰€ä»¥target[key]çš„å€¼å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±ç»§ç»­å¯¹å…¶è¿›è¡Œä»£ç†</span>
      <span class="keyword">return</span> isReadonly ? <span class="title function_">readonly</span>(res) : <span class="title function_">reactive</span>(res)
    &#125;
    <span class="keyword">return</span> res
  &#125;
&#125;</code></pre>
<p>æ•°ç»„æ–¹æ³•æ‹¦æˆª: å¯¹æ•°ç»„çš„ä¸¤ç§åŸç”Ÿæ–¹æ³•è¿›è¡Œäº†æ‹¦æˆª</p>
<ul>
<li>éå†æŸ¥æ‰¾çš„æ–¹æ³•ï¼šincludesã€indexOfã€lastIndexOf</li>
<li>æ”¹å˜æ•°ç»„é•¿åº¦çš„æ–¹æ³•ï¼špushã€popã€shiftã€unshiftã€splice<pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">createArrayInstrumentations</span>(<span class="params"></span>) &#123;
    <span class="keyword">const</span> <span class="attr">instrumentations</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt; = &#123;&#125;
    ;([<span class="string">&#x27;includes&#x27;</span>, <span class="string">&#x27;indexOf&#x27;</span>, <span class="string">&#x27;lastIndexOf&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;
      <span class="keyword">const</span> method = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>[key] <span class="keyword">as</span> <span class="built_in">any</span>
      instrumentations[key] = <span class="keyword">function</span>(<span class="params"><span class="variable language_">this</span>: <span class="built_in">unknown</span>[], ...args: <span class="built_in">unknown</span>[]</span>) &#123;
        <span class="comment">// è¿™ä¸€æ­¥æ˜¯ä¸ºäº†å–åŸå§‹å®ä¾‹ï¼Œå› ä¸ºå½“å‰çš„thisæ˜¯receiver</span>
        <span class="keyword">const</span> arr = <span class="title function_">toRaw</span>(<span class="variable language_">this</span>)
        <span class="comment">// æœé›†ä¾èµ–</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = <span class="variable language_">this</span>.<span class="property">length</span>; i &lt; l; i++) &#123;
          <span class="title function_">track</span>(arr, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, i + <span class="string">&#x27;&#x27;</span>)
        &#125;
        <span class="comment">// è§¦å‘æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œå°±å–åŸå§‹å€¼å†éå†</span>
        <span class="keyword">const</span> res = method.<span class="title function_">apply</span>(arr, args)
        <span class="keyword">if</span> (res === -<span class="number">1</span> || res === <span class="literal">false</span>) &#123;
          <span class="keyword">return</span> method.<span class="title function_">apply</span>(arr, args.<span class="title function_">map</span>(toRaw))
        &#125; <span class="keyword">else</span> &#123;
          <span class="keyword">return</span> res
        &#125;
      &#125;
    &#125;)
    <span class="comment">/* </span>
<span class="comment">      å› ä¸ºæ”¹å˜æ•°ç»„é•¿åº¦çš„æ–¹æ³•ï¼Œæ‰§è¡ŒæœŸé—´ä¼šè§¦å‘lengthçš„getå’Œset</span>
<span class="comment">      å°±å›å¯¼è‡´æ— é™å¾ªç¯trackå’Œtrigger</span>
<span class="comment">      æ‰€ä»¥å°±ç”¨pauseTracking()ç¦ç”¨ä¾èµ–æ”¶é›†ï¼Œè§¦å‘æ–¹æ³•åï¼Œ</span>
<span class="comment">      å†ç”¨resetTracking()æ¢å¤track</span>
<span class="comment">     */</span>
    ;([<span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;shift&#x27;</span>, <span class="string">&#x27;unshift&#x27;</span>, <span class="string">&#x27;splice&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;
      <span class="keyword">const</span> method = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>[key] <span class="keyword">as</span> <span class="built_in">any</span>
      instrumentations[key] = <span class="keyword">function</span>(<span class="params"><span class="variable language_">this</span>: <span class="built_in">unknown</span>[], ...args: <span class="built_in">unknown</span>[]</span>) &#123;
        <span class="title function_">pauseTracking</span>()
        <span class="keyword">const</span> res = method.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)
        <span class="title function_">resetTracking</span>()
        <span class="keyword">return</span> res
      &#125;
    &#125;)
    <span class="keyword">return</span> instrumentations
&#125;</code></pre></li>
</ul>
<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">createSetter</span>(<span class="params">shallow = <span class="literal">false</span></span>) &#123;
  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params"></span>
<span class="params">    target: <span class="built_in">object</span>,</span>
<span class="params">    key: <span class="built_in">string</span> | <span class="built_in">symbol</span>,</span>
<span class="params">    value: <span class="built_in">unknown</span>,</span>
<span class="params">    receiver: <span class="built_in">object</span></span>
<span class="params">  </span>): <span class="built_in">boolean</span> &#123;
    <span class="keyword">let</span> oldValue = (target <span class="keyword">as</span> <span class="built_in">any</span>)[key]
    <span class="keyword">if</span> (!shallow) &#123;
      value = <span class="title function_">toRaw</span>(value)
      oldValue = <span class="title function_">toRaw</span>(oldValue)
      <span class="comment">// å¦‚æœåŸæ¥çš„å€¼æ˜¯refï¼Œä½†æ–°çš„å€¼ä¸æ˜¯ï¼Œåˆ™å°†æ–°çš„å€¼èµ‹ç»™oldValue.value</span>
      <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isRef</span>(oldValue) &amp;&amp; !<span class="title function_">isRef</span>(value)) &#123;
        oldValue.<span class="property">value</span> = value
        <span class="keyword">return</span> <span class="literal">true</span>
      &#125;
    &#125; <span class="keyword">else</span> &#123;
      <span class="comment">// in shallow mode, objects are set as-is regardless of reactive or not</span>
    &#125;

    <span class="keyword">const</span> hadKey =
      <span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isIntegerKey</span>(key)
        ? <span class="title class_">Number</span>(key) &lt; target.<span class="property">length</span>
        : <span class="title function_">hasOwn</span>(target, key)
    <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver)
    
    <span class="comment">// åˆ¤æ–­receiveræ˜¯å½“å‰å¯¹è±¡çš„proxyå®ä¾‹ï¼Œé˜²æ­¢åŸå‹é“¾ä¸Šçš„proxyè§¦å‘æ›´æ–°</span>
    <span class="keyword">if</span> (target === <span class="title function_">toRaw</span>(receiver)) &#123;
      <span class="comment">// åˆ¤æ–­æ–°å¢å±æ€§è¿˜æ˜¯ä¿®æ”¹å±æ€§</span>
      <span class="keyword">if</span> (!hadKey) &#123;
        <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">ADD</span>, key, value)
      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(value, oldValue)) &#123;
        <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>, key, value, oldValue)
      &#125;
    &#125;
    <span class="keyword">return</span> result
  &#125;
&#125;</code></pre>
<h4 id="deletePropertyã€hasâ€¦"><a href="#deletePropertyã€hasâ€¦" class="headerlink" title="deletePropertyã€hasâ€¦"></a>deletePropertyã€hasâ€¦</h4><ul>
<li>deletePropertyã€hasã€ownKeysçš„æºç å°±ä¸è´´äº†ï¼Œéƒ½æ˜¯åˆ¤æ–­keyçš„å±æ€§ï¼Œç„¶åé€‰æ‹©è§¦å‘æˆ–è€…æ”¶é›†ä¾èµ–</li>
</ul>
<h3 id="collectionHandlers"><a href="#collectionHandlers" class="headerlink" title="collectionHandlers"></a>collectionHandlers</h3><ul>
<li>collectionä¸»è¦åˆ†æreactiveçš„é‡å†™æ–¹æ³•å¯¹è±¡mutableInstrumentations<pre><code class="highlight ts"><span class="comment">// ä¸»è¦å¯¹ä»¥ä¸‹åŸç”Ÿapiè¿›è¡Œäº†æ”¹å†™</span>
<span class="keyword">const</span> <span class="attr">mutableInstrumentations</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt; = &#123;
    <span class="title function_">get</span>(<span class="params"><span class="variable language_">this</span>: MapTypes, key: <span class="built_in">unknown</span></span>) &#123;
      <span class="keyword">return</span> <span class="title function_">get</span>(<span class="variable language_">this</span>, key)
    &#125;,
    <span class="keyword">get</span> <span class="title function_">size</span>() &#123;
      <span class="keyword">return</span> <span class="title function_">size</span>((<span class="variable language_">this</span> <span class="keyword">as</span> <span class="built_in">unknown</span>) <span class="keyword">as</span> <span class="title class_">IterableCollections</span>)
    &#125;,
    has,
    add,
    set,
    <span class="attr">delete</span>: deleteEntry,
    clear,
    <span class="attr">forEach</span>: <span class="title function_">createForEach</span>(<span class="literal">false</span>, <span class="literal">false</span>)
&#125;</code></pre></li>
</ul>
<h4 id="get-1"><a href="#get-1" class="headerlink" title="get"></a>get</h4><pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>
<span class="params">    target: MapTypes,</span>
<span class="params">    key: <span class="built_in">unknown</span>,</span>
<span class="params">    isReadonly = <span class="literal">false</span>,</span>
<span class="params">    isShallow = <span class="literal">false</span></span>
<span class="params"></span>) &#123;
    <span class="comment">// è·å–åŸå§‹å€¼é‡æ–°èµ‹å€¼ç»™target</span>
    target = (target <span class="keyword">as</span> <span class="built_in">any</span>)[<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>]

    <span class="comment">// å¯¹targetæºå¯¹è±¡å’Œkeyè¿›ä¸€æ­¥è·å–åŸå§‹å€¼</span>
    <span class="keyword">const</span> rawTarget = <span class="title function_">toRaw</span>(target)
    <span class="keyword">const</span> rawKey = <span class="title function_">toRaw</span>(key)

    <span class="comment">// å½“å‰keyå’ŒåŸå§‹keyå‡è¿›è¡Œä¾èµ–æ”¶é›†(track)</span>
    <span class="keyword">if</span> (key !== rawKey) &#123;
      !isReadonly &amp;&amp; <span class="title function_">track</span>(rawTarget, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, key)
    &#125;
    !isReadonly &amp;&amp; <span class="title function_">track</span>(rawTarget, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, rawKey)
    <span class="keyword">const</span> &#123; has &#125; = <span class="title function_">getProto</span>(rawTarget)

    <span class="comment">// è·å–å¯¹åº”çš„è½¬æ¢å‡½æ•°</span>
    <span class="keyword">const</span> wrap = isShallow ? toShallow : isReadonly ? toReadonly : toReactive
    <span class="comment">/* </span>
<span class="comment">      å¦‚æœæºå¯¹è±¡æœ‰keyå¯¹åº”çš„å±æ€§ï¼Œå°±é€šè¿‡åŸç”Ÿgetæ–¹æ³•å–åˆ°å€¼ï¼Œ</span>
<span class="comment">      å¹¶å¯¹è¯¥å€¼è¿›è¡Œå“åº”å¼è½¬æ¢ï¼Œè¿”å›è½¬æ¢åçš„å“åº”å¼å¯¹è±¡ï¼Œ</span>
<span class="comment">      å¦‚æœæ²¡æœ‰ï¼Œå°±å»keyåŸå§‹å€¼ä¸­å»æŸ¥æ‰¾</span>
<span class="comment">    */</span>
    <span class="keyword">if</span> (has.<span class="title function_">call</span>(rawTarget, key)) &#123;
      <span class="keyword">return</span> <span class="title function_">wrap</span>(target.<span class="title function_">get</span>(key))
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (has.<span class="title function_">call</span>(rawTarget, rawKey)) &#123;
      <span class="keyword">return</span> <span class="title function_">wrap</span>(target.<span class="title function_">get</span>(rawKey))
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target !== rawTarget) &#123;
      target.<span class="title function_">get</span>(key)
    &#125;
&#125;</code></pre>

<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><pre><code class="highlight ts"><span class="comment">// å¯¹sizeå±æ€§åšgetæ‹¦æˆª</span>
<span class="keyword">function</span> <span class="title function_">size</span>(<span class="params">target: IterableCollections, isReadonly = <span class="literal">false</span></span>) &#123;
  target = (target <span class="keyword">as</span> <span class="built_in">any</span>)[<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>]
  <span class="comment">// è·å–sizeå’Œè·å–æ•°ç»„çš„lengthç±»ä¼¼ï¼Œéƒ½ç”¨ä¸“é—¨çš„keyåšä¾èµ–æ”¶é›†</span>
  !isReadonly &amp;&amp; <span class="title function_">track</span>(<span class="title function_">toRaw</span>(target), <span class="title class_">TrackOpTypes</span>.<span class="property">ITERATE</span>, <span class="variable constant_">ITERATE_KEY</span>)
  <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, <span class="string">&#x27;size&#x27;</span>, target)
&#125;</code></pre>

<h4 id="set-1"><a href="#set-1" class="headerlink" title="set"></a>set</h4><pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">set</span>(<span class="params"><span class="variable language_">this</span>: MapTypes, key: <span class="built_in">unknown</span>, value: <span class="built_in">unknown</span></span>) &#123;
  <span class="comment">// è·å–valueå’Œthisä¸Šä¸‹æ–‡çš„åŸå§‹å€¼</span>
  value = <span class="title function_">toRaw</span>(value)
  <span class="keyword">const</span> target = <span class="title function_">toRaw</span>(<span class="variable language_">this</span>)
  <span class="keyword">const</span> &#123; has, get &#125; = <span class="title function_">getProto</span>(target)

  <span class="comment">/* </span>
<span class="comment">    åˆ¤æ–­æºå¯¹è±¡æ˜¯å¦å·²ç»å­˜åœ¨å¯¹åº”çš„key</span>
<span class="comment">    1. é¦–å…ˆæŸ¥æ‰¾æºå¯¹è±¡æ˜¯å¦å·²æœ‰keyå¯¹åº”çš„å±æ€§</span>
<span class="comment">    2. å¦‚æœæ²¡æœ‰ï¼Œå†æŸ¥æ‰¾keyå¯¹åº”çš„åŸå§‹å€¼åœ¨æºå¯¹è±¡çš„å±æ€§æ˜¯å¦å­˜åœ¨</span>
<span class="comment">  */</span>
  <span class="keyword">let</span> hadKey = has.<span class="title function_">call</span>(target, key)
  <span class="keyword">if</span> (!hadKey) &#123;
    key = <span class="title function_">toRaw</span>(key)
    hadKey = has.<span class="title function_">call</span>(target, key)
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__DEV__) &#123;
    <span class="title function_">checkIdentityKeys</span>(target, has, key)
  &#125;

  <span class="keyword">const</span> oldValue = get.<span class="title function_">call</span>(target, key)
  target.<span class="title function_">set</span>(key, value)

  <span class="comment">// è§¦å‘ä¾èµ–ï¼Œæ–°å¢å±æ€§å’Œä¿®æ”¹å±æ€§åˆ†å¼€è¿›è¡Œtrigger</span>
  <span class="keyword">if</span> (!hadKey) &#123;
    <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">ADD</span>, key, value)
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(value, oldValue)) &#123;
    <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>, key, value, oldValue)
  &#125;
  <span class="keyword">return</span> <span class="variable language_">this</span>
&#125;</code></pre>
<h4 id="hasã€clearâ€¦"><a href="#hasã€clearâ€¦" class="headerlink" title="hasã€clearâ€¦"></a>hasã€clearâ€¦</h4><ul>
<li>å…¶ä½™é‡å†™æ–¹æ³•æˆ‘å°±ä¸ä¸Šä»£ç äº†ï¼Œä¸åŒç‚¹æ˜¯å•ä¸ªå±æ€§è§¦å‘å•ä¸ªçš„ä¾èµ–ï¼Œå¦‚æœæ˜¯éå†æ‰€æœ‰å±æ€§çš„æ–¹æ³•å°±è§¦å‘æ‰€æœ‰ä¾èµ–</li>
</ul>
<h3 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h3><ul>
<li>effectæ–‡ä»¶ä½œä¸ºå“åº”å¼çš„æ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£æ”¶é›†ä¾èµ–ï¼Œè§¦å‘ä¾èµ–</li>
</ul>
<h4 id="effect-1"><a href="#effect-1" class="headerlink" title="effect"></a>effect</h4><ul>
<li>effectå‡½æ•°ä¸»è¦æ˜¯ç”Ÿæˆæ”¶é›†ä¾èµ–æ‰€éœ€çš„ä¾èµ–å‡½æ•°<pre><code class="highlight ts"><span class="keyword">export</span> <span class="keyword">function</span> effect&lt;T = <span class="built_in">any</span>&gt;(
    <span class="attr">fn</span>: <span class="function">() =&gt;</span> T,
    <span class="attr">options</span>: <span class="title class_">ReactiveEffectOptions</span> = <span class="variable constant_">EMPTY_OBJ</span>
): <span class="title class_">ReactiveEffect</span>&lt;T&gt; &#123;
    <span class="comment">// å¦‚æœå·²ç»æ˜¯effectå‡½æ•°ï¼Œå–å¾—åŸæ¥çš„fn</span>
    <span class="keyword">if</span> (<span class="title function_">isEffect</span>(fn)) &#123;
      fn = fn.<span class="property">raw</span>
    &#125;
    <span class="keyword">const</span> effect = <span class="title function_">createReactiveEffect</span>(fn, options)

    <span class="comment">// å¦‚æœlazyä¸ºfalseï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡</span>
    <span class="keyword">if</span> (!options.<span class="property">lazy</span>) &#123;
      <span class="title function_">effect</span>()
    &#125;
    <span class="keyword">return</span> effect
&#125;</code></pre></li>
<li><code>createReactiveEffect</code>ï¼šç”Ÿæˆeffectå¯¹è±¡<pre><code class="highlight ts"><span class="keyword">function</span> createReactiveEffect&lt;T = <span class="built_in">any</span>&gt;(
    <span class="attr">fn</span>: <span class="function">() =&gt;</span> T,
    <span class="attr">options</span>: <span class="title class_">ReactiveEffectOptions</span>
): <span class="title class_">ReactiveEffect</span>&lt;T&gt; &#123;
    <span class="keyword">const</span> effect = <span class="keyword">function</span> <span class="title function_">reactiveEffect</span>(<span class="params"></span>): <span class="built_in">unknown</span> &#123;
      <span class="comment">// æ²¡æœ‰æ¿€æ´»ï¼Œå·²ç»è°ƒç”¨stopå‡½æ•°åœæ­¢ç›‘å¬</span>
      <span class="keyword">if</span> (!effect.<span class="property">active</span>) &#123;
        <span class="keyword">return</span> <span class="title function_">fn</span>()
      &#125;
      <span class="comment">/**</span>
<span class="comment">       * effectStackæ˜¯ä¸€ä¸ªå…¨å±€çš„effectæ ˆç»“æ„</span>
<span class="comment">       * è®¾è®¡ä¸ºæ ˆç»“æ„æ˜¯å› ä¸ºå¦‚æœeffectæ˜¯åµŒå¥—æ—¶ï¼Œä¸ºäº†é˜²æ­¢å†…å±‚å‰¯ä½œç”¨å‡½æ•°è¦†ç›–å¤–å±‚å‰¯ä½œç”¨å‡½æ•°ï¼Œåœ¨æ”¶é›†æ—¶åªæ”¶é›†æ ˆé¡¶çš„ï¼Œè¿™æ ·å°±ä¸ä¼šæ”¶é›†åˆ°é”™è¯¯çš„å‰¯ä½œç”¨å‡½æ•°</span>
<span class="comment">       */</span>
      <span class="keyword">if</span> (!effectStack.<span class="title function_">includes</span>(effect)) &#123;
        <span class="comment">/**</span>
<span class="comment">         * ä¸ºäº†ä¿è¯å½“å‰effectçš„depæ˜¯æœ€æ–°ï¼Œå› ä¸ºåœ¨ä¸€äº›åˆ¤æ–­å¤„ç†ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ— æ•ˆçš„å‰¯ä½œç”¨å‡½æ•°</span>
<span class="comment">         * æ‰€ä»¥ä¸ºäº†å–æ¶ˆè¿™äº›ä¸å¿…è¦çš„æ›´æ–°ï¼Œå°±è¦æ¸…é™¤effectä¾èµ–</span>
<span class="comment">         */</span>
        <span class="title function_">cleanup</span>(effect)
        <span class="keyword">try</span> &#123;
          <span class="title function_">enableTracking</span>() <span class="comment">// é‡æ–°æ”¶é›†ä¾èµ–</span>
          effectStack.<span class="title function_">push</span>(effect)
          activeEffect = effect
          <span class="keyword">return</span> <span class="title function_">fn</span>()
        &#125; <span class="keyword">finally</span> &#123;
          <span class="comment">/* </span>
<span class="comment">            trackå°†ä¾èµ–å‡½æ•°activeEffectæ·»åŠ åˆ°å¯¹åº”çš„depä¸­ï¼Œ</span>
<span class="comment">            ç„¶åå°†activeEffecté‡ç½®ä¸ºä¸Šä¸€ä¸ªeffectçš„å€¼</span>
<span class="comment">          */</span>
          effectStack.<span class="title function_">pop</span>()
          <span class="title function_">resetTracking</span>()
          activeEffect = effectStack[effectStack.<span class="property">length</span> - <span class="number">1</span>]
        &#125;
      &#125;
    &#125; <span class="keyword">as</span> <span class="title class_">ReactiveEffect</span>
    effect.<span class="property">id</span> = uid++ <span class="comment">// è‡ªå¢ID</span>
    effect.<span class="property">allowRecurse</span> = !!options.<span class="property">allowRecurse</span> <span class="comment">// é€’å½’çŠ¶æ€</span>
    effect.<span class="property">_isEffect</span> = <span class="literal">true</span> <span class="comment">// ç”¨äºæ ‡è¯†æ–¹æ³•æ˜¯ä¸æ˜¯effect</span>
    effect.<span class="property">active</span> = <span class="literal">true</span> <span class="comment">// ç”¨äºåˆ¤æ–­å½“å‰effectæ˜¯å¦æ¿€æ´»ï¼Œæœ‰ä¸€ä¸ªstop()æ¥å°†å®ƒè®¾ä¸ºfalse</span>
    effect.<span class="property">raw</span> = fn <span class="comment">// effectçš„æ‰§è¡Œå‡½æ•°</span>
    effect.<span class="property">deps</span> = [] <span class="comment">// ç”¨äºæ”¶é›†ä¾èµ–</span>
    effect.<span class="property">options</span> = options <span class="comment">// åˆ›å»ºeffectä¼ å…¥çš„options</span>
    <span class="keyword">return</span> effect
&#125;</code></pre></li>
<li>activeEffectå°±æ˜¯æ ‡è®°trackæ‰€éœ€çš„ä¾èµ–å‡½æ•°</li>
</ul>
<h4 id="track"><a href="#track" class="headerlink" title="track"></a>track</h4><ul>
<li>trackå°±æ˜¯baseHandlerå’ŒcollectionHandlersæ–‡ä»¶ä¸­é¢‘ç¹ä½¿ç”¨çš„æ”¶é›†ä¾èµ–å‡½æ•°</li>
<li>é¦–å…ˆéœ€è¦çœ‹ä¸€ä¸ªå…³é”®å˜é‡targetMap<pre><code class="highlight ts"><span class="comment">// targetMapæ˜¯ä¾èµ–ç®¡ç†ä¸­å¿ƒï¼Œæ”¶é›†ä¾èµ–å’Œè§¦å‘ä¾èµ–éƒ½ä¾æ‰˜äºè¿™ä¸ªMapæ•°æ®</span>
<span class="comment">// ä¸‹é¢æ˜¯targetMapçš„å®šä¹‰(target -&gt; key -&gt; dep)</span>
<span class="comment">// target: ç›‘å¬çš„å¯¹è±¡æº</span>
<span class="comment">// key: ç›‘å¬çš„é”®å€¼</span>
<span class="comment">// depï¼šä¾èµ–å‡½æ•°</span>
<span class="keyword">type</span> <span class="title class_">Dep</span> = <span class="title class_">Set</span>&lt;<span class="title class_">ReactiveEffect</span>&gt;
<span class="keyword">type</span> <span class="title class_">KeyToDepMap</span> = <span class="title class_">Map</span>&lt;<span class="built_in">any</span>, <span class="title class_">Dep</span>&gt;
<span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>&lt;<span class="built_in">any</span>, <span class="title class_">KeyToDepMap</span>&gt;()
<span class="comment">// æ ¼å¼å¤§è‡´ä¸º</span>
targetMap = &#123;
  <span class="attr">target</span>: &#123;
    <span class="attr">key1</span>: &#123; fn1, fn2 &#125;
    <span class="attr">key2</span>: &#123; fn1, fn2 &#125;
  &#125;
&#125;</code></pre>
<pre><code class="highlight ts"><span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">target</span>&#125; ç›®æ ‡å¯¹è±¡</span>
<span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">type</span>&#125; æ”¶é›†ç±»å‹</span>
<span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">key</span>&#125; éœ€è¦æ”¶é›†ä¾èµ–çš„key</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target: <span class="built_in">object</span>, <span class="keyword">type</span>: TrackOpTypes, key: <span class="built_in">unknown</span></span>) &#123;
    <span class="comment">// activeEffectä¸ºç©ºï¼Œå°±è¡¨ç¤ºå½“å‰æ²¡æœ‰ä¾èµ–ï¼Œå°±æ²¡å¿…è¦åšä¾èµ–æ”¶é›†äº†</span>
    <span class="keyword">if</span> (!shouldTrack || activeEffect === <span class="literal">undefined</span>) &#123;
      <span class="keyword">return</span>
    &#125;
    <span class="comment">// è·å–å½“å‰ä¾èµ–æ•°æ®</span>
    <span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target)

    <span class="keyword">if</span> (!depsMap) &#123;
      targetMap.<span class="title function_">set</span>(target, (depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()))
    &#125;

    <span class="comment">// å¦‚æœå½“å‰æ•°æ®ä¸­æ²¡æœ‰æ‰€å±çš„ä¾èµ–keyï¼Œå°±é‡æ–°è®¾ç½®ä¸€ä¸ª</span>
    <span class="keyword">let</span> dep = depsMap.<span class="title function_">get</span>(key)
    <span class="keyword">if</span> (!dep) &#123;
      depsMap.<span class="title function_">set</span>(key, (dep = <span class="keyword">new</span> <span class="title class_">Set</span>()))
    &#125;
    <span class="comment">// æ·»åŠ ä¾èµ–å‡½æ•°</span>
    <span class="keyword">if</span> (!dep.<span class="title function_">has</span>(activeEffect)) &#123;
      dep.<span class="title function_">add</span>(activeEffect)
      activeEffect.<span class="property">deps</span>.<span class="title function_">push</span>(dep)
      <span class="keyword">if</span> (__DEV__ &amp;&amp; activeEffect.<span class="property">options</span>.<span class="property">onTrack</span>) &#123;
        activeEffect.<span class="property">options</span>.<span class="title function_">onTrack</span>(&#123;
          <span class="attr">effect</span>: activeEffect,
          target,
          <span class="keyword">type</span>,
          key
        &#125;)
      &#125;
    &#125;
&#125;</code></pre></li>
</ul>
<h4 id="trigger"><a href="#trigger" class="headerlink" title="trigger"></a>trigger</h4><pre><code class="highlight ts"><span class="comment">// è§¦å‘ä¾èµ–</span>
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params"></span>
<span class="params">  target: <span class="built_in">object</span>,</span>
<span class="params">  <span class="keyword">type</span>: TriggerOpTypes,</span>
<span class="params">  key?: <span class="built_in">unknown</span>,</span>
<span class="params">  newValue?: <span class="built_in">unknown</span>,</span>
<span class="params">  oldValue?: <span class="built_in">unknown</span>,</span>
<span class="params">  oldTarget?: <span class="built_in">Map</span>&lt;<span class="built_in">unknown</span>, <span class="built_in">unknown</span>&gt; | <span class="built_in">Set</span>&lt;<span class="built_in">unknown</span>&gt;</span>
<span class="params"></span>) &#123;
  <span class="keyword">const</span> depsMap = targetMap.<span class="title function_">get</span>(target)
  <span class="comment">// å¦‚æœæ²¡æœ‰æ”¶é›†è¿‡ä¾èµ–ï¼Œç›´æ¥è¿”å›</span>
  <span class="keyword">if</span> (!depsMap) &#123;
    <span class="keyword">return</span>
  &#125;

  <span class="keyword">const</span> effects = <span class="keyword">new</span> <span class="title class_">Set</span>&lt;<span class="title class_">ReactiveEffect</span>&gt;()
  <span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">effectsToAdd: <span class="built_in">Set</span>&lt;ReactiveEffect&gt; | <span class="literal">undefined</span></span>) =&gt; &#123;
    <span class="keyword">if</span> (effectsToAdd) &#123;
      effectsToAdd.<span class="title function_">forEach</span>(<span class="function"><span class="params">effect</span> =&gt;</span> &#123;
        <span class="comment">// é¿å…å¾ªç¯è§¦å‘ä¾èµ– ç±»ä¼¼`effect(() =&gt; obj.foo++)`</span>
        <span class="keyword">if</span> (effect !== activeEffect || effect.<span class="property">allowRecurse</span>) &#123;
          effects.<span class="title function_">add</span>(effect)
        &#125;
      &#125;)
    &#125;
  &#125;

  <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="title class_">TriggerOpTypes</span>.<span class="property">CLEAR</span>) &#123;
    <span class="comment">// åœ¨æ¸…ç©ºå‰ï¼Œå°†å¯¹åº”çš„ä¾èµ–å…¨éƒ¨æ·»åŠ åˆ°å±€éƒ¨Set</span>
    depsMap.<span class="title function_">forEach</span>(add)
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&#x27;length&#x27;</span> &amp;&amp; <span class="title function_">isArray</span>(target)) &#123;
    <span class="comment">// å½“æ•°ç»„çš„lengthå±æ€§å˜åŒ–æ—¶è§¦å‘</span>
    depsMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">dep, key</span>) =&gt;</span> &#123;
      <span class="keyword">if</span> (key === <span class="string">&#x27;length&#x27;</span> || key &gt;= (newValue <span class="keyword">as</span> <span class="built_in">number</span>)) &#123;
        <span class="title function_">add</span>(dep)
      &#125;
    &#125;)
  &#125; <span class="keyword">else</span> &#123;
    <span class="comment">// schedule runs for SET | ADD | DELETE</span>
    <span class="comment">// å¾€ç›¸åº”é˜Ÿåˆ—æ·»åŠ ä¾èµ–</span>
    <span class="keyword">if</span> (key !== <span class="built_in">void</span> <span class="number">0</span>) &#123;
      <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(key))
    &#125;

    <span class="comment">// also run for iteration key on ADD | DELETE | Map.SET</span>
    <span class="comment">// é€šè¿‡ä¸åŒçš„TriggerOpTypeså°†depsMapçš„æ•°æ®å–å‡ºï¼Œæ·»åŠ åˆ°effects</span>
    <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;
      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">ADD</span>:
        <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target)) &#123;
          <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))
          <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;
            <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">MAP_KEY_ITERATE_KEY</span>))
          &#125;
        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isIntegerKey</span>(key)) &#123;
          <span class="comment">// new index added to array -&gt; length changes</span>
          <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(<span class="string">&#x27;length&#x27;</span>))
        &#125;
        <span class="keyword">break</span>
      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">DELETE</span>:
        <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target)) &#123;
          <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))
          <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;
            <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">MAP_KEY_ITERATE_KEY</span>))
          &#125;
        &#125;
        <span class="keyword">break</span>
      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>:
        <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;
          <span class="title function_">add</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))
        &#125;
        <span class="keyword">break</span>
    &#125;
  &#125;

  <span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params">effect: ReactiveEffect</span>) =&gt; &#123;
    <span class="keyword">if</span> (__DEV__ &amp;&amp; effect.<span class="property">options</span>.<span class="property">onTrigger</span>) &#123;
      effect.<span class="property">options</span>.<span class="title function_">onTrigger</span>(&#123;
        effect,
        target,
        key,
        <span class="keyword">type</span>,
        newValue,
        oldValue,
        oldTarget
      &#125;)
    &#125;
    <span class="keyword">if</span> (effect.<span class="property">options</span>.<span class="property">scheduler</span>) &#123;
      <span class="comment">// å¦‚æœæœ‰è°ƒåº¦å±æ€§ï¼Œå°±é€šè¿‡schedulerå¤„ç†æ‰§è¡Œ</span>
      effect.<span class="property">options</span>.<span class="title function_">scheduler</span>(effect)
    &#125; <span class="keyword">else</span> &#123;
      <span class="title function_">effect</span>()
    &#125;
  &#125;

  effects.<span class="title function_">forEach</span>(run)
&#125;</code></pre>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>vue3å“åº”å¼æ˜¯é€šè¿‡æ•°æ®åŠ«æŒå’Œå‘å¸ƒè®¢é˜…çš„æ¨¡å¼è¿›è¡Œå¤„ç†ï¼Œé¦–å…ˆvue3ä¸­çš„æ•°æ®æ˜¯é€šè¿‡<code>proxy</code>åšäº†ä¸€å±‚ä»£ç†ï¼Œç„¶åå¤„ç†<code>proxy</code>çš„<code>handler</code>ï¼ŒåŸºæœ¬ç±»å‹çš„<code>handler</code>æ˜¯é€šè¿‡<code>baseHandlers</code>ï¼Œç‰¹æ®Šç±»å‹(mapï¼Œset)çš„<code>handler</code>æ˜¯é€šè¿‡<code>collectHandlers</code>ã€‚</li>
<li><code>handler</code>ä¸­è·å–å±æ€§çš„æ“ä½œé€šè¿‡<code>track</code>è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œä¿®æ”¹å±æ€§çš„æ“ä½œé€šè¿‡<code>trigger</code>è¿›è¡Œä¾èµ–è§¦å‘ï¼Œä¾èµ–çš„æ”¶é›†ä¸è§¦å‘æ˜¯é€šè¿‡ä¾èµ–ç®¡ç†ä¸­å¿ƒ<code>targetMap</code>ä¿å­˜çš„</li>
<li><code>track</code>è¿›è¡Œæ”¶é›†æ—¶ï¼Œä»–æ”¶é›†çš„æ˜¯<code>activeEffect</code>ï¼Œè¿™ä¸ªå˜é‡å­˜å‚¨çš„å°±æ˜¯æ­£åœ¨è§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œ<code>activeEffect</code>é€šè¿‡<code>effect()</code>æ–¹æ³•è¿›è¡Œæ”¶é›†</li>
<li><code>effect()</code>å¸¸ç”¨çš„ä¸‰ä¸ªåœ°æ–¹<ul>
<li>ç»„ä»¶å‰¯ä½œç”¨å‡½æ•°</li>
<li><code>watch</code></li>
<li><code>computed</code></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£æVue3patchæ ¸å¿ƒç®—æ³•patchKeyedChildren</title>
    <url>/2022/08/25/%E8%A7%A3%E6%9E%90Vue3patch%E6%A0%B8%E5%BF%83%E7%AE%97%E6%B3%95patchKeyedChildren/</url>
    <content><![CDATA[<h3 id="è§£æVue3patchæ ¸å¿ƒç®—æ³•patchKeyedChildren"><a href="#è§£æVue3patchæ ¸å¿ƒç®—æ³•patchKeyedChildren" class="headerlink" title="è§£æVue3patchæ ¸å¿ƒç®—æ³•patchKeyedChildren"></a>è§£æVue3patchæ ¸å¿ƒç®—æ³•patchKeyedChildren</h3><ul>
<li>locateï¼š<code>runtime-core &gt; renderer &gt; baseCreateRenderer &gt; patchKeyedChildren</code></li>
<li>patchKeyedChildrenæ˜¯patchç®—æ³•ä¸­è¾ƒä¸ºå¤æ‚çš„ä¸€æ®µï¼Œæ›´æ˜¯vueæŠ€æœ¯æ ˆé¢è¯•çš„é«˜é¢‘ç‚¹ï¼Œæœ€åˆæˆ‘æ˜¯åœ¨vue3.0 betaç‰ˆæœ¬æ—¶å¤§æ¦‚çœ‹è¿‡æºç ï¼Œåæ¥åœ¨ã€Švueè®¾è®¡ä¸åˆ†æã€‹ä¸­çœ‹äº†éœæ˜¥é˜³å¤§ä½¬çš„è§£æï¼Œæœ¬ç¯‡å°±ç®€è¦åˆ†æä¸€ä¸‹åšä¸ªè®°å½•</li>
<li>é¦–å…ˆpatchKeyedChildrenæ˜¯åœ¨å­åˆ—è¡¨å¯¹æ¯”å¹¶ä¸”æœ‰keyçš„æƒ…å†µä¼šè¿›å…¥ï¼Œå¹¶ä¸”é€»è¾‘å¤§è‡´åˆ†ä¸º5æ­¥ï¼Œè¿™ä¸ªçœ‹æºç å®˜æ–¹æ³¨é‡Šå°±å¯ä»¥çœ‹å‡º</li>
</ul>
<h4 id="ç¬¬ä¸€æ­¥ï¼Œä»å‰å‘åéå†"><a href="#ç¬¬ä¸€æ­¥ï¼Œä»å‰å‘åéå†" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œä»å‰å‘åéå†"></a>ç¬¬ä¸€æ­¥ï¼Œä»å‰å‘åéå†</h4><p>è¿™ä¸€æ­¥æ˜¯ä»èŠ‚ç‚¹ç»„å¤´éƒ¨å‘å°¾éƒ¨éå†ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­é‡åˆ°ç›¸ä¼¼èŠ‚ç‚¹ï¼Œå°±è¿›è¡Œpatchå¯¹æ¯”ï¼Œå¦åˆ™å°±é€€å‡ºéå†ï¼Œå¹¶è®°å½•å½“å‰éå†çš„æœ€æ–°ä¸‹æ ‡</p>
<pre><code class="highlight js"><span class="keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2) &#123;
  <span class="keyword">const</span> n1 = c1[i]
  <span class="keyword">const</span> n2 = (c2[i] = optimized
    ? <span class="title function_">cloneIfMounted</span>(c2[i] <span class="keyword">as</span> <span class="title class_">VNode</span>)
    : <span class="title function_">normalizeVNode</span>(c2[i]))
  <span class="keyword">if</span> (<span class="title function_">isSameVNodeType</span>(n1, n2)) &#123;
    <span class="title function_">patch</span>(
      n1,
      n2,
      container,
      <span class="literal">null</span>,
      parentComponent,
      parentSuspense,
      isSVG,
      slotScopeIds,
      optimized
    )
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">break</span>
  &#125;
  i++
&#125;</code></pre>

<h4 id="ç¬¬äºŒæ­¥ï¼Œä»åå‘å‰éå†"><a href="#ç¬¬äºŒæ­¥ï¼Œä»åå‘å‰éå†" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œä»åå‘å‰éå†"></a>ç¬¬äºŒæ­¥ï¼Œä»åå‘å‰éå†</h4><p>ä»åå‘å‰éå†ï¼Œå¦‚æœé‡åˆ°ç¬¬ä¸€æ­¥è®°å½•çš„ä¸‹æ ‡å°±åœæ­¢ï¼Œç„¶åéå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ç›¸ä¼¼èŠ‚ç‚¹ä¹Ÿæ˜¯ç›´æ¥è¿›è¡Œpatchå¯¹æ¯”ï¼Œå¦‚æœä¸ç›¸åŒå°±æ˜¯ç›´æ¥é€€å‡ºéå†ï¼Œå¹¶ä¸”è®°å½•æ—§èŠ‚ç‚¹ç»„å’Œæ–°èŠ‚ç‚¹ç»„çš„å°¾æŒ‡é’ˆ</p>
<pre><code class="highlight js"><span class="keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2) &#123;
  <span class="keyword">const</span> n1 = c1[e1]
  <span class="keyword">const</span> n2 = (c2[e2] = optimized
    ? <span class="title function_">cloneIfMounted</span>(c2[e2] <span class="keyword">as</span> <span class="title class_">VNode</span>)
    : <span class="title function_">normalizeVNode</span>(c2[e2]))
  <span class="keyword">if</span> (<span class="title function_">isSameVNodeType</span>(n1, n2)) &#123;
    <span class="title function_">patch</span>(
      n1,
      n2,
      container,
      <span class="literal">null</span>,
      parentComponent,
      parentSuspense,
      isSVG,
      slotScopeIds,
      optimized
    )
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">break</span>
  &#125;
  e1--
  e2--
&#125;</code></pre>

<h4 id="ç¬¬ä¸‰æ­¥ï¼Œæ£€æŸ¥æ—§èŠ‚ç‚¹ç»„"><a href="#ç¬¬ä¸‰æ­¥ï¼Œæ£€æŸ¥æ—§èŠ‚ç‚¹ç»„" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œæ£€æŸ¥æ—§èŠ‚ç‚¹ç»„"></a>ç¬¬ä¸‰æ­¥ï¼Œæ£€æŸ¥æ—§èŠ‚ç‚¹ç»„</h4><p>è¿™ä¸€æ­¥å°±æ˜¯æ£€æŸ¥æ—§èŠ‚ç‚¹ç»„åœ¨ä¸Šä¸¤æ­¥çš„éå†åæ˜¯å¦éå†å®Œï¼Œå¦‚æœéå†å®Œï¼Œé‚£ä¹ˆæ–°èŠ‚ç‚¹ç»„æ²¡æœ‰éå†å®Œçš„å°±éƒ½æ˜¯æ–°çš„domï¼Œå¯ä»¥å…¨éƒ¨å½“ä½œæ–°å¢èŠ‚ç‚¹è¿›è¡ŒæŒ‚è½½å¤„ç†</p>
<pre><code class="highlight js"><span class="keyword">if</span> (i &gt; e1) &#123;
  <span class="keyword">if</span> (i &lt;= e2) &#123;
    <span class="keyword">const</span> nextPos = e2 + <span class="number">1</span>
    <span class="keyword">const</span> anchor = nextPos &lt; l2 ? (c2[nextPos] <span class="keyword">as</span> <span class="title class_">VNode</span>).<span class="property">el</span> : parentAnchor
    <span class="keyword">while</span> (i &lt;= e2) &#123;
      <span class="comment">// patchç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œå°±æ˜¯ä»£è¡¨æ²¡æœ‰æ—§èŠ‚ç‚¹ï¼Œç›´æ¥å°†æ–°èŠ‚ç‚¹æ’å…¥</span>
      <span class="title function_">patch</span>(
        <span class="literal">null</span>,
        (c2[i] = optimized
          ? <span class="title function_">cloneIfMounted</span>(c2[i] <span class="keyword">as</span> <span class="title class_">VNode</span>)
          : <span class="title function_">normalizeVNode</span>(c2[i])),
        container,
        anchor,
        parentComponent,
        parentSuspense,
        isSVG,
        slotScopeIds,
        optimized
      )
      i++
    &#125;
  &#125;
&#125;</code></pre>

<h4 id="ç¬¬å››æ­¥ï¼Œæ£€æŸ¥æ–°èŠ‚ç‚¹ç»„"><a href="#ç¬¬å››æ­¥ï¼Œæ£€æŸ¥æ–°èŠ‚ç‚¹ç»„" class="headerlink" title="ç¬¬å››æ­¥ï¼Œæ£€æŸ¥æ–°èŠ‚ç‚¹ç»„"></a>ç¬¬å››æ­¥ï¼Œæ£€æŸ¥æ–°èŠ‚ç‚¹ç»„</h4><p>å¦‚æœä¸Šä¸€æ­¥æ£€æŸ¥æ—§èŠ‚ç‚¹æœªéå†å®Œï¼Œé‚£ä¹ˆå°±æ£€æŸ¥æ–°èŠ‚ç‚¹ç»„æ˜¯å¦éå†å®Œï¼Œå¦‚æœéå†å®Œï¼Œé‚£ä¹ˆæ—§çš„èŠ‚ç‚¹ç»„å‰©ä½™çš„èŠ‚ç‚¹è¯´æ˜éƒ½æ˜¯è¦å¸è½½çš„ï¼Œå› ä¸ºéƒ½ä¸éœ€è¦äº†</p>
<pre><code class="highlight js"><span class="keyword">else</span> <span class="keyword">if</span> (i &gt; e2) &#123;
  <span class="comment">// æ—§å­èŠ‚ç‚¹æœªè¢«éå†å®Œ</span>
  <span class="keyword">while</span> (i &lt;= e1) &#123;
    <span class="title function_">unmount</span>(c1[i], parentComponent, parentSuspense, <span class="literal">true</span>)
    i++
  &#125;
&#125;</code></pre>

<h4 id="ç¬¬äº”æ­¥ï¼ŒæœªçŸ¥åºåˆ—"><a href="#ç¬¬äº”æ­¥ï¼ŒæœªçŸ¥åºåˆ—" class="headerlink" title="ç¬¬äº”æ­¥ï¼ŒæœªçŸ¥åºåˆ—"></a>ç¬¬äº”æ­¥ï¼ŒæœªçŸ¥åºåˆ—</h4><ul>
<li>å¦‚æœæ–°æ—§èŠ‚ç‚¹ç»„éƒ½æœªéå†å®Œï¼Œè¯´æ˜å­˜åœ¨æœªçŸ¥åºåˆ—ï¼Œå¯èƒ½å­˜åœ¨ä½ç§»ç­‰æƒ…å†µï¼Œå°±éœ€è¦è¿›ä¸€æ­¥å¤„ç†</li>
<li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºè®°å½•æ–°æ—§èŠ‚ç‚¹çš„å¯¹åº”å…³ç³»<pre><code class="highlight js"><span class="comment">// toBePatchedæ˜¯æ–°åºåˆ—çš„èŠ‚ç‚¹æ•°é‡ e2 - s2 + 1</span>
<span class="keyword">const</span> newIndexToOldIndexMap = <span class="keyword">new</span> <span class="title class_">Array</span>(toBePatched)
<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; toBePatched; i++) newIndexToOldIndexMap[i] = <span class="number">0</span></code></pre></li>
<li>ç„¶åä¼šéå†æ—§èŠ‚ç‚¹ç»„ï¼Œè¿™é‡Œä¼šç”¨ä¸¤ä¸ªå˜é‡è®°å½•<ul>
<li><code>let moved = false</code>ï¼šä½ç§»æ ‡è¯†ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦ä½ç§»</li>
<li><code>let patched = 0</code>ï¼šè®°å½•å·²æ‰§è¡Œpatchçš„æ–°èŠ‚ç‚¹æ•°é‡ï¼Œç”¨äºå¤„ç†å¦‚æœåœ¨æ›´æ–°æ—¶æ›´æ–°è¿‡çš„æ•°é‡å¤§äºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹æ•°é‡ï¼Œå°±å¸è½½å¯¹åº”æ—§èŠ‚ç‚¹<pre><code class="highlight js"><span class="keyword">for</span> (i = s1; i &lt;= e1; i++) &#123;
  <span class="keyword">const</span> prevChild = c1[i]
  <span class="comment">// å¦‚æœå·²æ›´æ–°æ•°é‡å¤§äºæ–°èŠ‚ç‚¹æ•°é‡ï¼Œå°±å¸è½½èŠ‚ç‚¹</span>
  <span class="keyword">if</span> (patched &gt;= toBePatched) &#123;
    <span class="title function_">unmount</span>(prevChild, parentComponent, parentSuspense, <span class="literal">true</span>)
    <span class="keyword">continue</span>
  &#125;
  <span class="keyword">let</span> newIndex <span class="comment">//æ–°æ—§èŠ‚ç‚¹keyç›¸åŒçš„æ–°èŠ‚ç‚¹index</span>
  <span class="keyword">if</span> (prevChild.<span class="property">key</span> != <span class="literal">null</span>) &#123;
    newIndex = keyToNewIndexMap.<span class="title function_">get</span>(prevChild.<span class="property">key</span>)
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">for</span> (j = s2; j &lt;= e2; j++) &#123;
      <span class="keyword">if</span> (
        newIndexToOldIndexMap[j - s2] === <span class="number">0</span> &amp;&amp;
        <span class="title function_">isSameVNodeType</span>(prevChild, c2[j] <span class="keyword">as</span> <span class="title class_">VNode</span>)
      ) &#123;
        newIndex = j
        <span class="keyword">break</span>
      &#125;
    &#125;
  &#125;
  <span class="comment">// å¦‚æœnewIndexä¸ºç©ºï¼Œåˆ™è¯´æ˜æœªæ‰¾åˆ°ä¸æ—§èŠ‚ç‚¹å¯¹åº”çš„æ–°èŠ‚ç‚¹ï¼Œç›´æ¥å¸è½½</span>
  <span class="keyword">if</span> (newIndex === <span class="literal">undefined</span>) &#123;
    <span class="title function_">unmount</span>(prevChild, parentComponent, parentSuspense, <span class="literal">true</span>)
  &#125; <span class="keyword">else</span> &#123;
    <span class="comment">// æ›´æ–°æ–°æ—§èŠ‚ç‚¹å…³ç³»è¡¨</span>
    newIndexToOldIndexMap[newIndex - s2] = i + <span class="number">1</span>
    <span class="comment">/**</span>
<span class="comment">     * è¿™é‡Œçš„maxNexIndexSoFaræ˜¯è®°å½•æ¯æ¬¡patchæœ€å¤§index</span>
<span class="comment">     * ä¹Ÿæ˜¯ç”¨äºåˆ¤æ–­æ˜¯å¦äº§ç”Ÿäº†ä½ç§»ï¼Œå› ä¸ºå¦‚æœæ–°èŠ‚ç‚¹indexæ¯”æœ€å¤§indexå°ï¼Œå°±è¯´æ˜å‘ç”Ÿäº†ä½ç§»</span>
<span class="comment">     * ä¾‹å¦‚ï¼š</span>
<span class="comment">     *  (a b) c</span>
<span class="comment">     *  (a c  b)</span>
<span class="comment">     * åœ¨æ–°æ—§åºåˆ—å¯¹æ¯”bï¼Œcæ—¶ï¼Œç”±äºcæœ€æ–°çš„newIndexå·²ç»å°äºbå¯¹åº”çš„newIndexï¼Œå› æ­¤ä¼šè®°å½•éœ€è¦ä½ç§»</span>
<span class="comment">     */</span>
    <span class="keyword">if</span> (newIndex &gt;= maxNewIndexSoFar) &#123;
      maxNewIndexSoFar = newIndex
    &#125; <span class="keyword">else</span> &#123;
      moved = <span class="literal">true</span>
    &#125;
    <span class="title function_">patch</span>(
      prevChild,
      c2[newIndex] <span class="keyword">as</span> <span class="title class_">VNode</span>,
      container,
      <span class="literal">null</span>,
      parentComponent,
      parentSuspense,
      isSVG,
      slotScopeIds,
      optimized
    )
    patched++
  &#125;
&#125;</code></pre></li>
</ul>
</li>
<li>éå†å®Œæ—§åºåˆ—åï¼Œå°±éœ€è¦ç¡®å®šå¦‚ä½•ä½ç§»</li>
<li>é¦–å…ˆæ˜¯æ ¹æ®æ–°æ—§èŠ‚ç‚¹å…³ç³»è¡¨ç”Ÿæˆæœ€é•¿é€’å¢å­åºåˆ—(è¿™ä¸ªç®—æ³•å°±ä¸é™ˆè¿°äº†ï¼Œè¾ƒå¤æ‚ï¼Œå¯ä»¥çœ‹<a href="https://juejin.cn/post/6952674285311754276#comment">ç²¾è¯»ã€ŠDOM diff æœ€é•¿ä¸Šå‡å­åºåˆ—ã€‹</a>)ï¼Œç„¶åå€’åºéå†æ–°å­èŠ‚ç‚¹<pre><code class="highlight js"><span class="comment">// æœ€é•¿é€’å¢å­åºåˆ—</span>
<span class="keyword">const</span> increasingNewIndexSequence = moved
  ? <span class="title function_">getSequence</span>(newIndexToOldIndexMap)
  : <span class="variable constant_">EMPTY_ARR</span>
j = increasingNewIndexSequence.<span class="property">length</span> - <span class="number">1</span>
<span class="comment">// ä»æ–°åºåˆ—å°¾éƒ¨å‘å‰éå†ï¼Œç›®çš„æ˜¯ä¸ºäº†ä½¿ç”¨ä¸Šä¸€ä¸ªéå†çš„èŠ‚ç‚¹åšé”šç‚¹</span>
<span class="keyword">for</span> (i = toBePatched - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;
  <span class="keyword">const</span> nextIndex = s2 + i
  <span class="keyword">const</span> nextChild = c2[nextIndex] <span class="keyword">as</span> <span class="title class_">VNode</span>
  <span class="comment">// å¦‚æœæ˜¯åºåˆ—çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œanchorå°±æ˜¯çˆ¶èŠ‚ç‚¹å¯¹åº”çš„anchorï¼Œå¦åˆ™å°±æ˜¯ä¸Šä¸€ä¸ªå­èŠ‚ç‚¹</span>
  <span class="keyword">const</span> anchor =
    nextIndex + <span class="number">1</span> &lt; l2 ? (c2[nextIndex + <span class="number">1</span>] <span class="keyword">as</span> <span class="title class_">VNode</span>).<span class="property">el</span> : parentAnchor
  <span class="comment">// å¦‚æœnewIndexToOldIndexMap[i]è¿˜æ˜¯0ï¼Œé‚£ä¹ˆè¯´æ˜æ–°èŠ‚ç‚¹æ²¡æœ‰å¯¹åº”çš„æ—§èŠ‚ç‚¹ï¼Œè¯´æ˜æ˜¯æ–°èŠ‚ç‚¹ï¼Œç›´æ¥æŒ‚è½½</span>
  <span class="keyword">if</span> (newIndexToOldIndexMap[i] === <span class="number">0</span>) &#123;
    <span class="title function_">patch</span>(
      <span class="literal">null</span>,
      nextChild,
      container,
      anchor,
      parentComponent,
      parentSuspense,
      isSVG,
      slotScopeIds,
      optimized
    )
  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (moved) &#123;
    <span class="comment">// ç„¶ååœ¨movedä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœ€é•¿å­åºåˆ—ä¸ºç©ºæˆ–è€…æœ€é•¿å­åºåˆ—å’Œå½“å‰è®¿é—®çš„æ–°èŠ‚ç‚¹indexä¸åŒï¼Œè¯´æ˜å°±éœ€è¦è¿›è¡Œä½ç§»</span>
    <span class="keyword">if</span> (j &lt; <span class="number">0</span> || i !== increasingNewIndexSequence[j]) &#123;
      <span class="title function_">move</span>(nextChild, container, anchor, <span class="title class_">MoveType</span>.<span class="property">REORDER</span>)
    &#125; <span class="keyword">else</span> &#123;
      j--
    &#125;
  &#125;
&#125;</code></pre></li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºå‰ç«¯ç™»å½•æ¨¡å—è®¾è®¡</title>
    <url>/2022/09/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E7%AB%AF%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾®ä¿¡å°ç¨‹åºç™»å½•åŸºæœ¬ä¸Šæ˜¯æ¯ä¸ªå°ç¨‹åºéƒ½å¿…å¤‡çš„åŠŸèƒ½ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„é€æ¸å¤æ‚ï¼Œéœ€è¦è€ƒè™‘çš„æƒ…å†µä¼šè¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥ç™»å½•åŠŸèƒ½çš„å¥å£®å’Œé«˜æ•ˆæ˜¯å€¼å¾—é‡ç‚¹å…³æ³¨çš„ï¼Œæˆ‘ä¼šæŒ‰ç…§ä»¥å¾€ç»éªŒå®ç°ä¸€ä¸ªè¾ƒä¼˜é›…çš„ç™»å½•æ–¹æ¡ˆ</p>
<h2 id="åŸºæœ¬ç™»å½•æµç¨‹"><a href="#åŸºæœ¬ç™»å½•æµç¨‹" class="headerlink" title="åŸºæœ¬ç™»å½•æµç¨‹"></a>åŸºæœ¬ç™»å½•æµç¨‹</h2><ol>
<li>è·å–å¾®ä¿¡ç™»å½•å‡­è¯ï¼Œé€šè¿‡<code>wx.login</code>è·å–ï¼Œè¿™ä¸ªapiä¼šè¿”å›ä¸€ä¸ªå¸¦æœ‰æ—¶æ•ˆæ€§çš„code</li>
<li>å‘é€codeç»™æœåŠ¡ç«¯ï¼Œè¿™ä¸€æ­¥å°±æ˜¯é€šè¿‡ä½ å’Œåç«¯å®šä¹‰çš„æ¥å£å‘é€</li>
<li>æœåŠ¡ç«¯æ ¹æ®å‰ç«¯å‘é€çš„codeè·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œå½“ç„¶è¿™ä¸€æ­¥å°±ä¸æ˜¯å‰ç«¯çš„é€»è¾‘äº†</li>
<li>æœåŠ¡ç«¯å¤„ç†å®Œåï¼Œä¼šæŠŠç”¨æˆ·ä¿¡æ¯å’ŒsessinIdå‘é€ç»™å‰ç«¯ï¼Œç„¶åå‰ç«¯æŠŠéœ€è¦çš„ä¿¡æ¯è¿›è¡Œå­˜å‚¨ï¼Œæ¥ä¸‹æ¥çš„è¯·æ±‚å°±å¯ä»¥å¸¦ç€sessinIdæ¥è¡¨ç¤ºèº«ä»½</li>
<li>ä¸‹é¢æ˜¯å¾®ä¿¡å®˜æ–¹çš„æµç¨‹å›¾<br><img src="https://img-blog.csdnimg.cn/3b0b114c140247ebbc666b027dfbda66.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ol>
<h2 id="é€»è¾‘å°è£…"><a href="#é€»è¾‘å°è£…" class="headerlink" title="é€»è¾‘å°è£…"></a>é€»è¾‘å°è£…</h2><p>é’ˆå¯¹ä»¥ä¸Šç™»å½•æµç¨‹ï¼Œæˆ‘ä¼šå°è£…ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ä¾›ä¸šåŠ¡å±‚è°ƒç”¨</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><code>getLoginCode</code></td>
<td>è·å–å¾®ä¿¡ç™»å½•å‡­è¯</td>
</tr>
<tr>
<td><code>staticLogin</code></td>
<td>é™é»˜ç™»å½•</td>
</tr>
<tr>
<td><code>singleLogin</code></td>
<td>ç™»å½•è¯·æ±‚å°è£…</td>
</tr>
<tr>
<td><code>checkLogin</code></td>
<td>åˆ¤æ–­æ˜¯å¦ç™»å½•</td>
</tr>
<tr>
<td><code>getPhoneNum</code></td>
<td>è·å–å¾®ä¿¡æˆæƒæ‰‹æœºå·</td>
</tr>
</tbody></table>
<ul>
<li><p>æˆ‘ä¹ æƒ¯åœ¨promiseè¯·æ±‚ä¸­ä½¿ç”¨await-toæ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªé’ˆå¯¹å¼‚æ­¥æ¯”è¾ƒä¼˜é›…çš„æ–¹æ¡ˆ</p>
<ul>
<li><a href="https://blog.grossman.io/how-to-write-async-await-without-try-catch-blocks-in-javascript/">How to write async await without try-catch blocks in Javascript</a></li>
</ul>
</li>
<li><p>getLoginCodeï¼Œä¸€ä¸ªç®€å•çš„promiseå°è£…è·å–code</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getLoginCode</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;
      wx.<span class="title function_">login</span>(&#123;
        success (res) &#123;
          <span class="keyword">if</span> (res.<span class="property">code</span>) &#123;
            <span class="title function_">resolve</span>(res.<span class="property">code</span>)
          &#125; <span class="keyword">else</span> &#123;
            <span class="title function_">reject</span>(res)
          &#125;
        &#125;,
        <span class="title function_">fail</span>(<span class="params">err</span>) &#123;
          <span class="title function_">reject</span>(err)
        &#125;
      &#125;)
  &#125;)
&#125;</code></pre>
</li>
<li><p>é™é»˜ç™»å½•å°è£…ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œå­˜å‚¨</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">staticLogin</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;
  <span class="comment">// å¦‚æœå·²ç»ç™»å½•ï¼Œç›´æ¥è¿”å›ç™»å½•ä¿¡æ¯</span>
  <span class="keyword">if</span> (<span class="title function_">checkLogin</span>()) &#123;
    <span class="keyword">return</span> <span class="title function_">getLoginInfo</span>()
  &#125;
  <span class="keyword">const</span> [loginErr, loginRes] = <span class="keyword">await</span> <span class="title function_">_to</span>(<span class="title function_">singleLogin</span>());
  <span class="keyword">if</span> (loginErr) &#123;
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(loginErr);
  &#125;
  <span class="comment">// å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªå°±æ ¹æ®è‡ªå·±çš„æƒ…å†µäº†ï¼Œæˆ‘è¿™éšä¾¿å®šä¸ªæ–¹æ³•</span>
  <span class="title function_">setLoginInfo</span>(&#123;
    ...loginRes,
  &#125;)
  <span class="keyword">return</span> loginRes;
&#125;</code></pre>
</li>
<li><p>ç™»å½•è¯·æ±‚å°è£…ï¼Œè¿™é‡Œæˆ‘æ˜¯ç”¨å•ä¾‹æ¨¡å¼å¹¶è¿”å›äº†ä¸€ä¸ªpromiseï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†ï¼Œä½ å¤šæ¬¡è°ƒç”¨singleLoginæ—¶ï¼Œæ¯”å¦‚å¿«é€Ÿåˆ‡æ¢é¡µé¢ï¼Œå¿«é€Ÿç‚¹å‡»å¤šä¸ªéœ€ç™»å½•åŒºåŸŸï¼Œåœ¨æ•°æ®æ²¡æœ‰è¿”å›çš„æ—¶å€™ï¼Œéƒ½ä¼šç­‰å¾…ï¼Œè€Œä¸æ˜¯è§¦å‘å¤šæ¬¡è¯·æ±‚</p>
<pre><code class="highlight js"><span class="keyword">let</span> loginInstance = <span class="literal">null</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">singleLogin</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">if</span> (loginInstance) &#123;
    <span class="keyword">return</span> loginInstance
  &#125;
  <span class="comment">// loginReqï¼šå°è£…è¯·æ±‚ï¼ŒåŒ…æ‹¬è¯·æ±‚åç«¯å’ŒgetLoginCode</span>
  loginInstance = <span class="title function_">loginReq</span>()
  loginInstance.<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;
    loginInstance = <span class="literal">null</span>;
    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err);
  &#125;)
  <span class="keyword">return</span> loginInstance
&#125;</code></pre>
</li>
<li><p>checkLoginï¼Œæ£€æŸ¥æ˜¯å¦ç™»å½•ï¼Œè¿™ä¸ªå°±çœ‹ä½ å­˜å‚¨åœ¨é‚£ä¸ªåœ°æ–¹äº†ï¼Œè§†æƒ…å†µè€Œå®š</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">checkLogin</span> = (<span class="params"></span>) =&gt; &#123;
  <span class="keyword">return</span> <span class="title class_">Boolean</span>(loginInfo?.<span class="property">sid</span>)
&#125;</code></pre>
</li>
<li><p>getPhoneNum</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPhoneNum</span> = <span class="keyword">async</span> (<span class="params">iv, encryptedData</span>) =&gt; &#123;
  <span class="keyword">const</span> [codeErr, codeRes] = <span class="keyword">await</span> <span class="title function_">_to</span>(<span class="title function_">getLoginCode</span>())
  <span class="keyword">if</span> (codeErr) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(codeErr);
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(codeErr);
  &#125;
  <span class="comment">// decryptï¼šè¯·æ±‚åç«¯</span>
  <span class="keyword">const</span> [phoneErr, phoneRes] = <span class="keyword">await</span> <span class="title function_">_to</span>(<span class="title function_">decrypt</span>(&#123;
    iv,
    encryptedData,
    <span class="attr">code</span>: codeRes.<span class="property">code</span>
  &#125;))
  <span class="keyword">if</span> (phoneErr) &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(phoneErr);
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(phoneErr);
  &#125;
  <span class="keyword">const</span> phoneNumber = phoneRes.<span class="property">result</span>.<span class="property">phoneNumber</span>
  <span class="title function_">setLoginInfo</span>(&#123;
    phoneNumber,
  &#125;)
  <span class="keyword">return</span> phoneNumber
&#125;</code></pre></li>
</ul>
<h2 id="ä¸šåŠ¡å±‚"><a href="#ä¸šåŠ¡å±‚" class="headerlink" title="ä¸šåŠ¡å±‚"></a>ä¸šåŠ¡å±‚</h2><p>ä¸šåŠ¡å±‚æˆ‘ä¼šåœ¨ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹è°ƒç”¨</p>
<ol>
<li><p>è¯·æ±‚å‰æ ¹æ®optionsåˆ¤æ–­æ˜¯å¦éœ€ç™»å½•ï¼Œå¹¶è¿›è¡Œå¤„ç†</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">REQUEST</span> = <span class="keyword">async</span> (<span class="params">requestObj</span>) =&gt; &#123;
  <span class="comment">// isLogin å½“å‰æ¥å£è¯·æ±‚æ˜¯å¦éœ€è¦ç™»å½•</span>
  <span class="keyword">if</span> (requestObj.<span class="property">isLogin</span> &amp;&amp; !<span class="title function_">checkLogin</span>()) &#123;
    <span class="keyword">const</span> [loginErr, loginRes] = <span class="keyword">await</span> <span class="title function_">_to</span>(<span class="title function_">staticLogin</span>());
    <span class="keyword">if</span> (loginErr) &#123;
      <span class="title class_">Toast</span>(<span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>)
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(loginErr);
    &#125;
  &#125;
  ...
&#125;</code></pre>
</li>
<li><p>ç™»å½•æŒ‰é’®ï¼Œè¿™ä¸ªä¸»è¦ç”¨äºç™»å½•å¤±è´¥å…œåº•çš„æƒ…å†µï¼Œè®©ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»ï¼Œç”¨äºç™»å½•å¼¹çª—ç­‰ç»„ä»¶ï¼Œåªéœ€è°ƒç”¨<code>staticLogin</code>å³å¯</p>
</li>
<li><p>è·å–ç”¨æˆ·æˆæƒæ‰‹æœºå·æŒ‰é’®</p>
<pre><code class="highlight js"><span class="comment">// index.html</span>
<span class="comment">// ç”¨æˆ·ä¸»åŠ¨è§¦å‘è¿›è¡Œæˆæƒæ‰‹æœºå·</span>
&lt;button open-type=<span class="string">&quot;getPhoneNumber&quot;</span> bindgetphonenumber=<span class="string">&quot;bindPhoneNumber&quot;</span>&gt;
  <span class="language-xml"><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span>
&lt;/button&gt;

<span class="comment">// index.js</span>
<span class="keyword">async</span> <span class="title function_">bindPhoneNumber</span>(<span class="params">e</span>) &#123;
  <span class="keyword">const</span> iv = e.<span class="property">detail</span>.<span class="property">iv</span>;
  <span class="keyword">const</span> encryptedData = e.<span class="property">detail</span>.<span class="property">encryptedData</span>;
  <span class="keyword">const</span> [phoneErr, phoneRes] = <span class="keyword">await</span> <span class="title function_">_to</span>(<span class="title function_">getPhoneNum</span>(iv, encryptedData));
  <span class="keyword">if</span> (phoneErr) &#123;
    <span class="title class_">Toast</span>(<span class="string">&#x27;è·å–æ‰‹æœºå·å¤±è´¥&#x27;</span>);
    <span class="keyword">return</span>;
  &#125;
  <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&#x27;getPhoneNumber&#x27;</span>, phoneRes);
&#125;</code></pre>
</li>
<li><p>é¡µé¢ç»„ä»¶ï¼Œåœ¨å°ç¨‹åºä¸­ä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ªé¡µé¢ç»„ä»¶ï¼Œç”¨äºå°è£…ä¸€äº›é¡µé¢å¿…éœ€çš„åŠŸèƒ½ï¼Œæ¯”å¦‚loadingï¼Œå¯¼èˆªæ ï¼Œæ— æ•ˆé¡µé¢ç­‰ç­‰ï¼Œç™»å½•ä¹Ÿæ˜¯å¿…éœ€çš„ï¼Œæ‰€ä»¥æˆ‘æŠŠç™»å½•é€»è¾‘å°è£…åˆ°é¡µé¢ç»„ä»¶ä¸Šï¼Œå¦‚æœæˆåŠŸä¼šé€šè¿‡triggerEventè§¦å‘ç»™é¡µé¢ï¼Œå¦‚æœå¤±è´¥å°±å¼¹å‡ºç™»å½•å¼¹çª—ï¼Œå½“ç„¶è¿™ç§å¤„ç†ä¸å¤ªç»†ï¼Œæ ¹æ®ä¸šåŠ¡çš„ä¸åŒæ”¹å˜ç›¸å…³çš„é€»è¾‘<br><img src="https://img-blog.csdnimg.cn/f6cd710acc4d45a1a7d88042623ad4bc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
</ol>
<pre><code class="highlight js"><span class="comment">// index.html</span>
&lt;view&gt;
  ...
  &lt;login-modal show=&#123;loginShow&#125; &#123;...props&#125; /&gt;
&lt;/view&gt;

<span class="comment">// index.js</span>
<span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>) &#123;
  <span class="keyword">const</span> [loginErr, loginRes] = <span class="keyword">await</span> <span class="title function_">_to</span>(<span class="title function_">staticLogin</span>());
  <span class="keyword">if</span> (loginErr) &#123;
    <span class="title class_">Toast</span>(<span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>);
    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;
      <span class="attr">loginShow</span>: <span class="literal">true</span>,
    &#125;);
    <span class="keyword">return</span>;
  &#125;
  <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&#x27;login&#x27;</span>, loginRes);
&#125;</code></pre>
<ol start="5">
<li>è¿˜æœ‰ä¸€äº›ä¸æ˜¯å¤ªé€šç”¨çš„ä¸šåŠ¡ç»„ä»¶å°±ä¸å™è¿°äº†â€¦</li>
</ol>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£ænextTick---vue3ä»»åŠ¡è°ƒåº¦</title>
    <url>/2021/07/17/%E8%A7%A3%E6%9E%90nextTick-vue3%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/</url>
    <content><![CDATA[<h3 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h3><ul>
<li>å®šä¹‰ï¼šå°†å›è°ƒæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ª DOM æ›´æ–°å‘¨æœŸä¹‹åæ‰§è¡Œï¼Œåœ¨æ›´æ”¹äº†ä¸€äº›æ•°æ®ä»¥ç­‰å¾… DOM æ›´æ–°åç«‹å³ä½¿ç”¨å®ƒ</li>
<li>åœ¨å®é™…ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬æ˜¯ç”¨äºç»„ä»¶æ›´æ–°ï¼Œä½ éœ€è¦è·å–æ›´æ–°åçš„æ•°æ®ï¼Œæ‰€ä»¥ä½¿ç”¨nextTickç­‰å¾…DOMæ›´æ–°<pre><code class="highlight js"><span class="keyword">import</span> &#123; createApp, nextTick &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>
<span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;
    <span class="title function_">setup</span>(<span class="params"></span>) &#123;
      <span class="keyword">const</span> message = <span class="title function_">ref</span>(<span class="string">&#x27;Hello!&#x27;</span>)
      <span class="keyword">const</span> <span class="title function_">changeMessage</span> = <span class="keyword">async</span> newMessage =&gt; &#123;
        message.<span class="property">value</span> = newMessage
        <span class="comment">// è¿™é‡Œçš„valueæ˜¯æ—§å€¼</span>
        <span class="keyword">await</span> <span class="title function_">nextTick</span>()
        <span class="comment">// nextTickåè·å–çš„å°±æ˜¯DOMæ›´æ–°åçš„value</span>
        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Now DOM is updated&#x27;</span>)
      &#125;
    &#125;
&#125;)</code></pre></li>
<li>è¿™ä¸ªapiä½¿ç”¨æ—¶ç›¸å½“ç®€å•ï¼Œè€Œä¸”ç›¸å½“å®¹æ˜“ç†è§£ï¼Œä½†æ˜¯ä¸ºäº†çŸ¥å…¶æ„ï¼Œè¿˜æ˜¯è¦ç¿»ä¸€ä¸‹æºç äº†è§£å®ƒçš„æ‰§è¡Œæœºåˆ¶<pre><code class="highlight ts"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">nextTick</span>(<span class="params"></span>
<span class="params">  <span class="variable language_">this</span>: ComponentPublicInstance | <span class="built_in">void</span>,</span>
<span class="params">  fn?: () =&gt; <span class="built_in">void</span></span>
<span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;
  <span class="keyword">const</span> p = currentFlushPromise || resolvedPromise
  <span class="keyword">return</span> fn ? p.<span class="title function_">then</span>(<span class="variable language_">this</span> ? fn.<span class="title function_">bind</span>(<span class="variable language_">this</span>) : fn) : p
&#125;</code></pre></li>
<li>ä¸Šé¢æ˜¯vueæºç ä¸­nextTickçš„å®ç°ï¼Œä¸ºäº†ææ¸…æ¥šå®ç°é€»è¾‘ï¼Œå°±å¿…é¡»ææ‡‚<code>currentFlushPromise</code>è¿™ä¸ªå˜é‡çš„å«ä¹‰ï¼Œæ‰€ä»¥è¦ä»ä»»åŠ¡çš„è°ƒåº¦æœºåˆ¶å¼€å§‹åˆ†æ</li>
</ul>
<h3 id="ä»»åŠ¡è°ƒåº¦"><a href="#ä»»åŠ¡è°ƒåº¦" class="headerlink" title="ä»»åŠ¡è°ƒåº¦"></a>ä»»åŠ¡è°ƒåº¦</h3><p>é¦–å…ˆè¿™ä¸ªè°ƒåº¦æœºåˆ¶çš„åŠŸèƒ½åœ¨<code>runtime-core</code>çš„<code>scheduler</code>æ–‡ä»¶</p>
<ul>
<li><p>API</p>
<pre><code class="highlight ts"><span class="comment">// è¿™ä¸ªæ–‡ä»¶ä¼šæŠ›å‡ºä»¥ä¸‹å‡ ä¸ªAPIå‡½æ•°</span>
<span class="title function_">nextTick</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// å°†å‡½æ•°åœ¨ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåæ‰§è¡Œ</span>
<span class="title function_">queueJob</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// æ·»åŠ ä»»åŠ¡å¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—</span>
<span class="title function_">invalidateJob</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// åˆ é™¤ä»»åŠ¡</span>
<span class="title function_">queuePreFlushCb</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// æ·»åŠ å‰ç½®å›è°ƒå‡½æ•°å¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—</span>
<span class="title function_">queuePostFlushCb</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// æ·»åŠ åç½®å›è°ƒå‡½æ•°å¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—</span>
<span class="title function_">flushPreFlushCbs</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// æ‰§è¡Œå‰ç½®å›è°ƒå‡½æ•°</span>
<span class="title function_">flushPostFlushCbs</span>(<span class="params"></span>)&#123;&#125; <span class="comment">// æ‰§è¡Œåç½®å›è°ƒå‡½æ•°</span></code></pre></li>
<li><p>æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“å‡ ä¸ªå…³é”®å˜é‡</p>
<pre><code class="highlight ts"><span class="keyword">let</span> isFlushing = <span class="literal">false</span> <span class="comment">// æ˜¯å¦æ­£åœ¨æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span>
<span class="keyword">let</span> isFlushPending = <span class="literal">false</span> <span class="comment">// æ¸…é˜Ÿä»»åŠ¡å·²åˆ›å»ºï¼Œç­‰å¾…æ¸…ç©ºçŠ¶æ€</span>
<span class="keyword">const</span> <span class="attr">queue</span>: <span class="title class_">SchedulerJob</span>[] = [] <span class="comment">// ä»»åŠ¡é˜Ÿåˆ—</span>
<span class="keyword">let</span> flushIndex = <span class="number">0</span> <span class="comment">// å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ç´¢å¼•</span></code></pre></li>
<li><p>ç„¶åæˆ‘ä»¬ä»<code>queueJob</code>è¿™ä¸ªå‡½æ•°å¼€å§‹</p>
<pre><code class="highlight ts"><span class="comment">/* </span>
<span class="comment">  è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯å°†ä¸€ä¸ªä»»åŠ¡è¿›è¡Œå…¥é˜Ÿæ“ä½œ</span>
<span class="comment">  ç„¶ååœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹å¯åŠ¨queueFlush</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">queueJob</span>(<span class="params">job: SchedulerJob</span>) &#123;
    <span class="comment">/**</span>
<span class="comment">     * ä»»åŠ¡å¯å…¥é˜Ÿé€»è¾‘</span>
<span class="comment">     * 1. ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º</span>
<span class="comment">     * 2. å¾…å…¥é˜Ÿä»»åŠ¡ä¸èƒ½å­˜åœ¨äºä»»åŠ¡é˜Ÿåˆ—ä¸­(æŒ‰æƒ…å†µåˆ†æ)</span>
<span class="comment">     */</span>
    <span class="keyword">if</span> (
      (!queue.<span class="property">length</span> ||
        !queue.<span class="title function_">includes</span>(
          job,
          <span class="comment">/* </span>
<span class="comment">            åœ¨æ­£åœ¨æ¸…ç©ºé˜Ÿåˆ—ä¸”å½“å‰å¾…å…¥é˜Ÿä»»åŠ¡æ˜¯å¯ä»¥é€’å½’æ—¶ï¼Œ</span>
<span class="comment">            è¯´æ˜å½“å‰ä»»åŠ¡ä¸€å®šå’Œå½“å‰æ­£åœ¨æ‰§è¡Œä»»åŠ¡æ˜¯åŒä¸€ä»»åŠ¡ï¼Œæ‰€ä»¥+1ï¼Œ</span>
<span class="comment">            å°±æ˜¯ä¸ºäº†ä¿è¯å¾…å…¥é˜Ÿä»»åŠ¡å’Œæ­£åœ¨æ‰§è¡Œä»»åŠ¡ç›¸åŒï¼Œä½†ä¸èƒ½å’Œåé¢å¾…æ‰§è¡Œä»»åŠ¡ç›¸åŒ</span>
<span class="comment">           */</span>
          isFlushing &amp;&amp; job.<span class="property">allowRecurse</span> ? flushIndex + <span class="number">1</span> : flushIndex
        )) &amp;&amp;
      job !== currentPreFlushParentJob
    ) &#123;
      <span class="comment">// äºŒåˆ†æŸ¥æ‰¾ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®</span>
      <span class="keyword">const</span> pos = <span class="title function_">findInsertionIndex</span>(job)
      <span class="keyword">if</span> (pos &gt; -<span class="number">1</span>) &#123;
        queue.<span class="title function_">splice</span>(pos, <span class="number">0</span>, job)
      &#125; <span class="keyword">else</span> &#123;
        queue.<span class="title function_">push</span>(job)
      &#125;
      <span class="title function_">queueFlush</span>()
    &#125;
&#125;</code></pre>
</li>
<li><p><code>queueFlush</code></p>
<pre><code class="highlight ts"><span class="keyword">function</span> <span class="title function_">queueFlush</span>(<span class="params"></span>) &#123;
    <span class="comment">/**</span>
<span class="comment">      æ¸…é˜Ÿä»»åŠ¡åˆ›å»ºåç¦æ­¢å†æ¬¡åˆ›å»ºæ›´å¤šçš„æ¸…é˜Ÿä»»åŠ¡</span>
<span class="comment">      å› ä¸ºåœ¨å…¥é˜Ÿæ“ä½œå®Œæˆåï¼ŒflushJobsä¼šåœ¨ä¸€æ¬¡é€’å½’ä¸­å°†ä»»åŠ¡é˜Ÿåˆ—å…¨éƒ¨æ¸…ç©ºï¼Œæ‰€ä»¥åªéœ€è¦ä¸€æ¬¡æ¸…é˜Ÿä»»åŠ¡å³å¯</span>
<span class="comment">     */</span>
    <span class="keyword">if</span> (!isFlushing &amp;&amp; !isFlushPending) &#123;
      isFlushPending = <span class="literal">true</span>
      <span class="comment">/* </span>
<span class="comment">        æ¸…é˜Ÿä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œå¹¶è®°å½•ä¸‹å½“å‰æ¸…é˜Ÿä»»åŠ¡ï¼Œè¿™ä¸ªæ ‡è®°å¯ä»¥ç”¨äºnextTickåˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ï¼Œ</span>
<span class="comment">        è¯´æ˜nextTickçš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨æ¸…é˜Ÿä»»åŠ¡åçš„ï¼Œå…¶å®ä»è¿™ä¸ªåœ°æ–¹å°±å¯ä»¥ç†è§£nextTickçš„æ‰§è¡ŒåŸç†äº†</span>
<span class="comment">      */</span>
      currentFlushPromise = resolvedPromise.<span class="title function_">then</span>(flushJobs)
    &#125;
&#125;</code></pre>
</li>
<li><p><code>flushJobs</code></p>
<pre><code class="highlight ts"><span class="comment">// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span>
<span class="keyword">function</span> <span class="title function_">flushJobs</span>(<span class="params">seen?: CountMap</span>) &#123;
    isFlushPending = <span class="literal">false</span> <span class="comment">// å…³é—­æ¸…é˜Ÿä»»åŠ¡ç­‰å¾…çŠ¶æ€</span>
    isFlushing = <span class="literal">true</span> <span class="comment">// å¼€å¯æ­£åœ¨æ¸…ç©ºé˜Ÿåˆ—çŠ¶æ€</span>
    <span class="keyword">if</span> (__DEV__) &#123;
      seen = seen || <span class="keyword">new</span> <span class="title class_">Map</span>()
    &#125;

    <span class="comment">// æ¸…ç©ºå‰ç½®å›è°ƒä»»åŠ¡é˜Ÿåˆ—</span>
    <span class="title function_">flushPreFlushCbs</span>(seen)

    <span class="comment">/* </span>
<span class="comment">      ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ ¹æ®IDè¿›è¡Œæ’åºçš„åŸå› </span>
<span class="comment">        1. å› ä¸ºç»„ä»¶æ›´æ–°æ˜¯ä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶çš„ï¼Œè€Œä»»åŠ¡æ›´æ–°æ˜¯åœ¨æ•°æ®æºæ›´æ–°æ—¶è§¦å‘çš„ï¼Œæ‰€ä»¥ä¸ºäº†æ›´æ–°ä»»åŠ¡çš„é¡ºåºå°±éœ€è¦è¿›è¡Œæ’åº</span>
<span class="comment">        2. å¦‚æœåœ¨çˆ¶ç»„ä»¶æ›´æ–°æœŸé—´å·²ç»å¸è½½äº†ç»„ä»¶ï¼Œé‚£ä¹ˆå­ç»„ä»¶çš„æ›´æ–°ä»»åŠ¡å°±å¯ä»¥è·³è¿‡</span>
<span class="comment">    */</span>
    queue.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="title function_">getId</span>(a) - <span class="title function_">getId</span>(b))

    <span class="keyword">try</span> &#123;
      <span class="comment">// éå†ä»»åŠ¡é˜Ÿåˆ—</span>
      <span class="keyword">for</span> (flushIndex = <span class="number">0</span>; flushIndex &lt; queue.<span class="property">length</span>; flushIndex++) &#123;
        <span class="keyword">const</span> job = queue[flushIndex]
        <span class="keyword">if</span> (job &amp;&amp; job.<span class="property">active</span> !== <span class="literal">false</span>) &#123;
          <span class="keyword">if</span> (__DEV__ &amp;&amp; <span class="title function_">checkRecursiveUpdates</span>(seen!, job)) &#123;
            <span class="keyword">continue</span>
          &#125;
          <span class="comment">// æ‰§è¡Œå½“å‰ä»»åŠ¡</span>
          <span class="title function_">callWithErrorHandling</span>(job, <span class="literal">null</span>, <span class="title class_">ErrorCodes</span>.<span class="property">SCHEDULER</span>)
        &#125;
      &#125;
    &#125; <span class="keyword">finally</span> &#123;
      <span class="comment">// é‡ç½®å½“å‰ä»»åŠ¡ç´¢å¼•</span>
      flushIndex = <span class="number">0</span>
      <span class="comment">// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span>
      queue.<span class="property">length</span> = <span class="number">0</span>

      <span class="comment">// æ‰§è¡Œåç½®å›è°ƒä»»åŠ¡é˜Ÿåˆ—</span>
      <span class="title function_">flushPostFlushCbs</span>(seen)
        <span class="comment">// é‡ç½®æ¸…é˜Ÿä»»åŠ¡çš„çŠ¶æ€</span>
      isFlushing = <span class="literal">false</span>
      currentFlushPromise = <span class="literal">null</span>
      <span class="comment">/* </span>
<span class="comment">        å› ä¸ºæ¸…é˜Ÿä»»åŠ¡æ‰§è¡ŒæœŸé—´ä¹Ÿä¼šæœ‰ä»»åŠ¡å…¥é˜Ÿï¼Œæ‰€ä»¥ä¸ºäº†æ¸…é˜Ÿæ‰§è¡Œå®Œæˆ</span>
<span class="comment">        å°±éœ€è¦åˆ¤æ–­å„ä»»åŠ¡é˜Ÿåˆ—çš„é•¿åº¦ï¼Œç„¶åé€’å½’æ‰§è¡Œ</span>
<span class="comment">      */</span>
      <span class="keyword">if</span> (
        queue.<span class="property">length</span> ||
        pendingPreFlushCbs.<span class="property">length</span> ||
        pendingPostFlushCbs.<span class="property">length</span>
      ) &#123;
        <span class="title function_">flushJobs</span>(seen)
      &#125;
    &#125;
&#125;</code></pre></li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>nextTickçš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä»»åŠ¡é˜Ÿåˆ—(å‰ç½®ã€ä¸»ä»»åŠ¡ã€åç½®)æ¸…é™¤åçš„ï¼Œ<code>currentFlushPromise</code>æ˜¯æ¸…é˜Ÿä»»åŠ¡çš„promiseæ ‡è®°</li>
<li>ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œé¡ºåºï¼šæ‰§è¡Œå‰ç½®å›è°ƒä»»åŠ¡é˜Ÿåˆ— -&gt; æ‰§è¡Œä¸»ä»»åŠ¡é˜Ÿåˆ— -&gt; æ‰§è¡Œåç½®å›è°ƒä»»åŠ¡é˜Ÿåˆ—</li>
</ul>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢œè‰²é€‰æ‹©å™¨çš„çº¯JSå®ç°</title>
    <url>/2022/11/05/%E9%A2%9C%E8%89%B2%E9%80%89%E6%8B%A9%E5%99%A8%E7%9A%84%E7%BA%AFJS%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨é€›è®ºå›çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªæ–°APIï¼š<code>EyeDropper</code>ï¼Œä»…éœ€åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç„¶åè°ƒç”¨openæ–¹æ³•ï¼Œå°±å¯ä»¥å–åˆ°ä½ å±å¹•å†…æ‰€æœ‰å¯ä»¥å–åˆ°çš„é¢œè‰²ï¼Œå¯æƒœå…¼å®¹æ€§ä¸å¤ªè¡Œï¼Œåªæœ‰Chromeï¼ŒEdgeï¼ŒOperaæ”¯æŒï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Web/API/EyeDropper">MDNæ–‡æ¡£</a><br>çŸ¥é“äº†è¿™ä¸ªAPIåæˆ‘ä¹Ÿæœ‰äº†ä¸€ä¸ªæƒ³å®ç°å–è‰²å™¨çš„æƒ³æ³•ï¼Œå·¥ä½œæ‘¸é±¼æœŸé—´ğŸ‘»æŠ˜è…¾äº†å‡ å¤©æäº†å‡ºæ¥ï¼Œå®ç°æ­¥éª¤å¤§è‡´ä»¥ä¸‹å‡ æ­¥</p>
<ol>
<li>æ‰€éœ€é¡µé¢åˆ›å»ºå®ä¾‹ï¼Œåˆå§‹åŒ–æ‰€éœ€å±æ€§</li>
<li>éœ€å¼€å¯æ—¶è°ƒç”¨openæ–¹æ³•å¼€å¯å–è‰²å™¨ï¼Œç½‘é¡µæˆªå±ç”Ÿæˆcanvasï¼Œåˆå§‹åŒ–ç›‘å¬äº‹ä»¶å’Œæµ®åŠ¨å…ƒç´ (æ”¾å¤§é•œ)</li>
<li>é¼ æ ‡ç§»åŠ¨æ—¶æ ¹æ®åæ ‡è·å–é¢œè‰²æ•°æ®ä¿®æ”¹æ”¾å¤§é•œé¢œè‰²</li>
<li>é¼ æ ‡ç‚¹å‡»æˆ–è€…æŒ‰Escé”®åé”€æ¯</li>
</ol>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>é¢„è§ˆåœ°å€ï¼š<a href="https://songlh.top/page-color-picker/">https://songlh.top/page-color-picker/</a><br>githubï¼š<a href="https://github.com/LHRUN/page-color-picker">https://github.com/LHRUN/page-color-picker</a><br><img src="https://s1.ax1x.com/2022/11/05/xOoXo4.png"></p>
<h2 id="åˆå§‹åŒ–æ–¹æ³•"><a href="#åˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="åˆå§‹åŒ–æ–¹æ³•"></a>åˆå§‹åŒ–æ–¹æ³•</h2><p>åˆå§‹åŒ–æ–¹æ³•æ²¡ä»€ä¹ˆè¯´çš„ï¼Œå°±æ˜¯æŠŠéœ€è¦çš„å±æ€§å’Œæ–¹æ³•èµ‹å€¼ä¸€éåˆå§‹å€¼ï¼Œç„¶åæ¥æ”¶ä¸€ä¸ªé¼ æ ‡ç‚¹å‡»æ—¶çš„å›è°ƒ</p>
<pre><code class="highlight ts"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ColorPicker</span> &#123;
  <span class="attr">canvasContainer</span>: <span class="title class_">HTMLDivElement</span> | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// canvaså®¹å™¨å…ƒç´ </span>
  <span class="attr">canvas</span>: <span class="title class_">HTMLCanvasElement</span> | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// æˆªå±canvas</span>
  <span class="attr">context</span>: <span class="title class_">CanvasRenderingContext2D</span> | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// æˆªå±canvas[context]</span>
  <span class="attr">floatContainer</span>: <span class="title class_">HTMLDivElement</span> | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// é¼ æ ‡ç§»åŠ¨æ—¶çš„æµ®åŠ¨å®¹å™¨å…ƒç´ </span>
  onChange?: <span class="function">(<span class="params">color: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span> <span class="comment">// ç‚¹å‡»é¼ æ ‡åçš„å›è°ƒ</span>
  color = <span class="string">&#x27;&#x27;</span> <span class="comment">// é¢œè‰²å€¼</span>
  elementId = <span class="string">&#x27;&#x27;</span> <span class="comment">// å…ƒç´ å”¯ä¸€id</span>
  <span class="attr">colorArr</span>: &#123;
    <span class="attr">el</span>: <span class="title class_">HTMLDivElement</span>
    <span class="attr">row</span>: <span class="built_in">number</span>
    <span class="attr">col</span>: <span class="built_in">number</span>
  &#125;[] = [] <span class="comment">// æ”¾å¤§é•œé¢œè‰²æ•°ç»„</span>

  <span class="title function_">constructor</span>(<span class="params"></span>
<span class="params">    onChange?: (color: <span class="built_in">string</span>) =&gt; <span class="built_in">void</span> <span class="comment">// ç‚¹å‡»åå›è°ƒ</span></span>
<span class="params">  </span>) &#123;
    <span class="variable language_">this</span>.<span class="property">onChange</span> = onChange
  &#125;
  <span class="comment">// ...</span>
&#125;</code></pre>

<h2 id="å¼€å¯å–è‰²å™¨"><a href="#å¼€å¯å–è‰²å™¨" class="headerlink" title="å¼€å¯å–è‰²å™¨"></a>å¼€å¯å–è‰²å™¨</h2><p>å¼€å¯å–è‰²å™¨åˆ†ä¸º4æ­¥</p>
<ol>
<li>åˆå§‹åŒ–canvaså®¹å™¨</li>
<li>ç”Ÿæˆcanvasï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://www.npmjs.com/package/html2canvas">html2canvas</a></li>
<li>åˆå§‹åŒ–ç›‘å¬äº‹ä»¶</li>
<li>åˆ›å»ºæµ®åŠ¨å…ƒç´ </li>
</ol>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment">* å¼€å¯å–è‰²å™¨</span>
<span class="comment">*/</span>
<span class="title function_">open</span>(<span class="params"></span>) &#123;
  <span class="comment">// è·å–éšæœºid</span>
  <span class="variable language_">this</span>.<span class="property">elementId</span> = <span class="title function_">getId</span>()
  <span class="comment">// åˆå§‹åŒ–canvaså®¹å™¨</span>
  <span class="variable language_">this</span>.<span class="title function_">initContainer</span>()
  <span class="title function_">html2canvas</span>(<span class="variable language_">document</span>.<span class="property">body</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">canvas</span>) =&gt;</span> &#123;
    <span class="keyword">if</span> (canvas &amp;&amp; <span class="variable language_">this</span>.<span class="property">canvasContainer</span>) &#123;
      <span class="comment">// åˆå§‹åŒ–äº‹ä»¶</span>
      <span class="variable language_">this</span>.<span class="title function_">initEvent</span>(canvas)
      <span class="variable language_">this</span>.<span class="property">canvasContainer</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>
      <span class="variable language_">this</span>.<span class="property">canvasContainer</span>.<span class="title function_">appendChild</span>(canvas)
      <span class="variable language_">this</span>.<span class="property">canvas</span> = canvas
      <span class="variable language_">this</span>.<span class="property">context</span> = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)
      <span class="comment">// åˆ›å»ºæµ®åŠ¨å…ƒç´ </span>
      <span class="variable language_">this</span>.<span class="title function_">initFloatContainer</span>()
    &#125;
  &#125;)
&#125;</code></pre>
<ul>
<li><p>åˆå§‹åŒ–canvaså®¹å™¨</p>
<pre><code class="highlight ts"><span class="title function_">initContainer</span>(<span class="params"></span>) &#123;
  <span class="comment">// åˆ›å»ºå…ƒç´ æˆ‘å°è£…äº†ä¸€ä¸ªæ–¹æ³•</span>
  <span class="keyword">const</span> canvasContainer = <span class="title function_">createDocument</span>(
    <span class="string">&#x27;div&#x27;</span>,
    styleObj.<span class="property">canvasContainer</span>,
    <span class="variable language_">document</span>.<span class="property">body</span>
  )
  <span class="variable language_">this</span>.<span class="property">canvasContainer</span> = canvasContainer
  <span class="keyword">return</span> canvasContainer
&#125;

<span class="comment">/**</span>
<span class="comment"> * åˆ›å»ºå…ƒç´ </span>
<span class="comment"> * <span class="doctag">@param</span> elType å…ƒç´ ç±»å‹</span>
<span class="comment"> * <span class="doctag">@param</span> styleObj æ ·å¼å¯¹è±¡</span>
<span class="comment"> * <span class="doctag">@param</span> parent çˆ¶çº§å…ƒç´ </span>
<span class="comment"> * <span class="doctag">@returns</span> <span class="variable">element</span></span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> createDocument = &lt;T <span class="keyword">extends</span> keyof <span class="title class_">HTMLElementTagNameMap</span>&gt;(
  <span class="attr">elType</span>: T,
  <span class="attr">styleObj</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span> | <span class="built_in">number</span>&gt;,
  <span class="attr">parent</span>: <span class="title class_">HTMLElement</span> | <span class="title class_">DocumentFragment</span>
): <span class="title class_">HTMLElementTagNameMap</span>[T] =&gt; &#123;
  <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(elType)
  <span class="title class_">Object</span>.<span class="title function_">keys</span>(styleObj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;
    <span class="keyword">if</span> (<span class="title function_">isValidKey</span>(key, styleObj)) &#123;
      <span class="title class_">Reflect</span>.<span class="title function_">set</span>(el.<span class="property">style</span>, key, styleObj[key])
    &#125;
  &#125;)
  parent.<span class="title function_">appendChild</span>(el)
  <span class="keyword">return</span> el
&#125;</code></pre>
</li>
<li><p>åˆå§‹åŒ–äº‹ä»¶</p>
<pre><code class="highlight ts"><span class="comment">/**</span>
<span class="comment"> * åˆå§‹åŒ–äº‹ä»¶</span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">canvas</span></span>
<span class="comment"> */</span>
<span class="title function_">initEvent</span>(<span class="params">canvas: HTMLCanvasElement</span>) &#123;
  canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="variable language_">this</span>.<span class="property">canvasMouseMove</span>)
  canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">canvasMouseDown</span>)
  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>)
&#125;</code></pre>
</li>
<li><p>åˆ›å»ºæµ®åŠ¨å…ƒç´ å®¹å™¨</p>
<pre><code class="highlight js"><span class="title function_">initFloatCOntainer</span>(<span class="params"></span>) &#123;
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canvasContainer</span>) &#123;
    <span class="comment">// åˆ›å»ºæµ®åŠ¨å…ƒç´ å®¹å™¨</span>
    <span class="keyword">const</span> floatContainer = <span class="title function_">createDocument</span>(
      <span class="string">&#x27;div&#x27;</span>,
      styleObj.<span class="property">floatContainer</span>,
      <span class="variable language_">this</span>.<span class="property">canvasContainer</span>
    )

    <span class="comment">// åˆ›å»ºæ”¾å¤§é•œçš„å°é¢œè‰²å—</span>
    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>()
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="variable constant_">COLOR_ITEM_SIZE</span> * <span class="variable constant_">COLOR_ITEM_SIZE</span>; i++) &#123;
      <span class="keyword">const</span> row = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(i / <span class="variable constant_">COLOR_ITEM_SIZE</span>)
      <span class="keyword">const</span> col = i - (row - <span class="number">1</span>) * <span class="variable constant_">COLOR_ITEM_SIZE</span>
      <span class="keyword">const</span> <span class="attr">style</span>: <span class="title class_">Record</span>&lt;string, string | number&gt; = &#123;
        ...styleObj.<span class="property">colorItem</span>
      &#125;

      <span class="keyword">if</span> (row === <span class="number">6</span> &amp;&amp; col === <span class="number">6</span>) &#123;
        style.<span class="property">borderColor</span> = <span class="string">&#x27;#000000&#x27;</span>
      &#125;
      <span class="keyword">const</span> itemEl = <span class="title function_">createDocument</span>(<span class="string">&#x27;div&#x27;</span>, style, fragment)
      itemEl.<span class="title function_">setAttribute</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.elementId&#125;</span><span class="subst">$&#123;i&#125;</span>`</span>)
      <span class="variable language_">this</span>.<span class="property">colorArr</span>.<span class="title function_">push</span>(&#123;
        <span class="attr">el</span>: itemEl,
        row,
        col
      &#125;)
    &#125;
    floatContainer.<span class="title function_">appendChild</span>(fragment)
    <span class="keyword">const</span> textEl = <span class="title function_">createDocument</span>(<span class="string">&#x27;div&#x27;</span>, styleObj.<span class="property">text</span>, floatContainer)
    textEl.<span class="title function_">setAttribute</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.elementId&#125;</span>text`</span>)
    <span class="variable language_">this</span>.<span class="property">floatContainer</span> = floatContainer
  &#125;
&#125;</code></pre></li>
</ul>
<h2 id="é¼ æ ‡ç§»åŠ¨"><a href="#é¼ æ ‡ç§»åŠ¨" class="headerlink" title="é¼ æ ‡ç§»åŠ¨"></a>é¼ æ ‡ç§»åŠ¨</h2><ul>
<li>æ ¹æ®é¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡ï¼Œè®¡ç®—éœ€è¦å¤„ç†çš„é¢œè‰²åŒºåŸŸï¼Œç„¶åè°ƒç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/getImageData">CanvasRenderingContext2D.getImageData()</a>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªImageDataå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œå°±åŒ…å«RGBAæ•°æ®ï¼Œç„¶åæŠŠè¿™äº›æ•°æ®å±•ç¤ºåˆ°æ”¾å¤§é•œå…ƒç´ ä¸Šï¼Œå°±æœ‰äº†æ”¾å¤§çš„æ•ˆæœ<pre><code class="highlight ts">canvasMouseMove = <span class="function">(<span class="params">e: MouseEvent</span>) =&gt;</span> &#123;
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">context</span>) &#123;
    <span class="keyword">const</span> x = e.<span class="property">pageX</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>
    <span class="keyword">const</span> y = e.<span class="property">pageY</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>
    <span class="comment">// è·å–æ”¾å¤§é•œæ‰€éœ€åŒºåŸŸé¢œè‰²</span>
    <span class="keyword">const</span> colors = <span class="variable language_">this</span>.<span class="title function_">getColors</span>(x, y)
    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">floatContainer</span> &amp;&amp; colors) &#123;
      <span class="comment">// æ ¹æ®åæ ‡æ”¹å˜æ”¾å¤§é•œä½ç½®</span>
      <span class="variable language_">this</span>.<span class="property">floatContainer</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translate(<span class="subst">$&#123;e.pageX - <span class="number">82.5</span>&#125;</span>px, <span class="subst">$&#123;</span></span>
<span class="subst"><span class="string">        e.pageY - <span class="number">82.5</span></span></span>
<span class="subst"><span class="string">      &#125;</span>px )`</span>
      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">floatContainer</span>.<span class="property">style</span>.<span class="property">visibility</span> === <span class="string">&#x27;hidden&#x27;</span>) &#123;
        <span class="variable language_">this</span>.<span class="property">floatContainer</span>.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">&#x27;visible&#x27;</span>
      &#125;
      <span class="keyword">const</span> textEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.elementId&#125;</span>text`</span>)

      <span class="comment">// éå†æ¯ä¸ªé¢œè‰²å—ï¼Œä¿®æ”¹é¢œè‰²</span>
      <span class="keyword">for</span> (
        <span class="keyword">let</span> i = <span class="number">0</span>;
        i &lt; <span class="variable constant_">COLOR_ITEM_SIZE</span> * <span class="variable constant_">COLOR_ITEM_SIZE</span>;
        i++
      ) &#123;
        <span class="keyword">const</span> &#123; el, row, col &#125; = <span class="variable language_">this</span>.<span class="property">colorArr</span>[i]
        <span class="keyword">const</span> [r, g, b, a] = colors[i]
        <span class="comment">// toHexString rgbaè½¬16è¿›åˆ¶</span>
        <span class="keyword">const</span> hexStr = <span class="title function_">toHexString</span>(&#123; r, g, b, <span class="attr">a</span>: a / <span class="number">255</span> &#125;)

        <span class="comment">//  æœ€ä¸­é—´çš„é¢œè‰²ä¿å­˜èµ·æ¥</span>
        <span class="keyword">if</span> (row === <span class="number">6</span> &amp;&amp; col === <span class="number">6</span> &amp;&amp; textEl) &#123;
          textEl.<span class="property">textContent</span> = hexStr
          textEl.<span class="property">style</span>.<span class="property">color</span> = hexStr
          <span class="variable language_">this</span>.<span class="property">color</span> = hexStr
        &#125;

        el.<span class="property">style</span>.<span class="property">backgroundColor</span> = hexStr
      &#125;
    &#125;
  &#125;
&#125;

<span class="comment">/**</span>
<span class="comment"> * è·å–æ”¾å¤§é•œæ‰€éœ€åŒºåŸŸé¢œè‰²</span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">x</span></span>
<span class="comment"> * <span class="doctag">@param</span> <span class="variable">y</span></span>
<span class="comment"> * <span class="doctag">@returns</span></span>
<span class="comment"> */</span>
<span class="title function_">getColors</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">context</span>) &#123;
    <span class="keyword">const</span> &#123; data &#125; = <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">getImageData</span>(
      x - <span class="number">5</span>,
      y - <span class="number">5</span>,
      <span class="variable constant_">COLOR_ITEM_SIZE</span>,
      <span class="variable constant_">COLOR_ITEM_SIZE</span>
    )
    <span class="keyword">const</span> colors = []
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;
      colors.<span class="title function_">push</span>([data[i], data[i + <span class="number">1</span>], data[i + <span class="number">2</span>], data[i + <span class="number">3</span>]])
    &#125;
    <span class="keyword">return</span> colors
  &#125;
&#125;</code></pre></li>
</ul>
<h2 id="é¼ æ ‡ç‚¹å‡»"><a href="#é¼ æ ‡ç‚¹å‡»" class="headerlink" title="é¼ æ ‡ç‚¹å‡»"></a>é¼ æ ‡ç‚¹å‡»</h2><ul>
<li>é¼ æ ‡ç‚¹å‡»è§¦å‘å›è°ƒï¼Œé”€æ¯å…ƒç´ <pre><code class="highlight ts">canvasMouseDown = <span class="function">() =&gt;</span> &#123;
  <span class="variable language_">this</span>?.<span class="property">onChange</span>?.(<span class="variable language_">this</span>.<span class="property">color</span>)
  <span class="variable language_">this</span>.<span class="title function_">destroy</span>()
&#125;

<span class="title function_">destroy</span>(<span class="params"></span>) &#123;
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canvas</span>) &#123;
    <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="variable language_">this</span>.<span class="property">canvasMouseMove</span>)
    <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">canvasMouseDown</span>)
  &#125;
  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canvasContainer</span>) &#123;
    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>.<span class="property">canvasContainer</span>)
  &#125;
  <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onKeyDown</span>)
&#125;</code></pre></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»</p>
]]></content>
      <categories>
        <category>gallery</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>About Me</title>
    <url>/about/index.html</url>
    <content><![CDATA[<p>ğŸ‘‹ Hello there, Here is LHâ€™BLOG<br>ğŸ‘¨â€ğŸ’» Iâ€™m a Frontend Developer. I like to try new technologies and develop some interesting open source projects<br>ğŸ“œ I will write some tech blogs and life records<br>ğŸŒ± Iâ€™m currently learning english</p>
<h3 id="contact-me"><a href="#contact-me" class="headerlink" title="contact me"></a>contact me</h3><ul>
<li><a href="https://github.com/LHRUN">Github</a></li>
<li><a href="https://t.me/longhao_song">Telegram</a></li>
<li><a href="mailto:song.lhlh@gmail.com">song.lhlh@gmail.com</a><!-- + [SegmentFault](https://segmentfault.com/u/lh_s)</li>
<li><a href="https://blog.csdn.net/weixin_44719258">CSDN</a> </li>
<li><a href="https://juejin.cn/user/3949101499549518">æ˜é‡‘</a></li>
<li><a href="https://www.zhihu.com/people/wxae77cceaa49dcaf5">çŸ¥ä¹</a> â€“&gt;</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>&#39;tag&#39;</title>
    <url>/tag/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
</search>
