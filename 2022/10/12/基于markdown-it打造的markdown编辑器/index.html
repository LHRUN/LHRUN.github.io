<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="songlh">







<title>åŸºäºmarkdown-itæ‰“é€ çš„markdownç¼–è¾‘å™¨ | LH&#39;BLOG</title>



    <link rel="icon" href="/favicon.png">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/js/frame.js"></script>
    








<script type="text/javascript">
(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "jy4barl9vt");
</script>

  <meta name="generator" content="Hexo 6.2.0"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/">
          
            <img loading="lazy" class="logo-img" src="/logo.png" alt="logo_image">
          
        </a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/">Home</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/categories/gallery/">Posts</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/tags/Translate/">Translate</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/archives/">Archive</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/about/">About</a>
              </li> 
                   
          
          
            <li class="menu-item search-btn">
              <a href="#">Search</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </div>
</div>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
                
                    <span class="post-tag">
                        <a href="/tags/markdown/">
                            markdown
                        </a>
                    </span>    
                
                    <span class="post-tag">
                        <a href="/tags/markdown-it/">
                            markdown-it
                        </a>
                    </span>    
                           
            
        </div>
        <div class="post-title">
            
            
                åŸºäºmarkdown-itæ‰“é€ çš„markdownç¼–è¾‘å™¨
            
            
        </div>
        <span class="post-date">
            10æœˆ 12, 2022
        </span>
    </div>
    <div class="post-img">
        
            <img loading="lazy" src="https://s1.ax1x.com/2022/09/11/vXALvj.jpg" alt="featured_image">
              
    </div>
</div>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.6.0/styles/base16/gruvbox-light-medium.min.css">
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<div class="post-content">
    <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>markdown-itæ˜¯ä¸€ä¸ªç”¨æ¥è§£æmarkdownçš„åº“ï¼Œå®ƒå¯ä»¥å°†markdownç¼–è¯‘ä¸ºhtmlï¼Œç„¶åè§£ææ—¶markdown-itä¼šæ ¹æ®è§„åˆ™ç”Ÿæˆtokensï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰ï¼Œå°±é€šè¿‡ruleså‡½æ•°å¯¹tokenè¿›è¡Œå¤„ç†<br>æˆ‘ç°åœ¨åŸºäºmarkdown-itå·²å®Œæˆç¬¬ä¸€ç‰ˆç¼–è¾‘å™¨ï¼Œç°æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>å¿«æ·ç¼–è¾‘æŒ‰é’®</li>
<li>ä»£ç å—ä¸»é¢˜åˆ‡æ¢</li>
<li>åŒæ­¥æ»šåŠ¨</li>
<li>ç›®å½•åˆ—è¡¨ç”Ÿæˆ</li>
<li>å†…å®¹çŠ¶æ€ç¼“å­˜</li>
</ol>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>ç›®å‰å®ç°æ•ˆæœå¦‚ä¸‹<br><img src="https://s1.ax1x.com/2022/10/12/xaMejs.jpg"></p>
<p>é¢„è§ˆåœ°å€ï¼š<a href="https://lhrun.github.io/md-editor/">https://lhrun.github.io/md-editor/</a><br>repoï¼š<a target="_blank" rel="noopener" href="https://github.com/LHRUN/md-editor">https://github.com/LHRUN/md-editor</a> æ¬¢è¿starâ­ï¸</p>
<h2 id="ç¼–è¾‘å™¨è®¾è®¡"><a href="#ç¼–è¾‘å™¨è®¾è®¡" class="headerlink" title="ç¼–è¾‘å™¨è®¾è®¡"></a>ç¼–è¾‘å™¨è®¾è®¡</h2><ol>
<li>é¡µé¢å¸ƒå±€åˆ†å››éƒ¨åˆ†ï¼Œé¡¶éƒ¨æ˜¯å¿«æ·å·¥å…·æ ï¼Œç„¶åä¸»ä½“å†…å®¹åˆ†ä¸‰éƒ¨åˆ†ï¼Œç¼–è¾‘åŒºåŸŸ(textarea)ã€htmlå±•ç¤ºåŒºåŸŸã€ç›®å½•åˆ—è¡¨(å¯å±•ç¤ºéšè—)ï¼Œå› ä¸ºæˆ‘æ˜¯ç”¨reactå¼€å‘çš„ï¼Œæ‰€ä»¥htmlå­—ç¬¦ä¸²æˆ‘æ˜¯é€šè¿‡<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml">dangerouslySetInnerHTML</a>è®¾ç½®</li>
<li>markdown-itåˆå§‹åŒ–<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">MD</span> = <span class="keyword">new</span> <span class="title class_">MarkdownIt</span>(&#123;
  <span class="attr">html</span>: <span class="literal">true</span>, <span class="comment">// åœ¨æºç ä¸­å¯ç”¨HTMLæ ‡ç­¾</span>
  <span class="attr">linkify</span>: <span class="literal">true</span>, <span class="comment">// å°†ç±»ä¼¼URLçš„æ–‡æœ¬è‡ªåŠ¨è½¬æ¢ä¸ºé“¾æ¥</span>
  <span class="attr">breaks</span>: <span class="literal">true</span>, <span class="comment">// è½¬æ¢æ®µè½é‡Œçš„ &#x27;\n&#x27; åˆ° &lt;br&gt;</span>
  <span class="attr">highlight</span>: <span class="keyword">function</span> (<span class="params">str, lang</span>) &#123;
    <span class="keyword">return</span> <span class="title function_">highlightFormatCode</span>(str, lang)
  &#125;
&#125;)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItSub</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItSup</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItMark</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItDeflist</span>)
  .<span class="title function_">use</span>(<span class="title class_">MarkdownItTaskLists</span>)
  .<span class="title function_">use</span>(markdownItAbbr)
  .<span class="title function_">use</span>(markdownItFootnote)
  <span class="comment">// å…¶ä½™çš„markdownItæ’ä»¶...</span>

<span class="keyword">const</span> highlightFormatCode = (<span class="attr">str</span>: string, <span class="attr">lang</span>: string): <span class="function"><span class="params">string</span> =&gt;</span> &#123;
  <span class="keyword">if</span> (lang &amp;&amp; hljs.<span class="title function_">getLanguage</span>(lang)) &#123;
    <span class="keyword">try</span> &#123;
      <span class="keyword">return</span> <span class="title function_">codeBlockStyle</span>(hljs.<span class="title function_">highlight</span>(lang, str, <span class="literal">true</span>).<span class="property">value</span>)
    &#125; <span class="keyword">catch</span> (e) &#123;
      <span class="variable language_">console</span>.<span class="title function_">error</span>(e)
    &#125;
  &#125;

  <span class="keyword">return</span> <span class="title function_">codeBlockStyle</span>(<span class="variable constant_">MD</span>.<span class="property">utils</span>.escapeHtml(str))
&#125;

<span class="keyword">const</span> codeBlockStyle = (<span class="attr">val</span>: string): <span class="function"><span class="params">string</span> =&gt;</span> &#123;
  <span class="keyword">return</span> <span class="string">`&lt;pre class=&quot;hljs&quot; style=&quot;padding: 10px;border-radius: 10px;&quot;&gt;&lt;code&gt;<span class="subst">$&#123;val&#125;</span>&lt;/code&gt;&lt;/pre&gt;`</span>
&#125;</code></pre></li>
</ol>
<h2 id="å¿«æ·ç¼–è¾‘æŒ‰é’®"><a href="#å¿«æ·ç¼–è¾‘æŒ‰é’®" class="headerlink" title="å¿«æ·ç¼–è¾‘æŒ‰é’®"></a>å¿«æ·ç¼–è¾‘æŒ‰é’®</h2><p>å¿«æ·ä¾¿æ·æŒ‰é’®ä¸»è¦æ˜¯é€šè¿‡åˆ¤æ–­textareaçš„å…‰æ ‡ä½ç½®ï¼Œç„¶åé€šè¿‡å…‰æ ‡ä½ç½®æ”¹å˜ç¼–è¾‘å™¨æ–‡æœ¬å†…å®¹ï¼Œæ¯”å¦‚æ·»åŠ å›¾ç‰‡</p>
<pre><code class="highlight js"><span class="comment">// è·å–å…‰æ ‡ä½ç½®</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getCursorPosition</span> = (<span class="params">editor: HTMLTextAreaElement</span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; selectionStart, selectionEnd &#125; = editor
  <span class="keyword">return</span> [selectionStart, selectionEnd]
&#125;

<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">addImage</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  source: string,</span>
<span class="params">  setSource: (v: string) =&gt; <span class="keyword">void</span></span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> [start, end] = <span class="title function_">getCursorPosition</span>(editor)
  <span class="keyword">let</span> val = source
  <span class="keyword">if</span> (start === end) &#123;
    val = <span class="string">`<span class="subst">$&#123;source.slice(<span class="number">0</span>, start)&#125;</span>\n![å›¾ç‰‡æè¿°](url)\n<span class="subst">$&#123;source.slice(end)&#125;</span>`</span>
  &#125; <span class="keyword">else</span> &#123;
    val = <span class="string">`<span class="subst">$&#123;source.slice(<span class="number">0</span>, start)&#125;</span>\n![<span class="subst">$&#123;source.slice(</span></span>
<span class="subst"><span class="string">      start,</span></span>
<span class="subst"><span class="string">      end</span></span>
<span class="subst"><span class="string">    )&#125;</span>](url)\n<span class="subst">$&#123;source.slice(end)&#125;</span>`</span>
  &#125;
  <span class="title function_">setSource</span>(val)
&#125;</code></pre>

<h2 id="ä»£ç å—ä¸»é¢˜åˆ‡æ¢"><a href="#ä»£ç å—ä¸»é¢˜åˆ‡æ¢" class="headerlink" title="ä»£ç å—ä¸»é¢˜åˆ‡æ¢"></a>ä»£ç å—ä¸»é¢˜åˆ‡æ¢</h2><ul>
<li>ä»£ç å—é«˜äº®æˆ‘æ˜¯é‡‡ç”¨äº†<strong>highlight.js</strong>ï¼Œå› ä¸ºè¿™ä¸ªåº“æä¾›äº†å¾ˆå¤šä¸»é¢˜æ ·å¼ï¼Œæ‰€ä»¥ä¸»é¢˜åˆ‡æ¢ï¼Œæˆ‘åªéœ€è¦æ”¹å˜css linkå³å¯<pre><code class="highlight js"><span class="comment">// codeThemeå°±æ˜¯å·²é€‰çš„ä¸»é¢˜åå­—</span>
<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;
  <span class="keyword">if</span> (codeTheme) &#123;
    <span class="title function_">switchLink</span>(
      <span class="string">&#x27;code-style&#x27;</span>,
      <span class="string">`https://cdn.bootcdn.net/ajax/libs/highlight.js/11.6.0/styles/<span class="subst">$&#123;codeTheme&#125;</span>.min.css`</span>
    )
  &#125;
&#125;, [codeTheme])

<span class="comment">/**</span>
<span class="comment"> * åˆ‡æ¢html css link</span>
<span class="comment"> * <span class="doctag">@param</span> key link key æŒ‡å®šå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåˆ‡æ¢link</span>
<span class="comment"> * <span class="doctag">@param</span> href link href</span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">switchLink</span> = (<span class="params">key: string, href: string</span>) =&gt; &#123;
  <span class="keyword">const</span> head = <span class="variable language_">document</span>.<span class="property">head</span>
  <span class="keyword">const</span> oldLink = head.<span class="title function_">getElementsByClassName</span>(key)
  <span class="keyword">if</span> (oldLink.<span class="property">length</span>) head.<span class="title function_">removeChild</span>(oldLink[<span class="number">0</span>])

  <span class="keyword">const</span> newLink = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;link&#x27;</span>)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;rel&#x27;</span>, <span class="string">&#x27;stylesheet&#x27;</span>)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/css&#x27;</span>)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;class&#x27;</span>, key)
  newLink.<span class="title function_">setAttribute</span>(<span class="string">&#x27;href&#x27;</span>, href)
  newLink.<span class="property">onerror</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;
    <span class="variable language_">console</span>.<span class="title function_">error</span>(e)
    message.<span class="title function_">error</span>(<span class="string">&#x27;è·å–css linkå¤±è´¥&#x27;</span>)
  &#125;
  head.<span class="title function_">appendChild</span>(newLink)
&#125;</code></pre></li>
</ul>
<h2 id="åŒæ­¥æ»šåŠ¨"><a href="#åŒæ­¥æ»šåŠ¨" class="headerlink" title="åŒæ­¥æ»šåŠ¨"></a>åŒæ­¥æ»šåŠ¨</h2><p>åŒæ­¥æ»šåŠ¨æ˜¯æˆ‘è®¤ä¸ºæœ€éš¾æçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºæˆ‘ä¸æƒ³ä»…ä»…é€šè¿‡ç™¾åˆ†æ¯”æ¥è®¡ç®—æ»šåŠ¨è·ç¦»ï¼Œå› ä¸ºè¿™æ ·çš„è¯å¦‚æœç¼–è¾‘åŒºåŸŸæ·»åŠ äº†ä¸€å †å›¾ç‰‡ï¼Œé¢„è§ˆå°±ä¼šæœ‰éå¸¸å¤§çš„é«˜åº¦å·®ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†è®¸å¤šæ–¹æ¡ˆï¼Œæœ€åå‘ç°markdown-itçš„å®˜æ–¹å®ç°æ˜¯æˆ‘èƒ½æ‰¾åˆ°å¹¶èƒ½å®ç°çš„æœ€ä½³æ–¹æ¡ˆï¼Œå¤§è‡´å®ç°æ€è·¯æ˜¯å¦‚ä¸‹</p>
<ol>
<li><p>é¦–å…ˆåœ¨ç¼–è¯‘æ—¶å¯¹æ ‡é¢˜å…ƒç´ å’Œæ®µè½å…ƒç´ æ·»åŠ è¡Œå·</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * æ³¨å…¥è¡Œå·</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="attr">injectLineNumbers</span>: <span class="title class_">Renderer</span>.<span class="property">RenderRule</span> = <span class="function">(<span class="params"></span></span>
<span class="params"><span class="function">  tokens,</span></span>
<span class="params"><span class="function">  idx,</span></span>
<span class="params"><span class="function">  options,</span></span>
<span class="params"><span class="function">  _env,</span></span>
<span class="params"><span class="function">  slf</span></span>
<span class="params"><span class="function"></span>) =&gt;</span> &#123;
  <span class="keyword">let</span> line
  <span class="keyword">if</span> (tokens[idx].<span class="property">map</span> &amp;&amp; tokens[idx].<span class="property">level</span> === <span class="number">0</span>) &#123;
    line = (tokens[idx].<span class="property">map</span> <span class="keyword">as</span> [number, number])[<span class="number">0</span>]
    tokens[idx].<span class="title function_">attrJoin</span>(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;line&#x27;</span>)
    tokens[idx].<span class="title function_">attrSet</span>(<span class="string">&#x27;data-line&#x27;</span>, <span class="title class_">String</span>(line))
  &#125;
  <span class="keyword">return</span> slf.<span class="title function_">renderToken</span>(tokens, idx, options)
&#125;

<span class="variable constant_">MD</span>.<span class="property">renderer</span>.<span class="property">rules</span>.<span class="property">heading_open</span> = <span class="variable constant_">MD</span>.<span class="property">renderer</span>.<span class="property">rules</span>.<span class="property">paragraph_open</span> = injectLineNumbers</code></pre>
</li>
<li><p>æ»šåŠ¨å‰è®¡ç®—å‡ºå½“å‰ç¼–è¾‘åŒºåŸŸæ¯è¡Œå¯¹åº”çš„é¢„è§ˆåç§»è·ç¦»ï¼Œæœ‰æ ‡è®°è¡Œå·çš„å…ƒç´ ç›´æ¥è®¡ç®—offsetï¼Œæœªæ ‡è®°è¡Œå·çš„å…ƒç´ å°±ç­‰æ¯”è®¡ç®—</p>
<pre><code class="highlight js"><span class="comment">/**</span>
<span class="comment"> * è·å–ç¼–è¾‘åŒºåŸŸæ¯è¡Œå¯¹åº”çš„é¢„è§ˆåç§»è·ç¦»</span>
<span class="comment"> * <span class="doctag">@param</span> editor ç¼–è¾‘å…ƒç´ </span>
<span class="comment"> * <span class="doctag">@param</span> review é¢„è§ˆå…ƒç´ </span>
<span class="comment"> * <span class="doctag">@returns</span> number[]</span>
<span class="comment"> */</span>
<span class="keyword">const</span> <span class="title function_">buildScrollMap</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  review: HTMLDivElement</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">const</span> <span class="attr">lineHeightMap</span>: number[] = []
  <span class="keyword">let</span> linesCount = <span class="number">0</span> <span class="comment">// ç¼–è¾‘åŒºæ€»è¡Œæ•°</span>

  <span class="comment">/**</span>
<span class="comment">   * ä¸´æ—¶åˆ›å»ºå…ƒç´ è·å–æ¯æ¬¡æ¢è¡Œä¹‹é—´çš„æ€»è¡Œæ•°</span>
<span class="comment">   */</span>
  <span class="keyword">const</span> sourceLine = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)
  sourceLine.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">&#x27;hidden&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;auto&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;editor.clientWidth&#125;</span>px`</span>
  sourceLine.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&#x27;15px&#x27;</span>
  sourceLine.<span class="property">style</span>.<span class="property">lineHeight</span> = <span class="string">`<span class="subst">$&#123;LINE_HEIGHT&#125;</span>px`</span>
  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(sourceLine)
  <span class="keyword">let</span> acc = <span class="number">0</span>
  editor.<span class="property">value</span>.<span class="title function_">split</span>(<span class="string">&#x27;\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">str</span>) =&gt;</span> &#123;
    lineHeightMap.<span class="title function_">push</span>(acc)
    <span class="keyword">if</span> (str.<span class="property">length</span> === <span class="number">0</span>) &#123;
      acc++
      <span class="keyword">return</span>
    &#125;
    sourceLine.<span class="property">textContent</span> = str
    <span class="keyword">const</span> h = sourceLine.<span class="property">offsetHeight</span>
    acc += <span class="title class_">Math</span>.<span class="title function_">round</span>(h / <span class="variable constant_">LINE_HEIGHT</span>)
  &#125;)
  sourceLine.<span class="title function_">remove</span>()
  lineHeightMap.<span class="title function_">push</span>(acc)
  linesCount = acc

  <span class="comment">// æœ€ç»ˆè¾“å‡ºçš„åç§»map</span>
  <span class="keyword">const</span> <span class="attr">_scrollMap</span>: number[] = <span class="keyword">new</span> <span class="title class_">Array</span>(linesCount).<span class="title function_">fill</span>(-<span class="number">1</span>)

  <span class="comment">/**</span>
<span class="comment">   * è·å–æ ‡è®°è¡Œå·çš„offsetè·ç¦»</span>
<span class="comment">   */</span>
  <span class="keyword">const</span> nonEmptyList = []
  nonEmptyList.<span class="title function_">push</span>(<span class="number">0</span>)
  _scrollMap[<span class="number">0</span>] = <span class="number">0</span>
  <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.line&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;
    <span class="keyword">let</span> <span class="attr">t</span>: string | number = el.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-line&#x27;</span>) <span class="keyword">as</span> string
    <span class="keyword">if</span> (t === <span class="string">&#x27;&#x27;</span>) &#123;
      <span class="keyword">return</span>
    &#125;
    t = lineHeightMap[<span class="title class_">Number</span>(t)]
    <span class="keyword">if</span> (t !== <span class="number">0</span>) &#123;
      nonEmptyList.<span class="title function_">push</span>(t)
    &#125;
    _scrollMap[t] = <span class="title class_">Math</span>.<span class="title function_">round</span>((el <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="property">offsetTop</span> - review.<span class="property">offsetTop</span>)
  &#125;)

  nonEmptyList.<span class="title function_">push</span>(linesCount)
  _scrollMap[linesCount] = review.<span class="property">scrollHeight</span>

  <span class="comment">/**</span>
<span class="comment">   * æœªæ ‡è®°è¡Œå·çš„å…ƒç´ ç­‰æ¯”è®¡ç®—</span>
<span class="comment">   */</span>
  <span class="keyword">let</span> pos = <span class="number">0</span>
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; linesCount; i++) &#123;
    <span class="keyword">if</span> (_scrollMap[i] !== -<span class="number">1</span>) &#123;
      pos++
      <span class="keyword">continue</span>
    &#125;
    <span class="keyword">const</span> a = nonEmptyList[pos]
    <span class="keyword">const</span> b = nonEmptyList[pos + <span class="number">1</span>]
    _scrollMap[i] = <span class="title class_">Math</span>.<span class="title function_">round</span>(
      (_scrollMap[b] * (i - a) + _scrollMap[a] * (b - i)) / (b - a)
    )
  &#125;

  <span class="keyword">return</span> _scrollMap
&#125;</code></pre>
</li>
<li><p>ç¼–è¾‘åŒºåŸŸæ»šåŠ¨æ ¹æ®å…·ä½“è¡Œè·å–éœ€æ»šåŠ¨é«˜åº¦</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">editorScroll</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  preview: HTMLDivElement</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">if</span> (!scrollMap) &#123;
    scrollMap = <span class="title function_">buildScrollMap</span>(editor, preview)
  &#125;

  <span class="keyword">const</span> lineNo = <span class="title class_">Math</span>.<span class="title function_">floor</span>(editor.<span class="property">scrollTop</span> / <span class="variable constant_">LINE_HEIGHT</span>)
  <span class="keyword">const</span> posTo = scrollMap[lineNo]
  preview.<span class="title function_">scrollTo</span>(&#123; <span class="attr">top</span>: posTo &#125;)
&#125;</code></pre></li>
<li><p>é¢„è§ˆåŒºåŸŸæ»šåŠ¨æ ¹æ®å½“å‰çš„æ»šåŠ¨é«˜åº¦æŸ¥å¯¹åº”ç¼–è¾‘åŒºåŸŸçš„è¡Œï¼Œç„¶åæ ¹æ®è®¡ç®—æ»šåŠ¨é«˜åº¦</p>
<pre><code class="highlight js"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">previewScroll</span> = (<span class="params"></span>
<span class="params">  editor: HTMLTextAreaElement,</span>
<span class="params">  preview: HTMLDivElement</span>
<span class="params"></span>) =&gt; &#123;
  <span class="keyword">if</span> (!scrollMap) &#123;
    scrollMap = <span class="title function_">buildScrollMap</span>(editor, preview)
  &#125;

  <span class="keyword">const</span> lines = <span class="title class_">Object</span>.<span class="title function_">keys</span>(scrollMap)
  <span class="keyword">if</span> (lines.<span class="property">length</span> &lt; <span class="number">1</span>) &#123;
    <span class="keyword">return</span>
  &#125;
  <span class="keyword">let</span> line = lines[<span class="number">0</span>]
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; lines.<span class="property">length</span>; i++) &#123;
    <span class="keyword">if</span> (scrollMap[<span class="title class_">Number</span>(lines[i])] &lt; preview.<span class="property">scrollTop</span>) &#123;
      line = lines[i]
      <span class="keyword">continue</span>
    &#125;
    <span class="keyword">break</span>
  &#125;
  editor.<span class="title function_">scrollTo</span>(&#123; <span class="attr">top</span>: <span class="variable constant_">LINE_HEIGHT</span> * <span class="title class_">Number</span>(line) &#125;)
&#125;</code></pre></li>
</ol>
<h3 id="åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹"><a href="#åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹" class="headerlink" title="åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹"></a>åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹</h3><ol>
<li>åœ¨æ”¹å˜ç¼–è¾‘å†…å®¹å’Œçª—å£å¤§å°æ—¶éœ€æ¸…ç©ºè®¡ç®—ç»“æœï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä¸€æ”¹å˜ï¼Œæ¯è¡Œçš„åç§»è·ç¦»å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨æ»šåŠ¨æ—¶éœ€è¦é‡æ–°è®¡ç®—</li>
<li>åŒæ­¥æ»šåŠ¨æ—¶ä¼šæœ‰ä¸€ä¸ªæ— é™è§¦å‘çš„é—®é¢˜ï¼Œå› ä¸ºç¼–è¾‘åŒºåŸŸæ»šåŠ¨ï¼Œä¼šè§¦å‘é¢„è§ˆåŒºåŸŸçš„<code>scrollTo()</code>ï¼Œç„¶åé¢„è§ˆåŒºåŸŸçš„æ»šåŠ¨ç›‘å¬æ–¹æ³•å°±ä¼šè¢«è§¦å‘ï¼Œç„¶åè¿™æ ·å°±ä¼šæ— é™è§¦å‘ä¸‹å»ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå˜é‡è®°ä½å½“å‰çš„æ‰‹åŠ¨æ»šåŠ¨çš„åŒºåŸŸï¼Œè¿›è¡Œé™åˆ¶</li>
</ol>
<h2 id="ç›®å½•åˆ—è¡¨ç”Ÿæˆ"><a href="#ç›®å½•åˆ—è¡¨ç”Ÿæˆ" class="headerlink" title="ç›®å½•åˆ—è¡¨ç”Ÿæˆ"></a>ç›®å½•åˆ—è¡¨ç”Ÿæˆ</h2><p>ç›®å½•åˆ—è¡¨é€šè¿‡rulesçš„<code>heading_open</code>æ–¹æ³•ï¼Œè·å–å½“å‰æ ‡é¢˜çš„tokenï¼Œç„¶åé€šè¿‡tokenå¾—å‡ºæ ‡é¢˜çš„å…·ä½“å†…å®¹è¿›è¡Œæ‹¼æ¥ï¼Œæœ€åæ ¹æ®levelè®¡ç®—å­—ä½“å¤§å°</p>
<ul>
<li>è·å–æ ‡é¢˜å†…å®¹<pre><code class="highlight js"><span class="keyword">const</span> <span class="title function_">getTitle</span> = (<span class="params">tokens: Token[], idx: number</span>) =&gt; &#123;
  <span class="keyword">const</span> &#123; children &#125; = tokens[idx + <span class="number">1</span>]
  <span class="keyword">const</span> &#123; markup &#125; = tokens[idx]
  <span class="keyword">const</span> val = children?.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span><span class="subst">$&#123;cur.content&#125;</span>`</span>, <span class="string">&#x27;&#x27;</span>) || <span class="string">&#x27;&#x27;</span>
  toc.<span class="title function_">push</span>(&#123;
    val,
    <span class="attr">level</span>: markup.<span class="property">length</span>
  &#125;)
&#125;</code></pre></li>
<li>htmlå±•ç¤º<pre><code class="highlight js">&#123;showToc &amp;&amp; (
  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.toc&#125;</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.tocTitle&#125;</span>&gt;</span>ç›®å½•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span>
<span class="language-xml">      &#123;tocList.map((&#123; val, level &#125;, index) =&gt; &#123;</span>
<span class="language-xml">        const fontSize = ((7 - level) / 10) * 40</span>
<span class="language-xml"></span>
<span class="language-xml">        return (</span>
<span class="language-xml">          <span class="tag">&lt;<span class="name">div</span></span></span>
<span class="tag"><span class="language-xml">            <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span>
<span class="tag"><span class="language-xml">              <span class="attr">marginLeft:</span> `$&#123;<span class="attr">level</span> * <span class="attr">10</span>&#125;<span class="attr">px</span>`,</span></span>
<span class="tag"><span class="language-xml">              <span class="attr">fontSize:</span> `$&#123;<span class="attr">fontSize</span> &gt;</span> 12 ? fontSize : 12&#125;px`</span>
<span class="language-xml">            &#125;&#125;</span>
<span class="language-xml">            key=&#123;index&#125;</span>
<span class="language-xml">          &gt;</span>
<span class="language-xml">            &#123;val&#125;</span>
<span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">        )</span>
<span class="language-xml">      &#125;)&#125;</span>
<span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
<span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
)&#125;</code></pre></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯èƒ½å®Œæˆçš„æœ‰ç‚¹ç²—ç³™ï¼Œä»¥åæœ‰æ—¶é—´ç»§ç»­å®Œå–„ç»†èŠ‚ï¼Œæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºğŸ‘»</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_67393295/article/details/123220722">æ‰‹æŠŠæ‰‹å¸¦ä½ 10åˆ†é’Ÿæ‰‹æ’¸ä¸€ä¸ªç®€æ˜“çš„Markdownç¼–è¾‘å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/markdown-it/markdown-it/blob/master/support/demo_template/index.js">markdown-it.github.io</a></li>
</ul>

</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
                <div class="icon arrow-left"></div>
                <div class="post-link">
                    <a href="/2022/10/30/%E5%89%8D%E7%AB%AF%E7%9A%84Docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">Prev</a>
                </div>
            
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/2022/09/21/%E5%9F%BA%E4%BA%8Ecanvas%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%A4%9A%E5%8A%9F%E8%83%BD%E7%94%BB%E6%9D%BF/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

    <!-- <div class="post-toc">
  <div class="post-toc-wrap">
    <div class="post-toc-title">ç›®å½•</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E8%A7%88"><span class="toc-text">é¢„è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%99%A8%E8%AE%BE%E8%AE%A1"><span class="toc-text">ç¼–è¾‘å™¨è®¾è®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E6%8D%B7%E7%BC%96%E8%BE%91%E6%8C%89%E9%92%AE"><span class="toc-text">å¿«æ·ç¼–è¾‘æŒ‰é’®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%9D%97%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2"><span class="toc-text">ä»£ç å—ä¸»é¢˜åˆ‡æ¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E6%BB%9A%E5%8A%A8"><span class="toc-text">åŒæ­¥æ»šåŠ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E6%BB%9A%E5%8A%A8%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-text">åŒæ­¥æ»šåŠ¨æ³¨æ„ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90"><span class="toc-text">ç›®å½•åˆ—è¡¨ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
  </div>
</div>

<script>
  const tocLinks = document.querySelectorAll('.toc-link')
  tocLinks.forEach((el) => {
    el.setAttribute('href', `#${el.innerText}`)
  })
</script>
 -->
    
      <div class="post-comment">

     

    
        <div id="disqus_thread"></div>
        <script>
            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
            
            var disqus_config = function () {
                this.page.url = 'https://lhrun.github.io/2022/10/12/%E5%9F%BA%E4%BA%8Emarkdown-it%E6%89%93%E9%80%A0%E7%9A%84markdown%E7%BC%96%E8%BE%91%E5%99%A8/';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = '2022/10/12/åŸºäºmarkdown-itæ‰“é€ çš„markdownç¼–è¾‘å™¨/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                this.language = 'en'
            };
            
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://lhblog-1.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>   
     
    
    

</div>
     
  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
            
            
                Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
                
        </div>
    </div>
</div>

    </div>

    
      <div class="search-popup">
    <div class="search-popup-overlay">  
    </div>
    <div class="search-popup-window" >
        <div class="search-header">
            <div class="search-input-container">
              <input autocomplete="off" autocapitalize="off" maxlength="80"
                     placeholder="Search Anything" spellcheck="false"
                     type="search" class="search-input">
            </div>
            <div class="search-close-btn">
                <div class="icon close-btn"></div>
            </div>
        </div>
        <div class="search-result-container">
        </div>
    </div>
</div>

<script>
    const searchConfig = {
        path             : "/search.xml",
        top_n_per_article: "1",
        unescape         : "false",
        trigger: "auto",
        preload: "false"
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script>
<script src="/js/search.js"></script>
    
    

  </body>
</html>
